<div id="ordrgView" class="popup_area of_a" style="width: 100%; height: 100%;">
	<div class="tit_contents">
		<h4 class="tit">발주서 조회</h4>
	</div>
	<div class="popup_table">
		<form id="popForm">
			<input type="hidden" id="pgmId"       name="pgmId"       value="OD0102V01">
			<input type="hidden" id="pgmNm"       name="pgmNm"       value="발주서조회 및 확정">
			<input type="hidden" id="ordrgSeq"    name="ordrgSeq">
			<input type="hidden" id="reqDt"       name="reqDt">
			<input type="hidden" id="reqSeq"      name="reqSeq">  <!-- 구매요청번호 -->
			<input type="hidden" id="whClntCd"    name="whClntCd">
			<input type="hidden" id="whType"      name="whType">
			<input type="hidden" id="odrCreatDiv" name="odrCreatDiv">
			
			<!--재고주체가 자사인경우 거래처 창고의 거래처-->
<!-- 			<input type="hidden" id="trspTypCd"   name="trspTypCd" value="TRSPTYP1"> -->
			<!--정상거래로 인식-->
			<input type="hidden" id="prjctCd"     name="prjctCd"> 
			<input type="hidden" id="prjctNm"     name="prjctNm">
			<table>
				<colgroup>
					<col width="12%">
					<col width="">
					<col width="12%">
					<col width="">
					<col width="12%">
					<col width="">
				</colgroup>
				<tr>
					<th>회사</th>
					<td>
						<input type="hidden" id="coCd" name="coCd">
						<input type="text" id="coNm" name="coNm" readonly>
					</td>
					<th>판매유형</th>
					<td>
						<input type="hidden" id="typCd" name="typCd">
						<input type="text" id="typNm" name="typNm" readonly>
					</td>
					<th>직송여부</th>
					<td>
						<input type="text" id="dirtrsYn" name="dirtrsYn" readonly>
					</td>
				</tr>
				<tr>
					<th>매입거래처</th>
					<td>
						<input type="hidden" id="clntCd" name="clntCd">
						<input type="text" id="clntNm" name="clntNm" readonly>
					</td>
					<th>재고주체</th>
					<td>
						<input type="hidden" id="ownerCd" name="ownerCd">
						<input type="text" id="ownerNm" name="ownerNm" readonly>
					</td>
					<th>매출거래처</th>
					<td>
						<input type="hidden" id="sellClntCd" name="sellClntCd">
						<input type="text" id="sellClntNm" name="sellClntNm" readonly>
					</td>
				</tr>
				<tr>
					<th>거래유형</th>
					<td>
						<input type="hidden" id="trspTypCd" name="trspTypCd">
						<input type="text" id="trspTypNm" name="trspTypNm" readonly>
					</td>
					<th>입고창고</th>
					<td>
						<input type="hidden" id="whCd" name="whCd">
						<input type="text" id="whNm" name="whNm" readonly>
					</td>
					<th>계산서발행법인</th>
					<td>
						<input type="hidden" id="taxivcCoprt" name="taxivcCoprt">
						<input type="text" id="taxivcCoprtNm" name="taxivcCoprtNm" readonly>
					</td>
				</tr>
				<tr>
					<th>수입여부</th>
					<td>
						<input type="text" id="impYn" name="impYn" readonly>
					</td>
					<th>현장명</th>
					<td>
						<input type="hidden" id="siteCd" name="siteCd">
						<input type="text" id="siteNm" name="siteNm" readonly>
					</td>
					<th>판매지역</th>
					<td>
						<input type="hidden" id="salesAreaCd" name="salesAreaCd">
						<input type="text" id="salesAreaNm" name="salesAreaNm" readonly>
					</td>
				</tr>
				<tr>				
					<th>Maker</th>
					<td>
						<input type="hidden" id="makrCd" name="makrCd">
						<input type="text" id="makrNm" name="makrNm" readonly>
					</td>
					<th>착지연락처</th>
					<td>
						<input type="text" id="mngTel" name="mngTel" readonly>
					</td>
					<th>출하일자</th>
					<td>
						<input type="text" id="dlvrDttm" name="dlvrDttm" readonly>
					</td>
				</tr>
				<tr>
					<th>주문번호</th>
					<td>
						<input type="text" id="odrSeq" name="odrSeq" readonly>
					</td>				
					<th>운송비</th>
					<td>
						<input type="text" id="transAmt" name="transAmt" comma readonly>
					</td>
					<th>영업담당자</th>
					<td>
						<input type="hidden" id="salesMng" name="salesMng">
						<input type="text" id="salesMngNm" name="salesMngNm" readonly>
					</td>
				</tr>
				<tr>
					<th>착지 주소</th>
					<td>
						<input type="text" id="addrZip" name="addrZip" readonly>
					</td>
					<td colspan="2" style="border-left: 0px !important;">
						<input type="text" id="addrMain" name="addrMain" readonly>
					</td>
					<td colspan="2">
						<input type="text" id="addrSub" name="addrSub" readonly>
					</td>
				</tr>
				<tr>
					<th>매입비고</th>
					<td colspan="5">
						<textarea class="form-control" id="ordrgRmk" name="ordrgRmk" style="height: 60px;" maxlength="500" readonly></textarea>
					</td>
				</tr>
				<tr>
					<th>매출비고</th>
					<td colspan="5">
						<textarea class="form-control" id="dlvrRmk" name="dlvrRmk" style="height: 60px;" maxlength="500" readonly></textarea>
					</td>
				</tr>
			</table>
		</form>
	</div>

	<br>
	<!-- 테이블 -->
	<div class="popup_table">
		<table>
			<tr>
				<td colspan="13" style="text-align: LEFT; border-right: 0;">※상세내역</td>
			</tr>
		</table>
		<div class="ofx_s" style="width: 100%;">
			<table id="detailTable" style="width: 1700px;">
				<colgroup>
					<col width="2%">
					<col width="2%">  <!-- 매입확정 -->
					<col width="2%">  <!-- 매출확정 -->
					<col width="15%"> <!-- 제품명 -->
					<col width="7%">  <!-- SIZE -->
					<col width="7%">  <!-- SPEC-->
					<col width="5%">  <!-- 길이 -->
					<col width="5%">  <!-- 단위 -->
					<col width="5%">  <!-- 발주지시 수량-->
					<col width="5%">  <!-- 발주지시 중량-->
					<col width="5%">  <!-- 발주지시 단가-->
					<col width="5%">  <!-- 매출 단가-->
					<col width="7%">  <!-- 발주지시 금액-->
					<col width="7%">  <!-- 매출 금액-->
					<col width="7%">  <!-- 발주지시 손익-->
					<col width="7%">  <!-- 완료일자 -->
					<col width="7%">  <!-- 차량번호 -->
				</colgroup>
				<tr>
					<th class="tc" style="padding: 3px;"> 
						<input type="checkbox" id="allChkBox" onchange="ctrlDetailChkBox(this);">
					</th>
					<th class="tc pd0">매입</th>
					<th class="tc pd0">매출</th>
					<th class="tc">제품명</th>
					<th class="tc">사이즈</th>
					<th class="tc">SPEC</th>
					<th class="tc">길이</th>
					<th class="tc">단위</th>
					<th class="tc">수량</th>
					<th class="tc pd0">중량(KG)</th>
					<th class="tc">발주단가</th>
					<th class="tc">매출단가</th>
					<th class="tc">금액</th>
					<th class="tc">매출금액</th>
					<th class="tc">예상손익</th>
					<th class="tc">완료일자</th>
					<th class="tc">차량번호</th>
				</tr>
			</table>
			<table id="frameTable" style="display: none;">
				<tr name="detailRow">
					<input type="hidden" name="ordrgDtlSeq">
					<input type="hidden" name="odrDtlSeq"> 
			        <input type="hidden" name="reqSeq">     <!-- 구매요청 번호 -->
					<input type="hidden" name="reqDtlSeq">  <!-- 구매요청 상세번호 -->
					<input type="hidden" name="prdtDiv">
					<input type="hidden" name="prdtStkn">
					<input type="hidden" name="prdtErqkYn">
					<input type="hidden" name="prdtCoilYn">
					<input type="hidden" name="pchsUpr">
					<input type="hidden" name="sellUpr">
					<input type="hidden" name="stockUpr">
					<input type="hidden" name="prdtUpr">
					<input type="hidden" name="prdtCnvrsnWt">
<!-- 					<input type="hidden" name="ordrgWt"> -->
					<input type="hidden" name="prdtStockCd">
<!-- 					<input type="hidden" name="ordrgYn"> 매입확정여부 -->
<!-- 					<input type="hidden" name="shipYn">  매출확정여부 -->
					<input type="hidden" name="ordrgProcId">
					<input type="hidden" name="ordrgProcNm">
					<input type="hidden" name="realDlvrQty">
					<input type="hidden" name="realDlvrWt">
					<input type="hidden" name="realDlvrUpr">
					<input type="hidden" name="realDlvrAmt">
					<td>
						<input type="checkbox" name="detailChkBox" onclick="ctrlAllChkBox();">
					</td>
					<td>
						<input type="text" class="tc" name="ordrgYn" readonly>
					</td>
					<td>
						<input type="text" class="tc" name="shipYn" readonly>
					</td>
					<td>
						<input type="hidden" name="prdtCd">
						<input type="text" name="prdtNm" readonly>
					</td>
					<td>
						<input type="text" class="tc" name="prdtSize" readonly>
					</td>
					<td>
						<input type="text" class="tc" name="prdtSpec" readonly>
					</td>
					<td>
						<input type="text" class="tr" name="prdtLen" readonly>
					</td>
					<td>
						<input type="hidden" name="prdtUnit">
						<input type="text" class="tc" name="prdtUnitNm" readonly>
					</td>
					<td>
						<input type="text" class="tr" name="ordrgQty" comma readonly>
					</td>
					<td>
						<input type="text" class="tr" name="ordrgWt" comma readonly>
					</td>
					<td>
						<input type="text" class="tr" name="ordrgUpr" comma readonly>
					</td>
					<td>
						<input type="text" class="tr" name="shipUpr" comma readonly>
					</td>
					<td>
						<input type="text" class="tr" name="ordrgAmt" value="0" comma readonly>
					</td>
					<td>
						<input type="text" class="tr" name="shipAmt" value="0" comma readonly>
					</td>
					<td>
						<input type="text" class="tr" name="epctPal" value="0" readonly comma>
					</td>
					<td>
						<input type="text" class="tc" name="ordrgProcDttm" readonly>
					</td>
					<td>
						<input type="text" name="shipVehNo" readonly>
					</td>
				</tr>
			</table>
			<table style="width: 1700px;">
				<colgroup>
					<col width="2%">
					<col width="2%">  <!-- 매입확정 -->
					<col width="2%">  <!-- 매출확정 -->
					<col width="15%"> <!-- 제품명 -->
					<col width="7%">  <!-- SIZE -->
					<col width="7%">  <!-- SPEC-->
					<col width="5%">  <!-- 길이 -->
					<col width="5%">  <!-- 단위 -->
					<col width="5%">  <!-- 발주지시 수량-->
					<col width="5%">  <!-- 발주지시 중량-->
					<col width="5%">  <!-- 발주지시 단가-->
					<col width="5%">  <!-- 매출 단가-->
					<col width="7%">  <!-- 발주지시 금액-->
					<col width="7%">  <!-- 매출 금액-->
					<col width="7%">  <!-- 발주지시 손익-->
					<col width="7%">  <!-- 완료일자 -->
					<col width="7%">  <!-- 차량번호 -->
				</colgroup>
				<tr>
					<th class="tc" colspan="8">합계</th>
					<td>
						<input class="tr" type="text" id="totQty" name="totQty" comma readonly>
					</td>
					<td>
						<input class="tr" type="text" id="totWt" name="totWt" comma readonly>
					</td>
					<td>-</td>
					<td>-</td>
					<td>
						<input class="tr" type="text" id="totAmt" name="totAmt" comma readonly>
					</td>
					<td>
						<input class="tr" type="text" id="totShipAmt" name="totShipAmt" comma readonly>
					</td>
					<td>
						<input class="tr" type="text" id="totEpctPal" name="totEpctPal" comma readonly>
					</td>
					<td></td>
					<td></td>
				</tr>
			</table>
		</div>
	</div>
	<br>
	<div class="popup_table">
		<table>
			<colgroup>
				<col width="12%">
			</colgroup>
			<tr>
				<th>첨부파일</th>
				<td>
					<div data-ax5grid="ordrg-file-grid" data-ax5grid-config="{}" style="height: 120px; width: 100%"></div>
				</td>
			</tr>
		</table>
	</div>
	<!-- 하단 버튼 -->
	<div class="popup_bottom_btn">
		<button id="actionBtn" onclick="updateOrderModal();" authchk>수정</button>
		<button id="ordrgYnBtnP" onclick="updateConfirm('P');" authchk>매입확정</button>
		<button id="ordrgYnBtnS" onclick="updateConfirm('S');" authchk>매출확정</button>
		<button id="ordrgYnBtnA" onclick="updateConfirm('A');" authchk>일괄확정</button>
<!-- 		<button id="cancelBtnP" onclick="updateCancel('P');" style="background-color: red;" authchk>매입취소</button> -->
		<button id="cancelBtnS" onclick="updateCancel('S');" style="background-color: red;" authchk>매출취소</button>
		<button id="cancelBtnA" onclick="updateCancel('A');" style="background-color: red;" authchk>일괄취소</button>
		<button class="close_btn" onclick="modalStack.close();">닫기</button>
	</div>
</div>
<script type="text/javascript">
	var ordrgFileArr = [];
	var ordrgFileGridView = {
		initView: function(){
			this.target = new ax5.ui.grid();
			this.target.setConfig({
				target: $('[data-ax5grid="ordrg-file-grid"]'),
				showLineNumber: true,
				showRowSelector: false,
	        	multipleSelect: false,
				header: {selector: false},
				body: {
		        	onClick: function () {
		                this.self.select(this.dindex);
		            },
		            onDBLClick: function () {
		            	downloadFile(this.dindex);
		            }
		        },
	            columns: [
	                {key: "fileName", label: "파일명", width: 460},
	                {key: "fileType", label: "파일타입", width: 140},
	                {key: "fileSize", label: "파일크기", width: 140},
	            ]
			});
			return this;
		},
		setData : function() {
			var targetObj = this.target;
			targetObj.setData({
				list: ordrgFileArr,
				page : {
					totalElements : ordrgFileArr.length
				}
			});
		}
	}
	
	$(document).ready(function() {
		selectOrdrgInfo();
		authChk("OD0101M01");
	});
	
	function selectOrdrgInfo() {
    	var paramObj = modalStack.last().paramObj;
		postAjax("/user/od/od01/selectOrdrgInfo", paramObj, null, function(data){
			setOrdrgInfo(data.result);
		});
	}
	
	function setOrdrgInfo(obj) {
		var fileInfo = obj.fileList;
		var orderInfo = obj.orderInfo;
		var orderDetail = obj.orderDetail;
		
		// 메인정보 세팅
		$.each(orderInfo, function(key, value){
			var itemValue = value;
			if($('#ordrgView #'+key).is('[comma]')){
				itemValue = addCommaStr(itemValue);
			}
			$('#ordrgView #'+key).val(itemValue);
		});
		
		// 상세정보 세팅
		$.each(orderDetail, function(idx, obj){
			var $addedRow = addDetailRow();
			$.each($addedRow.find('[name]'), function(idx, elem){
				var itemValue = obj[elem.name];
				if(itemValue){
					if($(elem).is("[comma]")){
						itemValue = addCommaStr(itemValue);
					}
					$(elem).val(itemValue);
					
					if(elem.name == "ordrgYn" && itemValue == 'N') { //red
						$(elem).css({"color": "red"});
					}
					if($("#ordrgView #dirtrsYn").val() == "Y" && elem.name == "shipYn" && itemValue == 'N') { //red
						$(elem).css({"color": "red"});
					}
				}
			});
		});
		countTot();
		
		// 첨부파일 set
		$.each(fileInfo, function(idx, obj){
			ordrgFileArr.push({
				'fileKey' : obj.fileKey,
		      	'fileName' : obj.fileName,
		      	'fileType' : obj.fileType,
		      	'fileSize' : obj.fileSize,
		      	'file' : obj
			});
		});
		// 첨부파일 그리드 set
		ordrgFileGridView.initView().setData();
		
// 		// 매입확정된 상세가 없을경우 취소버튼 hide
// 		if(orderInfo.confirmCntP == 0){
// 			$("#cancelBtnP").hide();
// 		}

		// 직송이 아니거나 매출 확정된 상세가 없을경우 취소버튼 hide
		if(orderInfo.confirmCntS == 0 || $("#ordrgView #dirtrsYn").val() == 'N'){
			$("#ordrgView #cancelBtnS").hide();
		}
		// 매임/매출 확정된 상세가 없을경우 전체 취소버튼 hide
		if(orderInfo.confirmCntS == 0 && orderInfo.confirmCntP == 0){
			$("#ordrgView #cancelBtnA").hide();
		}	
		
		// 전체 매입확정시 확정  hide
		if(orderInfo.ordrgYn == "Y") {
			$("#ordrgView #ordrgYnBtnP").hide();
			$("#ordrgView #ordrgYnBtnA").hide();
		}
		// 직송이 아니거나 전체 매출확정시 확정  hide
		if(orderInfo.shipYn  == "Y" || $("#ordrgView #dirtrsYn").val() == 'N') {
			$("#ordrgView #ordrgYnBtnS").hide();
		}
		
		// 전체 매입/매출 확정시 확정 및 수정버튼 hide
		if(orderInfo.ordrgYn == "Y"  && (orderInfo.shipYn  == "Y" || $("#ordrgView #dirtrsYn").val() == 'N')) {
			$("#ordrgView #ordrgYnBtnA").hide();
			$("#ordrgView #actionBtn").hide();   // 수정버턴
		}
		
	}
	
	function addDetailRow() {
		var $detailRow = $('#ordrgView #frameTable tr[name="detailRow"]').clone();
		$('#ordrgView #detailTable tbody').append($detailRow[0]);
		return $detailRow;
	}
	
	function ctrlDetailChkBox(elem){
		if($(elem).is(':checked')){
			$('#ordrgView #detailTable tr[name="detailRow"] input[name="detailChkBox"]:not(:disabled)').prop("checked", true);
		}else{
			$('#ordrgView #detailTable tr[name="detailRow"] input[name="detailChkBox"]:not(:disabled)').prop("checked", false);
		}
	}
	
	function ctrlAllChkBox(){
		var isAllChk = true;
		var $detailChkBoxes = $('#ordrgView #detailTable tr[name="detailRow"] input[name="detailChkBox"]:not(:disabled)');
		if($detailChkBoxes.length > 0){
			$.each($detailChkBoxes, function(idx, elem){
				if(!$(elem).is(':checked')){
					isAllChk = false;
				}
			});
			if(isAllChk){
				$('#ordrgView #allChkBox').prop("checked", true);
			}else{
				$('#ordrgView #allChkBox').prop("checked", false);
			}
		}else{
			$('#ordrgView #allChkBox').prop("checked", false);
		}
	}
	
	function countTot() {
		var totOrdrgQty = 0;
		var totOrdrgWt = 0;
		var totOrdrgAmt = 0;
		var totShipAmt = 0;
		var totEpctPal = 0;
		
		$.each($('#ordrgView #detailTable tr[name="detailRow"]'), function(idx, elem){
			var ordrgQty = Number(deleteCommaStr($(elem).find('input[name="ordrgQty"]').val()));
			var ordrgWt  = Number(deleteCommaStr($(elem).find('input[name="ordrgWt"]').val()));
			var ordrgAmt = Number(deleteCommaStr($(elem).find('input[name="ordrgAmt"]').val()));
			var shipAmt  = Number(deleteCommaStr($(elem).find('input[name="shipAmt"]').val()));
			var epctPal  = Number(deleteCommaStr($(elem).find('input[name="epctPal"]').val()));
			
			totOrdrgQty += ordrgQty;
			totOrdrgWt  += ordrgWt;
			totOrdrgAmt += ordrgAmt; 
			totShipAmt  += shipAmt; 
			totEpctPal  += epctPal; 
		});
		
		$('#ordrgView #totQty').val(addCommaStr(totOrdrgQty));
		$('#ordrgView #totWt').val(addCommaStr(totOrdrgWt));
		$('#ordrgView #totAmt').val(addCommaStr(totOrdrgAmt));
		$('#ordrgView #totShipAmt').val(addCommaStr(totShipAmt));
		$('#ordrgView #totEpctPal').val(addCommaStr(totEpctPal));
	}
	
	function downloadFile(idx) {
		postAjax("/admin/cm/cm08/fileDownInfo", {"fileKey": ordrgFileArr[idx].fileKey}, null, function(data){
			var fileInfo = data.fileInfo;
			var filePath = encodeURI(fileInfo.filePath + fileInfo.fileKey + "_" + fileInfo.fileName , "UTF-8");
			location.href = "/admin/cm/cm08/fileDownload?filePath="+filePath;
		});
	}
	
	function updateOrderModal() {
		var paramObj = modalStack.last().paramObj;
		modalStack.close();
		setTimeout(function(){
			paramObj.actionType = "U";
			openModal("/static/html/user/od/od01/OD0102P01.html", 1300, 780, "", paramObj);			
		}, 500);
	}

	function updateConfirm(type) {
		var checkCount = 0;
		var checkCountP = 0;
		var checkCountS = 0;
		$.each($('#ordrgView #detailTable tr[name="detailRow"]'), function(idx, elem){
			if($(elem).find("input[name='detailChkBox']").is(":checked") && ($(elem).find("input[name='ordrgYn']").val() == "N" || $(elem).find("input[name='shipYn']").val() == "N")) {
				checkCount++;
			}
			if($(elem).find("input[name='detailChkBox']").is(":checked") && $(elem).find("input[name='ordrgYn']").val() == "Y") {
				checkCountP++;
			}
			if($(elem).find("input[name='detailChkBox']").is(":checked") && $(elem).find("input[name='shipYn']").val() == "Y") {
				checkCountS++;
			}
		});
			
		if(checkCount == 0){
			alert("발주내역을 선택해주세요");
			return;
		}
		
		// 매출만 확정가능한 케이스(GGM 건재류) 때문에 주석처리 - 20210611
		/*
			if (type == 'S' && checkCountP == 0){
				alert("매출 확정은 매입이 완료된 건에 대한 확정입니다. 매입확정을 혹은 일괄확정 후 작업하십시요.");
				return;
			}
		*/
		
		var formData = makeFormData('CONFIRM');
		formData.comfirmType = type; // P 매입확정, S 매출확정, A 일괄
		
		// 공장에서는 재고관리시 길이는 관리불가임으로 공통으로 8m를 입력한다. 나머지(하치장, 외주)는 실제 길이 관리한다.
		var mngPrdtLen = ''; 
		if($('#ordrgView #whType').val() == "WHDIV01") {mngPrdtLen = 8;}
		formData.mngPrdtLen = mngPrdtLen;

		putAjax("/user/od/od01/updateConfirm", formData, null, function(data){
			alert(data.resultMessage);           
			if(data.resultCode == 200){
				ordrgGridView.setData(0);
				modalStack.close();
			}
		});
	}
	
	function updateCancel(type) {
		var checkCount  = 0;
		var checkCountChk  = 0;
		var checkCountP = 0;
		var checkCountS = 0;
		$.each($('#ordrgView #detailTable tr[name="detailRow"]'), function(idx, elem){
			if($(elem).find("input[name='detailChkBox']").is(":checked") || $(elem).find("input[name='ordrgYn']").val() == "Y"
				                                                         || $(elem).find("input[name='shipYn']").val() == "Y") {
				checkCount++;
			}
			if($(elem).find("input[name='detailChkBox']").is(":checked")) {
				checkCountChk++;
			}
			if($(elem).find("input[name='ordrgYn']").val() == "Y") {
				checkCountP++;
			}
			if($(elem).find("input[name='shipYn']").val() == "Y") {
				checkCountS++;
			}
		});
		if(checkCountChk == 0){
			alert("발주내역을 선택해주세요");
			return;
		}
		if(type == 'P'){
			if(checkCountP == 0){
				alert("매입 확정 건이 존재하지 않습니다.");
				return;
			}
			
		}else if (type == 'S'){

			if(checkCountS == 0){
				alert("매출 확정 건이 존재하지 않습니다.");
				return;
			}
			
		}else{
			if(checkCount == 0){
				alert("확정 건이 존재하지 않습니다.");
				return;
			}
		}
		
		var formData = makeFormData('CANCEL');
		formData.cancelType = type; // P 매입취소, S 매출취소, A 일괄 취소

		// 공장에서는 재고관리시 길이는 관리불가임으로 공통으로 8m를 입력한다. 나머지(하치장, 외주)는 실제 길이 관리한다.
		var mngPrdtLen = ''; 
		if($('#ordrgView #whType').val() == "WHDIV01") {mngPrdtLen = 8;}
		formData.mngPrdtLen = mngPrdtLen
		
		putAjax("/user/od/od01/updateCancel", formData, null, function(data){
			alert(data.resultMessage);
			if(data.resultCode == 200) {
				ordrgGridView.setData(0);
				modalStack.close();
			}
		});
	}
	
	function makeFormData(type) {
		//콤마 제거
		$.each($('#ordrgView input[comma]'), function(idx, elem){
			deleteComma(elem);
		});
		
		// 폼데이터 생성
		var formData = $("#ordrgView #popForm").serializeObject();
		
		// 유저아이디 추가
		formData.userId = jwt.userId;
		
		// 상세내역 추가
		var detailArr = [];
		$.each($('#ordrgView #detailTable tr[name="detailRow"]'), function(idx, elem){
			if(type == "CONFIRM") {
				if($(elem).find("input[name='detailChkBox']").is(":checked") ) {  //&& $(elem).find("input[name='ordrgYn']").val() == "N"
					var detailObj = {};
					$.each($(elem).find('[name]'), function(idx, elem){
						if(elem.name == "ordrgProcId" && elem.value == "") elem.value = jwt.userId;
						if(elem.name == "ordrgProcNm" && elem.value == "") elem.value = jwt.userNm;
						detailObj[elem.name] = elem.value;
					});
					detailArr.push(detailObj);
				}
			} else {
				if($(elem).find("input[name='detailChkBox']").is(":checked")) {  // && $(elem).find("input[name='ordrgYn']").val() == "Y"
					var detailObj = {};
					$.each($(elem).find('[name]'), function(idx, elem){
						detailObj[elem.name] = elem.value;
					});
					detailArr.push(detailObj);
				}
			}
		});
		formData.detailArr = JSON.stringify(detailArr);
		
		return formData;
	}
</script>