<script type="text/javascript">
	var authId = null;
	var authRole = null;
	var actionType = null;
	var searchGrid = null;
	var insertOK = false;
	var flg = "Y";
	
	var gridView1 = {
		initView: function(){
			this.target = new ax5.ui.grid();
			this.target.setConfig({
		    	showRowSelector: true,
		    	multipleSelect: false,
		    	target: $('[data-ax5grid="search-grid"]'),
		        header: {
		        	align: "center", 
		        	selector: false
		        },
		        body: {
		        	onClick: function () {
		        		var idx = this.self.select(this.dindex);
		        		var prjctCdIdx = idx.list[this.dindex].prjctCd;
		                $("#prjctCd").val(prjctCdIdx);
		                if (flg == "Y"){
		                	$("#tt").show();
		                }else{
		                	$("#tt").hide();
		                }
		                
		            },
		            onDBLClick: function () {
		            	//updateProjectModal("U");
		            }, 
		        },
		        page: {
		            navigationItemCount: 9,
		            height: 30,
		            display: true,
		            searchIcon: '<i class="fa fa-step-backward" aria-hidden="true"></i>',
		            prevIcon: '<i class="fa fa-caret-left" aria-hidden="true"></i>',
		            nextIcon: '<i class="fa fa-caret-right" aria-hidden="true"></i>',
		            lastIcon: '<i class="fa fa-step-forward" aria-hidden="true"></i>',
		            onChange: function () {
		            	gridView1.setData(this.page.selectPage);
		            }
		        },
		        columns: [
		            {key: "coNm", label: "출고 회사"},
		            {key: "whNm", label: "출고지"},
		            {key: "ownerNm", label: "재고주체"},
		            {key: "typNm", label: "판매 유형"},
		            {key: "makrNm", label: "제조사"},
		            {key: "clntNm", label: "거래처"},
		            {key: "prdtNm", label: "제품"},
		            {key: "impNm", label: "수입 구분"},
		            {key: "stockQty", label: "현 재고 수량(KG)", formatter: "money"},
		            {key: "stockUpr", label: "재고단가", hidden:"true"},
		            {key: "stdUpr", label: "기준단가", hidden:"true"},
		            {key: "pchsUpr", label: "최종매입단가", hidden:"true"},
		            {key: "sellUpr", label: "최종매출단가", hidden:"true"},
		            {key: "etcField1", label: "여분필드(고정)", hidden:"true"},
		            {key: "etcField2", label: "여분필드(숫자)", hidden:"true"},
		            {key: "etcField3", label: "여분필드(가변)", hidden:"true"},
		            {key: "stockAmt", label: "단가", hidden:"true"},
		            {key: "proprtStockQty", label: "적정재고수량(KG)", hidden:"true"},
		            {key: "stockChgCd", label: "재고변동사유", hidden:"true"}
		        ]
		    });
			return this;
		},
		setData: function(_pageNo) {
			searchGrid = this.target;
			 var formData = {
				"coCd"   : $("#searchDtlOutCoCd").val(),
				"whCd"   : $("#searchDtlOutWhCd").val(),
				"clntNm": $("#searchDtlClntNm").val(),
				"ownerCd"  : $("#searchDtlOwnerCd").val(),
				"typCd" : $("#searchDtlTypCd").val(),
				"makrCd" : $("#searchDtlMakr").val(),
				"impYn" : $("#searchDtlImpYn").val(),
				"prdtNm" : $("#searchDtlPrdtNm").val(),
				"pageNo" : _pageNo + 1
			} 
			
			postAjax("/user/sm/sm02/selectStockMoveStatMngmDtlList", formData, null, function(data){
				var list = data.smsmDtlList;
				searchGrid.setData({
					list : list,
					page : {
						currentPage : _pageNo,
						pageSize : data.paginationInfo.pageSize,
						totalElements : data.paginationInfo.totalRecordCount,
						totalPages : data.paginationInfo.totalPageCount
					}
				});
			}); 
		} 
	} 
	
	//화면로드시
	$(document).ready(function() {
		$("#tt").hide();
	    setDtlSelectCombo();
	    gridView1.initView().setData(0);
	    $('#searchTransDt').datepicker({
			format : "yyyy-mm-dd",
			language : "ko",
			autoclose : true
		});
	})	
	
	//공통코드 조회
	function setDtlSelectCombo(){
		var paramObj = {
			"userId" : jwt.userId,
			"wh" 		: "WH",
			"co" 		: "CO",
			"owner" 	: "OWNER",
			"makr"		: "MAKR",
			"selltype"  : "SELLTYPE",
			"prdtimp"	: "PRDTIMP"
		};
		
		postAjax("/user/sm/sm02/selectDtlCmnCodeList", paramObj, null,  function(data){
			var whDtlHtml = '<option value="" selected>전체선택</option>';
			var coDtlHtml = '<option value="" selected>전체선택</option>';
			var makrDtlHtml = '<option value="" selected>전체선택</option>';
			var ownerDtlHtml = '<option value="" selected>전체선택</option>';
			var selltypeDtlHtml = '<option value="" selected>전체선택</option>';
			var prdtimpDtlHtml = '<option value="" selected>전체선택</option>';
			var cmnDtlCodeInfo = data.cmnDtlCodeInfo;
			$.each(cmnDtlCodeInfo, function(index, item){
				if(item.codeKind == 'WH'){
					whDtlHtml += '<option value='+item.codeId+'>';
					whDtlHtml += item.codeNm;
					whDtlHtml += '</option>';
				}else if(item.codeKind == 'CO'){
					coDtlHtml += '<option value='+item.codeId+'>';
					coDtlHtml += item.codeNm;
					coDtlHtml += '</option>';
				}else if(item.codeKind == 'MAKR'){
					makrDtlHtml += '<option value='+item.codeId+'>';
					makrDtlHtml += item.codeNm;
					makrDtlHtml += '</option>';
				}else if(item.codeKind == 'OWNER'){
					ownerDtlHtml += '<option value='+item.codeId+'>';
					ownerDtlHtml += item.codeNm;
					ownerDtlHtml += '</option>';
				}else if(item.codeKind == 'SELLTYPE'){
					selltypeDtlHtml += '<option value='+item.codeId+'>';
					selltypeDtlHtml += item.codeNm;
					selltypeDtlHtml += '</option>';
				}else if(item.codeKind == 'PRDTIMP'){
					prdtimpDtlHtml += '<option value='+item.codeId+'>';
					prdtimpDtlHtml += item.codeNm;
					prdtimpDtlHtml += '</option>';
				}
				//상단검색조건
				document.getElementById("searchDtlOutCoCd").innerHTML = coDtlHtml;
				document.getElementById("searchDtlOutWhCd").innerHTML = whDtlHtml;
				document.getElementById("searchDtlMakr").innerHTML = makrDtlHtml;
				document.getElementById("searchDtlOwnerCd").innerHTML = ownerDtlHtml;
				document.getElementById("searchDtlTypCd").innerHTML = selltypeDtlHtml;
				document.getElementById("searchDtlImpYn").innerHTML = prdtimpDtlHtml;
				
				//하단검색조건
				document.getElementById("searchDtlCoCd").innerHTML = coDtlHtml;
				document.getElementById("searchDtlWhCd").innerHTML = whDtlHtml;
			});
		});
	}
	
	function layerClose(){
		$("#tt").hide();
	}
	
	function insertUpdateMove(){
		var idx = searchGrid.selectedDataIndexs;
		var coCdVal = $("#searchDtlCoCd").val();
		var whCdVal = $("#searchDtlWhCd").val();
		var transDtVal = $("#searchTransDt").val().replace(/\-/g,'');
		var moveQtyVal = $("#searchMoveQty").val();
		if(coCdVal == ""){
			alert("입고회사는 필수항목 입니다.");
			return;
		}else if(whCdVal == ""){
			alert("입고지는 필수항목 입니다.");
			return;
		}else if(moveQtyVal == ""){
			alert("이동 수량은 필수항목 입니다.");
			return;
		}else if(transDtVal == ""){
			alert("운송일자는 필수항목 입니다.");
			return;
		}
		var formData = {
				"sCoCd"  	: $("#searchDtlCoCd").val(), 
				"sWhCd"		: $("#searchDtlWhCd").val(),
				"sTransDt" 	: $("#searchTransDt").val().replace(/\-/g,''),
				"sMoveQty"	: $("#searchMoveQty").val(),
				"sRmk"	 	: $("#searchRmk").val(),
				"mPrjctCd" 	: searchGrid.list[idx].prjctCd,
				"mCoCd" 	: searchGrid.list[idx].coCd,
				"mWhCd"		: searchGrid.list[idx].whCd,
				"mOwnerCd" 	: searchGrid.list[idx].ownerCd,
				"mClntCd" 	: searchGrid.list[idx].clntCd,
				"mTypCd" 	: searchGrid.list[idx].typCd,
				"mMakrCd" 	: searchGrid.list[idx].makrCd,
				"mPrdtCd" 	: searchGrid.list[idx].prdtCd,
				"mImpYn"	: searchGrid.list[idx].impYn,
				"mStockQty" : searchGrid.list[idx].stockQty,
				"mStockUpr" : searchGrid.list[idx].stockUpr,
				"mStdUpr"	: searchGrid.list[idx].stdUpr,
				"mPchsUpr" 	: searchGrid.list[idx].pchsUpr,
				"mSellUpr" 	: searchGrid.list[idx].sellUpr,
				"mEtcField1" : searchGrid.list[idx].etcField1,
				"mEtcField2" : searchGrid.list[idx].etcField2,
				"mEtcField3" : searchGrid.list[idx].etcField3,
				"stockAmt" : searchGrid.list[idx].stockAmt,
				"proprtStockQty" : searchGrid.list[idx].proprtStockQty,
				"stockChgCd" : searchGrid.list[idx].stockChgCd,
				"userId" 	: jwt.userId
		}
		putAjax("/user/sm/sm02/insertUpdateStockMove", formData, null, function(data){
			if(data.resultCode == 200){
				if(insertOK){
					alert("수정 되었습니다.");	
				}else{
					alert(data.resultMessage);
				}
				//getData();
				modal.close();
			}
		})
	}
	
	//초기화 함수
	function searchInit(){
		$("#searchDtlOutCoCd option:eq(0)").prop("selected",true); 
		$("#searchDtlOutWhCd option:eq(0)").prop("selected",true);
		$("#searchDtlClntCd").val('');
		$("#searchDtlOwnerCd option:eq(0)").prop("selected",true);
		$("#searchDtlTypCd option:eq(0)").prop("selected",true);
		$("#searchDtlMakr option:eq(0)").prop("selected",true);
		$("#searchDtlImpYn option:eq(0)").prop("selected",true);
		$("#searchDtlPrdtCd").val('');
	}
	
	//거래처 검색
	function clntSearch() {
		openSecondModal("/static/html/user/sm/sm02/SM0201P03.html", 500, 420, "거래처");
	}
	//제품 검색
	function prdtSearch() {
		openSecondModal("/static/html/user/sm/sm02/SM0201P02.html", 500, 400, "제품 검색");
	}
	//검색된 제품 받아오는함수
	function setDtlPrdtCd(params){
		$("#searchDtlPrdtCd").val(params.prdtNm);
	}
</script>
<body>
	<div class="container-fluid">
      <div class="row">
        <div class="popup_area">
		        <div  class="popup_table">
		          <div class="contents no_bg">
				    <ul class="btn_ul">
				      <li class="btn_r">
				        <a onclick = "gridView1.setData(0);">
				          <button class="bg_gray">검 색</button>
				        </a>
				        <a onclick = "searchInit()">
				          	<button class="bg_gray">초기화</button>
				        </a>
				      </li>
				    </ul>
			      </div>
		          <table>
		          	<tbody>
		          		<tr>
		          			<th colspan= "2">출고 법인</th>
		          			<td colspan="3"> 
		          				<select id="searchDtlOutCoCd" required></select>
		          			</td>
		          			<th colspan="2">출고지(창고)</th>
		          			<td colspan="3"> 
		          				<select id="searchDtlOutWhCd" required></select>
		          			</td>
		          			<th colspan= "2">거래처</th>
			                <td class="drctArea" colspan="3">
			                	<input type="hidden" id="searchDtlClntCd" name="searchDtlClntNm" style="width: 76%;">                   
			                	<div class="search_form">
				                    <input type="text" id="searchDtlClntNm" name="searchDtlClntNm" readonly="readonly">
			                    	<a onclick="clntSearch();"><i class="i_search_w"></i></a>
			                    </div>
			                </td>
		          			<th colspan="2">재고주체</th>
		          			<td colspan="3"> 
		          				<select id="searchDtlOwnerCd" required></select>
		          			</td>
		          		</tr>
		          		<tr>
		          			<th colspan="2">판매유형</th>
		          			<td colspan="3"> 
		          				<select id="searchDtlTypCd" required></select>
		          			</td>
		          			<th colspan= "2">제조사</th>
		          			<td colspan="3"> 
		          				<select id="searchDtlMakr" required></select>
		          			</td>
		          			<th colspan="2">수입구분</th>
		          			<td colspan="3"> 
		          				<select id="searchDtlImpYn" required></select>
		          			</td>
			          		<th colspan= "2">제품</th>
			                <td class="drctArea" colspan="3">
			                	<input type="hidden" id="searchDtlPrdtCd" name="searchDtlPrdtCd" style="width: 76%;">                   
			                	<div class="search_form">
				                    <input type="text" id="searchDtlPrdtNm" name="searchDtlPrdtNm" readonly="readonly">
			                    	<a onclick="prdtSearch();"><i class="i_search_w"></i></a>
			                    </div>
			                </td>	
		          		</tr>
		          	</tbody>
		          </table>
	          </div>
	        <div class="contents">
			  <div data-ax5grid="search-grid" data-ax5grid-config="{}" style="height: 200px; width: 100%"></div>
		    </div>
        </div>
      </div>
      <div class="row" id="tt">
      <div class="popup_area">
      <div class="popup_table">
      	<div class="contents no_bg">
	      <ul class="btn_ul">
	        <li class="btn_r">
	          <a id="move">
	            <button class="bg_gray" onclick = "insertUpdateMove()">이동</button>
	          </a>
	        </li>
	      </ul>
		 </div>
      	<div class="contents">
          <table>
          	<tbody>
          	  <tr>
          	    <th colspan="2">입고회사</th>
          		<td colspan="3"> 
          		  <select id="searchDtlCoCd" required></select>
          		</td>
          		<th colspan="2">입고지</th>
          		<td colspan="3"> 
          		  <select id="searchDtlWhCd" required></select>
          		</td> 
          		<th colspan= "2">이동 수량(KG)</th>
      			<td colspan="3"> 
      				<input id="searchMoveQty" required>
      			</td>  
          	  </tr>
          	<tr>
			  <th colspan= "2">운송일자</th>
      		  <td colspan="3"> 
      			<input type="text" id="searchTransDt" name="searchTransDt" class="input_calendar">
      		  </td>
      		  <th colspan= "2">메모</th>
      			<td colspan="3"> 
      				<input id="searchRmk" required>
      		  </td>	          	  
          	</tr>
          	</tbody>
          </table>      		
      	</div>
      </div>
      </div>
      </div>
    </div>
    <a id="closeBtn" >
    	<button class="bg_gray" onclick="modal.close();">닫기</button>
    </a>
</body>
</html>
