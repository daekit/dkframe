<style>
	input[comma] {text-align: right;}
</style>
<div class="popup_area of_a" style="width: 100%; height: 100%;">
	<div class="tit_contents">
		<h4 class="tit"></h4>
	</div>
	<div class="popup_table">
		<input type="file" id="file" style="display: none" multiple="multiple" onchange="setFile(this);" />
		<form id="popForm">
			<input type="hidden" id="pgmId" name="pgmId" value="SD0301M01"> 
			<input type="hidden" id="estNo" name="estNo">
			<table>
				<colgroup>
					<col width="12%">
					<col width="">
					<col width="12%">
					<col width="">
					<col width="12%">
					<col width="">
				</colgroup>
				<tr>
					<th class="hit">회사</th>
					<td>
						<select id="coCd" name="coCd" data-kind="CO" onchange="setByCoCd(this.value)" required></select>
					</td>
					<th class="hit">수신 거래처</th>
					<td>
						<input type="hidden" id="estClntCd" name="estClntCd">
						<div class="search_form">
							<input type="text" id="estClntNm" name="estClntNm" readonly required>
							<a onclick="openSecondClntSearch();">
								<i class="i_search_w"></i>
							</a>
						</div>
					</td>
					<th class="hit">견적일자</th>
					<td>
						<input type="text" class="input_calendar" autocomplete="off" id="estDt" name="estDt" date required>
					</td>
				</tr>
				<tr>
					<th class="hit">발행법인</th>
					<td>
						<select id="estCoprt" name="estCoprt" data-kind="ESTCOPRT" required></select>
					</td>
					<th class="hit">영업담당자</th>
					<td>
						<div class="search_form">
							<input type="hidden" id="salesEmpId" name="salesEmpId"> 
							<input type="text" id="salesEmpNm" readonly required>
							<a onclick="openSecondUserSearch();"> 
								<i class="i_search_w"></i>
							</a>
						</div>
					</td>
					<th class="">참조내용</th>
					<td>
						<input type="text" id="estRprc" name="estRprc">
					</td>
				</tr>
				<tr>
					<th class="">사업자 Tel.</th>
					<td>
						<input type="text" id="bizTelNo" name="bizTelNo" onkeyup="telNumberFormatter(this);" maxlength="20">
					</td>
					<th class="">사업자 Fax</th>
					<td>
						<input type="text" id="bizFaxNo" name="bizFaxNo" onkeyup="telNumberFormatter(this);" maxlength="20">
					</td>
					<th class="">담당자 Email</th>
					<td>
						<input type="text" id="mngEmail" name="mngEmail" onkeyup="exceptKorean(this);" maxlength="100">
					</td>
				</tr>
				<tr>
					<th class="hit">현장</th>
					<td>
						<div class="search_form">
							<input type="hidden" id="prjctCd" name="prjctCd"> 
							<input type="text" id="prjctNm" name="prjctNm" required> 
							<a onclick="openSecondSiteSearch();"> 
								<i class="i_search_w"></i>
							</a>
						</div>
					</td>
					<th>낙찰구분</th>
					<td>
						<select id="winbdYn" name="winbdYn" data-kind="YN">
						</select>
					</td>
					<th>낙찰일자</th>
					<td>
						<input type="text" class="input_calendar" autocomplete="off" id="winbdDt" name="winbdDt" date>
					</td>
				</tr>
				<tr>
					<th class="">비고</th>
					<td colspan="5">
						<textarea class="form-control" id="rmk" name="rmk" style="height: 60px;" maxlength="1000"></textarea>
					</td>
				</tr>
			</table>
		</form>
	</div>
	<br>
	<!-- 테이블 -->
	<div class="popup_table">
		<table id="detailTable">
			<colgroup>
				<col width="3%">
				<col width="14%">
				<col width="9%">
				<col width="6%">
				<col width="11%">
				<col width="5%">
				<col width="5%">
				<col width="8%">
				<col width="8%">
				<col width="8%">
				<col width="10%">
				<col width="10%">
				<col width="7%">
				<col width="3%">
			</colgroup>
			<tr>
				<td colspan="2" style="text-align: LEFT; border-right: 0;">※상세내역</td>
				<td colspan="12">
					<div class="add_btn">
						<a onclick="addRow();" authchk>+</a> 
						<a onclick="removeDetailRow();" authchk>-</a>
					</div>
				</td>
			</tr>
			<tr>
				<th><input type="checkbox" name="allChk" onclick="allChk(this)"></th>
				<th class="hit tc">제품명</th>
				<th class="tc">제품강종</th>
				<th class="tc">사이즈</th>
				<th class="tc">SPEC</th>
				<th class="tc">길이</th>
				<th class="tc">단위</th>
				<th class="hit tc">수량</th>
				<th class="hit tc">중량</th>
				<th class="tc">단가</th>
				<th class="tc">금액</th>
				<th class="tc">예상손익</th>
				<th class="tc">비고</th>
				<th class="tc"></th>
			</tr>
			<tr class="detailRow" name="detailRow">
				<input type="hidden" name="estPrdtSeq">
				<input type="hidden" name="prdtDiv">
				<input type="hidden" name="prdtStockCd">
				<input type="hidden" name="stockUpr">
				<input type="hidden" name="prdtCoilYn"> 
				<input type="hidden" name="prdtCnvrsnWt">
				<td>
					<input type="checkbox" name="detailChkBox">
				</td>
				<td>
					<div class="search_form">
						<input type="hidden" name="prdtCd">
						<input type="text" name="prdtNm" readonly required> 
						<a onclick="openSecondPrdtSearch(this);">
							<i class="i_search_w"></i>
						</a>
					</div>
				</td>
				<td><input type="hidden" name="prdtStkn" readonly>
					<input type="text" class="tc" name="prdtStknNm" readonly></td>
				<td><input type="text" class="tc" name="prdtSize" maxlength="15"></td>
				<td><input type="text" class="tc" name="prdtSpec" maxlength="25"></td>
				<td><input type="text" class="tc" name="prdtLen" maxlength="10"></td>
				<td><input type="hidden" name="prdtUnit" readonly>
					<input type="text" class="tc" name="prdtUnitNm" readonly></td>
				<td><input type="text" name="estQty" onkeyup="onlyNumber(this); calEstWt(this); countAmt(this);" comma></td>
				<td><input type="text" name="estWt" onkeyup="onlyNumber(this); countAmt(this);" comma></td>
				<td><input type="text" name="estUpr" onkeyup="onlyNumber(this); countAmt(this);" comma></td>
				<td><input type="text" name="estAmt" comma readonly></td>
				<td><input type="text" name="expAmt" comma readonly></td>
				<td><input type="text" name="rmk" maxlength="50"></td>
				<td><div><a name="copyRow" onclick="copyRow(this);" authchk>복사</a></div> </td>
			</tr>
		</table>
		<table>
			<colgroup>
				<col width="3%">
				<col width="14%">
				<col width="9%">
				<col width="6%">
				<col width="11%">
				<col width="5%">
				<col width="5%">
				<col width="8%">
				<col width="8%">
				<col width="8%">
				<col width="10%">
				<col width="10%">
				<col width="7%">
				<col width="3%">
			</colgroup>
			<tr>
				<th colspan="7" class="tc">합계</th>
				<td class="tr" id="totEstQty"></td>
				<td class="tr" id="totEstWt"></td>
				<td>-</td>
				<td class="tr" id="totEstAmt"></td>
				<td class="tr" id="toExpAmt"></td>
				<td></td>
				<td></td>
			</tr>
		</table>
	</div>
	<br>
	<div class="popup_table">
		<table>
			<colgroup>
				<col width="12%">
				<col width="88%">
			</colgroup>
			<tr>
				<th>
					<button type="button" class="btn btn-primary btn-sm" style="height: 25px; line-height: 15px;" onclick="file.click();">첨부파일</button>
				</th>
				<td>
					<div data-ax5grid="file-grid" data-ax5grid-config="{}" style="width: 100%; height: 120px;"></div>
				</td>
			</tr>
		</table>
	</div>
	<!-- 하단 버튼 -->
	<div class="popup_bottom_btn">
		<button id="actionBtn" authchk>등록</button>
		<button onclick="setReport();">견적서출력</button>
		<button class="close_btn" onclick="modalStack.close();">닫기</button>
	</div>
</div>
<script type="text/javascript">
	var $targetRow = null;
	var fileArr = [];
	var deleteFileArr = [];
	var fileGridView = {
		initView: function(){
			this.target = new ax5.ui.grid();
			this.target.setConfig({
				target: $('[data-ax5grid="file-grid"]'),
				showLineNumber: true,
				showRowSelector: false,
	        	multipleSelect: false,
				header: {selector: false},
				body: {
		        	onClick: function () {
		                this.self.select(this.dindex);
		            },
		            onDBLClick: function () {
		            	if(this.item.fileKey){
		            		downloadFile(this.item.fileKey);
		            	}
		            }
		        },
	            columns: [
	                {key: "fileName", label: "파일명", width: 680},
	                {key: "fileType", label: "파일타입", width: 120},
	                {key: "fileSize", label: "파일크기", width: 120},
	                {
						key:"fileDelete", label: "삭제", width:60,
						formatter:function() {
							return '<button type="button" class="btn btn-default btn-sm" style="height: 19px; padding: 0 0 0 0;" onclick="deleteFile('+this.dindex+');">삭제</button>';
						}
					}
	            ]
			});
		},
		setData : function() {
			var targetObj = this.target;
			targetObj.setData({
				list: fileArr,
				page : {
					totalElements : fileArr.length
				}
			});
		}
	}
	
	$(document).ready(function() {
		// 공통코드 selectBox set
		setCommonSelect($(".popup_area select[data-kind]"));

		// 견적일자 datepicker bind
		$('#estDt').datepicker({
			format : "yyyy-mm-dd",
			language : "ko",
			autoclose : true
		});
		// 낙찰일자 datepicker bind
		$('#winbdDt').datepicker({
			format : "yyyy-mm-dd",
			language : "ko",
			autoclose : true
		});
		
		
		// 파일 그리드 초기화
		fileGridView.initView();
		
		if(actionType == "C") {
			countTot();
			$('#coCd').val(jwt.coCd);
			setByCoCd($('#coCd').val());
			$('#estDt').datepicker("setDate", new Date());
			$('#actionBtn').on("click", function(){insertEst();});
			$('.tit_contents .tit').text("견적서 등록");
			$("#actionBtn").text("등록");
		}else if(actionType == "U"){
			selectEstInfo();
			$('#actionBtn').on("click", function(){updateEst();});
			$('.tit_contents .tit').text("견적서 수정");
			$('#actionBtn').text("수정");
		}
        //권한관리
        authChk();
	
	});
	
	function selectEstInfo(){
		var row = gridView.target.getList("selected")[0];
		var paramObj = {"estNo": row.estNo};
		postAjax("/user/sd/sd03/selectEstInfo", paramObj, null, function(data){
			setEstInfo(data.estInfo);
		});
	}
	
	function setEstInfo(estInfo){
		//메인정보 세팅
		$.each(estInfo, function(key, value){
			if($('#'+key)[0]){
				if($('#'+key).is('[date]')){
					$('#'+key).datepicker("setDate", moment(value, 'YYYY-MM-DD').toDate());
				}else{
					if($('#'+key).is('[comma]')){
						value = addCommaStr(value);
					}
					if(key=="coCd"){
						setByCoCd(value)
					}
					$('#'+key).val(value);
				}
			}
		});
		
		//상세정보 세팅
		$.each(estInfo.estDetailList, function(idx, obj){
			if(idx != 0) addRow();
			$addedRow = $("tr[name='detailRow']:last");
			
			$.each($addedRow.find('[name]'), function(idx, elem){
				var itemValue = obj[elem.name];
				if(itemValue){
					if($(elem).is("[comma]")){
						itemValue = addCommaStr(itemValue);
					}
					$(elem).val(itemValue);
				}
			});
		});
		countTot();
		
		// 첨부파일 set
		$.each(estInfo.estFileList, function(idx, obj){
			fileArr.push({
				'fileKey' : obj.fileKey,
		      	'fileName' : obj.fileName,
		      	'fileType' : obj.fileType,
		      	'fileSize' : obj.fileSize,
		      	'file' : obj
			});
		});
		
		// 첨부파일 그리드 set
		fileGridView.setData();
	}
	
	// 거래처
	function openSecondClntSearch() {
		openSecondModal("/static/html/cmn/modal/clntSearch.html", 600, 420, "거래처 검색", {}, function (grid) {
			var row = grid.target.getList("selected")[0];
			$('#estClntCd').val(row.clntCd);
			$('#estClntNm').val(row.clntNm);
			
			var paramObj = {
				"coCd": $('#coCd').val(),
				"clntCd": row.clntCd
			}
			setMngInfo(paramObj);
		});
	}
	
	// 담당자 set
	function setMngInfo(paramObj){
		postAjax("/admin/bm/bm02/selectMngInfo", paramObj, null, function(data) {
			if(data.mngInfo){
				$('#salesEmpId').val(data.mngInfo.salesEmpId);
				$('#salesEmpNm').val(data.mngInfo.salesEmpNm);
			}else{
				$('#salesEmpId').val("");
				$('#salesEmpNm').val("");
			}
		});
	}
	
	// 사용자 검색
	function openSecondUserSearch() {
		var paramObj = {
			"coCd" : "GUM", //$('#coCd').val(),
			"userId": $('#salesEmpId').val(),
			"useYn": "Y"
		};
		
		openSecondModal("/static/html/cmn/modal/userSearch.html", 300, 500, "사용자 검색", paramObj, function (tree){
			var checkedId = tree.get_checked()[0];
			var checkedNode = tree.get_node(checkedId);
			$("#salesEmpId").val(checkedNode.id);
			$("#salesEmpNm").val(checkedNode.text);
		});
	}
	
	// 제품 검색
	function openSecondPrdtSearch(elem) {
		$targetRow = $(elem).closest('tr[name="detailRow"]');
		// selpchCd - SELPCH2: 매출
		var paramObj = {
			"coCd" : $("#coCd").val(),
			"selpchCd": "SELPCH2",
			"impYn": "N", 
			"clntCd" : $("#estClntCd").val(),
			"prjctCd" : $("#prjctCd").val(),
			"useYn": "Y"
		};
		
		openSecondModal("/static/html/cmn/modal/prdtSearch.html", 800, 600, "제품 검색", paramObj, function (grid) {
			var row = grid.target.getList("selected")[0];
			// 값 초기화
			$targetRow.find('input[name]').val("");
			// input 제어
			if(row.prdtStockCd == "Y"){
				$targetRow.find('input[name="prdtSize"]').attr("readonly", false);
				$targetRow.find('input[name="prdtSpec"]').attr("readonly", false);
				$targetRow.find('input[name="estQty"]').attr("readonly", false);
				$targetRow.find('input[name="estWt"]').attr("readonly", false);
			}else{
				$targetRow.find('input[name="prdtSize"]').attr("readonly", true);
				$targetRow.find('input[name="prdtSpec"]').attr("readonly", true);
// 				$targetRow.find('input[name="estQty"]').attr("readonly", true);
// 				$targetRow.find('input[name="estWt"]').attr("readonly", true);
			}
			$.each(row, function(key, value){
				if($targetRow.find('[name="'+key+'"]')[0]){
					$targetRow.find('[name="'+key+'"]').val(value);
				}
			});
// 			$targetRow.find('input[name="prdtCd"]').val(row.prdtCd);
// 			$targetRow.find('input[name="prdtDiv"]').val(row.prdtDiv);
// 			$targetRow.find('input[name="prdtStockCd"]').val(row.prdtStockCd);
// 			$targetRow.find('input[name="prdtNm"]').val(row.prdtNm);
// 			$targetRow.find('input[name="prdtStkn"]').val(row.prdtStkn);
// 			$targetRow.find('input[name="prdtStknNm"]').val(row.prdtStknNm);
// 			$targetRow.find('input[name="prdtSize"]').val(row.prdtSizeNm);
// 			$targetRow.find('input[name="prdtSpec"]').val(row.prdtSpec);
// 			$targetRow.find('input[name="prdtUnit"]').val(row.prdtUnit);
// 			$targetRow.find('input[name="prdtUnitNm"]').val(row.prdtUnitNm);
// 			$targetRow.find('input[name="stockUpr"]').val(row.stockUpr);
			$targetRow.find('input[name="estUpr"]').val(row.ordrgUpr);
			
			countTot();
		});
	}
	// 현장 검색
	function openSecondSiteSearch(){
		var paramObj = {
			"coCd": $('#popForm #coCd').val(), 
			"clntCd": $('#popForm #estClntCd').val(),
			"clntNm": $('#popForm #estClntNm').val()
		}
	
		openSecondModal("/static/html/cmn/modal/siteSearch.html", 600, 450, "현장 검색", paramObj, function (grid){
			var row = grid.target.getList("selected")[0];
			$('#prjctCd').val(row.siteCd);
			$('#prjctNm').val(row.siteNm);
		});
	}
	
	// list 행추가
	function addRow() {
		var row = $("#detailTable > tbody:last > tr:last").clone();
		$("#detailTable > tbody:last").append(row);
		$.each($(row).find(':input'), function(){
			this.value = '';
			this.checked = '';
			$(this).prop("disabled", false);
		});
		return $("tr[name='detailRow']:last")[0];
	}
	
	// list 행삭제	
	function removeDetailRow(){
		var $checkedDetails = $('#detailTable input[name="detailChkBox"]:checked');
		if($checkedDetails.length > 0){
			$.each($checkedDetails, function(idx, elem){
				$(elem).closest('tr[name="detailRow"]').remove();
			});
			countTot();
		}else{
			alert("삭제할 상세내역을 선택해주세요.");
		}
	}
	// 중량계산
	function calEstWt(elem){
		$targetRow = $(elem).closest('tr[name="detailRow"]');
		var estQty = Number(deleteCommaStr($targetRow.find('input[name="estQty"]').val())) || 0;
		var prdtCnvrsnWt = Number($targetRow.find('input[name="prdtCnvrsnWt"]').val()) || 0;
		var estWt = estQty * prdtCnvrsnWt;
		$targetRow.find('input[name="estWt"]').val(addCommaStr(estWt));
	}
	// 금액계산
	function countAmt(elem){
		$targetRow = $(elem).closest('tr[name="detailRow"]');
		var prdtStockCd = $targetRow.find('input[name="prdtStockCd"]').val();
		var prdtUnitNm = $targetRow.find('input[name="prdtUnitNm"]').val();
		var estQty   = Number(deleteCommaStr($targetRow.find('input[name="estQty"]').val()));
		var estWt   = Number(deleteCommaStr($targetRow.find('input[name="estWt"]').val()));
		var estUpr   = Number(deleteCommaStr($targetRow.find('input[name="estUpr"]').val()));
		var stockUpr = Number(deleteCommaStr($targetRow.find('input[name="stockUpr"]').val()));
		
		var totEstAmt = 0;
		var totExpAmt = 0;
		if((prdtUnitNm == "KG") || (prdtUnitNm == "TON")){
			totEstAmt = estWt * estUpr;
			totExpAmt = (estWt * estUpr) - (estWt * stockUpr);
			$targetRow.find('input[name="estAmt"]').val(addCommaStr(totEstAmt.toFixed(0)));
			$targetRow.find('input[name="expAmt"]').val(addCommaStr(totExpAmt.toFixed(0)));
		}else{
			$targetRow.find('input[name="estAmt"]').val(addCommaStr(estQty * estUpr));
			$targetRow.find('input[name="expAmt"]').val(addCommaStr((estQty * estUpr) - (estQty * stockUpr)));
		}
		countTot();
	}
	
	function countTot() {
		var totEstQty = 0; 
		var totEstWt  = 0; 
		var totEstAmt = 0;
		var totExpAmt = 0;
		
		$.each($('#detailTable tr[name="detailRow"]'), function(idx, elem){
			var estQty = $(elem).find("input[name='estQty']").val();
			var estWt  = $(elem).find("input[name='estWt']").val();
			var estAmt = $(elem).find("input[name='estAmt']").val();
			var expAmt = $(elem).find("input[name='expAmt']").val();
			var stockCd = $(elem).find("input[name='prdtStockCd']").val();
			debugger;
			if (stockCd == "Y"){
				totEstQty  += Number(deleteCommaStr(estQty)); 
				totEstWt   += Number(deleteCommaStr(estWt));
			}
			totEstAmt  += Number(deleteCommaStr(estAmt));
			totExpAmt  += Number(deleteCommaStr(expAmt));
		});
		
		
		if ((totEstQty % 1)== 0) {
			$("#totEstQty").html(addCommaStr(totEstQty.toFixed(0)));
		} else {
			$("#totEstQty").html(addCommaStr(totEstQty.toFixed(3)));
		}
		if  ((totEstWt % 1)== 0) {
			$("#totEstWt").html(addCommaStr(totEstWt.toFixed(0)));
		} else {
			$("#totEstWt").html(addCommaStr(totEstWt.toFixed(3)));
		}
		$("#totEstAmt").html(addCommaStr(totEstAmt.toFixed(0)));
		$("#totExpAmt").html(addCommaStr(totExpAmt.toFixed(0)));
	}
	
	function setFile(elem) {
		var tempFiles = elem.files;
		$.each(tempFiles, function(idx, obj) {
			var testArr = obj.name.split(".");
			fileArr.push({
				'fileKey' : 0,
				'fileName' : obj.name,
				'fileType' : testArr[testArr.length - 1],
				'fileSize' : obj.size,
				'file' : obj
			});
		});
		fileGridView.setData();
		$(elem).val("");
	}
	
	function deleteFile(rowIndex) {
		fileGridView.target.removeRow(rowIndex);

		if (fileArr[rowIndex].fileKey) {
			// 기 등록되어 있는 파일 삭제시
			deleteFileArr.push(fileArr[rowIndex].fileKey);
		}

		fileArr.splice(rowIndex, 1);
		fileGridView.setData();
	}
	
	function downloadFile(fileKey) {
		postAjax("/admin/cm/cm08/fileDownInfo", {"fileKey": fileKey}, null, function(data){
			var fileInfo = data.fileInfo;
			var filePath = encodeURI(fileInfo.filePath + fileInfo.fileKey + "_" + fileInfo.fileName , "UTF-8");
			location.href = "/admin/cm/cm08/fileDownload?filePath="+filePath;
		});
	}

	//문자열 자르기
	function cutStr(str, maxByte) {
	
		for(b=i=0;c=str.charCodeAt(i);) {
	      b+=c>>7?2:1;
	      if (b > maxByte)
	      break;
	      i++;
	    }
	  	return str.substring(0,i);
	 }
	 	
	function insertEst() {
		//비고 문자열 길이 필드길이로 byte 자르기
		$("#estRprc").val(cutStr($("#estRprc").val(),100));
		$("#prjctNm").val(cutStr($("#prjctNm").val(),100));
		$("#rmk").val(cutStr($("#rmk").val(),1000));
				
		if(inputValidation($('.popup_area input[required]'))) {
			var formData = makeFormData();
			filePostAjax("/user/sd/sd03/insertEst", formData, function(data){
				alert(data.resultMessage); 
				if(data.resultCode == 200){
					gridView.setData(0);
					modalStack.close();
				}
			});
		}
	}
	
	function updateEst() {
		//비고 문자열 길이 필드길이로 byte 자르기
		$("#estRprc").val(cutStr($("#estRprc").val(),100));
		$("#prjctNm").val(cutStr($("#prjctNm").val(),100));
		$("#rmk").val(cutStr($("#rmk").val(),1000));
	debugger;
		if(inputValidation($('.popup_area input[required]'))) {
			var formData = makeFormData();
			filePutAjax("/user/sd/sd03/updateEst", formData, function(data){
				alert(data.resultMessage);
				if(data.resultCode == 200){
					gridView.setData(0);
					modalStack.close();
				}
			});
		}
	} 
	
	function makeFormData() {
		// 금액 콤마 제거
		$.each($('.popup_area input[comma]'), function(idx, elem){
			deleteComma(elem);
		});
		
		// 날짜 하이픈 제거
		$.each($('.popup_area input[date]'), function(idx, elem){
			deleteHyphen(elem);		
		});
		
		// 폼데이터 생성
		var formData = new FormData($("#popForm")[0]);
		
		// 유저아이디 추가
		formData.append("userId", jwt.userId);
		
		// 첨부파일 추가
		$.each(fileArr, function(idx, obj){
			// 신규파일만 추가
			if(obj.fileKey == 0){
				formData.append("files", obj.file);
			}
		});
		
		// 수정시 삭제된 파일 추가
		if(actionType == "U") {
			formData.append("deleteFileArr", JSON.stringify(deleteFileArr));
		} 
		
		// 상세내역 추가
		var detailArr = [];
		$.each($('#detailTable tr[name="detailRow"]'), function(idx, elem){
			var detailObj = {};
			$.each($(elem).find('[name]'), function(idx, elem){
				detailObj[elem.name] = elem.value;
			});
			detailArr.push(detailObj);
		});
		formData.append("detailArr", JSON.stringify(detailArr));
		
		return formData;
	}  
	
	function allChk(elem){
		if($(elem).prop("checked")){
			$("[name='detailChkBox']").prop("checked", true);
		} else {
			$("[name='detailChkBox']").prop("checked", false);
		}
	}
	
	function setByCoCd(value){		
		// 판매법인 set
		$('#estCoprt').data("rprc", value);
		$('#estCoprt option:not([value=""])').remove()
		setCommonSelect($('#estCoprt'));  
	}

	//list 행추가
	function copyRow(elem) {
		if($("[name=detailRow]").length > 15){
			alert("상세 내역은 15건 까지 입력 할 수 있습니다.");
			return false;
		}
		var row = $(elem).closest('tr').clone();
		$("#detailTable > tbody:last").append(row);
// 		$.each($(row).find(':input'), function(){
// 			$(this).prop("disabled", false);
// 		});
		countTot();
		return $("tr[name='tableCd']:last")[0];
	}	
</script>
