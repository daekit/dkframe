<div id="cplrUntpcDiv" class="popup_area of_a" style="width: 100%; height: 100%;">
    <div class="tit_contents">
        <h4 class="tit">현장 관리</h4>
    </div>
    <div class="popup_table">
    	<form id="popForm" onSubmit="return false;">
    		<input type="hidden" id="orgSiteCd" name="orgSiteCd">
	        <table>
	            <colgroup>
	                <col width="12%">
	                <col width="">
	                <col width="12%">
	                <col width="">
	                <col width="12%">
	                <col width="">
	            </colgroup>
	            <tr>
	                <th class="hit">회사</th>
	                <td>
	                    <select id="coCd" name="coCd" data-kind="CO" required="required" msg="회사" onchange="setWareHouse(this.value);">
	                    	<option value="">선택</option>
	                    </select>
	                </td>
	                <th class="hit">매출처</th>
	                <td>                                
                    	<input type="hidden" id="clntCd" name="clntCd" >
		                <div class="search_form" style="width: 100%;">
				            <input type="text" id="clntNm" name="clntNm" disabled required="required" msg="매출처">
				            <a id="btnClnt" onclick="openSecondClntSearch();"><i class="i_search_w"></i></a>
			            </div>
	                </td>
	                <th>등록일</th>
	                <td>                                
	                    <input type="text" id="creatDttm" name="creatDttm" readOnly tall>
	                </td>
	            </tr>
	            <tr>
	                <th class="hit">현장명</th>
	                <td colspan="3">     
	                	<input type="hidden" id="siteCd" name="siteCd"/>
			            <input type="text" id="siteNm" name="siteNm" required="required" msg="현장명" maxLength="50" tall/>
	                </td>
	                <th>현장담당자</th>
	                <td>	              
			            <input type="text" id="siteMngNm" name="siteMngNm" maxLength="25" tall/>
	                </td>
	            </tr>
	            <tr>
	                <th>프로젝트</th>
	                <td colspan="3" style="border-left: 0px !important;">
	                    <input type="hidden" id="prjctCd" name="prjctCd">
		                <div class="search_form" style="width: 100%;">
				            <input type="text" id="prjctNm" name="prjctNm" readonly>
				            <a id="btnPrjct" onclick="openSecondPrjctSearch();" tall><i class="i_search_w"></i></a>
			            </div>
	                </td>
	                <th>전화번호</th>
	                <td style="border-left: 0px !important;">
	                    <input id="telNo" name="telNo" type="text" style="width: 100%;" onKeyUp="telNumberFormatter(this);" maxLength="50" tall>
	                </td>
	            </tr>
            
	            <tr>	
	            	<th>영업담당자</th>
					<td>
							<input type="hidden" id="mngId" name="mngId" style="width: 76%;" maxlength="20">
							<div class="search_form">
								<input type="text" id="mngNm" name="mngNm" readonly="readonly">
								<a onclick="openUserTree();" tall><i class="i_search_w"></i>
								</a>
							</div>
					</td>
	            	<th>현장명 약어</th>
	            	<td>
	            		<input id="siteAbbrNm" name="siteAbbrNm" type="text">
	            	</td>
	            	<th class="">E-Mail</th>
					<td>
						<input id="clntEmail" name="clntEmail" type="text" onkeyup="exceptKorean(this);" maxlength="50" tall>
					</td>
					
	            </tr>
	            <tr>
	                <th class="hit">판매지역</th>
	                	<td>
	                		<select data-kind="SALESAREA" id="salesAreaCd" name="salesAreaCd" required="required" msg="판매지역" tall>
	                			<option value="">전체</option>
	              			</select>  
	                	</td>
	                
	   				<th>사용여부</th>
	            	<td>
	            		<select id="useYn" name="useYn" data-kind="YN" tall>
	                    	<option value="">선택</option>
	                    </select>
	            	</td>
	        		
					<th class="">Fax</th>
					<td>
						<input id="clntFaxNo" name="clntFaxNo" type="text" onkeyup="telNumberFormatter(this);" maxlength="13" tall>
					</td>
	            </tr>	 
	                       
	            <tr>		            
	            	<th rowspan="1">주소</th>
	            	<td colspan="1">
	            		<div class="search_form">
							<input type="text" id="siteAddrZip" name="siteAddrZip" readonly> 
							<a onclick="openDaumPostcode();" tall><i class="i_search_w"></i>
							</a>
						</div>
	            	</td>
	            	<td colspan="2">
	            		<input type="text" id="siteAddr" name="siteAddr" placeholder="선택 주소지" readonly tall/>
	            	</td>
	            	<td colspan="2">
	            		<input type="text" id="siteAddrSub" name="siteAddrSub" placeholder="상세 주소 입력" maxLength="50" tall/>
	            	</td>
	            </tr>
 
	        </table>
	        <table>
				<tr>
					<td colspan="2" style="text-align: LEFT; border-right: 0;">가공관련</td>
					<td colspan="9"></td>
				</tr>
			</table>
			<table>
	            <colgroup>
	                <col width="12%">
	                <col width="">
	                <col width="12%">
	                <col width="">
	                <col width="12%">
	                <col width="">
	            </colgroup>

	            <tr>
	            	<th>가공공장</th>
	            	<td>
	            		<select id="whCd" name="whCd" data-kind="WH">
	                    	<option value="">선택</option>
	                    </select>
	            	</td>
	            	<th>외주가공장1</th>
						<td>
							<select id="scndWhCd" name="scndWhCd" data-kind="WH" style="width:80%" tall>
								<option value="">전체</option>
							</select>
							<a name="tallProc" onclick="onTallProc('1')">임가공</a>
						</td>	
						<th>외주가공장2</th>
						<td>
							<select id="thrdWhCd" name="thrdWhCd" data-kind="WH" style="width:80%" tall>
								<option value="">전체</option>
							</select>
							<a name="tallProc" onclick="onTallProc('2')">임가공</a>
						</td>	
				
	            </tr>	            
	            <tr>
                   <th>가공담당자</th>
					<td>
						<input type="hidden" id="outordMngId" name="outordMngId" style="width: 76%;">
						<div class="search_form">
							<input type="text" id="outordMngNm" name="outordMngNm"> 
							<a onclick="openUserTree('FRST');"><i class="i_search_w"></i>
							</a>
						</div>
					</td>
					<th>외주담당자1</th>
					<td>
						<input type="hidden" id="scndWhMngId" name="scndWhMngId" style="width: 76%;" tall>
						<div class="search_form">
							<input type="text" id="scndWhMngNm" name="scndWhMngNm"> 
							<a onclick="openUserTree('SCND');" tall><i class="i_search_w"></i>
							</a>
						</div>
					</td>
					<th>외주담당자2</th>
					<td>
						<input type="hidden" id="thrdWhMngId" name="thrdWhMngId" style="width: 76%;" tall>
						<div class="search_form">
							<input type="text" id="thrdWhMngNm" name="thrdWhMngNm"> 
							<a onclick="openUserTree('THRD');" tall><i class="i_search_w"></i>
							</a>
						</div>
					</td>
	            </tr>	            
	            <tr>	
					<th>연락처</th>
					<td style="border-left: 0px !important;">
	                    <input id="outordTelNo" name="outordTelNo" type="text" style="width: 100%;" onKeyUp="telNumberFormatter(this);" maxLength="50">
	                </td>
					<th>연락처1</th>
					<td style="border-left: 0px !important;">
	                    <input id="scndWhTelNo" name="scndWhTelNo" type="text" style="width: 100%;" onKeyUp="telNumberFormatter(this);" maxLength="50">
	                </td>
					<th>연락처2</th>
					<td style="border-left: 0px !important;">
	                    <input id="thrdWhTelNo" name="thrdWhTelNo" type="text" style="width: 100%;" onKeyUp="telNumberFormatter(this);" maxLength="50">
	                </td>
	            </tr>	 
	            <tr>
	               	<th>수주형태</th>
					<td>
						<select id="ordTyp" name="ordTyp" data-kind="ORDTYP" msg="수주형태" onchange="setByOrdTyp(this.value);">
							<option value="">전체</option>
						</select>
					</td>
	            
	            	<th class="">제강사</th>
					<td class="tl">
						<select id="makrCd" name="makrCd" data-kind="MAKR" style="width: 50%" tall></select>
  						<label for="tnkeyYn">제강사턴키여부</label>
						<input type="checkbox" id="tnkeyYn" name="tnkeyYn">
					</td>
					<th>커플러 매입업체</th>
					<td class="drctArea">
						<input type="hidden" id="cplrPchsClntCd" name="cplrPchsClntCd" style="width: 76%;">
						<div class="search_form">
							<input type="text" id="cplrPchsClntNm" name="cplrPchsClntNm" readonly="readonly">
							<a onclick="openSecondClntSearch('CPLRP');" tall><i class="i_search_w"></i>
							</a>
						</div>
					</td>
	            </tr>
 	            <tr>
	               	<th></th>
	               	<td></td>
	               	<th>매입처</th>
					<td class="drctArea">
						<input type="hidden" id="pchsClntCd" name="pchsClntCd" style="width: 76%;">
						<div class="search_form">
							<input type="text" id="pchsClntNm" name="pchsClntNm" readonly="readonly">
							<a onclick="openSecondClntSearch('PCHS');" tall><i class="i_search_w"></i>
							</a>
						</div>
					</td>	            
	            	<th>커플러 매출업체</th>
					<td class="drctArea">
						<input type="hidden" id="cplrSellClntCd" name="cplrSellClntCd" style="width: 76%;">
						<div class="search_form">
							<input type="text" id="cplrSellClntNm" name="cplrSellClntNm" readonly="readonly">
							<a onclick="openSecondClntSearch('CPLRS');" tall><i class="i_search_w"></i>
							</a>
						</div>
					</td>

	            </tr>  
 	            <tr>
	               	<th>롤러값 사용여부</th>
	               	<td>
	               		<select id="rllrvalUseYn" name="rllrvalUseYn" tall>
							<option value="Y">Y</option>
							<option value="N">N</option>
						</select>
	               	</td>
	               	<th>원산지 출력여부</th>
					<td>
	               		<select id="orgplcePrtnYn" name="orgplcePrtnYn" tall>
							<option value="Y">Y</option>
							<option value="N">N</option>
						</select>
					</td>	            
	            	<th>태그 절단길이 표시여부</th>
					<td>
	               		<select id="tagCttnlenDpYn" name="tagCttnlenDpYn" tall>
							<option value="Y">Y</option>
							<option value="N">N</option>
						</select>
					</td>

	            </tr>  
	        </table>	        
	        <input type="hidden" id="userId" name="userId">
	        <input type="hidden" id="pgmId" name="pgmId" value="SD0902P01">
	        <input type="hidden" id="outordLossRate" name="outordLossRate">
	        <input type="hidden" id="outordUpr" name="outordUpr">
<!-- 					<th class="">Loss율(%)</th> -->
<!-- 						<td> -->
<!-- 							<input id="outordLossRate" name="outordLossRate" type="text" onkeyup="onlyNumber(this)"> -->
<!-- 						</td> -->
<!-- 					<th>단가</th> -->
<!-- 						<td> -->
<!-- 							<input id="outordUpr" name="outordUpr" type="text" maxlength="13" onkeyup="onlyNumber(this); onlyNumber(this);" comma> -->
<!-- 						</td>	 -->
	        <!-- 계약상세 프로젝트관리와 같은 방식 -->
			<table>
				<tr>
					<td colspan="2" style="text-align: LEFT; border-right: 0;">제품상세</td>
					<td colspan="9">
						<div class="add_btn">
							<a onclick="addNewRow();" authchk>+</a> 
							<a onclick="removeDetailRow();" authchk>-</a>
						</div>
					</td>
				</tr>
			</table>
			<div class="ofx_s" style="width: 100%;">
			  <table id="detailTb">
				<colgroup>
					<col width="3%">
					<col width="20%">
					<col width="30%">
					<col width="50%">
					<col width="20%">
					<col width="30%">
					<col width="30%">
				</colgroup>
				<tr>
					<th></th>
					<th class="tc hit">제품구분</th>
					<th class="tc">제품강종</th>
					<th class="tc">SPEC</th>
					<th class="tc">Loss율(%)</th>
					<th class="tc" title="철근:가공단가, 기타:판매단가">판매단가</th>
					<th class="tc" title="철근:매입단가, 기타:매입단가">매입단가</th>
				</tr>
				</table>
			    <table id="frameTable" style="display: none;">
					<tr class="detailRow" name="tableCd">
					<td>
						<input type="checkbox" name="detailChkBox" onclick="ctrlAllChkBox('D');">
						<input type="hidden" name="siteSeq">
						<input type="hidden" name="prjctSeq">
					</td>
					<td>
						<div class="search_form">
							<select id="prdtDivCd" name="prdtDivCd" data-kind="PRDTDIV" onchange="prdtDivCombo(this);" msg="제품구분">
								<option value="">선택</option>
							</select>
						</div>
					</td>
					<td>
						<div class="search_form">
							<select id="prdtStknCd" name="prdtStknCd" onchange="prdtStknCombo(this);"  msg="제품강종">
								<option value="">선택</option>
							</select>
						</div>
					</td>
					<td class="drctArea">
						<div class="search_form">
							<input type="hidden" id="prdtSpecCd" name="prdtSpecCd" readonly="readonly"> 
							<input type="text" id="prdtSizeNm" name="prdtSizeNm" style="text-align: left" maxlength="100" onkeyup="exceptKorean(this)">
							<a onclick="prdtSpecSearch(this);"><i class="i_search_w"></i>
							</a>
						</div>
					</td>
					<td>
						<input class="tc" name="lossRate" type="text" onkeyup="onlyNumber(this)" comma>
					</td>
					<td>
						<input class="tc" name="cplrUpr" type="text" onkeyup="onlyNumber(this)" comma title="철근:가공단가, 기타:판매단가" maxlength="4">
					</td>
					<td>
						<input class="tc" name="pchsCplrUpr" type="text" onkeyup="onlyNumber(this)" comma title="철근:매입단가, 기타:매입단가" maxlength="13" tall>
					</td>
				</tr>
			</table>
            <!-- 운반비 단가 입력 -->
			<table>
				<tr>
					<td colspan="2" style="text-align: LEFT; border-right: 0;">운반비상세</td>
					<td colspan="9">
						<div class="add_btn">
							<a onclick="transAddNewRow();" authchk>+</a> 
							<a onclick="transRemoveDetailRow();" authchk>-</a>
						</div>
					</td>
				</tr>
			</table>
			
			<div class="ofx_s" style="width: 100%;">
			 <table id="trnsTb">
				<colgroup>
					<col width="3%">
					<col width="20%">
					<col width="30%">
					<col width="50%">
				</colgroup>
				<tr>
					<th></th>
					<th class="tc hit">차량</th>
					<th class="tc">단위</th>
					<th class="tc title="단위에 따라 단가 혹은 금액">운송비</th>
				</tr>
			</table>	
			<table id="transFrameTable" style="display: none;">
				<tr class="transRow" id= "transDetailRow" name="transCd">
					<td>
						<input type="checkbox" name="transChkBox" onclick="ctrlAllChkBox('T');">
						<input type="hidden"   name="siteTransSeq"></td>
					<td>
						<input class="tr" id="truckWt" name="truckWt" msg="차량 중량" onkeyup="onlyNumber(this)" comma>
					</td>
					<td>
						<div class="search_form">
							<select id="transUprUnit" name="transUprUnit"  data-kind="TRNSPRU"  msg="운송단가 단위"><!--  -->
								<option value="">선택</option>
							</select>
						</div>
					</td>
					<td>
						<input class="tr" name="transUpr" type="text" onkeyup="onlyNumber(this)" comma title="운송단가">
					</td>
				</tr>
			</table>
			</div>
            <table>
            	<tr>
	            	<th>비고</th>
	                <td colspan="5">     
	                	<textarea class="form-control" id="rmk" name="rmk" style="height: 80px;" maxlength="500"></textarea>
	                </td>
	            </tr> 
            </table>
            
            
            
		    <br>
		    <!-- 하단 버튼 -->
		    <div>  <!--  class="popup_bottom_btn" -->
		      <button id="actionBtn" authchk></button>
			  <button type="button" class="btn btn-default btn-sm" onclick="modalStack.close();">닫기</button>
		    </div>
	  </form>
 </div>
<link rel="stylesheet" href="/static/css/jstree/style.min.css" />
<script src="/static/js/jstree/jstree.min.js"></script>
<script type="text/javascript">
	
	//매입매출구분
	var clntType = null;
	var treeType = null;
	var fileArr = [];
	var deleteFileArr = [];
	var selectedIdx = 0;
	
	$(document).ready(function() {
		setCommonSelect($(".popup_area select[data-kind]"));
		setInit();
		//$(".popup_area input").prop("readonly", true);
		//$(".popup_area select").prop("disabled", true);
		
		//권한체크
		authChk("SD0901M01");
	});
	
	function setInit() {
		//selectOrderInfo();
		if(actionType == "C"){
			$('#actionBtn').on("click", function(){insertSite();});
			$('#actionBtn').text("등록");
			var format = new Date();
		    var year = format.getFullYear();
		    var month = format.getMonth() + 1;
		    if(month<10) month = '0' + month;
		    var date = format.getDate();
		    if(date<10) date = '0' + date;
			$("#creatDttm").val(year + "-" + month + "-" + date);
			$("#popForm #coCd").val(jwt.coCd);
			$("#popForm #useYn").val("Y");
			$("[name='tallProc']").hide();

			$(".detailRow [name='prdtDivCd']").eq(0).val("PRDTDIV11");
			prdtDivCombo($(".detailRow [name='prdtDivCd']"));
			
			setWareHouse($("#popForm #coCd").val());
		} else if(actionType == "U"){
			$('#actionBtn').on("click", function(){updateSite();});
			$('#actionBtn').text("저장");
			
			selectSiteDetail();
			
			setWareHouse($("#popForm #PrjctNm").val());
		}
	}
	
	function makeFormData(){		
		$("#popForm input").prop("disabled", false);
		$("#popForm select").prop("disabled", false);
		$("#popForm #userId").val(jwt.userId);
		
		//콤마 제거
		$.each($('input[comma]'), function(idx, elem){
			deleteComma(elem);
		});
		
		var formData = new FormData($("#popForm")[0]);
		
		// 턴키여부 set
		if($('#popForm #tnkeyYn').is(":checked")){
			formData.set("tnkeyYn", "Y");
		}else{
			formData.set("tnkeyYn", "N");
		}
		// 프로젝트Dtl 추가
		var detailArr = [];
		$.each($("#detailTb tr[name='tableCd']"), function(idx, elem){
			var detailObj = {};
			$.each($(elem).find('[name]'), function(idx, elem){
				detailObj[elem.name] = elem.value;
			});
			detailArr.push(detailObj);
		});
		formData.append("detailArr", JSON.stringify(detailArr));
		
		// 프로젝트 운반비Dtl 추가
		var transArr = [];
		$.each($("#trnsTb tr[name='transCd']"), function(idx, elem){
			var transObj = {};
			$.each($(elem).find('[name]'), function(idx, elem){
				transObj[elem.name] = elem.value;
			});
			transArr.push(transObj);
		});
		formData.append("transArr", JSON.stringify(transArr));
		return formData;
	}
	
	function selectSiteDetail(){
		var row = gridView.target.getList("selected")[0];
		var formData = {
				"siteCd" : row.siteCd,
				"coCd" : row.coCd,
		}
		postAjax("/user/sd/sd09/selectSiteDetail", formData, null, function(data){
			setSiteDetail(data.result);
		});
	}

	function setSiteDetail(obj){
		var siteInfo = obj.siteInfo;
		var siteDtl = obj.siteDtl;
		var siteTrans = obj.siteTrans
		//메인정보 세팅
		$.each(siteInfo, function(key, value){
			var itemValue = value;
			if($('#popForm #'+key)[0]){
				if($('#popForm #'+key).is('[comma]')){
					itemValue = addCommaStr(itemValue);
				}
				
				// 창고 Set
				if(key == "coCd"){
					setWareHouse(value);
				}
				
				// 턴키여부 set
				if(key == "tnkeyYn" && value == "Y"){
					$('#popForm #'+key).prop("checked", true);
				}	
				
				$('#popForm #'+key).val(itemValue);
			}
		});
		
		$("#popForm input").prop("disabled", false);
		$("#popForm select").prop("disabled", false);
		$('#popForm #coCd').prop("disabled", true);
// 		$('#popForm #clntNm').prop("disabled", true);
// 		$('#popForm #prjctNm').prop("disabled", true);
		$('#popForm #clntNm').prop("readonly", true);
		
		// 수정할 때 프로젝트는 변경 불가
		$('#popForm #prjctNm').prop("disabled", true);
		$('#popForm #btnPrjct').remove();
		
		//제품상세 세팅
		$.each(siteDtl, function(idx, obj){
			var $addedRow = addNewRow();
			$.each($addedRow.find('[name]'), function(idx, elem){
				var itemValue = obj[elem.name];
				if(itemValue){
					if($(elem).is('[comma]')){
						itemValue = addCommaStr(itemValue);
					}
					$(elem).val(itemValue);
				}
				if($('#cplrUntpcDiv #detailTb tr.detailRow').eq(idx).find('[name="prjctSeq"]').val()){				
					$('#cplrUntpcDiv #detailTb tr.detailRow').eq(idx).find('input, select').prop("disabled", true)
					$('#cplrUntpcDiv #detailTb tr.detailRow').eq(idx).find('[name="pchsCplrUpr"]').prop("disabled", false)
				}
			});
		});
		
		//운반비상세 세팅
	    $.each(siteTrans, function(idx, obj){
			var $transAddedRow = transAddNewRow();
			$.each($transAddedRow.find('[name]'), function(idx, elem){
				var itemValue = obj[elem.name];
				if(itemValue){
					if($(elem).is('[comma]')){
						itemValue = addCommaStr(itemValue);
					}
					$(elem).val(itemValue);
				}
				//$('#cplrUntpcDiv #trnsTb tr.transRow').eq(idx).find('input, select').prop("disabled", false);			
			});
		});
	}
	
	function insertSite() {
		if(inputValidation($('.popup_area [required]'))) {
			var formData = makeFormData();
			filePostAjax("/user/sd/sd09/insertSite", formData, function(data){
				alert(data.resultMessage);           
				gridView.setData(0);
				modalStack.close();
			});
		}
	}
	
	function updateSite() {
		if(inputValidation($('.popup_area [required]'))) {
			var formData = makeFormData();
			filePostAjax("/user/sd/sd09/updateSite", formData, function(data){
				alert(data.resultMessage);           
				gridView.setData(0);
				modalStack.close();
			});
		}
	}
	
	function setSitePrdtDtail(idx, item){

		$.each(item, function(key, value){
			if($(".detailRow").find("[name="+key+"]")[idx] != undefined) {
				var itemValue = value;
				if($(".detailRow").find("[name="+key+"]").eq(idx).is('[comma]')){
					itemValue = addCommaStr(itemValue);
				}
				$(".detailRow").find("[name="+key+"]")[idx].value = itemValue;
				
				if(key == "prdtDivCd"){
					var formData = {"prdtDivCd" : value};
					postAjaxSync("/user/sd/sd05/prdtDivCombo", formData, null, function(stknData){
						var prdtStknData = stknData.codeInfoList;
						var stknOptionHtml = '<option value="">선택</option>';
						for (var i = 0; i < prdtStknData.length; i++) {
							stknOptionHtml += '<option value=\"' +  prdtStknData[i].prdtStkn + '\">'
							+ prdtStknData[i].prdtStknNm + '</option>';
						}
						$(".detailRow [name='prdtStknCd']").eq(idx).html(stknOptionHtml);
					});
				}
				
// 				if(key == "prdtDivCd"){
// 					if(value == "PRDTDIV11"){
// 						$('.detailRow a').eq(idx).prop("disabled",false);
// 			 	 		$('.detailRow [name=prdtSizeNm]').eq(idx).prop("disabled",false);
// 					} else {
// 						$('.detailRow a').eq(idx).prop("disabled",true);
// 					}
// 				}
			}
		});
	}

	// 운반비 상세 세팅
	function setSiteTransDetail(idx, item){

		$.each(item, function(key, value){
			if($(".transRow").find("[name="+key+"]")[idx] != undefined) {
				var itemValue = value;
				if($(".transRow").find("[name="+key+"]").eq(idx).is('[comma]')){
					itemValue = addCommaStr(itemValue);
				}
				$(".transRow").find("[name="+key+"]")[idx].value = itemValue;
			}
		});
	}
	
	// 거래처 검색
	function openSecondClntSearch(type) {
		openSecondModal("/static/html/cmn/modal/clntSearch.html", 600, 420, "거래처 검색", {}, function (grid) {
			var row = grid.target.getList("selected")[0];
			if(type=='PCHS'){
				$('#popForm #pchsClntCd').val(row.clntCd);
				$('#popForm #pchsClntNm').val(row.clntNm);
			}else if(type=='CPLRP'){
				$('#popForm #cplrPchsClntCd').val(row.clntCd);
				$('#popForm #cplrPchsClntNm').val(row.clntNm);
			}else if(type=='CPLRS'){
				$('#popForm #cplrSellClntCd').val(row.clntCd);
				$('#popForm #cplrSellClntNm').val(row.clntNm);
			}else{
				$('#popForm #clntCd').val(row.clntCd);
				$('#popForm #clntNm').val(row.clntNm);	
			}
		});
	}

	// 프로젝트 검색
	function openSecondPrjctSearch() {
		openSecondModal("/static/html/cmn/modal/prjctSearch.html", 600, 420, "프로젝트 검색", {}, function (grid) {
			var row = grid.target.getList("selected")[0];
			$('#popForm #prjctCd').val(row.prjctCd);
			$('#popForm #prjctNm').val(row.prjctNm);
			$("#popForm #siteAddrZip").val(row.prjctAddrZip);
			$("#popForm #siteAddr").val(row.prjctAddr);
			$("#popForm #siteAddrSub").val(row.prjctAddrSub);
		});
	}
	
	// 주소 검색
	function openDaumPostcode() {
		new daum.Postcode({
			oncomplete:function(data){
				// 우편번호
				$('#siteAddrZip').val(data.zonecode);
				$('#siteAddr').val((data.roadAddress || data.address) + ' ' + data.buildingName);
			}
		}).open();
	}

	function modalClose(){
		modalStack.close();
	}
	
	function openUserTree(type) {
		var userId = $('#mngId').val();
		
		if      (type == 'FRST'){	userId = $('#outordMngId').val();			
		}else if(type == 'SCND'){	userId = $('#scndWhMngId').val();			
		}else if(type == 'THRD'){	userId = $('#thrdWhMngId').val();			
		}
		
		var paramObj = {
		 	"coCd" : "GUM", //$('#coCd').val(),
			"userId": userId,
			"useYn": "Y"
		};
		
		openSecondModal("/static/html/cmn/modal/userSearch.html", 300, 500, "사용자 검색", paramObj, function (tree){
			var checkedId = tree.get_checked()[0];
			var checkedNode = tree.get_node(checkedId);
			if      (type == 'FRST'){	$('#outordMngId').val(checkedNode.id);	$('#outordMngNm').val(checkedNode.text);
			}else if(type == 'SCND'){	$('#scndWhMngId').val(checkedNode.id);	$('#scndWhMngNm').val(checkedNode.text);
			}else if(type == 'THRD'){	$('#thrdWhMngId').val(checkedNode.id);	$('#thrdWhMngNm').val(checkedNode.text);
			}else{						$('#mngId').val(checkedNode.id);        $('#mngNm').val(checkedNode.text);
			}
		});
	}
	
	// 창고 set
	function setWareHouse(value){
		// 창고 set	
		$('#whCd').data("desc", value);
	//	$('#whCd_S').empty();
		$('#whCd option:not([value=""])').remove()
		setCommonSelect($('#whCd'));

		$('#scndWhCd').data("desc", value);
		$('#scndWhCd option:not([value=""])').remove();
		setCommonSelect($('#scndWhCd'));
		
		$('#thrdWhCd').data("desc", value);
		$('#thrdWhCd option:not([value=""])').remove();
		setCommonSelect($('#thrdWhCd'));
	}
	
	//list 행추가
	function addNewRow() {
		var $detailRow = $('#cplrUntpcDiv #frameTable tr[class="detailRow"]').clone();
		$('#cplrUntpcDiv #detailTb tbody').append($detailRow[0]);
		
		$.each($detailRow.find(':input'), function(){
			if($(this).attr("name") == "prdtDivCd"){
				this.value = 'PRDTDIV11';
 				prdtDivCombo(this);
			} else {
				this.value = '';
				this.checked = '';
			}
			 
			if($(this).attr("name") == "prdtDivCd"){
				$(this).prop("required", "required");
			}
			
			$(this).prop("disabled", false);
		});
		return $detailRow;
	}
	
	// 운반비 list 행추가
	function transAddNewRow() {
		var $transDetailRow = $('#cplrUntpcDiv #transFrameTable tr[name="transCd"]').clone();
		$('#cplrUntpcDiv #trnsTb tbody').append($transDetailRow[0]);
		$.each($transDetailRow.find(':input'), function(){
			$(this).prop("disabled", false);
			this.value = '';
			this.checked = '';
		});
		if($(this).attr("name") == "truckWt"){
			$(this).prop("required", "required");
		}
		
		return $transDetailRow;
	}
	
	//list 행삭제	+ DB 삭제
	function removeDetailRow(){
		var detailArr = [];
		$.each($('input:checkbox[name="detailChkBox"]'), function(idx, elem){
			var detailObj = {};
			if($(elem).is(":checked")){
				var $closestRow = $(elem).closest('.detailRow');
				detailObj["coCd"]     = $('#coCd').val();
				detailObj["siteCd"]   = $('#siteCd').val();
				detailObj["siteSeq"]  = $closestRow.find('[name="siteSeq"]').val();
				detailObj["prjctSeq"]  = $closestRow.find('[name="prjctSeq"]').val();
				
				if(!detailObj.prjctSeq){
					detailArr.push(detailObj);
				}				
 				$(elem).closest('.detailRow').remove();
			}
		});		
	}
	
	//list 행삭제	+ DB 삭제
	function transRemoveDetailRow(){
		var transArr = [];
		$.each($('input:checkbox[name="transChkBox"]'), function(idx, elem){
			var transObj = {};
			if($(elem).is(":checked")){
				var $closestRow = $(elem).closest('.transRow');
				transObj["coCd"]     = $('#coCd').val();
				transObj["siteCd"]   = $('#siteCd').val();
				transObj["siteTransSeq"]  = $closestRow.find('[name="siteTransSeq"]').val();
				
				transArr.push(transObj);
 				$(elem).closest('.transRow').remove();
			}
		});		
	}
	//제품
	function prdtDivCombo(elem){
		
	 	$targetRow = $(elem).closest('tr[name="tableCd"]');
		if($('#prdtDivCd').val() != "PRDTDIV11"){
			$(".drctArea button").prop("disabled", true);
		}else{
			$(".drctArea button").prop("disabled", false);
		}
		if($targetRow.find('select[name="prdtDivCd"]').val()){
			var formData = {"prdtDivCd" : $targetRow.find('select[name="prdtDivCd"]').val()};
			postAjaxSync("/user/sd/sd05/prdtDivCombo", formData, null, function (data){
				var codeList = data.codeInfoList; 
				var optionHtml = '<option value="">선택</option>';
				for (var i = 0; i < codeList.length; i++) {
					optionHtml += '<option value=\"' +  codeList[i].prdtStkn + '\">'
						+ codeList[i].prdtStknNm + '</option>';
					}
				$targetRow.find('select[name="prdtStknCd"]').html(optionHtml);
			})
			if($targetRow.find('select[name="prdtDivCd"]').val() != "PRDTDIV11"){
				$targetRow.find('button').prop("disabled",true);
	 	 		//$targetRow.find('[name=prdtSizeNm]').prop("disabled",true);
			} else {
				$targetRow.find('button').prop("disabled",false);
	 	 		$targetRow.find('[name=prdtSizeNm]').prop("disabled",false);
			}
		}else{
			$targetRow.find('select[name="prdtStknCd"]').val("");
 			$targetRow.find('input[name="prdtSizeNm"]').val("");
		}
 	}	
	//강종
 	function prdtStknCombo(elem){
 		$targetRow = $(elem).closest('tr[name="tableCd"]');
 		if(!$targetRow.find('select[name="prdtDivCd"]').val()){ 
 			alert("제품구분을 선택하세요.");
//  			$('#prdtStknCd').val("");
 			$targetRow.find('select[name="prdtStknCd"]').val("");
 			$targetRow.find('input[name="prdtSizeNm"]').val("");
 			return;
 		} 
 		if(!$targetRow.find('select[name="prdtStknCd"]').val()){ 
 			$targetRow.find('input[name="prdtSizeNm"]').val("");
 			return;
 		} 		
 	}	
	// SPEC
 	function prdtSpecSearch(elem){
 		if($(elem).closest('tr[name="tableCd"]').find('#prdtDivCd').val() == ""){
 			alert("제품구분을 선택하세요.");
 			$(elem).closest('tr[name="tableCd"]').find('#prdtStknCd').val("");
 			return;
 		}else if($(elem).closest('tr[name="tableCd"]').find('#prdtStknCd').val() == ""){
 			alert("제품강종을 선택하세요.");
 			return;
		}else if(!$(elem).closest('tr[name="tableCd"]').find('#prjctSeq').val()){
			$targetRow = $(elem).closest('tr[name="tableCd"]');
			// selpchCd - SELPCH2: 매출
			var paramObj = {
				"prdtStkn" : $targetRow.find('#prdtStknCd').val(),
				"useYn": "Y"
			};
			$targetRow = $(elem).closest('tr[name="tableCd"]');
			var eq = $targetRow.index() - 1;
			openSecondModal("/static/html/user/sd/sd05/SD0502P02.html", 300, 580, "SPEC 검색", paramObj, function (grid) {
				var size = ""
				var row = grid.target.getList("selected");
				var isDup = false;
				var isMsg = false;
				for(var i=0; i<row.length; i++){
					isDup = false;
					$.each($('input[name="prdtSizeNm"]'), function(idx, elem){
						if(eq != idx){
							var dupArr = elem.value.split(",");
							for(var j = 0; j < dupArr.length; j++){
								if(dupArr[j] == row[i].prdtSpec){
									isDup = true;
									isMsg = true;
								}
							}
						}
					});
					if(isDup == true){
						
					} else {
						size += row[i].prdtSpec + ",";
					}
				}
				if(isMsg == true){
					alert("중복된 제품SPEC이 제외되었습니다.");
				}
				szie1 = size.substr(0, size.length-1)
				$targetRow.find('input[name="prdtSizeNm"]').val(szie1);
			});
 		}
 	}
	// 수주형태에 따른 제강사턴키 구분 
	function setByOrdTyp(ordType){
		if(ordType =="ORDTYP02"){ //가공(턴키)
			$("#tnkeyYn").prop("disabled",false);		
		}else{
			$("#tnkeyYn").prop("checked", false);
			$("#tnkeyYn").prop("disabled", true);			
			$("#tnkeyYn").val("N");		
		}
	};
	
	// 임가공
	function onTallProc(type){
		var whCd;
		if(type == '1'){
			whCd = $("#scndWhCd").val();
		} else {
			whCd = $("#thrdWhCd").val();
		}

		$('#actionBtn').on("click", function(){insertSite();});
		$('#actionBtn').text("등록");
		$.each($('[tall]'), function(idx, elem){
			$(elem).prop("disabled", true);
			$(elem).attr("onclick", null);
		});
		
		$.each($("[name='pchsCplrUpr']"), function(idx, elem){
			$(elem).val("");
		});
		
		$("#popForm #coCd").prop('disabled', false);
		$("#popForm #whCd").val(whCd);
		$("#popForm #ordTyp").val("ORDTYP03");
		$("#popForm #ordTyp").prop("disabled", true);
		$("#popForm #orgSiteCd").val($("#popForm #siteCd").val());
		$("#scndWhCd").val("");
		$("#thrdWhCd").val("");
		$("#scndWhMngId").val("");
		$("#thrdWhMngId").val("");
		$("#scndWhMngNm").val("");
		$("#thrdWhMngNm").val("");
		$("#popForm #coCd").val("");
		var formData = {
				"whCd" : whCd
		}
		postAjax("/user/sd/sd09/selectClntFromWh", formData, null, function(data){
			$("#popForm #clntCd").val(data.result.clntCd);
			$("#popForm #clntNm").val(data.result.clntNm);
		});
	}
</script>