<!DOCTYPE html>
<html lang="ko">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="icon" href="/static/favicon.ico" type="image/x-icon">
	<link rel="stylesheet" href="/static/bootstrap/css/bootstrap.min.css">
	<link rel="stylesheet" href="/static/bootstrap/css/bootstrap-theme.min.css">
	<link rel="stylesheet" href="/static/bootstrap/css/dashboard.css">
	<link rel="stylesheet" href="/static/bootstrap/css/bootstrap-datepicker.css">
	<link rel="stylesheet" href="/static/fontawesome/css/all.css">
	<link rel="stylesheet" href="/static/css/ax5/ax5mask.css" />
	<link rel="stylesheet" href="/static/css/ax5/ax5modal.css" />
	<link rel="stylesheet" href="/static/css/ax5/ax5toast.css" />
	<link rel="stylesheet" href="/static/css/jstree/style.min.css" />
	<link rel="stylesheet" href="/static/css/gnb.css" />
	<link rel="stylesheet" href="/static/css/main.css" />
	<link rel="stylesheet" href="/static/css/sub.css" />
	<link rel="stylesheet" href="/static/css/common.css" />
	
	<script src="/static/js/jquery-latest.min.js"></script>
	<script src="/static/js/jquery.serializeObject.js"></script>
	<script src="/static/bootstrap/js/bootstrap.min.js"></script>
	<script src="/static/bootstrap/js/bootstrap-datepicker.min.js"></script>
	<script src="/static/bootstrap/js/bootstrap-datepicker.ko.min.js"></script>
	<script src="/static/js/moment/moment-with-locales.js"></script>
	<script src="/static/js/ax5/ax5core.min.js"></script>
	<script src="/static/js/ax5/ax5mask.min.js"></script>
	<script src="/static/js/ax5/ax5modal.min.js"></script>
	<script src="/static/js/ax5/ax5toast.min.js"></script>
	<script src="/static/js/jstree/jstree.min.js"></script>
	<script src="/static/js/global.js"></script>
	
	<style>
		span.complete{
			color: springgreen;
		}
		span.fail{
			color: red;
		}
	</style>
</head>

<body>
	<div id="head_area"></div>
	<div id="top_area"></div>
	<div id="main_area">
		<form id="closeForm">
			<!-- 페이지 상단 -->
			<div class="contents no_bg">
				<ul class="btn_ul">
					<li class="btn_r">
						<a onclick="initSearch();">
							<button type="button" class="bg_gray">초기화</button>
						</a> 
						<a onclick="">
							<button type="button" class="bg_gray" onclick="selectClose();">검 색</button>
						</a>
					</li>
				</ul>
			</div>
			<!-- 검색 콘텐츠 -->
			<div class="contents search">
				<!-- 테이블 인풋 3분할 -->
				<table class="table_input type02">
					<tr>
						<th>회사</th>
						<td>
							<select id="coCd" name="coCd" data-kind="CO" data-search="coCd">
								<option value="">전체</option>
							</select>
						</td>
						<th>마감대상년월</th>
						<td>
							<div class="date_input">
								<input type="text" class="input_calendar" id="closeYm" name="closeYm" data-search="closeYm" date> 
							</div>
						</td>
					</tr>
				</table>
			</div>
			<!-- 콘텐츠 -->
			<div class="contents no_bg">
				<!-- 콘텐츠 타이틀 -->
				<div class="add_btn_small pdl10">
					<a style="width:80px;" onclick="saveClose();">저장</a>
				</div>
				<div class="add_btn_small pdl10">
					<a style="width:80px;" onclick="excuteClose();">마감실행</a>
				</div>
			</div>
			<!-- 콘텐츠 -->
			<div class="contents">
				<div class="popup_area">
					<div class="popup_table">
						<table>
							<colgroup>
								<col width="15%">
								<col width="">
								<col width="15%">
								<col width="">
							</colgroup>
							<tr>
								<th>매입마감일자</th>
								<td>
									<input type="text" class="input_calendar" id="pchsCloseDttm" name="pchsCloseDttm" date> 
								</td>
								<th>매입마감여부</th>
								<td>
									<ul class="dp_ib">
										<li class="pdr10">
											<input type="radio" id="pchsCloseY" name="pchsCloseYn" value="Y">
											<label for="pchsCloseY">예</label>
										</li>
										<li>
											<input type="radio" id="pchsCloseN" name="pchsCloseYn" value="N">
											<label for="pchsCloseN">아니오</label>
										</li>
									</ul>
								</td>
							</tr>
							<tr>
								<th>매출마감일자</th>
								<td>
									<input type="text" class="input_calendar" id="sellCloseDttm" name="sellCloseDttm" date>
								</td>
								<th>매출마감여부</th>
								<td>
									<ul class="dp_ib">
										<li class="pdr10">
											<input type="radio" id="sellCloseY" name="sellCloseYn" value="Y">
											<label for="sellCloseY">예</label>
										</li>
										<li>
											<input type="radio" id="sellCloseN" name="sellCloseYn" value="N">
											<label for="sellCloseN">아니오</label>
										</li>
									</ul>
								</td>
							</tr>
							<tr>
								<th>재고마감일자</th>
								<td>
									<input type="text" class="input_calendar" id="stockCloseDttm" name="stockCloseDttm" date>
								</td>
								<th>재고마감여부</th>
								<td>
									<ul class="dp_ib">
										<li class="pdr10">
											<input type="radio" id="stockCloseY" name="stockCloseYn" value="Y">
											<label for="stockCloseY">예</label>
										</li>
										<li>
											<input type="radio" id="stockCloseN" name="stockCloseYn" value="N">
											<label for="stockCloseN">아니오</label>
										</li>
									</ul>
								</td>
							</tr>
							<tr>
								<th>입금마감일자</th>
								<td>
									<input type="text" class="input_calendar" id="etrdpsCloseDttm" name="etrdpsCloseDttm" date>
								</td>
								<th>입금마감여부</th>
								<td>
									<ul class="dp_ib">
										<li class="pdr10">
											<input type="radio" id="etrdpsCloseY" name="etrdpsCloseYn" value="Y">
											<label for="etrdpsCloseY">예</label>
										</li>
										<li>
											<input type="radio" id="etrdpsCloseN" name="etrdpsCloseYn" value="N">
											<label for="etrdpsCloseN">아니오</label>
										</li>
									</ul>
								</td>
							</tr>
						</table>
					</div>
					<br>
					<div class="popup_table">
						<table>
							<colgroup>
								<col width="15%">
								<col width="">
								<col width="15%">
								<col width="">
							</colgroup>
							<tr>
								<th>재고마감여부</th>
								<td>
									<ul class="dp_ib">
										<li class="pdr10">
											<input type="radio" name="testYn" value="Y" disabled>
											<label>예</label>
										</li>
										<li>
											<input type="radio" name="testYn" value="N" disabled>
											<label>아니오</label>
										</li>
									</ul>
								</td>
								<td>
								</td>
								<td>
								</td>
							</tr>
							<tr>
								<th>입금마감여부</th>
								<td>
									<ul class="dp_ib">
										<li class="pdr10">
											<input type="radio" name="testYn" value="Y" disabled>
											<label>예</label>
										</li>
										<li>
											<input type="radio" name="testYn" value="N" disabled>
											<label>아니오</label>
										</li>
									</ul>
								</td>
								<td>
								</td>
								<td>
								</td>
							</tr>
						</table>
					</div>
					<br>
					<div class="popup_table">
						<table>
							<colgroup>
								<col width="15%">
								<col width="">
							</colgroup>
							<tr>
								<th rowspan="6">마감실행결과</th>
							</tr>
							<tr>
								<td class="tl">
									입고자료취합 --> <span name="stockStatus">작업전</span>
								</td>
							</tr>
							<tr>
								<td class="tl">
									출고자료취합 --> <span name="stockStatus">작업전</span>
								</td>
							</tr>
							<tr>
								<td class="tl">
									재고마감 --> <span name="stockStatus">작업전</span>
								</td>
							</tr>
							<tr>
								<td class="tl">
									입금자료취합
								</td>
							</tr>
							<tr>
								<td class="tl">
									채권마감
								</td>
							</tr>
						</table>
					</div>
				</div>
			</div>
		</form>
	</div>
</body>
</html>

<script type="text/javascript">
	$(document).ready(function() {
		// 페이지 타이틀 set
		mainDefaultLoad("영업관리", "월마감관리");
		// 공통코드 set
		setCommonSelect($("#main_area select[data-kind]"));
		// 접속자 회사 set
		$('#coCd').val(jwt.coCd);
		
		// 마감년월 set
		$('#closeYm').datepicker({
			format : "yyyy-mm",
			minViewMode: 1,
			language : "ko",
			autoclose : true
		})
		.datepicker("setDate", new Date());
		
		// 검색조건 이벤트 bind
		$('[data-search]').on("change", function(){
			selectClose();
		});
		
		// 매입마감일 datepicker bind
		$('#pchsCloseDttm').datepicker({
			format : "yyyy-mm-dd",
			language : "ko",
			autoclose : true
		});
		
		// 매출마감일 datepicker bind
		$('#sellCloseDttm').datepicker({
			format : "yyyy-mm-dd",
			language : "ko",
			autoclose : true
		});
		
		// 재고마감일 datepicker bind
		$('#etrdpsCloseDttm').datepicker({
			format : "yyyy-mm-dd",
			language : "ko",
			autoclose : true
		});
		
		// 입금마감일 datepicker bind
		$('#stockCloseDttm').datepicker({
			format : "yyyy-mm-dd",
			language : "ko",
			autoclose : true
		});
		
		// 월마감정보 select
		selectClose();
	});
	
	// 검색조건 초기화
	function initSearch() {
		
	}
	
	// 월마감정보 select
	function selectClose(){
		var paramObj = {};
		for(var i=0;i<$('[data-search]').length;i++){
			var $tempElem = $('[data-search]').eq(i);
			var tempValue = $tempElem.val();
			if($tempElem.is('[date]')){
				tempValue = deleteHyphenStr(tempValue);
			}
			paramObj[$tempElem.data("search")] = tempValue;
		}
		
		postAjax("/user/sd/sd07/selectClose", paramObj, null, function(data){
			setCloseInfo(data.closeInfo);
		});
	}
	
	// 월마감정보 set
	function setCloseInfo(closeInfo){
		if(closeInfo){
			$.each(closeInfo, function(key, value){
				var $tempElem = $('[name="'+key+'"]');
				if(!$tempElem.is('[data-search]')){
					if($tempElem[0]){
						if($tempElem.is('[date]')){
							$tempElem.datepicker("setDate", moment(value, 'YYYY-MM-DD').toDate());
						}
						
						if($tempElem.prop("type") == "radio"){
							$tempElem.filter('[value="'+value+'"]').prop("checked", true);
						}
					}
				}
			});
		}else{
			$('[date]').not('#closeYm').datepicker("setDate", moment($('#closeYm').val(), 'YYYY-MM').endOf("month").toDate());
			$('input:radio[value="N"]').not('[disabled]').prop("checked", true);
		}
	}
	
	// 저장
	function saveClose(){
		var formData = $('#closeForm').serializeObject();
		formData.closeYm = deleteHyphenStr(formData.closeYm);
		formData.userId = jwt.userId;
		formData.pgmId = "SD0701M01";
		
		putAjax("/user/sd/sd07/saveClose", formData, null, function(data){
			alert(data.resultMessage);
		});
	}
	
	// 마감실행
	function excuteClose(){
		var paramObj = {
			"closeYm": deleteHyphenStr($('#closeYm').val()),
			"userId": jwt.userId,
			"pgmId": "SD0701M01"
		}
		
		postAjaxSync("/user/sd/sd07/excuteClose", paramObj, null, function(data){
			if(data.resultCode == 200){
				$('span[name="stockStatus"]').text("완료");
				$('span[name="stockStatus"]').addClass("complete");
			}else{
				$('span[name="stockStatus"]').text("실패");
				$('span[name="stockStatus"]').addClass("fail");
			}
		});
		
	}
</script>
