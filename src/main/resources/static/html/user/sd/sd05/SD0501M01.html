<!DOCTYPE html>
<html lang="ko">
<head>
   <meta charset="utf-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="width=device-width, initial-scale=1">
   <link rel="icon" href="/static/favicon.ico" type="image/x-icon">
   <link rel="stylesheet" href="/static/bootstrap/css/bootstrap.min.css">
   <link rel="stylesheet" href="/static/bootstrap/css/bootstrap-theme.min.css">
   <link rel="stylesheet" href="/static/bootstrap/css/dashboard.css">
   <link rel="stylesheet" href="/static/bootstrap/css/bootstrap-datepicker.css">
   <link rel="stylesheet" href="/static/fontawesome/css/font-awesome.min.css">
   <link rel="stylesheet" href="/static/css/ax5/ax5grid.css" />
   <link rel="stylesheet" href="/static/css/ax5/ax5mask.css" />
   <link rel="stylesheet" href="/static/css/ax5/ax5modal.css" />
   <link rel="stylesheet" href="/static/css/ax5/ax5toast.css" />
   <link rel="stylesheet" href="/static/css/jstree/style.min.css" />
   <link rel="stylesheet" href="/static/css/common.css" />
   <link rel="stylesheet" href="/static/css/gnb.css" />
   <link rel="stylesheet" href="/static/css/main.css" />
   <link rel="stylesheet" href="/static/css/sub.css" />
   <script src="/static/js/jquery-3.5.1.min.js"></script>
   <script src="/static/js/jquery.serializeObject.js"></script>
   <script src="/static/bootstrap/js/bootstrap.min.js"></script>
   <script src="/static/bootstrap/js/bootstrap-datepicker.min.js"></script>
   <script src="/static/bootstrap/js/bootstrap-datepicker.ko.min.js"></script>
   <script src="/static/js/ax5/ax5core.min.js"></script>
   <script src="/static/js/ax5/ax5grid.min.js"></script>
   <script src="/static/js/ax5/ax5mask.min.js"></script>
   <script src="/static/js/ax5/ax5modal.min.js"></script>
   <script src="/static/js/ax5/ax5toast.min.js"></script>
   <script src="/static/js/jstree/jstree.min.js"></script>
   <script src="/static/js/global.js"></script>
</head>
<body>
	<div id="head_area"></div>
	<div id="top_area">
		<div class="row form-group">
			<span style="font-size: 25px; font-weight: bold;">프로젝트 관리</span>
			<div class="btn_area">
				<a id="logoutBtn"><button class="logout_btn" onclick="logoutClick();" >Logout</button></a>
				<a href="/static/html/admin/admin.html" target="_blank">
				<button class="bg_b">Admin</button>
				</a>
			</div>
			<!-- <div style="float: right;">
				<a id="loginBtn" class="btn btn-default btn-sm" onclick="createProjectModal('C');">등록</a>
				<a id="loginBtn" class="btn btn-default btn-sm" onclick="updateProjectModal('U');">수정</a>
				<a id="loginBtn" class="btn btn-default btn-sm" onclick="deleteProject();">삭제</a>
			</div> -->
		</div>
	</div>
	<div id="main_area">
		<div class="contents no_bg">
	      <ul class="btn_ul">
	        <li class="btn_r">
	        <a onclick = "getData(0);">
	          <button class="bg_gray">검 색</button>
	         </a>
	          <a id="loginBtn" class="btn btn-default btn-sm" onclick="createProjectModal('C');">등록</a>
			  <a id="loginBtn" class="btn btn-default btn-sm" onclick="updateProjectModal('U');">수정</a>
	        </li>
	      </ul>
    	</div>
    	
		<div class="contents">
			<div class="form-inline form-group">
				<span style="font-size: 15px; font-weight: bold;">법인</span>
				<select id="coCd" class="form-control"  onchange="commonCodeList();"></select>
				<span style="font-size: 15px; font-weight: bold;">프로젝트기간</span>
				<input id="strtDt" class="form-control" type="date"> <span>~</span> <input id="endDt" class="form-control" type="date">
				<select id="searchType" class="form-control" onchange="getData(0);">
					<option value="MAKR_CD">제조사</option>
					<option value="MNG_ID">담당자</option>
				</select>
				<input id="searchValue" type="text" class="form-control" onkeypress="if(event.keyCode == 13){search();}">
			</div>
		</div>
		<div class="row">
			<div data-ax5grid="first-grid" name="coNm" data-ax5grid-config="{}" style="height: 600px; width: 100%"></div>
		</div>
	</div>
<script>
	var authId = null;
	var authRole = null;
	var actionType = null;
	var firstGrid = new ax5.ui.grid();
	
	$(document).ready(function() {
	    $("#head_area").load("/static/html/header.html");
	    setMenuAuth();
		coCdCombo.initCombo();
		firstGrid.setConfig({
	    	showRowSelector: true,
	    	multipleSelect: false,
	        target: $('[data-ax5grid="first-grid"]'),
	        header: {
	        	 selector: false
	        },
	        body: {
	        	 onClick: function () {
	                this.self.select(this.dindex);
	            },
	            onDBLClick: function () {
	            	updateProjectModal("U");
	            }, 
	        },
	        page: {
	            navigationItemCount: 9,
	            height: 30,
	            display: true,
	            firstIcon: '<i class="fa fa-step-backward" aria-hidden="true"></i>',
	            prevIcon: '<i class="fa fa-caret-left" aria-hidden="true"></i>',
	            nextIcon: '<i class="fa fa-caret-right" aria-hidden="true"></i>',
	            lastIcon: '<i class="fa fa-step-forward" aria-hidden="true"></i>',
	            onChange: function () {
	            	gridView.setData(this.page.selectPage);
	            }
	        },
	        columns: [
	            {key: "coCd", label: "회사"},
	            {key: "strtDt", label: "프로젝트시작일"},
	            {key: "endDt", label: "프로젝트종료일"},
	            {key: "prjctNm", label: "프로젝트명"},
	            {key: "makrCd", label: "제조사"},
	            {key: "mngId", label: "담당자"},
	            {key: "totWt", label: "총중량"},
	            {key: "tnkeyYn", label: "턴키여부"},
	            {key: "creatDttm", label: "등록일"},
	        ]
	    });
		getData(0);
	})
	
	function getData(_pageNo) {
		var targetObj = this.target;
		var paramObj = {'pageNo': _pageNo + 1, 'recordCnt': 20};
		
		var coCd ="";
		
		if($('#coCd').val()){
			coCd = $('#coCd').val();
		}
		paramObj.coCd = coCd;
		
		//프로젝트 시작일
		paramObj.strtDt = $('#strtDt').val();
		//프로젝트 시작일
		paramObj.endDt = $('#endDt').val();
		// 검색구분 set
		paramObj.searchType = $('#searchType').val();
		// 검색어 set
		paramObj.searchValue = $('#searchValue').val();
		
		postAjax("/user/sd/sd05/selectProjectList", paramObj, null, function(data){
			var list = data.sd0501m01;
			firstGrid.setData({
				list : list,
				page : {
					currentPage : _pageNo,
					pageSize : data.paginationInfo.pageSize,
					totalElements : data.paginationInfo.totalRecordCount,
					totalPages : data.paginationInfo.totalPageCount
				}
			});
			/* var optionHtml = '<option value="">전체</option>';
			for (var i = 0; i < list.length; i++) {
						optionHtml += '<option value=\"' +  list[i].coCd + '\">'
						+ list[i].coCd + '</option>';
			}
			document.getElementById("coCd").innerHTML = optionHtml; */
		});
	} 
	
	 var coCdCombo = {
		initCombo: function(param){
			var formData = {"coCd": "TEST"};
			
			postAjax("/user/sd/sd05/selectProjectcoCdList", formData, null, function (data){
				var list = data.codecoCd; 
				var optionHtml = '<option value="">전체</option>';
				for (var i = 0; i < list.length; i++) {
							optionHtml += '<option value=\"' +  list[i].deptId + '\">'
							+ list[i].deptNm + '</option>';
				}
				document.getElementById("coCd").innerHTML = optionHtml;
			})
		}
	} 
	
	/*수정 or 등록 버튼 클릭시*/
	function createProjectModal(type) {
		actionType = type;
		openModal("/static/html/user/sd/sd05/SD0501P01.html", 1000, 700, "프로젝트 등록");
	}
	
	function updateProjectModal(type) {
		if (selectGridValidation(firstGrid)) return;
		actionType = type;
		openModal("/static/html/user/sd/sd05/SD0501P01.html", 1000, 700, "프로젝트 수정");
	} 
	
	/*삭제 버튼 클릭시*/
	function deleteProject() {
		if (selectGridValidation(firstGrid))
			return;
		if (!confirm("삭제하시겠습니까?"))
			return;
		var formData = {
			"authId" : firstGrid.getList("selected")[0].authId
		}
		deleteAjax("/admin/bm/account/deleteCode", formData, null, function(data) {
			if (data.resultCode == 200) {
				alert(data.resultMessage);
				getData();
			}
		});
	}
	
	/*select box 선택시*/
	function commonCodeList(param){
		var codeSelect = document.getElementById("coCd");
		var codeId = codeSelect.options[codeSelect.selectedIndex].value;
	}
	
	function coCdSerch(){
		gridView.initView().getData(0);
	}
	

</script>