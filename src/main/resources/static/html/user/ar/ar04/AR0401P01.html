<body>
  <div id="cplrUntpcDiv" class="popup_area of_a" style="width: 100%; height: 100%;">
    <div class="tit_contents">
        <h4 class="tit">계산서 관리</h4>
    </div>

    <div class="popup_table">
    	<form id="popForm">
	        <table>
	            <colgroup>
	                <col width="4%">
	                <col width="12%">
	                <col width="">
	                <col width="4%">
	                <col width="12%">
	                <col width="">
	                <col width="12%">
	                <col width="">
	            </colgroup>
	            <tr>
	                <th colspan="2" class="hit">매출일자</th>
	                <td>
	                	<input type="text" id="sellDt" name="sellDt" class="" required="required" readonly="readonly">
	                </td>
	                <th colspan="2" class="hit">매입/매출구분</th>
	                <td>                                
                    	<select id="selpchCd" name="selpchCd" data-kind="SELPCH" required="required" disabled>
	                    	<option value="">선택</option>
	                    </select>
	                </td>
	                <th class="hit">거래처명</th>
	                <td>                                
	                    <input type="hidden" id="clntCd" name="clntCd" required="required" disabled>
		                <div class="search_form" style="width: 100%;">
				            <input type="text" id="clntNm" name="clntNm" readonly="readonly">
				            <!-- <a id="btnClnt" onclick="clntSearch('S');"><i class="i_search_w"></i></a> -->
			            </div>
	                </td>
	            </tr>
	            <tr>
	                <th colspan="2">세금계산서번호</th>
	                <td>     
	                	<input type="text" id="taxBilgNo" name="taxBilgNo" style="width: 100%;" maxlength="20"readonly="readonly">   
	                </td>
	                <th colspan="2" class="hit">영수/청구 구분</th>
	                <td>	                    
	                    <select id="rffCno" name="rffCno" data-kind="PAYDIV" required="required">
	                    	<option value="">선택</option>
	                    </select>
	                </td>
	                <th id="rffAeaTh" class="hit">전자세금계산서 수정사유 코드</th>
	                <td>             
	                    <select id="rffAea" name="rffAea" data-kind="RFFAEA" required="required">
	                    	<option value="">선택</option>
	                    </select>
	                </td>
	            </tr>
	            <tr>
	                <th colspan="2" class="hit">공급가액 합계</th>
	                <td style="border-left: 0px !important;">
	                	<input type="text" id="taxMoa523" name="taxMoa523" style="width: 100%;" onkeyup="addComma(this);" comma required="required" readonly="readonly">   
	                </td>
	                <th colspan="2" class="hit">부가세액 합계</th>
	                <td style="border-left: 0px !important;">
	                	<input type="text" id="taxMoa5124" name="taxMoa5124" style="width: 100%;" onkeyup="addComma(this);" comma required="required" readonly="readonly">  
	                </td>
	                <th class="hit">총금액</th>
	                <td style="border-left: 0px !important;">
	                	<input type="text" id="taxMoa5388" name="taxMoa5388" style="width: 100%;" onkeyup="addComma(this);" comma required="required" readonly="readonly">  
	                </td>
	            </tr>
	            <tr>
	            	<th rowspan="6">공급자</th>
	            	<th class="hit">발행법인</th>
	            	<td>
	            		<input type="text" id="taxivcCoprt" name="taxivcCoprt" style="width: 100%;" required="required" onkeyup="onlyNumber(this)" maxlength="22"> 
	            	</td>
	            	<th rowspan="6">공급받는자</th>
	            	<th class="hit">타입</th>
	            	<td>
	            		<select id="ctaivBj1" name="ctaivBj1" style="width: 100%;" required="required"> 
	            			<option value="">선택</option> 
	            			<option value="01">사업자등록번호</option> 
	            			<option value="02">주민등록번호</option> 
	            			<option value="03">외국인</option>
	            		</select>
	            	</td>
	            	<th>수신담당자명</th>
	            	<td>
	                    <input type="hidden" id="taxRcvSn" name="taxRcvSn">
	            		<div class="search_form" style="width: 100%;">
				            <input type="text" id="taxRcvNm" name="taxRcvNm">
				            <a id="btnRcv" onclick="rcvNmSearch();"><i class="i_search_w"></i></a>
			            </div>
			        </td>
	            </tr>
	            <tr>
	            	<th class="hit">사업자번호</th>
	            	<td>
	            		<input type="text" id="taxivcCoprtNo" name="taxivcCoprtNo" style="width: 100%;" required="required" maxlength="20" onkeyup="crnFormatter(this)"> 
	            	</td>
	            	<th class="hit">사업자번호</th>
	            	<td>
	            		<input type="text" id="taxivcRcvCrn" name="taxivcRcvCrn" style="width: 100%;" required="required" maxlength="12" onkeyup="crnFormatter(this)"> 
	            	</td>
	            	<th>수신자 이메일</th>
	            	<td>
	            		<input type="text" id="taxRcvEmail" name="taxRcvEmail" style="width: 100%;" maxlength="40"> 
	            	</td>
	            </tr>
	            <tr>
	            	<th class="hit">대표자</th>
	            	<td>
	            		<input type="text" id="taxivcCoprtCeo" name="taxivcCoprtCeo" style="width: 100%;" required="required" maxlength="10"> 
	            	</td>
	            	<th class="hit">대표자</th>
	            	<td>
	            		<input type="text" id="taxivcRcvCeo" name="taxivcRcvCeo" style="width: 100%;" required="required" maxlength="10"> 
	            	</td>
	            	<th>수신자 이메일2</th>
	            	<td>
	            		<input type="text" id="taxRcvEmail" name="taxRcvEmail2" style="width: 100%;" maxlength="40"> 
	            	</td>
	            </tr>
	            <tr>
	            	<th class="hit">상호</th>
	            	<td>
	            		<input type="text" id="taxivcCoprtNm" name="taxivcCoprtNm" style="width: 100%;" required="required" maxlength="35"> 
	            	</td>
	            	<th class="hit">주소</th>
	            	<td>
	            		<input type="text" id="taxivcRcvAddr" name="taxivcRcvAddr" style="width: 100%;" required="required" maxlength="50"> 
	            	</td>
	            	<th>수신자팩스번호</th>
	            	<td>
	            		<input type="text" id="taxRcvFax" name="taxRcvFax" style="width: 100%;" maxlength="50" onkeyup="onlBkac(this)"> 
	            	</td>
	            </tr>
	            <tr>
	            	<th class="hit">업태명</th>
	            	<td>
	            		<input type="text" id="taxCoprtBizcon" name="taxCoprtBizcon" style="width: 100%;" required="required" maxlength="25"> 
	            	</td>
	            	<th class="hit">업태명</th>
	            	<td>
	            		<input type="text" id="taxivcRcvBizcon" name="taxivcRcvBizcon" style="width: 100%;" required="required" maxlength="25"> 
	            	</td>
	            	<th>수신자전화번호</th>
	            	<td>
	            		<input type="text" id="taxRcvTel" name="taxRcvTel" style="width: 100%;" maxlength="20" onkeyup="telNumberFormatter(this)"> 
	            	</td>
	            </tr>
	            <tr>
	            	<th class="hit">업종명</th>
	            	<td>
	            		<input type="text" id="taxvicCoprtBsty" name="taxvicCoprtBsty" style="width: 100%;" required="required" maxlength="25"> 
	            	</td>
	            	<th class="hit">업종명</th>
	            	<td>
	            		<input type="text" id="taxivcRcvBsty" name="taxivcRcvBsty" style="width: 100%;" required="required" maxlength="25"> 
	            	</td>
	            	<th>수신자휴대전화</th>
	            	<td>
	            		<input type="text" id="taxMoblphon" name="taxMoblphon" style="width: 100%;" maxlength="20" onkeyup="telNumberFormatter(this)"> 
	            	</td>
	            </tr>
	            <tr>
	            	<th colspan="2">비고1</th>
	            	<td colspan="6"><input type="text" id="ftxac11" name="ftxac11" style="width: 100%;" maxlength="75"> </td>
	            </tr>
	            <tr>
	            	<th colspan="2">비고2</th>
	            	<td colspan="6"><input type="text" id="ftxac21" name="ftxac21" style="width: 100%;" maxlength="75" > </td>
	            </tr>
	            <tr>
	            	<th colspan="2">비고3</th>
	            	<td colspan="6"><input type="text" id="ftxac31" name="ftxac31" style="width: 100%;"  maxlength="75"> </td>
	            </tr>
	        </table>
    		<input type="hidden" id="coCd" name="coCd">
    		<input type="hidden" id="clntCd" name="clntCd">
    		<input type="hidden" id="bilgCertNo" name="bilgCertNo">
    		<input type="hidden" id="cseqRcvYn" name="cseqRcvYn">
	        <input type="hidden" id="userId" name="userId">
	        <input type="hidden" id="pgmId" name="pgmId" value="AR0401">
	    </form>
    </div>

    <br>
    <!-- 하단 버튼 -->
    <div class="popup_bottom_btn">
      <button id="actionBtn"></button>
      <button class="close_btn" onclick="modalClose();">닫기</button>
    </div>
  </div>
 
</body>
<link rel="stylesheet" href="/static/css/jstree/style.min.css" />
<script src="/static/js/jstree/jstree.min.js"></script>
<script type="text/javascript">
	
	//매입매출구분
	var clntType = null;
	var treeType = null;
	var fileArr = [];
	var deleteFileArr = [];
	var selectedIdx = 0;
	
	$(document).ready(function() {
		setCommonSelect($(".popup_area select[data-kind]"));
		/* $('#sellDt').datepicker({
			format : "yyyy-mm-dd",
			language : "ko",
			autoclose : true
		}); */
		setInit();
		//$(".popup_area input").prop("readonly", true);
		//$(".popup_area select").prop("disabled", true);
	});
	
	function setInit() {
		$('#actionBtn').on("click", function(){updateTaxBilg();});
		$('#actionBtn').text("저장");
		selectTaxBilg();
	}
		
	function makeFormData(){
		$("#popForm input").prop("disabled", false);
		$("#popForm select").prop("disabled", false);
		$("#userId").val(jwt.userId);
		
		//콤마 제거
		$.each($('input[comma]'), function(idx, elem){
			deleteComma(elem);
		});
		
		var formData = new FormData($("#popForm")[0]);
		return formData;
	}
	
	function selectTaxBilg(){
		var row = gridView.target.getList("selected")[0];
		$('#popForm #bilgCertNo').val(row.bilgCertNo);
		var formData = {
				"bilgCertNo" : row.bilgCertNo
		}
		if(row.bgm1225Cd == "BGM12259"){
			$("#popForm #rffAea").removeAttr("required");
			$("#popForm #rffAeaTh").removeClass("hit");
		}
		postAjax("/user/ar/ar04/selectTaxBilg", formData, null, function(data){
			console.log(data.result);
			setTaxBilgInfo(data.result);
		});
	}
	
	function setTaxBilgInfo(obj){
		
		//메인정보 세팅
		$.each(obj, function(key, value){
			$('#popForm #'+key).val(value);
		});
		
		$.each($('input[comma]'), function(idx, elem){
			addComma(elem);
		});
		if(obj.cseqRcvYn != "E" || !obj.cseqRcvYn){
			$("#popForm #rffAea").attr("disabled", "disabled");
		} else {
			console.log("EEE");
			$("#popForm #rffAea").removeAttr("disabled");
		}
	}
	
	function updateTaxBilg() {
		if(inputValidation($('[required]'))) {
			var formData = makeFormData();
			filePostAjax("/user/ar/ar04/updateTaxBilg", formData, function(data){
				alert(data.resultMessage);    
				if(data.resultMessage == "200"){
					gridView.setData(0);
					modal.close();
				}
			});
		}
	}

	// 제품 조회
	function rcvNmSearch() {
		/* if($("#popForm #coCd").val() == ""){
			
		}
		if($("#popForm #coCd").val() == ""){
			
		} */
		openSecondModal("/static/html/user/ar/ar04/AR0401P03.html", 1000, 420, "수신담당자검색");
	}
	
	// 거래처
	function clntSearch(type) {
		actionTp = type;
		openSecondModal("/static/html/user/ar/ar04/AR0401P02.html", 500, 420, "거래처검색");
	}

	function modalClose(){
		modal.close();
	}
	
</script>
