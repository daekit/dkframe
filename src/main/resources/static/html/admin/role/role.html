<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<link rel="icon" href="/static/favicon.ico"  type="image/x-icon">
</head>
<script type="text/javascript">
	
	var authorizationToken = getCookie("jwtToken");
	console.log("쿠키 저장된 값: "+ authorizationToken);
	
	var firstGrid = new ax5.ui.grid();
	
	$(document).ready(function() {
		$.ajaxSetup({
			contentType: "application/json; charset=utf-8",
			beforeSend: function (request)
            {
                request.setRequestHeader("Authorization", authorizationToken);
            }
		});
		
        firstGrid.setConfig({
        	showRowSelector: true,
        	multipleSelect: false,
            target: $('[data-ax5grid="first-grid"]'),
            columns: [
                {key: "roleId", label: "롤ID"},
                {key: "roleNm", label: "롤명"},
                {key: "roleType", label: "롤타입"},
                {key: "roleSort", label: "롤정렬"},
                {key: "description", label: "설명"},
                {key: "createDt", label: "등록일"},
                {
                	key: "", label: "메뉴정보", align: 'center', formatter: function() {
                		return '<button type="button"/>메뉴';
                	}
                }
            ]
        });
        
        getData();
	})
	
	function getData() {
        $.ajax({
            method: "POST",            
            url: "/role/selectRoleInfo",
            success: function (data, status, request) {
                firstGrid.setData(data.roleList);
            }
        });
	}
	
	function createRoleModal() {
		openModal("/static/html/admin/role/createRole.html", 600, 300, "롤등록");
	}
	

	function updateRoleModal() {
		if(selectGridValidation(firstGrid)) return;
		openModal("/static/html/admin/role/updateRole.html", 600, 300, "롤수정");
	}
	
	function deleteRole() {
		if(selectGridValidation(firstGrid)) return;
		if(!confirm("삭제하시겠습니까?")) return;
		var formData = {
				"roleId" : firstGrid.getList("selected")[0].roleId
		}
		$.ajax({
            method: "DELETE",       
            url: "/role/deleteRole",
            data: JSON.stringify(formData),
            success: function (data, status, request) {
            	if(data.resultCode == 200){
					alert(data.resultMessage);
					getData();
				}
            }
        });
	}
	
</script>
<body>
	<div>
		<h1>롤관리</h1>
		<a id="loginBtn" class="btn focus" onclick="createRoleModal();">등록</a>
		<a id="loginBtn" class="btn focus" onclick="updateRoleModal();">수정</a>
		<a id="loginBtn" class="btn focus" onclick="deleteRole();">삭제</a>
		<div data-ax5grid="first-grid" data-ax5grid-config="{}" style="height: 500px; width: 50%"></div>
	</div>
</body>
</html>
