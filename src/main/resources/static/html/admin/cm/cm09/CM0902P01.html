<style>
	.table tr th {
		text-align: center;
	}
	
	.modal_bottom {
		position: fixed;
		bottom: 5px;
		width: 100%;
	}
</style>
<div class="form-group">
	<form id="popForm">
		<table class="popup_table">
			<colgroup>
				<col style="width: 15%;">
				<col style="width: 85%;">
			</colgroup>
			<tbody>
				<tr>
					<th>제목</th>
					<td>
						<input type="text" class="form-control input-sm" id="notiTitle" name="notiTitle" required>
					</td>
				</tr>
				<tr>
					<th>내용</th>
					<td>
						<textarea rows="8" cols="78" id="notiCnts" name="notiCnts"></textarea>
					</td>
				</tr>
				<tr>
					<th>첨부파일</th>
					<td id="fileArea"><input type="file" class="form-control input-sm" id="files" name="files" multiple="multiple"></td>
				</tr>
			</tbody>
		</table>
		<table class="popup_table">
			<colgroup>
				<col style="width: 15%;">
				<col style="width: 35%;">
				<col style="width: 15%;">
				<col style="width: 35%;">
			</colgroup>
			<tbody>
				<tr>
					<th>팝업 기능</th>
					<td>
						<input type="radio" name="popupYn" value="N" checked="checked">사용 안함
						<input type="radio" name="popupYn" value="Y">사용
					</td>
					<th>사용 여부</th>
					<td>
						<input type="radio" name="useYn" value="N" checked="checked">사용 안함
						<input type="radio" name="useYn" value="Y">사용
					</td>
				</tr>
				<tr>
					<th>만료 기능</th>
					<td>
						<input type="radio" name="exprtnYn" value="N" checked="checked">사용 안함
						<input type="radio" name="exprtnYn" value="Y">사용
					</td>
					<th>만료일</th>
					<td>
						<div class="input-group date" id="exprtnDatePicker">
		                    <input type="text" class="form-control input-sm" id="exprtnDt" name="exprtnDt" style="text-align: center;"/>
		                    <span class="input-group-addon" style="padding: 0px 5px;">
		                        <span class="glyphicon glyphicon-calendar" style="cursor: pointer;"></span>
		                    </span>
		                </div>
					</td>
				</tr>
			</tbody>
		</table>
		<input type="hidden" id="notiKey" name="notiKey">
		<input type="hidden" id="userId" name="userId">
		<input type="hidden" id="coCd" name="coCd">
	</form>
</div>
<div class="bottom_btn">
	<button type="button" class="btn btn-default btn-sm" onclick="insertNoti();">저장</button>
	<button type="button" class="btn btn-default btn-sm" onclick="modal.close();">닫기</button>
</div>
<script type="text/javascript">
	//등록시 직급코드 중복체크 여부
	var isChecked = false;
	
	$(document).ready(function() {
		$("input[name='popupYn']").on("change", function(){
			if($(this).val() == "N") {
				$('input:radio[name=exprtnYn]:input[value="N"]').prop("checked", true);
			} 
		});
		$("input[name='exprtnYn']").on("change", function(){
			if($("input[name='popupYn']:checked").val() == "N") {
				$('input:radio[name=exprtnYn]:input[value="N"]').prop("checked", true);
			} 
		});
		if(actionType == "C"){
			
		} else if(actionType == "U") {
			selectNotiInfo();
		}
	});
	
	// 만료일 데이트피커 set
	$('#exprtnDatePicker').datepicker({
		format: "yyyymmdd",
		language : "ko",
		autoclose : true
	});
	
	function insertNoti() {
		$('input[required]').each(function(idx, elem){
			if($.trim($(elem).val()) == ""){
				alert("필수값을 입력해 주세요.");
				$(elem).focus();
				isValid = false;
				return false;
			}
		});
		$("#userId").val(jwt.userId)              ;
		$("#popForm").find("#coCd").val($('#mainForm').find("#coCd option:selected").val());
		var formData = new FormData($("#popForm")[0]);
		fileAjax("/admin/cm/cm09/insertNoti", formData, function(data){
			alert(data.resultMessage);           
			gridView.setData(0);
			modal.close();
		});
	}
	
	function selectNotiInfo(){
		var row = gridView.target.getList("selected")[0];
		var paramObj = {"notiKey": row.notiKey};
		postAjax("/admin/cm/cm09/selectNotiInfo", paramObj, null, function(data){
			setNotiInfo(data.result.notiInfo);
			setFileInfo(data.result.fileList);
		});
	}
	
	function setNotiInfo(notiInfo){
		$.each(notiInfo, function(key, value){
			$('#'+key).val(value);
		});
		$('input:radio[name=popupYn]:input[value=' + notiInfo.popupYn + ']').prop("checked", true);
		$('input:radio[name=useYn]:input[value=' + notiInfo.useYn + ']').prop("checked", true);
		$('input:radio[name=exprtnYn]:input[value=' + notiInfo.exprtnYn + ']').prop("checked", true);
	}
	
	function setFileInfo(fileInfo) {
		if(fileInfo.length != 0) {
			var html = "";
			$.each(fileInfo, function(key, value){
				html += "<a href='/admin/cm/cm08/fileDownload?fileKey="+value.fileKey+"'>"+value.fileName+"<br></a>";
			});
			$("#fileArea").html(html);
		}
	}
	
</script>