<!DOCTYPE html>
<html lang="ko">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="icon" href="/static/favicon.ico" type="image/x-icon">
	<link rel="stylesheet" href="/static/bootstrap/css/bootstrap.min.css">
	<link rel="stylesheet" href="/static/bootstrap/css/bootstrap-theme.min.css">
	<link rel="stylesheet" href="/static/bootstrap/css/dashboard.css">
	<link rel="stylesheet" href="/static/bootstrap/css/bootstrap-datepicker.css">
	<link rel="stylesheet" href="/static/fontawesome/css/all.css">
	<link rel="stylesheet" href="/static/css/ax5/ax5grid.css" />
	<link rel="stylesheet" href="/static/css/ax5/ax5mask.css" />
	<link rel="stylesheet" href="/static/css/ax5/ax5modal.css" />
	<link rel="stylesheet" href="/static/css/ax5/ax5toast.css" />
	<link rel="stylesheet" href="/static/css/jstree/style.min.css" />
	<link rel="stylesheet" href="/static/css/gnb.css" />
	<link rel="stylesheet" href="/static/css/main.css" />
	<link rel="stylesheet" href="/static/css/sub.css" />
	<link rel="stylesheet" href="/static/css/common.css" />
	
	<script src="/static/js/jquery-latest.min.js"></script>
	<script src="/static/js/jquery.serializeObject.js"></script>
	<script src="/static/bootstrap/js/bootstrap.min.js"></script>
	<script src="/static/bootstrap/js/bootstrap-datepicker.min.js"></script>
	<script src="/static/bootstrap/js/bootstrap-datepicker.ko.min.js"></script>
	<script src="/static/js/moment/moment-with-locales.js"></script>
	<script src="/static/js/ax5/ax5core.min.js"></script>
	<script src="/static/js/ax5/ax5grid.min.js"></script>
	<script src="/static/js/ax5/ax5mask.min.js"></script>
	<script src="/static/js/ax5/ax5modal.min.js"></script>
	<script src="/static/js/ax5/ax5toast.min.js"></script>
	<script src="/static/js/jstree/jstree.min.js"></script>
	<script src="/static/js/global.js"></script>
</head>

<body>
	<div id="head_area"></div>
	<div id="top_area"></div>
	<div id="main_area">

		<!-- 콘텐츠 -->
		<div class="contents">
			<!-- 리스트 -->
			<table class="form-group popup_table" id="scndTable">
				<colgroup>
					<col width="32%">
					<col width="32%">
					<col width="32%">
				</colgroup>
				<thead>
					<tr>
						<td style="text-align: left;">
							<h3 class="location"><span class="page_tit">구매요청 미확정 현황</span>
								<select id="coCd1" data-kind="CO" onchange="reqGridView.initView().setData();">
									<option value="">전체</option>
								</select>
							</h3> <!-- <span id="ordrgTotCnt"></span> -->
						</td>
						<td style="text-align: left;">
							<h3 class="location"><span class="page_tit">발주 미확정 현황</span>
								<select id="coCd2" data-kind="CO" onchange="gridView.initView().setData();">
									<option value="">전체</option>
								</select>
							</h3> <!-- <span id="ordrgTotCnt"></span> -->
						</td>
						<td style="text-align: left;">
							<h3 class="location"><span class="page_tit">출하 미확정 현황</span>
								<select id="coCd3" data-kind="CO" onchange="shipGridView.initView().setData();">
									<option value="">전체</option>
								</select>
							</h3> <!-- <span id="ordrgTotCnt"></span> -->
						</td>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td>
							<div class="contents" style="margin:0px;padding:0px;width:100%;min-width:300px">
								<div data-ax5grid="third-grid" data-ax5grid-config="{}" style="height: 725px; width: 100%"></div>
							</div>
						</td>
						<td>
							<div class="contents" style="margin:0px;padding:0px;width:100%;min-width:300px">
								<div data-ax5grid="first-grid" data-ax5grid-config="{}" style="height: 725px; width: 100%"></div>
							</div>
						</td>
						<td>
							<div class="contents" style="margin:0px;padding:0px;width:100%; min-width:300px">
								<div data-ax5grid="second-grid" data-ax5grid-config="{}" style="height: 725px; width: 100%"></div>
							</div>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>
</body>
</html>

<script type="text/javascript">
	var actionType = null;
	var odrSeq = null;
	var odrDtlSeqArr = [];
	var gridView = {
			initView : function() {
				this.target = new ax5.ui.grid();
				this.target.setConfig({
					showRowSelector : true,
					multipleSelect : false,
					sortable : true,
					target : $('[data-ax5grid="first-grid"]'),
					header : {
						align : "center",
						selector : false
					},
					body : {
						onClick : function() {
							this.self.select(this.dindex);
						},
			            onDBLClick: function () {
			            	viewOrderModal(this.item.ordrgSeq);
			            },
					},
					page : {
						display : true,
					},
					footSum: [
				    	[
				    		{label: "합계", align: "center", colspan: 6},
		                    {key: "ordrgQty", collector: "sum", formatter:"money", align: "right"},
		                    {key: "realDlvrQty", collector: "sum", formatter:"money", align: "right"},
		                    {key: "remainQty", collector: "sum", formatter:"money", align: "right"}
				    	]
				    ],
					columns: [
			          	{key: "ordrgSeq",   label: "발주일련번호",  align: "center",  hidden: true},
			          	{key: "ordrgYn",    label: "확정",   		align: "center",  width: 50},
			          	{key: "reqDt",      label: "요청일",   	align: "center",  width: 80},
			          	{key: "clntNm",     label: "거래처",   	align: "left",    width: 120},
			          	{key: "siteNm",     label: "현장",	   	align: "left",    width: 120},
			          	{key: "whNm",     	label: "창고",   		align: "left",    width: 100},
			          	{key: "odrCreatDiv",label: "구분",   		align: "center",  width: 60, styleClass: function () {
		                     return (this.item.odrCreatDiv == "MES") ? "grid-font-blue":"";}},
			          	{key: "ordrgQty",   label: "요청량",   	align: "right",   width: 70, formatter: "money"},
			          	{key: "realDlvrQty",label: "출하량",   	align: "right",   width: 70, formatter: "money"},
			          	{key: "remainQty",  label: "잔량",   		align: "right",   width: 70, formatter: "money"}
			        ]
				});
				return this;
			},
			setData : function() {
				var targetObj = this.target;
				var paramObj = {
						coCd2 : $("#coCd2").val()
						};
				postAjax("/user/cm/cm10/selectOrdrgNList", paramObj, null, function(data) {
					var list = data.resultList;
					targetObj.setData({
						list : list,
						page : {
							totalElements : data.paginationInfo.totalRecordCount
						}
					});
				});				
			}
		}
	

	var shipGridView = {
			initView : function() {
				this.target = new ax5.ui.grid();
				this.target.setConfig({
					showRowSelector : true,
					multipleSelect : false,
					sortable : true,
					target : $('[data-ax5grid="second-grid"]'),
					header : {
						align : "center",
						selector : false
					},
					body : {
						onClick : function() {
							this.self.select(this.dindex);
						},
			            onDBLClick: function () {
			            	viewShipModal(this.item.shipSeq);
			            },
					},
					page : {
						display : true,
					},
					footSum: [
				    	[
				    		{label: "합계", align: "center", colspan: 7},
		                    {key: "shipTotQty", collector: "sum", formatter:"money", align: "right"},
		                    {key: "realTotQty", collector: "sum", formatter:"money", align: "right"},
		                    {key: "remainQty", collector: "sum", formatter:"money", align: "right"}
				    	]
				    ],
					columns: [
			          	{key: "shipSeq",    label: "출하일련번호",  align: "center",  hidden: true},
			          	{key: "shipYn",     label: "확정",   		align: "center",  width: 50},
			          	{key: "recptYn",    label: "접수",   		align: "center",  width: 50, styleClass: function () {
		                     return (this.item.recptYn == "N") ? "grid-font-red-bold":"";}},
			          	{key: "reqDt",      label: "요청일", 		align: "center",  width: 80},
			          	{key: "clntNm",     label: "거래처", 		align: "left",    width: 120},
			          	{key: "siteNm",     label: "현장",		align: "left",    width: 120},
			          	{key: "whNm",       label: "창고",   		align: "left",    width: 100},
			          	{key: "odrCreatDiv",label: "구분",   		align: "center",  width: 60, styleClass: function () {
		                     return (this.item.odrCreatDiv == "MES") ? "grid-font-blue":"";}},
			          	{key: "shipTotQty", label: "요청량",	 	align: "right",   width: 70, formatter: "money"},
			          	{key: "realTotQty", label: "출하량", 		align: "right",   width: 70, formatter: "money"},
			          	{key: "remainQty",  label: "잔량",   		align: "right",   width: 70, formatter: "money"}
			        ]
				});
				return this;
			},
			setData : function(_pageNo) {
				var targetObj = this.target;
				var paramObj = {
						coCd3 : $("#coCd3").val()
						};
				postAjax("/user/cm/cm10/selectShipNList", paramObj, null, function(data) {
					var list = data.resultList;
					targetObj.setData({
						list : list,
						page : {
							totalElements : data.paginationInfo.totalRecordCount
						}
					});
				});				
			}
		}
	
	var reqGridView = {
			initView : function() {
				this.target = new ax5.ui.grid();
				this.target.setConfig({
					showRowSelector : true,
					multipleSelect : false,
					sortable : true,
					target : $('[data-ax5grid="third-grid"]'),
					header : {
						align : "center",
						selector : false
					},
					body : {
						onClick : function() {
							this.self.select(this.dindex);
						},
			            onDBLClick: function () {
			            	viewReqModal(this.item.reqSeq,this.item.reqDt);
			            },
					},
					page : {
						display : true,
					},
					footSum: [
				    	[
				    		{label: "합계", align: "center", colspan: 7},
		                    {key: "reqQty", collector: "sum", formatter:"money", align: "right"},
		                    {key: "realDlvrQty", collector: "sum", formatter:"money", align: "right"},
		                    {key: "remainQty", collector: "sum", formatter:"money", align: "right"}
				    	]
				    ],
					columns: [
			          	{key: "reqSeq",   	 label: "구매요청일련번호", align: "center", hidden: true},
			          	{key: "reqDt",   	 label: "구매요청일자",    align: "center", hidden: true},
			          	{key: "recptYn",     label: "접수",   	align: "center",  width: 60,styleClass: function () {
		                     return (this.item.recptYn == "N") ? "grid-font-red-bold":"";}},
			          	{key: "ordrgYn",     label: "발주",   	align: "center",  width: 60},
			          	{key: "reqDt",       label: "요청일",   	align: "center",  width: 100},
			          	{key: "prdtNm",      label: "거래처",   	align: "left",    width: 140},
			          	{key: "siteNm",      label: "현장",   	align: "left",    width: 140},
			          	{key: "whNm",    	 label: "창고",   	align: "left",    width: 110},
			          	{key: "reqCreatDiv", label: "구분",  		align: "center",  width: 60, styleClass: function () {
		                     return (this.item.odrCreatDiv == "MES") ? "grid-font-blue":"";}},
			          	{key: "reqQty",      label: "요청량",   	align: "right",   width: 80, formatter: "money"},
			          	{key: "ordrgQty",    label: "발주량",   	align: "right",   width: 80, formatter: "money"},
			          	{key: "remainQty",   label: "잔량",   	align: "right",   width: 80, formatter: "money"}
			        ]
				});
				return this;
			},
			setData : function() {
				var targetObj = this.target;
				var paramObj = {
						coCd1 : $("#coCd1").val()
				};
				postAjax("/user/cm/cm10/selectReqNList", paramObj, null, function(data) {
					var list = data.resultList;
					targetObj.setData({
						list : list,
						page : {
							totalElements : data.paginationInfo.totalRecordCount
						}
					});
				});				
			}
		}
	

	$(document).ready(function() {
		// 페이지 타이틀 set
		mainDefaultLoad("대시보드", "실무자 현황");
		setCommonSelect($("#main_area select[data-kind]"));

		//메뉴 숨기기
		$('#head_area').toggleClass('off');
		$('#top_area').toggleClass('on');
		$('#main_area').toggleClass('on');
		
		$("#coCd1").val(jwt.coCd);
		$("#coCd2").val(jwt.coCd);
		$("#coCd3").val(jwt.coCd);
		gridView.initView().setData();
		shipGridView.initView().setData();
		reqGridView.initView().setData();
		// grid init
	});
	
	var openFrom = "CM1001M01";
	
	function viewOrderModal(ordrgSeq) {
		var paramObj = {'ordrgSeq' : ordrgSeq};
		openModal("/static/html/user/od/od01/OD0102V01.html", 1300, 780, "", paramObj);
	}
	
	function viewShipModal(shipSeq) {
		var paramObj = {'shipSeq' : shipSeq};
		openModal("/static/html/user/ar/ar01/AR0102V01.html", 1200, 780, "", paramObj);
	}
	
	function viewReqModal(reqSeq, reqDt) {
        actionType = "U";
        openFrom   = "CM1001M01";
		var paramObj = {
			'reqSeq' : reqSeq,
			"reqDt" :  reqDt
		};
		openModal("/static/html/user/od/od04/OD0402P01.html", 1200, 780, "", paramObj);
	}
</script>
