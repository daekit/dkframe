	<div class="container-fluid" id="popup_area">
      <div class="row">
        <div class="form-group">
	        <form id="frm">
	          <table class="popup_table">
	          	<colgroup>
	          		<col width="12%">
	          		<col width="">
	          		<col width="12%">
	          		<col width="">
	          		<col width="12%">
	          		<col width="">
	          	</colgroup>
	          	<tr>
	          		<th class="hit">제품명</th>
	          		<td colspan ="3">
	          			<input name="prdtNm" type="text" class="form-control" required>
	          		</td>
	          		<th class="hit">사용 여부</th>
	          		<td>
	          			<select class="form-control input-sm" id="useYn" name="useYn" required>
									<option value="Y">사용</option>
									<option value="N">미사용</option>
						</select>
	          			
	          		</td>
	          	</tr>
	          	<tr>
	          		<th class="hit">제품 구분</th>
	          		<td>
	          			 <select id= "prdtDiv" data-kind="PRDTDIV" name="prdtDiv"  class="form-control input-sm"  required >
                  			<option value="">선택</option>
                 		 </select>
	          		</td>
	          		<th>제품 강종</th>
	          		<td>
	          			 <select id= "prdtStkn" data-kind="PDSK" name="prdtStkn" class="form-control input-sm" >
                  			<option value="">선택</option>
                 		 </select>	          		
	          		</td>
	          		<th class="hit">내진설계<br/>구분</th>
	          		<td>
	          			 <select id= "prdtErqkYn" data-kind="PRDTERQK" name="prdtErqkYn" class="form-control input-sm" required >
                  			<option value="">선택</option>
                 		 </select>	      						
					</td>
	          	</tr>
	          	<tr>
	          		<th>사이즈</th>
	          		<td>
	          			 <select id= "prdtSize" data-kind="PDSZ" name="prdtSize"  class="form-control input-sm">
                  			<option value="">선택</option>
                 		 </select>
	          		</td>
	          		<th>제품 규격</th>
	          		<td>
	          			 <input id= "prdtSpec" type="text" name="prdtSpec" class="form-control input-sm" >
                  			
	          		</td>
	          		<th>코일 구분</th>
	          		<td>
	          			 <select id= "prdtCoilYn" name="prdtCoilYn" class="form-control input-sm" >
							<option value="N">일반</option>
                  			<option value="Y">코일</option>
                 		 </select>
	          		</td>
	          	</tr>
	          	<tr>
	          		<th class="hit">단위</th>
	          		<td>
	          			 <select id= "prdtUnit" data-kind="PRDTUNIT"  name="prdtUnit" class="form-control input-sm" required>
                  			<option value="">선택</option>
                 		 </select>
	          		</td>
	          		<th>단위 중량</th>
	          		<td><input id="prdtWt" name="prdtWt" type="text"  class="form-control"></td>
	          		<th title="수량 * 환산중량 = 중량" class="hit">환산중량</th>
	          		<td><input id="prdtCnvrsnWt" name="prdtCnvrsnWt" type="text" class="form-control" required></td>
	          	</tr>
	          	<tr>
	          		<th>기준단가</th>
	          		<td><input name="prdtUpr" type="text" class="form-control"></td>
	          		<th>단가 기준일</th>
	          		<td>
	          			<input type="date" name="prdtDt"  id="prdtDt" class="form-control">
	          		</td>
	          		<th>MES<br/>대응코드</th>
	          		<td><input id="prdtMesCd" name="prdtMesCd" type="text" class="form-control"></td>
	          		
	          		
	          	</tr>
	          	<tr>
	          		<th>최종매입단가</th>
	          		<td>
	          			<input type="text" name="pchsUpr"  id="pchsUpr" class="form-control">
	          		</td>
	          		<th>최종매입단가</th>
	          		<td>
	          			<input type="text" name="sellUpr" id="sellUpr"  class="form-control">
	          		</td>
	          		<th>동국제강<br/>코드</th>
	          		<td><input id="prdtDkCd" name="prdtDkCd" type="text" class="form-control"></td>
	          	</tr>
	          		          	
	          	<tr>
	          		<th>여분필드<br/>(고정)</th>
	          		<td>
	          			<input type="text" name="etcField1"  id="etcField1" class="form-control">
	          		</td>
	          		<th>여분필드<br/>(숫자)</th>
	          		<td>
	          			<input type="text" name="etcField2" id="etcField2"  class="form-control">
	          		</td>
	          		<th>여분필드<br/>(변동)</th>
	          		<td>
	          			<input type="text" name="etcField3" id="etcField3"  class="form-control">
	          		</td>
	          	</tr>
	          </table>
	          	<input id="userId" name="userId" type="hidden" class="form-control">
	          	<input id="prdtCd" name="prdtCd" type="hidden" class="form-control">
	          	
	          	<input type="hidden" id="pgmId" name="pgmId" value="BM0102P01">
	        </form>
        </div>
      </div>
    </div>
	<div>
		<button id="checkBtn" type="button" class="btn btn-default btn-sm" onclick="checkOverLap()">중복체크</button>
		<button id="actionBtn" type="button" class="btn btn-default btn-sm" ></button>
		<button type="button" class="btn btn-default btn-sm" onclick="modal.close();">닫기</button>
	</div>
<script type="text/javascript">

	var insertOK = false;

	$(document).ready(function() {
		
		setCommonSelect($("#popup_area select[data-kind]"));
		
		$("#userId").val(jwt.userId);
		
		
		if(actionType == "U") {
			$('#actionBtn').on("click", function(){updateMaterial();});
			$("#actionBtn").html("수정");
			$("#checkBtn").hide();
			selectMaterialInfo();
			insertOK = true;
			
		} else {
			$('#actionBtn').on("click", function(){insertMaterial();});
			$("#actionBtn").html("등록");
			 document.getElementById("prdtDt").value = new Date().toISOString().substring(0, 10);
           // 등록 시 기본값 설정
			$("#prdtCnvrsnWt").val(1);
			 
		}
		
		$('[required]').on("change", function(){
			insertOK = false;
		});
		
		
	});
	
	function selectMaterialInfo() {
		var row = gridView.target.getList("selected")[0];
		$("#prdtCd").val(row.prdtCd);
		var formData = $('#frm').serializeObject();
		postAjax("/admin/bm/bm01/selectMaterialInfo", formData, null, function(data){
			setData(data.materialInfo);
		});
	}
	
	function setData(data) {
		$.each(data, function(idx, item){
			for(var i=0; i<$('#frm [name]').length; i++) {
				if($('#frm [name]')[i].name == idx) {
					if($('#frm [name]')[i].required){ //수정 못하도록 막는다.
						$("#frm [name]")[i].disabled = true;
					}
					$('#frm [name]')[i].value = item;	
				}
			}
		});
		
	}
	  
	function insertMaterial() {
		
		if(inputValidation($('[required]'))) {
			if(insertOK) {
				var formData = $('#frm').serializeObject();
				formData.prdtDt = formData.prdtDt.replace(/\-/g,'');
				
				postAjax("/admin/bm/bm01/insertMaterial", formData, null, function(data){
					if(data.resultCode == 200){
						modal.close();
						gridView.initView().setData(0);
					}
				});
			}
		} 
	}
	 
	function updateMaterial() {
		
		for(var i=0; i<$('#frm [name]').length; i++) {
			
			if($('#frm [name]')[i].required){ 
				$("#frm [name]")[i].disabled = false;
			}
		}
		
		
		if(insertOK) {
				var formData = $('#frm').serializeObject();
				formData.prdtCd = formData.prdtCd + ''; 
				formData.prdtDt = formData.prdtDt.replace(/\-/g,'');
				
				putAjax("/admin/bm/bm01/updateMaterial", formData, null, function(data){
					alert(data.resultMessage);
					if(data.resultCode == 200){
						modal.close();
						gridView.initView().setData(0);
					}
				});
			} 
	}
	
	
	function checkOverLap() {
		
		
		if(inputValidation($('[required]'))) {
			var formData = $('#frm').serializeObject();
			formData.prdtDt = formData.prdtDt.replace(/\-/g,'');
			
			postAjax("/admin/bm/bm01/checkOverLap", formData, null, function(data){
				alert(data.resultMessage);
				if(data.resultCode == 200){
					insertOK = true;
				} 
			})
			
		}
		
	}
	
</script>