<body>
	<div class="row form-group">
		<span style="font-size: 25px; font-weight: bold;">자재코드 관리</span>
		<div style="float: right;">
			<a id="loginBtn" class="btn btn-default btn-sm" onclick="detailMaterial('C');">등록</a>
			<a id="loginBtn" class="btn btn-default btn-sm" onclick="detailMaterial('U');">수정</a>
			<a id="loginBtn" class="btn btn-default btn-sm" onclick="deleteMaterial();">삭제</a>
		</div>
	</div>
	<div class="row">
		<div class="form-inline form-group">
			<select id="useYn" class="form-control" >
				<option value="Y">사용</option>
				<option value="N">미사용</option>
			</select>
			<select id="searchType" class="form-control" >
				<option value="PRDT_NM">자재코드명</option>
			</select>
			<input id="searchValue" type="text" class="form-control" onkeypress="if(event.keyCode == 13){search();}">
			<button class="btn btn-primary" type="button" onclick="search();">검색</button>
		</div>
	</div>
	<div class="row">
		<div data-ax5grid="first-grid" data-ax5grid-config="{}" style="height: 600px; width: 100%"></div>
	</div>
</body>
<script type="text/javascript">
	
	var authId = null;
	var authRole = null;
	var actionType = null;
	var firstGrid = null;
	
	var gridView = {
		initView: function(){
			this.target = new ax5.ui.grid();
			this.target.setConfig({
		    	showRowSelector: true,
		    	multipleSelect: false,
		        target: $('[data-ax5grid="first-grid"]'),
		        header: {
		        	 selector: false
		        },
		        body: {
		        	onClick: function () {
		                this.self.select(this.dindex);
		            },
		            onDBLClick: function () {
		            	detailMaterial("U");
		            },
		        },
		        page: {
		            navigationItemCount: 9,
		            height: 30,
		            display: true,
		            firstIcon: '<i class="fa fa-step-backward" aria-hidden="true"></i>',
		            prevIcon: '<i class="fa fa-caret-left" aria-hidden="true"></i>',
		            nextIcon: '<i class="fa fa-caret-right" aria-hidden="true"></i>',
		            lastIcon: '<i class="fa fa-step-forward" aria-hidden="true"></i>',
		            onChange: function () {
		            	gridView.setData(this.page.selectPage);
		            }
		        },
		        columns: [
		        	{key: "prdtCd", label: "제품코드"},
		        	{key: "prdtNm", label: "제품명"},
		        	{key: "prdtDivNm", label: "제품구분"},
		        	{key: "prdtStknNm", label: "제품강종"},
		        	{key: "prdtErqkNm", label: "내진구분"},
		        	{key: "prdtSizeNm", label: "사이즈"},
		        	{key: "prdtSpecNm", label: "제품규격"},
		        	{key: "prdtCoilYn", label: "코일구분"},
		        	{key: "prdtUnitNm", label: "제품단위"},
		        	{key: "prdtWt", label: "제품단위중량"},
		        	{key: "prdtUpr", label: "제품기준단가"},
		        	{key: "prdtDt", label: "기준일자"},
		        	{key: "prdtDkCd", label: "동국제강 제품코드"},
		        	{key: "prdtMesCd", label: "MES대응코드"},
		        	{key: "useYn", label: "사용여부"},
		        	{key: "etcField1", label: "여분필드(고정)"},
		        	{key: "etcField2", label: "여분필드(숫자)"},
		        	{key: "etcField3", label: "여분필드(가변)"},
		        ]
		    });
			return this;
		}, 
		setData: function(_pageNo) {
			firstGrid = this.target;
			var formData = {
				"useYn" : $("#useYn").val(),
				"searchType" : $("#searchType").val(),
				"searchValue" : $("#searchValue").val(),
				"pageNo" : _pageNo + 1, 
				"recordCnt" : 20
			}
			postAjax("/admin/bm/bm01/selectMaterialList", formData, null, function(data){
				var list = data.materialList;
				firstGrid.setData({
					list : list,
					page : {
						currentPage : _pageNo,
						pageSize : data.paginationInfo.pageSize,
						totalElements : data.paginationInfo.totalRecordCount,
						totalPages : data.paginationInfo.totalPageCount
					}
				});
			});
		}
	}
	
	$(document).ready(function() {
		gridView.initView().setData(0);
	})
	
	function search() {
		gridView.initView().setData(0);
	}
	
	function detailMaterial(type) {
		actionType = type;
		
		if ( actionType == 'U' && selectGridValidation(firstGrid))
			return;
		
		openModal("/static/html/admin/bm/bm01/BM0102P01.html", 800, 400, "자재코드");
	}

	
	function deleteMaterial() {
		if (selectGridValidation(firstGrid))
			return;
		if (!confirm("삭제하시겠습니까?"))
			return;
		var formData = {
			"prdtCd" : firstGrid.getList("selected")[0].prdtCd
		}
		deleteAjax("/admin/bm/bm01/deleteMaterial", formData, null, function(data) {
			if (data.resultCode == 200) {
				alert(data.resultMessage);
				gridView.initView().setData(firstGrid.page.currentPage);
			}
		});
	}
</script>