<body>
	<div class="row form-group">
		<span style="font-size: 25px; font-weight: bold;">자재코드 관리</span>
		<div style="float: right;">
			<a id="loginBtn" class="btn btn-default btn-sm" onclick="detailMaterial('C');">등록</a>
			<a id="loginBtn" class="btn btn-default btn-sm" onclick="detailMaterial('U');">수정</a>
			<a id="loginBtn" class="btn btn-default btn-sm" onclick="deleteMaterial();">삭제</a>
		</div>
	</div>
	<div class="row">
		<div class="form-inline form-group">
			<select id="searchType" class="form-control" >
				<option>품명</option>
				<option>규격</option>
				<option>구분</option>
				<option>모델번호</option>
				<option>모델명</option>
				<option>비고</option>
				<option>중분류</option>
				<option>소분류</option>
			</select>
			<input id="searchValue" type="text" class="form-control">
			<button class="btn btn-primary" type="button" onclick="getData(0);">검색</button>
		</div>
	</div>
	<div class="row">
		<div data-ax5grid="first-grid" data-ax5grid-config="{}" style="height: 500px; width: 100%"></div>
	</div>
</body>
<script type="text/javascript">
	
	var firstGrid = new ax5.ui.grid();
	var authId = null;
	var authRole = null;
	var actionType = null;
	
	$(document).ready(function() {
		
        firstGrid.setConfig({
        	showRowSelector: true,
        	multipleSelect: false,
            target: $('[data-ax5grid="first-grid"]'),
            header: {
            	 selector: false
            },
            body: {
            	onClick: function () {
                    this.self.select(this.dindex);
                },
                onDBLClick: function () {
                	detailMaterial("U");
                },
            },
            page: {
                navigationItemCount: 9,
                height: 30,
                display: true,
                firstIcon: '<i class="fa fa-step-backward" aria-hidden="true"></i>',
                prevIcon: '<i class="fa fa-caret-left" aria-hidden="true"></i>',
                nextIcon: '<i class="fa fa-caret-right" aria-hidden="true"></i>',
                lastIcon: '<i class="fa fa-step-forward" aria-hidden="true"></i>',
                onChange: function () {
                	firstGrid.setData(this.page.selectPage);
                }
            },
            columns: [
                {key: "stock", label: "재고표시"},
                {key: "materialCd", label: "구조코드"},
                {key: "bCd", label: "대분류"},
                {key: "accountNm", label: "계정과목"},
                {key: "sAccountNm", label: "매출계정과목"},
                {key: "itemName", label: "품명/용역"},
            ]
        });
        getData(0);
	})
	
	function roleListModal(index) {
		firstGrid.select(index);
		authId = firstGrid.getList("selected")[0].authId;
		authRole = firstGrid.getList("selected")[0].authRole;
		openModal("/static/html/admin/cm/auth/updateAuthRole.html", 800, 550, "권한롤등록 "+authId);
	}
	
	function getData(_pageNo) {
		var formData = {
			"searchType" : $("#searchType").val(),
			"searchValue" : $("#searchValue").val()
		}
		postAjax("/admin/bm/material/selectMaterialList", formData, null, function(data){
			var list = data.materialList;
			firstGrid.setData({
				list : list,
				page : {
					currentPage : _pageNo,
					pageSize : 10,
					totalElements : list.length,
					totalPages : list.length / 10
				}
			});
			return this;
		});
	}

	function detailMaterial(type) {
		actionType = type;
		openModal("/static/html/admin/bm/material/detailMaterial.html", 800, 400, "자재코드");
	}

	function updateAuthModal() {
		if (selectGridValidation(firstGrid)) return;
		openModal("/static/html/admin/bm/auth/updateAuth.html", 600, 300, "자재코드 수정");
	}

	function deleteMaterial() {
		if (selectGridValidation(firstGrid))
			return;
		if (!confirm("삭제하시겠습니까?"))
			return;
		var formData = {
			"materialCd" : firstGrid.getList("selected")[0].materialCd
		}
		deleteAjax("/admin/bm/material/deleteMaterial", formData, null, function(data) {
			if (data.resultCode == 200) {
				alert(data.resultMessage);
				getData();
			}
		});
	}
</script>