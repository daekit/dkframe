<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.dksys.biz.admin.user.mapper.UserMapper">

	<select id="selectUserList" resultType="CamelMap">
		SELECT
			ID,
			NAME,
			EMP_NO,
			EMAIL,
			USE_YN,
			DATE_FORMAT(CREATE_DT, '%Y-%m-%d %H:%i:%s') AS CREATE_DT,
			DATE_FORMAT(UPDATE_DT, '%Y-%m-%d %H:%i:%s') AS UPDATE_DT
		FROM
			USER
		WHERE 1=1
		<if test="deptId !='' and deptId != null">
			AND DEPT_ID = #{deptId}
		</if>
		<if test="searchValue !='' and searchValue != null">
			AND NAME = #{searchValue}
		</if>
	</select>
	
	<select id="selectUserCount" resultType="int">
		SELECT
			COUNT(*)
		FROM
			USER
		WHERE
			ID = #{userId}
	</select>
	
	<insert id="insertUser">
		INSERT INTO USER(
			ID,
			PASSWORD, 
			EMP_NO, 
			NAME, 
			EMAIL, 
			DEPT_ID,
			AUTH_INFO,
			ENTER_DT,
			USE_YN, 
			CREATE_DT, 
			UPDATE_DT
		)VALUES(
			#{userId},
			#{password},
			#{empNo},
			#{userNm},
			#{email},
			#{deptId},
			#{authInfo},
			STR_TO_DATE(#{enterDt}, '%Y-%m-%d'),
			#{useYn},
			NOW(),
			NOW()
		)
	</insert>
	
	<select id="selectUserInfo" resultType="CamelMap">
		SELECT
			ID,
			EMP_NO, 
			NAME, 
			EMAIL, 
			DEPT_ID,
			(SELECT DEPT_NM FROM DEPARTMENT WHERE DEPT_ID = U.DEPT_ID) DEPT_NM,
			AUTH_INFO,
			DATE_FORMAT(ENTER_DT, '%Y-%m-%d') AS ENTER_DT,
			USE_YN,
			CREATE_DT,
			UPDATE_DT
		FROM
			USER U
		WHERE
			ID = #{userId}
	</select>
	
	<update id="updateUser">
		UPDATE
			USER
		SET
			EMP_NO = #{empNo},
			NAME = #{userNm},
			EMAIL = #{email},
			DEPT_ID = #{deptId},
			AUTH_INFO = #{authInfo},
			ENTER_DT = STR_TO_DATE(#{enterDt}, '%Y-%m-%d'),
			USE_YN = #{useYn},
			UPDATE_DT = NOW()
		WHERE
			ID = #{userId}
	</update>
	
</mapper>