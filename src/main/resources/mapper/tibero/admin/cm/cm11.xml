<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.dksys.biz.admin.cm.cm11.mapper.CM11Mapper">
	<select id="selectSearchDttm" resultType="String">
	SELECT TO_CHAR(SYSDATE, 'YYYY-MM-DD HH24:MI:SS') SEARCH_DTTM FROM DUAL
	</select>
	<select id="selectPrdtSelpch2Count" resultType="int">
	  SELECT COUNT(*)
	  FROM (SELECT FN_CM05M01_CD_TO_NM(PRDT_DIV) PRDT_DIV_NM
				 , SUM(TRST_QTY) TRST_QTY
				 , SUM(REAL_TRST_QTY) REAL_TRST_QTY
				 , SUM(TRST_AMT) TRST_AMT
				 , SUM(REAL_TRST_AMT) REAL_TRST_AMT
				  FROM(
						SELECT B.PRDT_DIV
							 , TRST_QTY
							 , REAL_TRST_QTY 
							 , TRST_AMT
							 , REAL_TRST_AMT
						  FROM TB_AR02M01 A
						  	 , TB_BM01M01 B
						 WHERE A.TRST_PRDT_CD = B.PRDT_CD
						   AND SUBSTRING(TRST_DT, 0, 6) = TO_CHAR(SYSDATE, 'YYYYMM')
						   AND A.SELPCH_CD  = 'SELPCH2') T
				GROUP BY T.PRDT_DIV)
	</select>
	
	<select id="selectPrdtSelpch2List" resultType="CamelMap">
	SELECT FN_CM05M01_CD_TO_NM(PRDT_DIV) PRDT_DIV_NM
	 , ROUND(SUM(TRST_QTY)      /1000, 0)    TRST_QTY
	 , ROUND(SUM(REAL_TRST_QTY) /1000, 0)    REAL_TRST_QTY
	 , ROUND(SUM(TRST_AMT)      /1000000, 0) TRST_AMT
	 , ROUND(SUM(REAL_TRST_AMT) /1000000, 0) REAL_TRST_AMT
	  FROM(
			SELECT B.PRDT_DIV
				 , TRST_QTY
				 , REAL_TRST_QTY 
				 , TRST_AMT
				 , REAL_TRST_AMT
			  FROM TB_AR02M01 A
			  	 , TB_BM01M01 B
			 WHERE A.TRST_PRDT_CD = B.PRDT_CD
			   AND SUBSTRING(TRST_DT, 0, 6) = TO_CHAR(SYSDATE, 'YYYYMM')
			   AND A.SELPCH_CD  = 'SELPCH2') T
	GROUP BY T.PRDT_DIV
	</select>
	
	<select id="selectClntSelpch2Count" resultType="int">
	SELECT COUNT(*)
	  FROM (SELECT TAXIVC_COPRT,
		   <!-- (SELECT CLNT_NM FROM TB_BM02M01 WHERE CLNT_CD = T.TRST_CLNT_CD) CLNT_NM, -->
		   FN_CM05M01_CD_TO_NM(TAXIVC_COPRT) CLNT_NM,
		   SUM(TRST_QTY) TRST_QTY,
		   SUM(REAL_TRST_QTY)  REAL_TRST_QTY,
		   SUM(TRST_AMT) TRST_AMT,
		   SUM(REAL_TRST_AMT) REAL_TRST_AMT
	  FROM TB_AR02M01 T
	 WHERE SUBSTRING(TRST_DT, 0, 6) = TO_CHAR(SYSDATE, 'YYYYMM')
	   AND SELPCH_CD = 'SELPCH2'
	 GROUP BY TAXIVC_COPRT
  ORDER BY TAXIVC_COPRT)
	</select>
	
	<select id="selectClntSelpch2List" resultType="CamelMap">
	SELECT TAXIVC_COPRT,
		   FN_CM05M01_CD_TO_NM(TAXIVC_COPRT) CLNT_NM,
		   ROUND(SUM(TRST_QTY)      /1000, 0)    TRST_QTY,
		   ROUND(SUM(REAL_TRST_QTY) /1000, 0)    REAL_TRST_QTY,
		   ROUND(SUM(TRST_AMT)      /1000000, 0) TRST_AMT,
		   ROUND(SUM(REAL_TRST_AMT) /1000000, 0) REAL_TRST_AMT
	  FROM TB_AR02M01 T
	 WHERE SUBSTRING(TRST_DT, 0, 6) = TO_CHAR(SYSDATE, 'YYYYMM')
	   AND SELPCH_CD = 'SELPCH2'
	 GROUP BY TAXIVC_COPRT
  ORDER BY TAXIVC_COPRT
	</select>
	
	<select id="selectClntSelpch1Count" resultType="int">
	SELECT COUNT(*)
	  FROM (SELECT TAXIVC_COPRT
		   <!-- (SELECT CLNT_NM FROM TB_BM02M01 WHERE CLNT_CD = T.TRST_CLNT_CD) CLNT_NM, -->
		   , FN_CM05M01_CD_TO_NM(TAXIVC_COPRT) CLNT_NM
				 , SUM(TRST_QTY) TRST_QTY
				 , SUM(REAL_TRST_QTY) REAL_TRST_QTY
				 , SUM(TRST_AMT) TRST_AMT
				 , SUM(REAL_TRST_AMT) REAL_TRST_AMT
				  FROM(
						SELECT TAXIVC_COPRT
							 , B.PRDT_DIV
							 , TRST_QTY
							 , REAL_TRST_QTY 
							 , TRST_AMT
							 , REAL_TRST_AMT
						  FROM TB_AR02M01 A
						  	 , TB_BM01M01 B
						 WHERE A.TRST_PRDT_CD = B.PRDT_CD
							   AND SUBSTRING(TRST_DT, 0, 6) = TO_CHAR(SYSDATE, 'YYYYMM')
						   AND A.SELPCH_CD  = 'SELPCH2') T
				GROUP BY TAXIVC_COPRT
				ORDER BY TAXIVC_COPRT)
	</select>
	
	<select id="selectClntSelpch1List" resultType="CamelMap">
	SELECT TAXIVC_COPRT
		   <!-- (SELECT CLNT_NM FROM TB_BM02M01 WHERE CLNT_CD = T.TRST_CLNT_CD) CLNT_NM, -->
		 ,  FN_CM05M01_CD_TO_NM(TAXIVC_COPRT) CLNT_NM
		 , ROUND(SUM(TRST_QTY) / 1000, 0)          TRST_QTY
		 , ROUND(SUM(REAL_TRST_QTY) / 1000, 0)     REAL_TRST_QTY
		 , ROUND(SUM(TRST_AMT) / 1000000, 0)         TRST_AMT
		 , ROUND(SUM(REAL_TRST_AMT) / 1000000, 0)     REAL_TRST_AMT
		  FROM(
				SELECT TAXIVC_COPRT
					 , B.PRDT_DIV
					 , TRST_QTY
					 , REAL_TRST_QTY 
					 , TRST_AMT
					 , REAL_TRST_AMT
				  FROM TB_AR02M01 A
				  	 , TB_BM01M01 B
				 WHERE A.TRST_PRDT_CD = B.PRDT_CD
					   AND SUBSTRING(TRST_DT, 0, 6) = TO_CHAR(SYSDATE, 'YYYYMM')
				   AND A.SELPCH_CD  = 'SELPCH2') T
		GROUP BY TAXIVC_COPRT
		ORDER BY TAXIVC_COPRT
	</select>
	
	<select id="selectFacList" resultType="CamelMap">
	SELECT '인천공장' FAC_NM 
	, C.DD_WGT --일생산량
	,  C.MM_WGT --월생산량 
	, CASE WHEN TO_CHAR(SYSDATE,'MM') = '01' THEN nvl(D.PLAN_WGT_01,0)
            WHEN TO_CHAR(SYSDATE,'MM') = '02' THEN nvl(D.PLAN_WGT_02,0)
            WHEN TO_CHAR(SYSDATE,'MM') = '03' THEN nvl(D.PLAN_WGT_03,0)
            WHEN TO_CHAR(SYSDATE,'MM') = '04' THEN nvl(D.PLAN_WGT_04,0)
            WHEN TO_CHAR(SYSDATE,'MM') = '05' THEN nvl(D.PLAN_WGT_05,0)
            WHEN TO_CHAR(SYSDATE,'MM') = '06' THEN nvl(D.PLAN_WGT_06,0)
            WHEN TO_CHAR(SYSDATE,'MM') = '07' THEN nvl(D.PLAN_WGT_07,0)
            WHEN TO_CHAR(SYSDATE,'MM') = '08' THEN nvl(D.PLAN_WGT_08,0)
            WHEN TO_CHAR(SYSDATE,'MM') = '09' THEN nvl(D.PLAN_WGT_09,0)
            WHEN TO_CHAR(SYSDATE,'MM') = '10' THEN nvl(D.PLAN_WGT_10,0)
            WHEN TO_CHAR(SYSDATE,'MM') = '11' THEN nvl(D.PLAN_WGT_11,0)
            WHEN TO_CHAR(SYSDATE,'MM') = '12' THEN nvl(D.PLAN_WGT_12,0)
       END MM_PLAN --계획목표량 
	FROM (
		SELECT  ROUND(  SUM(CASE WHEN RCPT_DD = TO_CHAR(SYSDATE,'YYYYMMDD') THEN ORD_PACK_WGT END)/1000,3) DD_WGT --일생산량 
	         , ROUND(SUM(ORD_PACK_WGT)/1000,3) AS MM_WGT --월생산량 
	         , MAX(WORKS_CD) AS WORKS_CD, MAX(FAC_CD) AS FAC_CD
	    FROM (   
				   SELECT B.WORKS_CD, B.FAC_CD, B.RCPT_DD, B.ORD_PACK_WGT- NVL(A.WEIGHT,0) AS ORD_PACK_WGT
				   FROM KUMMUN.TB_MES_ORD_ITEM B
				    LEFT JOIN KUMMUN.TB_MES_PROD_CANCEL A ON B.WORKS_CD = A.WORKS_CD AND B.FAC_CD = A.FAC_CD
					      AND A.CANCEL_CD='1'
					      AND B.TAG_NO = A.TAG_NO
				WHERE B.WORKS_CD = 'N' --N: 인천금문철강 
				   AND B.FAC_CD = '1180' --1180: 인천공장 
				   AND B.RCPT_DD LIKE TO_CHAR(SYSDATE,'YYYYMM')||'%'
	          )
	)C  LEFT JOIN KUMMUN.TB_MES_MMAIM_MGNT D ON C.WORKS_CD = D.WORKS_CD AND C.FAC_CD = D.FAC_CD
	WHERE D.PLAN_YYYY = TO_CHAR(SYSDATE, 'YYYY') AND D.MMAIM_GBN = '2'
	UNION ALL
	SELECT '진천2공장' FAC_NM
	  , C.DD_WGT --일생산량
	  ,  C.MM_WGT --월생산량 
	  , CASE WHEN TO_CHAR(SYSDATE,'MM') = '01' THEN nvl(D.PLAN_WGT_01,0)
	            WHEN TO_CHAR(SYSDATE,'MM') = '02' THEN nvl(D.PLAN_WGT_02,0)
	            WHEN TO_CHAR(SYSDATE,'MM') = '03' THEN nvl(D.PLAN_WGT_03,0)
	            WHEN TO_CHAR(SYSDATE,'MM') = '04' THEN nvl(D.PLAN_WGT_04,0)
	            WHEN TO_CHAR(SYSDATE,'MM') = '05' THEN nvl(D.PLAN_WGT_05,0)
	            WHEN TO_CHAR(SYSDATE,'MM') = '06' THEN nvl(D.PLAN_WGT_06,0)
	            WHEN TO_CHAR(SYSDATE,'MM') = '07' THEN nvl(D.PLAN_WGT_07,0)
	            WHEN TO_CHAR(SYSDATE,'MM') = '08' THEN nvl(D.PLAN_WGT_08,0)
	            WHEN TO_CHAR(SYSDATE,'MM') = '09' THEN nvl(D.PLAN_WGT_09,0)
	            WHEN TO_CHAR(SYSDATE,'MM') = '10' THEN nvl(D.PLAN_WGT_10,0)
	            WHEN TO_CHAR(SYSDATE,'MM') = '11' THEN nvl(D.PLAN_WGT_11,0)
	            WHEN TO_CHAR(SYSDATE,'MM') = '12' THEN nvl(D.PLAN_WGT_12,0)
	       END MM_PLAN --계획목표량 
	FROM (
	  SELECT  ROUND(  SUM(CASE WHEN TO_CHAR(END_DT, 'YYYYMMDD') = TO_CHAR(SYSDATE, 'YYYYMMDD') THEN ORD_PACK_WGT END)/1000,3) DD_WGT
	      , ROUND(SUM(ORD_PACK_WGT)/1000,3) AS MM_WGT
	      , MAX(WORKS_CD) AS WORKS_CD
	      , MAX(FAC_CD) AS FAC_CD
	    FROM (   
	          SELECT  B.WORKS_CD, B.FAC_CD, A.END_DT, B.RCPT_DD, B.ORD_PACK_WGT- NVL(E.WEIGHT,0) AS ORD_PACK_WGT
	         FROM KUMMUN.TB_MES_PROD_RSLT A, KUMMUN.TB_MES_ORD_DTL C ,KUMMUN.TB_MES_ORD_ITEM B
	          LEFT JOIN KUMMUN.TB_MES_PROD_CANCEL E ON B.WORKS_CD = E.WORKS_CD AND B.FAC_CD = E.FAC_CD
	              AND E.CANCEL_CD='1'
	              AND B.TAG_NO = E.TAG_NO
	       WHERE B.WORKS_CD = 'J' --J: 진천금문철강
	         AND B.FAC_CD = '1146' --1146: 진천공장 
	         AND B.WORKS_CD = A.WORKS_CD AND B.FAC_CD = A.FAC_CD AND B.TAG_NO = A.TAG_NO 
	         AND C.WORKS_CD = B.WORKS_CD AND C.FAC_CD = B.FAC_CD AND C.ORD_NO =B.ORD_NO AND C.ORD_LINE_NO = B.ORD_LINE_NO
	         AND A.EQP_CD LIKE 'K2MC' || '%' --진천 2공장 설비조회, --진천 1공장 설비 조회시 'K1MC'
	         AND B.RCPT_DD LIKE TO_CHAR(SYSDATE,'YYYYMM')||'%'
	          )
	  ) C LEFT OUTER JOIN  KUMMUN.TB_MES_MMAIM_MGNT D ON C.WORKS_CD = D.WORKS_CD AND C.FAC_CD = D.FAC_CD AND D.PLAN_YYYY = TO_CHAR(SYSDATE, 'YYYY') AND D.MMAIM_GBN = '2' AND D.FAC_GUBUN = 'B0002' --B0001: 1공장, B0002: 2공장 
	UNION ALL
	SELECT '진천1공장' FAC_NM
	  , C.DD_WGT --일생산량
	  ,  C.MM_WGT --월생산량 
	  , CASE WHEN TO_CHAR(SYSDATE,'MM') = '01' THEN nvl(D.PLAN_WGT_01,0)
	            WHEN TO_CHAR(SYSDATE,'MM') = '02' THEN nvl(D.PLAN_WGT_02,0)
	            WHEN TO_CHAR(SYSDATE,'MM') = '03' THEN nvl(D.PLAN_WGT_03,0)
	            WHEN TO_CHAR(SYSDATE,'MM') = '04' THEN nvl(D.PLAN_WGT_04,0)
	            WHEN TO_CHAR(SYSDATE,'MM') = '05' THEN nvl(D.PLAN_WGT_05,0)
	            WHEN TO_CHAR(SYSDATE,'MM') = '06' THEN nvl(D.PLAN_WGT_06,0)
	            WHEN TO_CHAR(SYSDATE,'MM') = '07' THEN nvl(D.PLAN_WGT_07,0)
	            WHEN TO_CHAR(SYSDATE,'MM') = '08' THEN nvl(D.PLAN_WGT_08,0)
	            WHEN TO_CHAR(SYSDATE,'MM') = '09' THEN nvl(D.PLAN_WGT_09,0)
	            WHEN TO_CHAR(SYSDATE,'MM') = '10' THEN nvl(D.PLAN_WGT_10,0)
	            WHEN TO_CHAR(SYSDATE,'MM') = '11' THEN nvl(D.PLAN_WGT_11,0)
	            WHEN TO_CHAR(SYSDATE,'MM') = '12' THEN nvl(D.PLAN_WGT_12,0)
	       END MM_PLAN --계획목표량 
	FROM (
	  SELECT  ROUND(  SUM(CASE WHEN TO_CHAR(END_DT, 'YYYYMMDD') = TO_CHAR(SYSDATE, 'YYYYMMDD') THEN ORD_PACK_WGT END)/1000,3) DD_WGT
	      , ROUND(SUM(ORD_PACK_WGT)/1000,3) AS MM_WGT
	      , MAX(WORKS_CD) AS WORKS_CD
	      , MAX(FAC_CD) AS FAC_CD
	    FROM (   
	          SELECT  B.WORKS_CD, B.FAC_CD, A.END_DT, B.RCPT_DD, B.ORD_PACK_WGT- NVL(E.WEIGHT,0) AS ORD_PACK_WGT
	         FROM KUMMUN.TB_MES_PROD_RSLT A, KUMMUN.TB_MES_ORD_DTL C ,KUMMUN.TB_MES_ORD_ITEM B
	          LEFT JOIN KUMMUN.TB_MES_PROD_CANCEL E ON B.WORKS_CD = E.WORKS_CD AND B.FAC_CD = E.FAC_CD
	              AND E.CANCEL_CD='1'
	              AND B.TAG_NO = E.TAG_NO
	       WHERE B.WORKS_CD = 'J' --J: 진천금문철강
	         AND B.FAC_CD = '1146' --1146: 진천공장 
	         AND B.WORKS_CD = A.WORKS_CD AND B.FAC_CD = A.FAC_CD AND B.TAG_NO = A.TAG_NO 
	         AND C.WORKS_CD = B.WORKS_CD AND C.FAC_CD = B.FAC_CD AND C.ORD_NO =B.ORD_NO AND C.ORD_LINE_NO = B.ORD_LINE_NO
	         AND A.EQP_CD LIKE 'K1MC' || '%' --진천 2공장 설비조회, --진천 1공장 설비 조회시 'K1MC'
	         AND B.RCPT_DD LIKE TO_CHAR(SYSDATE,'YYYYMM')||'%'
	          )
	  ) C LEFT OUTER JOIN  KUMMUN.TB_MES_MMAIM_MGNT D ON C.WORKS_CD = D.WORKS_CD AND C.FAC_CD = D.FAC_CD AND D.PLAN_YYYY = TO_CHAR(SYSDATE, 'YYYY') AND D.MMAIM_GBN = '2' AND D.FAC_GUBUN = 'B0002' --B0001: 1공장, B0002: 2공장
		
	</select>
	
	<select id="selectMonthlyStat" resultType="CamelMap">
	SELECT SUM(SELPCH1_QTY) SELPCH1_QTY
	     , SUM(SELPCH2_QTY) SELPCH2_QTY
	     , TRST_DT
	 FROM (
		SELECT NVL(SUM(DECODE(SELPCH_CD, 'SELPCH1', REAL_TRST_QTY)), 0) SELPCH1_QTY
			 , NVL(SUM(DECODE(SELPCH_CD, 'SELPCH2', REAL_TRST_QTY)), 0) SELPCH2_QTY
			 , SUBSTRING(TRST_DT, 0, 4) || '-' || SUBSTRING(TRST_DT, 5, 2) TRST_DT
			  FROM TB_AR02M01
			 WHERE TRST_DT IS NOT NULL
			   AND SUBSTRING(TRST_DT, 0, 4) = TO_CHAR(SYSDATE, 'YYYY')
			  GROUP BY SUBSTRING(TRST_DT, 0, 4) || '-' || SUBSTRING(TRST_DT, 5, 2)
		UNION ALL
		SELECT 0, 0, TO_CHAR(SYSDATE, 'YYYY') || '-01' FROM DUAL
		UNION ALL
		SELECT 0, 0, TO_CHAR(SYSDATE, 'YYYY') || '-02' FROM DUAL
		UNION ALL
		SELECT 0, 0, TO_CHAR(SYSDATE, 'YYYY') || '-03' FROM DUAL
		UNION ALL
		SELECT 0, 0, TO_CHAR(SYSDATE, 'YYYY') || '-04' FROM DUAL
		UNION ALL
		SELECT 0, 0, TO_CHAR(SYSDATE, 'YYYY') || '-05' FROM DUAL
		UNION ALL
		SELECT 0, 0, TO_CHAR(SYSDATE, 'YYYY') || '-06' FROM DUAL
		UNION ALL
		SELECT 0, 0, TO_CHAR(SYSDATE, 'YYYY') || '-07' FROM DUAL
		UNION ALL
		SELECT 0, 0, TO_CHAR(SYSDATE, 'YYYY') || '-08' FROM DUAL
		UNION ALL
		SELECT 0, 0, TO_CHAR(SYSDATE, 'YYYY') || '-09' FROM DUAL
		UNION ALL
		SELECT 0, 0, TO_CHAR(SYSDATE, 'YYYY') || '-10' FROM DUAL
		UNION ALL
		SELECT 0, 0, TO_CHAR(SYSDATE, 'YYYY') || '-11' FROM DUAL
		UNION ALL
		SELECT 0, 0, TO_CHAR(SYSDATE, 'YYYY') || '-12' FROM DUAL)
	GROUP BY TRST_DT
	ORDER BY TRST_DT
	</select>
</mapper>