<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.dksys.biz.admin.cm.cm20.mapper.CM20Mapper">

	<select id="selectSanctnCount" resultType="int">
	SELECT COUNT(*)
	FROM  (
		SELECT CO_CD, FN_CM05M01_CD_TO_NM(CO_CD) AS CO_NM, SANCTN_CD
			, MAX(DECODE(SANCTN_LEVEL, 1, LEVEL_CD)) FST_LEVEL_CD
			, MAX(DECODE(SANCTN_LEVEL, 1, LEVEL_NM)) FST_LEVEL_NM
			, MAX(DECODE(SANCTN_LEVEL, 2, LEVEL_CD)) SND_LEVEL_CD
			, MAX(DECODE(SANCTN_LEVEL, 2, LEVEL_NM)) SND_LEVEL_NM
			, MAX(DECODE(SANCTN_LEVEL, 3, LEVEL_CD)) THD_LEVEL_CD
			, MAX(DECODE(SANCTN_LEVEL, 3, LEVEL_NM)) THD_LEVEL_NM
			, MAX(DECODE(SANCTN_LEVEL, 4, LEVEL_CD)) FOU_LEVEL_CD
			, MAX(DECODE(SANCTN_LEVEL, 4, LEVEL_NM)) FOU_LEVEL_NM
			, MAX(DECODE(SANCTN_LEVEL, 5, LEVEL_CD)) FIF_LEVEL_CD
			, MAX(DECODE(SANCTN_LEVEL, 5, LEVEL_NM)) FIF_LEVEL_NM
			, MAX(DECODE(SANCTN_LEVEL, 6, LEVEL_CD)) SIX_LEVEL_CD
			, MAX(DECODE(SANCTN_LEVEL, 6, LEVEL_NM)) SIX_LEVEL_NM
			, MAX(DECODE(SANCTN_LEVEL, 7, LEVEL_CD)) SEV_LEVEL_CD
			, MAX(DECODE(SANCTN_LEVEL, 7, LEVEL_NM)) SEV_LEVEL_NM
			, MAX(DECODE(SANCTN_LEVEL, 8, LEVEL_CD)) EGH_LEVEL_CD
			, MAX(DECODE(SANCTN_LEVEL, 8, LEVEL_NM)) EGH_LEVEL_NM
		FROM TB_CM20M01 
		GROUP BY CO_CD, SANCTN_CD
	)
	</select>
	
	<select id="selectSanctnList"  parameterType="Map"  resultType="CamelMap">
	SELECT *
	FROM (
		SELECT ROWNUM AS RNUM, A.*
		FROM (
			SELECT CO_CD, FN_CM05M01_CD_TO_NM(CO_CD) AS CO_NM, SANCTN_CD
						, MAX(DECODE(SANCTN_LEVEL, 1, LEVEL_CD)) FST_LEVEL_CD
						, MAX(DECODE(SANCTN_LEVEL, 1, LEVEL_NM)) FST_LEVEL_NM
						, MAX(DECODE(SANCTN_LEVEL, 2, LEVEL_CD)) SND_LEVEL_CD
						, MAX(DECODE(SANCTN_LEVEL, 2, LEVEL_NM)) SND_LEVEL_NM
						, MAX(DECODE(SANCTN_LEVEL, 3, LEVEL_CD)) THD_LEVEL_CD
						, MAX(DECODE(SANCTN_LEVEL, 3, LEVEL_NM)) THD_LEVEL_NM
						, MAX(DECODE(SANCTN_LEVEL, 4, LEVEL_CD)) FOU_LEVEL_CD
						, MAX(DECODE(SANCTN_LEVEL, 4, LEVEL_NM)) FOU_LEVEL_NM
						, MAX(DECODE(SANCTN_LEVEL, 5, LEVEL_CD)) FIF_LEVEL_CD
						, MAX(DECODE(SANCTN_LEVEL, 5, LEVEL_NM)) FIF_LEVEL_NM
						, MAX(DECODE(SANCTN_LEVEL, 6, LEVEL_CD)) SIX_LEVEL_CD
						, MAX(DECODE(SANCTN_LEVEL, 6, LEVEL_NM)) SIX_LEVEL_NM
						, MAX(DECODE(SANCTN_LEVEL, 7, LEVEL_CD)) SEV_LEVEL_CD
						, MAX(DECODE(SANCTN_LEVEL, 7, LEVEL_NM)) SEV_LEVEL_NM
						, MAX(DECODE(SANCTN_LEVEL, 8, LEVEL_CD)) EGH_LEVEL_CD
						, MAX(DECODE(SANCTN_LEVEL, 8, LEVEL_NM)) EGH_LEVEL_NM
			FROM TB_CM20M01 
			GROUP BY CO_CD, SANCTN_CD
			ORDER BY SANCTN_CD, CO_CD
		)A
	)
	WHERE RNUM BETWEEN #{firstIndex} AND #{lastIndex}
	</select>
	
	
	<select id="selectSanctnInfo"  parameterType="Map"  resultType="CamelMap">
		SELECT CO_CD, FN_CM05M01_CD_TO_NM(CO_CD) AS CO_NM, SANCTN_CD
						, MAX(DECODE(SANCTN_LEVEL, 1, LEVEL_CD)) FST_LEVEL_CD
						, MAX(DECODE(SANCTN_LEVEL, 1, LEVEL_NM)) FST_LEVEL_NM
						, MAX(DECODE(SANCTN_LEVEL, 2, LEVEL_CD)) SND_LEVEL_CD
						, MAX(DECODE(SANCTN_LEVEL, 2, LEVEL_NM)) SND_LEVEL_NM
						, MAX(DECODE(SANCTN_LEVEL, 3, LEVEL_CD)) THD_LEVEL_CD
						, MAX(DECODE(SANCTN_LEVEL, 3, LEVEL_NM)) THD_LEVEL_NM
						, MAX(DECODE(SANCTN_LEVEL, 4, LEVEL_CD)) FOU_LEVEL_CD
						, MAX(DECODE(SANCTN_LEVEL, 4, LEVEL_NM)) FOU_LEVEL_NM
						, MAX(DECODE(SANCTN_LEVEL, 5, LEVEL_CD)) FIF_LEVEL_CD
						, MAX(DECODE(SANCTN_LEVEL, 5, LEVEL_NM)) FIF_LEVEL_NM
						, MAX(DECODE(SANCTN_LEVEL, 6, LEVEL_CD)) SIX_LEVEL_CD
						, MAX(DECODE(SANCTN_LEVEL, 6, LEVEL_NM)) SIX_LEVEL_NM
						, MAX(DECODE(SANCTN_LEVEL, 7, LEVEL_CD)) SEV_LEVEL_CD
						, MAX(DECODE(SANCTN_LEVEL, 7, LEVEL_NM)) SEV_LEVEL_NM
						, MAX(DECODE(SANCTN_LEVEL, 8, LEVEL_CD)) EGH_LEVEL_CD
						, MAX(DECODE(SANCTN_LEVEL, 8, LEVEL_NM)) EGH_LEVEL_NM
			FROM TB_CM20M01 
			WHERE SANCTN_CD = #{sanctnCd}
			  AND CO_CD = #{coCd}
			GROUP BY CO_CD, SANCTN_CD
	</select>
	
	<delete id="deleteSanctnInfo" parameterType="Map" >
		DELETE FROM TB_CM20M01 
		WHERE SANCTN_CD = #{sanctnCd}
		  AND CO_CD = #{coCd}
	</delete>
	
	<insert id="insertSanctnInfo" parameterType="Map">

	INSERT INTO TB_CM20M01
	 (SANCTN_CD, SANCTN_LEVEL, LEVEL_CD, LEVEL_NM, CO_CD)
	VALUES
		(#{sanctnCd}, #{sanctnLevel}, #{levelCd},  FN_CM05M01_CD_TO_NM(#{levelCd}), #{coCd} )

	</insert>


	<update id="updateSanctnInfo" parameterType="Map">
	
	UPDATE TB_CM20M01 
	SET LEVEL_CD= #{levelCd}
		, LEVEL_NM = FN_CM05M01_CD_TO_NM(#{levelCd}) 
	WHERE SANCTN_CD= #{sanctnCd} AND SANCTN_LEVEL= #{sanctnLevel}
	  AND CO_CD = #{coCd}
	
	</update>
</mapper>