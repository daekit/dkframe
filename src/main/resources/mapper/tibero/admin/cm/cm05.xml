<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.dksys.biz.admin.cm.cm05.mapper.CM05Mapper">

	<select id="selectCodeCount" resultType="int">
		SELECT
			COUNT(*)
		FROM 
			TB_CM05M01 
		WHERE
			CODE_KIND = #{codeKind}
			AND USE_YN = #{useYn}
			<if test="searchValue != null and !searchValue.equals('')">
				AND ${searchType} LIKE '%${searchValue}%'
			</if>
		ORDER BY SORT_NO ASC
	</select>

	<select id="selectCodeList" resultType="CamelMap">
		SELECT 
			*
		FROM
		(
			SELECT
				ROWNUM AS RNUM, A.*
			FROM 
			(
				SELECT
					*
				FROM 
					TB_CM05M01 
				WHERE
					CODE_KIND = #{codeKind}
					AND USE_YN = #{useYn}
					<if test="searchValue != null and !searchValue.equals('')">
						AND ${searchType} LIKE '%${searchValue}%'
					</if>
				ORDER BY SORT_NO ASC
			) A
		)
		WHERE
			RNUM BETWEEN #{firstIndex} AND #{lastIndex}
	</select>
	
	<select id="selectChildCodeList" resultType="CamelMap">
		SELECT
			*
		FROM
			TB_CM05M01
		WHERE
			USE_YN = 'Y'
			AND CODE_KIND = #{codeKind}
			<if test="codeRprc != null and !codeRprc.equals('')">
				AND CODE_RPRC = #{codeRprc}
			</if>
		ORDER BY SORT_NO ASC
	</select>
	
	<select id="selectCodeInfo" resultType="CamelMap">
		SELECT
			CODE_ID,
			CODE_NM,
			CODE_KIND,
			CODE_DESC,
			CODE_RPRC,
			SORT_NO,
			USE_YN
		FROM
			TB_CM05M01
		WHERE
			CODE_ID = #{codeId}
	</select>
	
	<select id="selectCodeInfoList" parameterType="Map" resultType="CamelMap">
		SELECT
			CODE_ID, 
			CODE_NM, 
			CODE_KIND, 
			CODE_DESC, 
			SORT_NO,
			USE_YN, 
			CREAT_ID, 
			CREAT_DTTM
		FROM
			TB_CM05M01
		WHERE
			CODE_KIND = #{codeKind}
		ORDER BY SORT_NO ASC
	</select>
	
	<insert id="insertCode" parameterType="Map">
		MERGE INTO TB_CM05M01 A
			USING DUAL
			ON (A.CODE_ID = #{codeId})
		WHEN MATCHED THEN
			UPDATE SET
				CODE_NM = #{codeNm},
				CODE_KIND = #{codeKind},
				CODE_DESC = #{codeDesc},
				CODE_RPRC = #{codeRprc},
				SORT_NO = #{sortNo},
				USE_YN = #{useYn},
				UDT_ID = #{userId},
				UDT_PGM = 'admin',
				UDT_DTTM = SYSDATE
		WHEN NOT MATCHED THEN
		INSERT
		(
			CODE_ID,
			CODE_NM,
			CODE_KIND,
			CODE_DESC,
			CODE_RPRC,
			SORT_NO,
			USE_YN,
			CREAT_ID,
			CREAT_PGM,
			CREAT_DTTM
		)
		VALUES(
			#{codeId},
			#{codeNm},
			#{codeKind},
			#{codeDesc},
			#{codeRprc},
			#{sortNo},
			#{useYn},
			#{userId},
			'admin',
			SYSDATE
		)		
	</insert>

	<update id="deleteCode" parameterType="Map">
		UPDATE
			TB_CM05M01
		SET
			USE_YN = 'N',
			UDT_ID = #{userId},
			UDT_PGM = 'admin',
			UDT_DTTM = SYSDATE
		WHERE
			CODE_ID = #{codeId}
	</update>

</mapper>