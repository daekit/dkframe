<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.dksys.biz.admin.cm.cm09.mapper.CM09Mapper">

	<select id="selectNotiList" parameterType="Map" resultType="CamelMap">
		SELECT 
			 T.*
			,(SELECT CODE_NM FROM TB_CM05M01 WHERE CODE_ID = T.CO_CD) AS CO_NM
			,(SELECT NAME FROM TB_CM06M01 WHERE ID = T.CREAT_ID) AS CREAT_NM
		FROM 
		(
		 	SELECT ROWNUM RNUM, A.* FROM TB_CM09M01 A
		 	WHERE 1=1
		 	<if test="searchValue != null and !searchValue.equals('')">
				AND ${searchType} LIKE '%${searchValue}%'				
			</if>
			<if test="coCd != null and !coCd.equals('')">
				AND CO_CD = #{coCd}				
			</if>
			<if test="useYn != null and !useYn.equals('')">
				AND USE_YN = #{useYn}				
			</if>
		) T
		WHERE RNUM BETWEEN ${firstIndex} AND ${lastIndex}
	</select>
	
	<select id="selectNotiCount" parameterType="Map" resultType="int">
	 	SELECT 
	 		COUNT(*) 
	 	FROM TB_CM09M01
	 	WHERE 1=1
	 	<if test="searchValue != null and !searchValue.equals('')">
			AND ${searchType} LIKE '%${searchValue}%'				
		</if>
		<if test="coCd != null and !coCd.equals('')">
			AND CO_CD = #{coCd}				
		</if>
		<if test="useYn != null and !useYn.equals('')">
			AND USE_YN = #{useYn}				
		</if>
	</select>
	
	<insert id="insertNoti" parameterType="Map" useGeneratedKeys="true" keyProperty="notiKey">
		MERGE INTO TB_CM09M01 A
			USING DUAL
			ON (A.NOTI_KEY = #{notiKey})
		WHEN MATCHED THEN
			UPDATE SET
				 CO_CD = #{coCd}     
				,NOTI_TITLE = #{notiTitle}
				,NOTI_CNTS = #{notiCnts} 
				,EXPRTN_YN = #{exprtnYn} 
				,EXPRTN_DT = #{exprtnDt} 
				,POPUP_YN = #{popupYn}  
				,USE_YN = #{useYn}    
				,UDT_ID = #{userId}
				,UDT_PGM = #{pgmId}
				,UDT_DTTM = SYSDATE
		WHEN NOT MATCHED THEN
			INSERT
		 	VALUES
		 	(
		 		 TB_CM09M01_SQ01.NEXTVAL
		 		,#{coCd}
		 		,#{notiTitle}
		 		,#{notiCnts}
		 		,#{exprtnYn}
		 		,#{exprtnDt}
		 		,#{popupYn}
		 		,#{useYn}
		 		,'N'
		 		,0
		 		,#{userId}
		 		,#{pgmId}
		 		,SYSDATE
		 		,#{userId}
		 		,#{pgmId}
		 		,SYSDATE
		 	)
		<selectKey keyProperty="notiKey" resultType="String" order="AFTER">
	    	SELECT MAX(NOTI_KEY) FROM TB_CM09M01
	  	</selectKey>
	</insert>
	
	<delete id="deleteNoti" parameterType="Map">
		DELETE FROM TB_CM09M01
		WHERE NOTI_KEY = #{notiKey}
	</delete>
		
</mapper>