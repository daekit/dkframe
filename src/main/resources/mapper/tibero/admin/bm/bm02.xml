<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.dksys.biz.admin.bm.bm02.mapper.BM02Mapper">
	<insert id="insertClnt">
		<selectKey keyProperty="clntCd" resultType="String" order="BEFORE">
			SELECT TB_BM02M01_SQ01.NEXTVAL FROM DUAL
		</selectKey>
		INSERT INTO TB_BM02M01 (
			CLNT_CD, CLNT_NM, CRN, 
			CLNT_DIV_CD, REPST_NM, 
			BIZCON_NM, BSTY_NM, 
			BIZ_ZIP, BIZ_ADDR, BIZ_ADDR_DTL, 
			BIZ_TEL_NO, BIZ_FAX_NO, SUB_RMK_URL, 
			BANK_CD, BKAC_NO, BKAC_OWNER, BASIS_CDTLN_AMT, 
			PCHS_PAY_DIV_CD, PCHS_CLMN_DIV_CD, PCHS_PMNT_MTD_CD, PCHS_VAT_CD, 
			SELL_PAY_DIV_CD, SELL_CLMN_DIV_CD, SELL_PMNT_MTD_CD, SELL_VAT_CD, 
			CLNT_RMK, USE_YN, 
			CREAT_ID, CREAT_PGM, CREAT_DTTM,
			UDT_ID, UDT_PGM, UDT_DTTM
		) VALUES (
			#{clntNm}, #{crn},
			#{clntDivCd}, #{repstNm},
			#{bizconNm}, #{bstyNm},
			#{bizZip}, #{bizAddr}, #{bizAddrDtl},
			#{bizTelNo}, #{bizFaxNo}, #{subRmkUrl},
			#{bankCd}, #{bkacNo}, #{bkacOwner}, #{basisCdtlnAmt},
			#{pchsPayDivCd}, #{pchsClmnDivCd}, #{pchsPmntMtdCd}, #{pchsVatCd},
			#{sellPayDivCd}, #{sellClmnDivCd}, #{sellPmntMtdCd}, #{sellVatCd},
			#{clntRmk}, #{useYn},
			#{userId}, #{pgmId}, SYSDATE,
			#{userId}, #{pgmId}, SYSDATE
		)
	</insert>
	
	<update id="updateClnt">
		UPDATE
			TB_BM02M01
		SET
			CLNT_NM = #{clntNm}, CRN = #{crn}, 
			CLNT_DIV_CD = #{clntDivCd}, REPST_NM = #{repstNm}, 
			BIZCON_NM = #{bizconNm}, BSTY_NM = #{bstyNm},
			BIZ_ZIP = #{bizZip}, BIZ_ADDR = #{bizAddr}, BIZ_ADDR_DTL = #{bizAddrDtl},
			BIZ_TEL_NO = #{bizTelNo}, BIZ_FAX_NO = #{bizFaxNo}, SUB_RMK_URL = #{subRmkUrl},
			BANK_CD = #{bankCd}, BKAC_NO = #{bkacNo}, BKAC_OWNER = #{bkacOwner}, BASIS_CDTLN_AMT = #{basisCdtlnAmt},
			PCHS_PAY_DIV_CD = #{pchsPayDivCd}, PCHS_CLMN_DIV_CD = #{pchsClmnDivCd}, PCHS_PMNT_MTD_CD = #{pchsPmntMtdCd}, PCHS_VAT_CD = #{pchsVatCd},
			SELL_PAY_DIV_CD = #{sellPayDivCd}, SELL_CLMN_DIV_CD = #{sellClmnDivCd}, SELL_PMNT_MTD_CD = #{sellPmntMtdCd}, SELL_VAT_CD = #{sellVatCd},
			CLNT_RMK = #{clntRmk}, USE_YN = #{useYn},
			UDT_ID = #{userId}, UDT_PGM = #{pgmId}, UDT_DTTM = SYSDATE
		WHERE
			CLNT_CD = #{clntCd}
	</update>
	
	<select id="selectClntCount" resultType="int">
		SELECT 
			COUNT(*)
		FROM
			TB_BM02M01
		WHERE
			USE_YN = #{useYn}
			<if test="searchValue != null and !searchValue.equals('')">
				AND ${searchType} LIKE '%${searchValue}%'
			</if>
		ORDER BY CLNT_CD
	</select>
	
	<select id="selectClntList" resultType="CamelMap">
		SELECT
			*
		FROM
		(
			SELECT
				ROWNUM AS RNUM, A.*
			FROM
			(
				SELECT 
					CLNT_CD,
					CLNT_NM,
					CRN,
					(SELECT CODE_NM FROM GOLDMOON.TB_CM05M01 WHERE CODE_ID = CLNT.CLNT_DIV_CD) CLNT_DIV_NM,
					BIZCON_NM,
					BSTY_NM,
					BIZ_TEL_NO,
					CREAT_DTTM,
					UDT_DTTM
				FROM
					TB_BM02M01 CLNT
				WHERE
					USE_YN = #{useYn}
					<if test="searchValue != null and !searchValue.equals('')">
						AND ${searchType} LIKE '%${searchValue}%'
					</if>
				ORDER BY CLNT_CD
			) A
		)
		WHERE
			RNUM BETWEEN #{firstIndex} AND #{lastIndex}
	</select>
	
	<resultMap id="resultInfoMap" type="CamelMap">
		<collection select="selectClntFileList" property="CLNT_FILE_LIST" column="{fileTrgtKey=CLNT_CD}" ofType="CamelMap"/>
	</resultMap>
	
	<select id="selectClntInfo" resultMap="resultInfoMap">
		SELECT
			CLNT_CD, CLNT_NM, CRN,
			CLNT_DIV_CD, REPST_NM,
			BIZCON_NM, BSTY_NM,
			BIZ_ZIP, BIZ_ADDR, BIZ_ADDR_DTL,
			BIZ_TEL_NO, BIZ_FAX_NO, SUB_RMK_URL,
			BANK_CD, BKAC_NO, BKAC_OWNER, BASIS_CDTLN_AMT,
			PCHS_PAY_DIV_CD, PCHS_CLMN_DIV_CD, PCHS_PMNT_MTD_CD, PCHS_VAT_CD,
			SELL_PAY_DIV_CD, SELL_CLMN_DIV_CD, SELL_PMNT_MTD_CD, SELL_VAT_CD,
			CLNT_RMK, USE_YN
		FROM
			TB_BM02M01
		WHERE
			CLNT_CD = ${clntCd}
	</select>
	
	<select id="selectClntFileList" resultType="CamelMap">
		SELECT * FROM TB_CM08M01 WHERE FILE_TRGT_TYP = 'TB_BM02M01' AND FILE_TRGT_KEY = #{fileTrgtKey}
	</select>
	
</mapper>