<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.dksys.biz.user.ar.ar04.mapper.AR04Mapper">
	<insert id="insertBilg" parameterType="Map">
		INSERT INTO TB_AR04M01 
		(
			BILG_CERT_NO,
            CO_CD,
            SELL_DT,
            SELPCH_CD,
            CLNT_CD,
            CLNT_NM,
            TAX_DT,
            TAX_BILG_NO,
            TAX_DMS5_7240,
            TAX_MOA5_23,
            TAX_MOA5_124,
            TAX_MOA5_388,
            RFF_CNO,
            RFF_VA,
            TAX_DIV_CD,
            RFF_GN1,
            RFF_GN2,
            RFF_AEA,
            BGM_1225,
            BGM_4343,
            XML_FLOW,
            TAX_CREAT_ID,
            TAX_CREAT_NM,
            TAXIVC_COPRT,
            TAXIVC_COPRT_NO,
            TAXIVC_COPRT_CEO,
            TAXIVC_COPRT_NM,
            TAX_COPRT_BIZCON,
            TAXVIC_COPRT_BSTY,
            CTAII_MD_2,
            COMII_AL,
            COMII_EM,
            COMII_TE,
            COMII_FX,
            CTAIV_BJ_1,
            TAXIVC_RCV_CRN,
            TAXIVC_RCV_CEO,
            TAXIVC_RCV_ADDR,
            TAXIVC_RCV_BIZCON,
            TAXIVC_RCV_BSTY,
            TAX_RCV_SN,
            TAX_RCV_NM,
            TAX_RCV_EMAIL,
            TAX_RCV_EMAIL2,
            TAX_RCV_FAX,
            TAX_RCV_TEL,
            TAX_MOBLPHON,
            FTXAC1_1,
            FTXAC2_1,
            FTXAC3_1,
            TAX_MOA5_22,
            TAX_MOA5_212,
            TAX_MOA5_308,
            TAX_MOA5_9,
            TRST_QTY,
            TRST_WT,
            TRST_UPR,
            TRST_AMT,
            REAL_TRST_QTY,
            REAL_TRST_WT,
            REAL_TRST_UPR,
            REAL_TRST_AMT,
            BILG_QTY,
            BILG_WT,
            BILG_UPR,
            BILG_AMT,
            TRANS_AMT,
            TRST_DC_AMT,
            ETC_AMT,
            SND_YN,
            SND_DTTM,
            SND_PROC_ID,
            CSEQ_RCV_YN,
            CSEQ_RCV_DTTM,
            TAX_ADMS_YN,
            TAX_ADMS_DTTM,
            RCV_YN,
            RCV_DTTM,
            RCV_PROC_ID,
            ACC_SLIP_NO,
            ACC_SLIP_YN,
            ACC_SLIP_DTTM,
            ACC_PROC_ID,
            ETC_FIELD1,
            ETC_FIELD2,
            ETC_FIELD3,
            CREAT_ID,
            CREAT_PGM,
            CREAT_DTTM,
            UDT_ID,
            UDT_PGM,
            UDT_DTTM,
            ORGN_TAX_BILG_NO
		)
		VALUES 
		(
			#{bilgCertNo},
			#{coCd},
			TO_CHAR(SYSDATE, 'YYYYMMDD'),
			#{selpchCd},
			#{clntCd},
			#{clntNm},
			#{taxDt, jdbcType=VARCHAR},
			#{taxBilgNo, jdbcType=VARCHAR},
			#{taxDms57240, jdbcType=VARCHAR},
			#{taxMoa523, jdbcType=VARCHAR},
			#{taxMoa5124, jdbcType=VARCHAR},
			#{taxMoa5388, jdbcType=VARCHAR},
			#{rffCno, jdbcType=VARCHAR},
			#{rffVa, jdbcType=VARCHAR},
			#{taxDivCd, jdbcType=VARCHAR},
			#{rffGn1, jdbcType=VARCHAR},
			#{rffGn2, jdbcType=VARCHAR},
			#{rffAea, jdbcType=VARCHAR},
			#{bgm1225, jdbcType=VARCHAR},
			#{bgm4343, jdbcType=VARCHAR},
			#{xmlFlow, jdbcType=VARCHAR},
			#{taxCreatId, jdbcType=VARCHAR},
			#{taxCreatNm, jdbcType=VARCHAR},
			#{taxivcCoprt, jdbcType=VARCHAR},
			#{taxivcCoprtNo, jdbcType=VARCHAR},
			#{taxivcCoprtCeo, jdbcType=VARCHAR},
			#{taxivcCoprtNm, jdbcType=VARCHAR},
			#{taxCoprtBizcon, jdbcType=VARCHAR},
			#{taxvicCoprtBsty, jdbcType=VARCHAR},
			#{ctaiiMd2, jdbcType=VARCHAR},
			#{comiiAl, jdbcType=VARCHAR},
			#{comiiEm, jdbcType=VARCHAR},
			#{comiiTe, jdbcType=VARCHAR},
			#{comiiFx, jdbcType=VARCHAR},
			#{ctaivBj1, jdbcType=VARCHAR},
			#{taxivcRcvCrn, jdbcType=VARCHAR},
			#{taxivcRcvCeo, jdbcType=VARCHAR},
			#{taxivcRcvAddr, jdbcType=VARCHAR},
			#{taxivcRcvBizcon, jdbcType=VARCHAR},
			#{taxivcRcvBsty, jdbcType=VARCHAR},
			#{taxRcvSn, jdbcType=VARCHAR},
			#{taxRcvNm, jdbcType=VARCHAR},
			#{taxRcvEmail, jdbcType=VARCHAR},
			#{taxRcvEmail2, jdbcType=VARCHAR},
			#{taxRcvFax, jdbcType=VARCHAR},
			#{taxRcvTel, jdbcType=VARCHAR},
			#{taxMoblphon, jdbcType=VARCHAR},
			#{ftxac11, jdbcType=VARCHAR},
			#{ftxac21, jdbcType=VARCHAR},
			#{ftxac31, jdbcType=VARCHAR},
			#{taxMoa522, jdbcType=VARCHAR},
			#{taxMoa5212, jdbcType=VARCHAR},
			#{taxMoa5308, jdbcType=VARCHAR},
			#{taxMoa59, jdbcType=VARCHAR},
			#{trstQty},
			#{trstWt},
			#{trstUpr},
			#{trstAmt},
			#{realTrstQty},
			#{realTrstWt},
			#{realTrstUpr},
			#{realTrstAmt},
			#{bilgQty},
			#{bilgWt},
			#{bilgUpr},
			#{bilgAmt},
			#{transAmt, jdbcType=VARCHAR},
			#{trstDcAmt, jdbcType=VARCHAR},
			#{etcAmt, jdbcType=VARCHAR},
			#{sndYn, jdbcType=VARCHAR},
			#{sndDttm, jdbcType=VARCHAR},
			#{sndProcId, jdbcType=VARCHAR},
			#{cseqRcvYn, jdbcType=VARCHAR},
			#{cseqRcvDttm, jdbcType=VARCHAR},
			#{taxAdmsYn, jdbcType=VARCHAR},
			#{taxAdmsDttm, jdbcType=VARCHAR},
			#{rcvYn, jdbcType=VARCHAR},
			#{rcvDttm, jdbcType=VARCHAR},
			#{rcvProcId, jdbcType=VARCHAR},
			#{accSlipNo, jdbcType=VARCHAR},
			#{accSlipYn, jdbcType=VARCHAR},
			#{accSlipDttm, jdbcType=VARCHAR},
			#{accProcId, jdbcType=VARCHAR},
			#{etcField1, jdbcType=VARCHAR},
			#{etcField2, jdbcType=VARCHAR},
			#{etcField3, jdbcType=VARCHAR},
			#{userId},
			#{pgmId},
			SYSDATE,
			#{userId},
			#{pgmId},
			SYSDATE,
			#{orgnTaxBilgNo}
		)
	</insert>
	
	<insert id="insertBilgDetail" parameterType="Map">
		INSERT INTO TB_AR04D01 
		(
			BILG_CERT_NO,
	        BILG_CERT_NO_SEQ,
	        MOA9_5004,
	        ARD_5006,
	        ARD___113A,
	        MEA10_6154,
	        DMS_1056,
	        MEA10_6314,
	        MOA10_146,
	        MOA10_23,
	        MOA10_124,
	        DMS_1000,
	        CREAT_ID,
	        CREAT_PGM,
	        CREAT_DTTM,
	        UDT_ID,
	        UDT_PGM,
	        UDT_DTTM
		)
		VALUES 
		(
			#{bilgCertNo},
			(SELECT NVL(MAX(BILG_CERT_NO_SEQ), 0) + 1 FROM TB_AR04D01 WHERE BILG_CERT_NO = #{bilgCertNo}),
			#{moa95004},
			#{ard5006},
			#{ard113a},
			#{mea106154},
			#{dms1056},
			#{mea106314},
			#{moa10146, jdbcType=VARCHAR},
			#{moa1023},
			#{moa10124},
			#{dms1000, jdbcType=VARCHAR},
			#{userId},
			#{pgmId},
			SYSDATE,
			#{userId},
			#{pgmId},
			SYSDATE
		)
	</insert>
	
	<select id="getBilgCertNo" resultType="int">
		SELECT TB_AR04M01_SQ01.NEXTVAL FROM DUAL
	</select>
	
	<select id="selectTaxBilgCount" resultType="int">
		SELECT COUNT(*)
		FROM TB_AR04M01 A
		 <where>
			<if test="coCd != null and !coCd.equals('')">
			   AND A.CO_CD = #{coCd}
			</if>
			<if test="startDt != null and !startDt.equals('') and endDt != null and !endDt.equals('')">
			   AND A.SELL_DT BETWEEN REPLACE(#{startDt}, '-', '') AND REPLACE(#{endDt}, '-', '')
			</if>
		 	<if test="clntNm != null and !clntNm.equals('')">
				AND CLNT_NM LIKE '%${clntNm}%'
			</if>
			<if test="selpchCd != null and !selpchCd.equals('')">
			   AND A.SELPCH_CD = #{selpchCd}
			</if>
			<if test="taxBilgNo != null and !taxBilgNo.equals('')">
			   AND A.TAX_BILG_NO = #{taxBilgNo}
			</if>
			<if test="taxAdmsYn != null and !taxAdmsYn.equals('')">
			   AND A.TAX_ADMS_YN = #{taxAdmsYn}
			</if>
			<if test="xmlFlow != null and !xmlFlow.equals('')">
			   AND A.XML_FLOW = #{xmlFlow}
			</if>
			<if test="accSlipYn != null and !accSlipYn.equals('')">
			   AND A.ACC_SLIP_YN = #{accSlipYn}
			</if>
			<if test="sndYn != null and !sndYn.equals('')">
			   AND NVL(A.SND_YN, 'N') = #{sndYn}
			</if>
			<if test="rcvYn != null and !rcvYn.equals('')">
			   AND NVL(A.RCV_YN, 'N') = #{rcvYn}
			</if>
			<if test="taxCreatNm != null and !taxCreatNm.equals('')">
			   AND A.TAX_CREAT_NM LIKE '%' || #{taxCreatNm} || '%'
			</if>
		   </where>
	</select>
	
	<select id="selectTaxBilgList" resultType="CamelMap">
		SELECT
			*
		FROM
		(
			SELECT
				ROWNUM AS RNUM, A.*
			FROM
			(
				SELECT A.BILG_CERT_NO,
						A.CO_CD,
						TO_CHAR(TO_DATE(A.SELL_DT, 'YYYYMMDD'), 'YYYY-MM-DD') SELL_DT,
						FN_CM05M01_CD_TO_NM(A.SELPCH_CD) SELPCH_CD,
						A.CLNT_CD,
						A.CLNT_NM,
						TO_CHAR(TO_DATE(A.TAX_DT, 'YYYYMMDD'), 'YYYY-MM-DD') TAX_DT,
						A.TAX_BILG_NO,
						A.TAX_DMS5_7240,
						A.TAX_MOA5_23,
						A.TAX_MOA5_124,
						A.TAX_MOA5_388,
						FN_CM05M01_CD_TO_NM(A.RFF_CNO) RFF_CNO,
						FN_CM05M01_CD_TO_NM(A.RFF_VA) RFF_VA,
						A.TAX_DIV_CD,
						FN_CM05M01_CD_TO_NM(A.TAX_DIV_CD) TAX_DIV_NM,
						FN_CM05M01_CD_TO_NM(A.RFF_GN1) RFF_GN1,
						FN_CM05M01_CD_TO_NM(A.RFF_GN2) RFF_GN2,
						FN_CM05M01_CD_TO_NM(A.RFF_AEA) RFF_AEA,
						FN_CM05M01_CD_TO_NM(A.BGM_1225) BGM_1225,
						(SELECT CODE_ETC FROM TB_CM05M01 WHERE CODE_ID = A.RFF_GN1) RFF_GN1_CD,
						(SELECT CODE_ETC FROM TB_CM05M01 WHERE CODE_ID = A.RFF_GN2) RFF_GN2_CD,
						(SELECT CODE_ETC FROM TB_CM05M01 WHERE CODE_ID = A.RFF_AEA) RFF_AEA_CD,
						A.BGM_1225 BGM_1225_CD,
						A.BGM_4343,
						FN_CM05M01_CD_TO_NM(A.XML_FLOW) XML_FLOW,
						A.TAX_CREAT_ID,
						A.TAX_CREAT_NM,
						A.TAXIVC_COPRT,
						A.TAXIVC_COPRT_NO,
						A.TAXIVC_COPRT_CEO,
						A.TAXIVC_COPRT_NM,
						A.TAX_COPRT_BIZCON,
						A.TAXVIC_COPRT_BSTY,
						A.CTAII_MD_2,
						A.COMII_AL,
						A.COMII_EM,
						A.COMII_TE,
						A.COMII_FX,
						A.CTAIV_BJ_1,
						A.TAXIVC_RCV_CRN,
						A.TAXIVC_RCV_CEO,
						A.TAXIVC_RCV_ADDR,
						A.TAXIVC_RCV_BIZCON,
						A.TAXIVC_RCV_BSTY,
						A.TAX_RCV_SN,
						A.TAX_RCV_NM,
						A.TAX_RCV_EMAIL,
						A.TAX_RCV_EMAIL2,
						A.TAX_RCV_FAX,
						A.TAX_RCV_TEL,
						A.TAX_MOBLPHON,
						A.FTXAC1_1,
						A.FTXAC2_1,
						A.FTXAC3_1,
						A.TAX_MOA5_22,
						A.TAX_MOA5_212,
						A.TAX_MOA5_308,
						A.TAX_MOA5_9,
						A.TRST_QTY,
						A.TRST_WT,
						A.TRST_UPR,
						A.TRST_AMT,
						A.REAL_TRST_QTY,
						A.REAL_TRST_WT,
						A.REAL_TRST_UPR,
						A.REAL_TRST_AMT,
						A.BILG_QTY,
						A.BILG_WT,
						A.BILG_UPR,
						A.BILG_AMT,
						A.TRANS_AMT,
						A.TRST_DC_AMT,
						A.ETC_AMT,
						A.SND_YN,
						TO_CHAR(A.SND_DTTM, 'YYYY-MM-DD HH24:MI:SS') SND_DTTM,
						A.SND_PROC_ID,
						A.CSEQ_RCV_YN,
						TO_CHAR(A.CSEQ_RCV_DTTM, 'YYYY-MM-DD HH24:MI:SS') CSEQ_RCV_DTTM,
						A.TAX_ADMS_YN,
						TO_CHAR(A.TAX_ADMS_DTTM, 'YYYY-MM-DD HH24:MI:SS') TAX_ADMS_DTTM,
						A.RCV_YN,
						A.RCV_DTTM,
						A.RCV_PROC_ID,
						A.ACC_SLIP_NO,
						A.ACC_SLIP_YN,
						TO_CHAR(A.ACC_SLIP_DTTM, 'YYYY-MM-DD HH24:MI:SS') ACC_SLIP_DTTM,
						A.ACC_PROC_ID,
						A.ETC_FIELD1,
						A.ETC_FIELD2,
						A.ETC_FIELD3,
						A.ORGN_TAX_BILG_NO
					  FROM TB_AR04M01 A
					  <where>
						<if test="coCd != null and !coCd.equals('')">
						   AND A.CO_CD = #{coCd}
						</if>
						<if test="startDt != null and !startDt.equals('') and endDt != null and !endDt.equals('')">
			   				AND A.SELL_DT BETWEEN REPLACE(#{startDt}, '-', '') AND REPLACE(#{endDt}, '-', '')
						</if>
						<if test="clntCd != null and !clntCd.equals('')">
						   AND A.CLNT_CD = #{clntCd}
						</if>
					 	<if test="clntNm != null and !clntNm.equals('')">
							AND CLNT_NM LIKE '%${clntNm}%'
						</if>
						<if test="selpchCd != null and !selpchCd.equals('')">
						   AND A.SELPCH_CD = #{selpchCd}
						</if>
						<if test="taxBilgNo != null and !taxBilgNo.equals('')">
						   AND A.TAX_BILG_NO = #{taxBilgNo}
						</if>
						<if test="taxAdmsYn != null and !taxAdmsYn.equals('')">
						   AND A.TAX_ADMS_YN = #{taxAdmsYn}
						</if>
						<if test="xmlFlow != null and !xmlFlow.equals('')">
						   AND A.XML_FLOW = #{xmlFlow}
						</if>
						<if test="accSlipYn != null and !accSlipYn.equals('')">
						   AND A.ACC_SLIP_YN = #{accSlipYn}
						</if>
						<if test="sndYn != null and !sndYn.equals('')">
						   AND NVL(A.SND_YN, 'N') = #{sndYn}
						</if>
						<if test="rcvYn != null and !rcvYn.equals('')">
						   AND NVL(A.RCV_YN, 'N') = #{rcvYn}
						</if>
						<if test="taxCreatNm != null and !taxCreatNm.equals('')">
						   AND A.TAX_CREAT_NM LIKE '%' || #{taxCreatNm} || '%'
						</if>
					   </where>
				 ORDER BY SELL_DT DESC, ORGN_TAX_BILG_NO, TAX_BILG_NO,  BILG_CERT_NO DESC
			) A
		)
		WHERE
				RNUM BETWEEN #{firstIndex} AND #{lastIndex}
	</select>

	<select id="selectTaxBilg" resultType="CamelMap">
	SELECT A.BILG_CERT_NO,
		A.CO_CD,
		TO_CHAR(TO_DATE(A.SELL_DT, 'YYYYMMDD'), 'YYYY-MM-DD') SELL_DT,
		A.SELPCH_CD,
		FN_CM05M01_CD_TO_NM(A.SELPCH_CD) SELPCH_CD,
		A.CLNT_CD,
		A.CLNT_NM,
		TO_CHAR(TO_DATE(A.TAX_DT, 'YYYYMMDD'), 'YYYY-MM-DD') TAX_DT,
		A.TAX_BILG_NO,
		A.ORGN_TAX_BILG_NO,
		A.TAX_DMS5_7240,
		A.TAX_MOA5_23,
		A.TAX_MOA5_124,
		A.TAX_MOA5_388,
		A.RFF_CNO,
		A.RFF_VA,
		A.TAX_DIV_CD,
		A.RFF_GN1,
		A.RFF_GN2,
		A.RFF_AEA,
		A.BGM_1225,
		A.BGM_4343,
		A.XML_FLOW,
		A.TAX_CREAT_ID,
		A.TAX_CREAT_NM,
		A.TAXIVC_COPRT,
		A.TAXIVC_COPRT_NO,
		A.TAXIVC_COPRT_CEO,
		A.TAXIVC_COPRT_NM,
		A.TAX_COPRT_BIZCON,
		A.TAXVIC_COPRT_BSTY,
		A.CTAII_MD_2,
		A.COMII_AL,
		A.COMII_EM,
		A.COMII_TE,
		A.COMII_FX,
		A.CTAIV_BJ_1,
		A.TAXIVC_RCV_CRN,
		A.TAXIVC_RCV_CEO,
		A.TAXIVC_RCV_ADDR,
		A.TAXIVC_RCV_BIZCON,
		A.TAXIVC_RCV_BSTY,
		A.TAX_RCV_SN,
		A.TAX_RCV_NM,
		A.TAX_RCV_EMAIL,
		A.TAX_RCV_EMAIL2,
		A.TAX_RCV_FAX,
		A.TAX_RCV_TEL,
		A.TAX_MOBLPHON,
		A.FTXAC1_1,
		A.FTXAC2_1,
		A.FTXAC3_1,
		A.TAX_MOA5_22,
		A.TAX_MOA5_212,
		A.TAX_MOA5_308,
		A.TAX_MOA5_9,
		A.TRST_QTY,
		A.TRST_WT,
		A.TRST_UPR,
		A.TRST_AMT,
		A.REAL_TRST_QTY,
		A.REAL_TRST_WT,
		A.REAL_TRST_UPR,
		A.REAL_TRST_AMT,
		A.BILG_QTY,
		A.BILG_WT,
		A.BILG_UPR,
		A.BILG_AMT,
		A.TRANS_AMT,
		A.TRST_DC_AMT,
		A.ETC_AMT,
		A.SND_YN,
		A.SND_DTTM,
		A.SND_PROC_ID,
		A.CSEQ_RCV_YN,
		TO_CHAR(A.CSEQ_RCV_DTTM, 'YYYY-MM-DD HH24:MI:SS') CSEQ_RCV_DTTM,
		A.TAX_ADMS_YN,
		TO_CHAR(A.TAX_ADMS_DTTM, 'YYYY-MM-DD HH24:MI:SS') TAX_ADMS_DTTM,
		A.RCV_YN,
		A.RCV_DTTM,
		A.RCV_PROC_ID,
		A.ACC_SLIP_NO,
		A.ACC_SLIP_YN,
		TO_CHAR(A.ACC_SLIP_DTTM, 'YYYY-MM-DD HH24:MI:SS') ACC_SLIP_DTTM,
		A.ACC_PROC_ID,
		A.ETC_FIELD1,
		A.ETC_FIELD2,
		A.ETC_FIELD3,
		A.ERR_CD,
		A.ERR_CNTS,
		A.ORGN_TAX_BILG_NO
	  FROM TB_AR04M01 A
	 WHERE BILG_CERT_NO = #{bilgCertNo}
	</select>
	
	<select id="selectTaxBilgDetailCount" resultType="int">
	SELECT COUNT(*)
	 FROM TB_AR02M01 A
	WHERE BILG_CERT_NO = #{bilgCertNo}
	  AND CO_CD = #{coCd}
	</select>
	
	<select id="selectTaxBilgDetailList" resultType="CamelMap">
	SELECT
			*
		FROM
		(
			SELECT
				ROWNUM AS RNUM, A.*
			FROM
			(
			SELECT CO_CD
				 , TRST_CERTI_NO
				 , SELPCH_CD
				 , FN_CM05M01_CD_TO_NM(SELPCH_CD) SELPCH_NM
				 , TAXIVC_COPRT
				 , SUBSTRING(TRST_DT,0,4) || '-' || SUBSTRING(TRST_DT,5,2) || '-' || SUBSTRING(TRST_DT,7,2) TRST_DT
				 , TRST_CLNT_CD
		 		 , (SELECT CLNT_NM FROM TB_BM02M01 WHERE CLNT_CD = TRST_CLNT_CD) CLNT_NM
				 , TRST_PRDT_CD
				 , (SELECT PRDT_NM FROM TB_BM01M01 WHERE PRDT_CD = TRST_PRDT_CD) AS PRDT_NM
				 , OWNER_CD
				 , IMP_YN
				 , TYP_CD
				 , TRSP_TYP_CD
				 , TRST_RPRC_SEQ
				 , TRST_DTL_SEQ
				 , PRDT_LEN
				 , ODR_NO
				 , SALES_MNG
				 , PRJCT_CD
				 , MAKR_CD
				 , FN_CM05M01_CD_TO_NM(MAKR_CD) MAKR_NM
				 , WH_CD
				 , FN_CM05M01_CD_TO_NM(WH_CD) WH_NM
				 , MNG_TEL
				 , TO_CHAR(DLVR_DTTM, 'YYYY-MM-DD') DLVR_DTTM
				 , DIRTRS_YN
				 , PRDT_DIV
				 , PRDT_STKN
				 , FN_CM05M01_CD_TO_NM(PRDT_STKN) PRDT_STKN_NM
				 , PRDT_SIZE
				 , FN_CM05M01_CD_TO_NM(PRDT_SIZE) PRDT_SIZE_NM
				 , PRDT_UNIT
				 , FN_CM05M01_CD_TO_NM(PRDT_UNIT) PRDT_UNIT_NM
				 , PRDT_UPR
				 , STOCK_UPR
				 , PCHS_UPR
				 , SELL_UPR
				 , TRST_QTY
				 , TRST_WT
				 , TRST_UPR
				 , TRST_AMT
				 , REAL_TRST_QTY
				 , REAL_TRST_WT
				 , REAL_TRST_UPR
				 , REAL_TRST_AMT
				 , BILG_QTY
				 , BILG_WT
				 , BILG_UPR
				 , BILG_AMT
				 , TRST_DC_AMT
				 , ETC_AMT
				 , TRSP_RMK
				 , TRANS_AMT
				 , SHIP_VEH_NO
				 , CLNT_NM
				 , BILG_CERT_NO
				 , LOSS_RATE
				 , ODR_CREAT_DIV
				 , SALES_AREA_CD
				 , SITE_CD
				 , BILG_VAT_AMT
				 , PRDT_SPEC
			 FROM TB_AR02M01 A
			WHERE BILG_CERT_NO = #{bilgCertNo}
			  AND CO_CD = #{coCd}
		ORDER BY CO_CD, TRST_CERTI_NO
			) A
		)
	WHERE
		RNUM BETWEEN #{firstIndex} AND #{lastIndex}
	</select>
	
	<update id="updateTaxBilg">
	UPDATE TB_AR04M01
	SET SELL_DT = REPLACE(#{sellDt}, '-', '')
	  , SELPCH_CD = #{selpchCd}
	  , CLNT_CD = #{clntCd}
	  , CLNT_NM = #{clntNm}
	  , TAX_BILG_NO = #{taxBilgNo}
	  , RFF_CNO = #{rffCno}
	  , RFF_AEA = #{rffAea}
	  , RFF_GN1 = CASE WHEN #{rffAea} IS NULL THEN 'RFFGN101'
	  				   ELSE 'RFFGN102' END
	  , TAX_MOA5_23 = #{taxMoa523}
	  , TAX_MOA5_124 = #{taxMoa5124}
	  , TAX_MOA5_388 = #{taxMoa5388}
	  , TAXIVC_COPRT = #{taxivcCoprt}
	  , TAXIVC_COPRT_NO = #{taxivcCoprtNo}
	  , TAXIVC_COPRT_CEO = #{taxivcCoprtCeo}
	  , TAXIVC_COPRT_NM = #{taxivcCoprtNm}
	  , TAX_COPRT_BIZCON = #{taxCoprtBizcon}
	  , TAXVIC_COPRT_BSTY = #{taxvicCoprtBsty}
	  , CTAIV_BJ_1 = #{ctaivBj1}
	  , TAXIVC_RCV_CRN = #{taxivcRcvCrn}
	  , TAXIVC_RCV_CEO = #{taxivcRcvCeo}
	  , TAXIVC_RCV_ADDR = #{taxivcRcvAddr}
	  , TAXIVC_RCV_BIZCON = #{taxivcRcvBizcon}
	  , TAXIVC_RCV_BSTY = #{taxivcRcvBsty}
	  , TAX_RCV_SN = #{taxRcvSn}
	  , TAX_RCV_NM = #{taxRcvNm}
	  , TAX_RCV_EMAIL = #{taxRcvEmail}
	  , TAX_RCV_EMAIL2 = #{taxRcvEmail2}
	  , TAX_RCV_FAX = #{taxRcvFax}
	  , TAX_RCV_TEL = #{taxRcvTel}
	  , TAX_MOBLPHON = #{taxMoblphon}
	  , FTXAC1_1 = #{ftxac11}
	  , FTXAC2_1 = #{ftxac21}
	  , FTXAC3_1 = #{ftxac31}
	  , UDT_ID = #{userId}
	  , UDT_PGM = #{pgmId}
	  , UDT_DTTM = SYSDATE
	WHERE BILG_CERT_NO = #{bilgCertNo}
	</update>
	
	<select id="selectTaxRcvCount" resultType="int">
	SELECT COUNT(*)
	  FROM TB_AR06M01
	 WHERE CO_CD = #{coCd}
	   AND CLNT_CD = #{clntCd} 
	<if test="taxRcvNm != null and !taxRcvNm.equals('')">
	   AND TAX_RCV_NM = #{taxRcvNm}
	</if>
	</select>
	
	<select id="selectTaxRcvList" resultType="CamelMap">
	SELECT
			*
		FROM
		(
			SELECT
				ROWNUM AS RNUM, A.*
			FROM
			(
			SELECT CO_CD,
					CLNT_CD,
					TAX_RCV_SN,
					TAX_RCV_NM,
					TAX_RCV_EMAIL,
					TAX_RCV_EMAIL2,
					TAX_RCV_FAX,
					TAX_RCV_TEL,
					TAX_MOBLPHON,
					TAX_RCV_DEPT
			  FROM TB_AR06M01
			 WHERE CO_CD = #{coCd}
			   AND CLNT_CD = #{clntCd} 
			<if test="taxRcvNm != null and !taxRcvNm.equals('')">
			   AND TAX_RCV_NM = #{taxRcvNm}
			</if>
			) A
		)
		WHERE
		RNUM BETWEEN #{firstIndex} AND #{lastIndex}
	</select>
	
	<select id="selectMsgId" resultType="String">
	SELECT TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS') || '000001' || LPAD(#{msgId}, 4, '0') FROM DUAL
	</select>
		
	<select id="selectBgmSeq" resultType="String">
	SELECT 'KM' || TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS') || LPAD(COUNT(*) + 1, 4, '0')
	  FROM KLUSER01.TAX_HD
	 WHERE SUBSTRING(BGM_1004, 3, 14) = TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
	</select>
	
	<insert id="insertMapoutKey">
	INSERT INTO KLUSER01.MAPOUT_KEY
	(
		XML_MSG_ID,
		LOGIN_ID,
		ORIGINATOR,
		RECIPIENT,
		DOC_NAME,
		DOC_CODE,
		DOC_VER,
		DOC_SYNTAX,
		TIMESTAMP
	)
	VALUES
	(
		#{xmlMsgId},
		(SELECT CODE_RPRC FROM TB_CM05M01 WHERE CODE_ID = #{coCd}),
		'KL' || (SELECT CODE_RPRC FROM TB_CM05M01 WHERE CODE_ID = #{coCd}),
		'KLLOGISBIL',
		#{docName},
		#{docCode},
		'D00A',
		'KECA',
		SYSDATE	
	)
	</insert>
	
	<insert id="insertTaxHd">
	INSERT INTO KLUSER01.TAX_HD
	(XML_MSG_ID
	 ,XMLDOC_SEQ
	 ,XML_FLOW
	 ,ATTACH
	 ,BGM_1001
	 ,BGM_1004
	 ,BGM_1225
	 ,BGM_4343
	 ,BGM_1060
	 ,RFF_CNO
	 ,RFF_VA
	 ,RFF_SZ
	 ,RFF_GN
	 ,RFF_AEA
	 ,RFF_ACD
	 ,RFF_AMT_1
	 ,RFF_AMT_2
	 ,RFF_APG
	 ,DTM_2380
	 ,FTXAAI_1
	 ,FTXAAI_2
	 ,FTXAC1_1
	 ,FTXAC2_1
	 ,FTXAC3_1
	 ,NADII_3039
	 ,NADII3124
	 ,NADII3036A
	 ,NADII3036B
	 ,NADII3036C
	 ,NADII3036D
	 ,RFF_II_XA
	 ,RFFIIXA_40
	 ,CTAII_MD_2
	 ,CTAII_AK_2
	 ,CTAII_BJ_2
	 ,CTAII_MS_1
	 ,CTAII_MS_2
	 ,COMII_EM
	 ,COMII_TE
	 ,COMII_AL
	 ,COMII_FX
	 ,NADIV3039
	 ,NADIV3124
	 ,NADIV3036A
	 ,NADIV3036B
	 ,NADIV3036C
	 ,NADIV3036D
	 ,NADIV3164
	 ,RFF_IV_XA
	 ,RFFIVXA_40
	 ,CTAIV_MD_2
	 ,CTAIV_AK_2
	 ,CTAIV_BJ_1
	 ,CTAIV_BJ_2
	 ,COMIV_EM
	 ,COMIV_TE
	 ,COMIV_AL
	 ,COMIV_FX
	 ,CTAIVBF_2
	 ,CTAIVAL_2
	 ,COMIV2_EM
	 ,COMIV2_TE
	 ,COMIV2_AL
	 ,NADP13124
	 ,NADP13036A
	 ,NADP13036B
	 ,NADP13036C
	 ,NADP13036D
	 ,RFF_P1_XA
	 ,RFFP1XA_40
	 ,CTAP1_MD_2
	 ,CTAP1_AK_2
	 ,CTAP1_BJ_2
	 ,COMP1_EM
	 ,COMP1_TE
	 ,RFF_P2_XA
	 ,COMP2_EM
	 ,COMTE_315E
	 ,DMS5_7240
	 ,MOA5_23
	 ,MOA5_124
	 ,MOA5_388
	 ,MOA5_22
	 ,MOA5_212
	 ,MOA5_308
	 ,MOA5_9
	 ,TIMESTAMP)
	SELECT #{xmlMsgId}
		 , '1' <!-- XMLDOC_SEQ 무조건 1 -->
		 , 'S'
		 , 0
		 , '938'
 		 , #{bgm1004}
		 , (SELECT CODE_ETC FROM TB_CM05M01 WHERE CODE_ID = A.BGM_1225)
		 , A.BGM_4343 
		 , 'COINTX' 
		 , (SELECT CODE_ETC FROM TB_CM05M01 WHERE CODE_ID = A.RFF_CNO)
		 , (SELECT CODE_ETC FROM TB_CM05M01 WHERE CODE_ID = A.RFF_VA)
		 , NULL
		 , (SELECT CODE_ETC FROM TB_CM05M01 WHERE CODE_ID = A.RFF_GN1) || (SELECT CODE_ETC FROM TB_CM05M01 WHERE CODE_ID = A.RFF_GN2)
		 , (SELECT CODE_ETC FROM TB_CM05M01 WHERE CODE_ID = A.RFF_AEA)
		 , 'SO'
		 , 'A' 
		 , NULL 
		 , 'S' 
		 , TO_CHAR(SYSDATE, 'YYYYMMDD')
		 , 'ST3'
		 , NULL
		 , A.FTXAC1_1 
		 , A.FTXAC2_1 
		 , A.FTXAC3_1 
		 , NULL 
		 , (SELECT BIZ_ADDR FROM TB_BM02M01 WHERE CLNT_CD = A.TAXIVC_COPRT) 
		 , A.TAXIVC_COPRT_NM 
		 , A.TAX_COPRT_BIZCON 
		 , A.TAXVIC_COPRT_BSTY 
		 , A.TAXIVC_COPRT_CEO 
		 , REPLACE(A.TAXIVC_COPRT_NO, '-', '')  
		 , NULL
		 , (SELECT DEPT_NM FROM TB_CM04M01 WHERE DEPT_ID = #{deptId})
		 , #{userNm}
		 , NULL 
		 , NULL 
		 , NULL
		 , (SELECT EMAIL FROM TB_CM06M01 WHERE ID = #{userId})
		 , (SELECT TEL_NO FROM TB_CM06M01 WHERE ID = #{userId})
		 , NULL
		 , NULL
		 , NULL 
		 , A.TAXIVC_RCV_ADDR 
		 , A.CLNT_NM 
		 , A.TAXIVC_RCV_BIZCON 
		 , A.TAXIVC_RCV_BSTY 
		 , A.TAXIVC_RCV_CEO 
		 , NULL 
		 , REPLACE(A.TAXIVC_RCV_CRN, '-', '')       <!--  RFF_II_XA   -->
		 , NULL
		 , NULL
		 , A.TAX_RCV_NM
		 , A.CTAIV_BJ_1
		 , NULL
		 , A.TAX_RCV_EMAIL
		 , A.TAX_RCV_TEL
		 , A.TAX_MOBLPHON
		 , A.TAX_RCV_FAX
		 , NULL
		 , NULL
		 , NULL
		 , NULL
		 , NULL
		 , NULL
		 , NULL
		 , NULL
		 , NULL
		 , NULL --NADP13036D
		 , NULL
		 , NULL
		 , NULL
		 , NULL
		 , NULL
		 , NULL
		 , NULL
		 , NULL
		 , NULL
		 , NULL
		 , A.TAX_DMS5_7240
		 , NVL(A.TAX_MOA5_23, 0) 
		 , NVL(A.TAX_MOA5_124 , 0)
		 , NVL(A.TAX_MOA5_388 , 0)
		 , A.TAX_MOA5_22 
		 , A.TAX_MOA5_212 
		 , A.TAX_MOA5_308 
		 , A.TAX_MOA5_9 
		 , SYSDATE
	  FROM TB_AR04M01 A
	  WHERE BILG_CERT_NO = #{bilgCertNo}
	</insert>
	
	<insert id="insertTaxDtl">
	INSERT INTO KLUSER01.TAX_DTL
	(
		XML_MSG_ID,
		XMLDOC_SEQ,
		LIN_7140,
		TIMESTAMP
	)
	VALUES
	(
		#{xmlMsgId},
		'1',
		'.',
		SYSDATE
	)
	</insert>
	
	<update id="updateTaxBilgNo">
	UPDATE TB_AR04M01
	   SET TAX_BILG_NO = #{bgm1004}
	     , TAX_DT = TO_CHAR(SYSDATE, 'YYYYMMDD')
	     , SND_YN = 'Y'
	     , SND_DTTM = SYSDATE
	     , ORGN_TAX_BILG_NO = #{orgnTaxBilgNo}
	     , SND_PROC_ID = #{userId}
	     , UDT_ID = #{userId}
	     , UDT_PGM = #{pgmId}
	     , UDT_DTTM = SYSDATE
	 WHERE BILG_CERT_NO = #{bilgCertNo}
	</update>
		
	<insert id="insertTaxItem">
	INSERT INTO KLUSER01.TAX_ITEM
		(XML_MSG_ID
		 , XMLDOC_SEQ
		 , ITEM_SEQ
		 , MOA9_5004
		 , ARD_5007
		 , ARD_5006
		 , ARD___113A
		 , ARD___113B
		 , ARD___5104
		 , DMS_1056
		 , DMS_1000
		 , MOA10_23
		 , MOA10_124
		 , MOA10_146
		 , MEA10_6154
		 , MEA10_6314
		 , MOA10_5004
		 , MOA10_6345
		 , TIMESTAMP)
	SELECT #{xmlMsgId}
		 , '1' <!-- XMLDOC_SEQ 무조건 1 -->
		 , ROWNUM
		 , MOA9_5004
		 , NULL
		 , ARD_5006
		 , ARD___113A <!-- ARD__113A 중국일떄만 사용 -->
		 , NULL <!-- ARD__113B 중국일떄만 사용 -->
		 , NULL <!-- ARD__5104 중국일떄만 사용 -->
		 , DMS_1056
		 , SUBSTRB(DMS_1000,1,35)
		 , NVL(MOA10_23, 0)
		 , NVL(MOA10_124, 0)
		 , NVL(MOA10_146, 0)
		 , MEA10_6154
		 , NVL(MEA10_6314, 0)
		 , NULL <!-- MOA10_5004 외화금액 -->
		 , NULL <!-- MOA10_6345 외화통화코드 -->
		 , SYSDATE
		 FROM TB_AR04D01 A
		WHERE BILG_CERT_NO = #{bilgCertNo}
	ORDER BY BILG_CERT_NO
	</insert>
	
	<delete id="deleteBilgInfo">
		DELETE FROM TB_AR04M01
		WHERE BILG_CERT_NO = #{bilgCertNo}
	</delete>

	<insert id="insertInvHd">
	INSERT INTO KLUSER01.INV_HD
	(
		XML_MSG_ID,
		XMLDOC_SEQ,
		XML_FLOW,
		BGM_1004,
		BGM_1060,
		BGM_1225,
		BGM_4343,
		NADII3124,
		NADII3036A,
		NADII3036B,
		NADII3036C,
		NADII3036D,
		CTAII_MS_1,
		CTAII_MS_2,
		CTAII_AK_1,
		CTAII_AK_2,
		CTAII_MD_2,
		COMII_EM,
		COMII_TE,
		COMII_AL,
		COMII_FX,
		RFF_II_XA,
		RFF_VA,
		RFF_ACD,
		RFF_AMT_1,
		RFF_AMT_2,
		RFF_CNO,
		RFF_ACE_1,
		RFF_ACE_2,
		RFF_APG,
		FTXAAI_1,
		FTXAAI_2,
		FTXAAI_3,
		FTXAAI_4,
		FTXAAI_5,
		FTXAC1_1,
		FTXAC1_2,
		FTXAC1_3,
		FTXAC1_4,
		FTXAC1_5,
		FTXAC2_1,
		FTXAC2_2,
		FTXAC2_3,
		FTXAC2_4,
		FTXAC2_5,
		FTXABE_1,
		FTXABE_2,
		DTM_2380,
		DMS5_1056,
		DMS5_1060,
		DMS5_7240,
		MOA5_23,
		MOA5_124,
		MOA5_22,
		MOA5_212,
		MOA5_308,
		MOA5_9,
		NADIV3039,
		NADIV3124,
		NADIV3036A,
		NADIV3036B,
		NADIV3036C,
		NADIV3036D,
		NADIV3164,
		CTAIV_AK_1,
		CTAIV_AK_2,
		CTAIV_MD_2,
		COMIV_EM,
		COMIV_TE,
		COMIV_AL,
		COMIV_FX,
		RFF_IV_XA,
		NADCA3124,
		RFF_P1_XA,
		RFF_P2_XA,
		TIMESTAMP
	)
	SELECT 
		#{xmlMsgId},
		'1',
		'S',
		#{bgm1004},
		'COINTX',
		(SELECT CODE_ETC FROM TB_CM05M01 WHERE CODE_ID = A.BGM_1225),
		BGM_4343,
		(SELECT BIZ_ADDR FROM TB_BM02M01 WHERE CLNT_CD = A.TAXIVC_COPRT),
		A.TAXIVC_COPRT_NM, 
		A.TAX_COPRT_BIZCON ,
		A.TAXVIC_COPRT_BSTY, 
		A.TAXIVC_COPRT_CEO, 
		NULL,
		NULL,
		(SELECT DEPT_NM FROM TB_CM04M01 WHERE DEPT_ID = #{deptId}),
		#{userNm},
		(SELECT DEPT_NM FROM TB_CM04M01 WHERE DEPT_ID = #{deptId}),
		(SELECT EMAIL FROM TB_CM06M01 WHERE ID = #{userId}),
		(SELECT TEL_NO FROM TB_CM06M01 WHERE ID = #{userId}),
		NULL, --COMII_AL
		NULL, --COMII_FX
		REPLACE(TAXIVC_COPRT_NO, '-', ''),
		(SELECT CODE_ETC FROM TB_CM05M01 WHERE CODE_ID = A.RFF_VA),
		NULL,
		NULL,
		NULL,
		(SELECT CODE_ETC FROM TB_CM05M01 WHERE CODE_ID = A.RFF_CNO),
		NULL,
		NULL,
		NULL,
		'STD', -- FTXAAI_1
		FTXAC1_1,
		FTXAC2_1,
		FTXAC3_1,
		NULL,
		NULL,
		NULL,
		NULL,
		NULL,
		NULL,
		NULL,
		NULL,
		NULL,
		NULL,
		NULL,
		NULL,
		NULL,
		TO_CHAR(SYSDATE, 'YYYYMMDD'),
		NULL,
		NULL,
		TAX_DMS5_7240,
		TAX_MOA5_23,
		TAX_MOA5_124,
		TAX_MOA5_22,
		TAX_MOA5_212,
		TAX_MOA5_308,
		TAX_MOA5_9,
		NULL,
		TAXIVC_RCV_ADDR,
		A.CLNT_NM, 
		A.TAXIVC_RCV_BIZCON, 
		A.TAXIVC_RCV_BSTY, 
		A.TAXIVC_RCV_CEO, 
		NULL,
		NULL,
		TAX_RCV_NM,
		NULL,
		TAX_RCV_EMAIL,
		TAX_RCV_TEL,
		TAX_MOBLPHON,
		TAX_RCV_FAX,
		REPLACE(TAXIVC_RCV_CRN, '-', ''),
		NULL,
		NULL,
		NULL,
		SYSDATE
		FROM TB_AR04M01 A
		WHERE BILG_CERT_NO = #{bilgCertNo}
	
	</insert>
	
	<insert id="insertInvDtl">
	INSERT INTO KLUSER01.INV_DTL
	(
		XML_MSG_ID,
		XMLDOC_SEQ,
		LIN_1082,
		LIN_7140,
		NAD7_3124A,
		TIMESTAMP
	)
	SELECT #{xmlMsgId},
			'1',
			ROWNUM,
			(SELECT PRDT_NM FROM TB_BM01M01 WHERE PRDT_CD = A.TRST_PRDT_CD),
			A.TRST_DT,
			SYSDATE
	  FROM TB_AR02M01 A
		WHERE BILG_CERT_NO = #{bilgCertNo}
		  AND CO_CD = #{coCd}
	ORDER BY CO_CD, TRST_CERTI_NO
	</insert>
	
	<insert id="insertInvDtlUpdate">
	INSERT INTO KLUSER01.INV_DTL
	(
		XML_MSG_ID,
		XMLDOC_SEQ,
		LIN_1082,
		LIN_7140,
		NAD7_3124A,
		TIMESTAMP
	)
	SELECT #{xmlMsgId},
			'1',
			ROWNUM,
			(SELECT PRDT_NM FROM TB_BM01M01 WHERE PRDT_CD = A.TRST_PRDT_CD),
			A.TRST_DT,
			SYSDATE
	  FROM TB_AR02M01 A
		WHERE BILG_CERT_NO = #{beforeBilgCertNo}
		  AND CO_CD = #{coCd}
	ORDER BY CO_CD, TRST_CERTI_NO
	</insert>
	
	<insert id="insertItem">
	INSERT INTO KLUSER01.INV_ITEM
	(
		XML_MSG_ID,
		XMLDOC_SEQ,
		LIN_1082,
		ITEM_SEQ,
		ARD_5007,
		ARD_5006,
		ARD_5105,
		ARD_5104,
		DMS_1056,
		DMS_1000,
		MOA10_23,
		MOA10_124,
		MOA10_146,
		MEA10_6311,
		MEA10_6411,
		MEA10_6314,
		MOA10_5004,
		MOA10_6345,
		TIMESTAMP
	)
	SELECT #{xmlMsgId},
			'1',
			ROWNUM,
		 	(SELECT NVL(MAX(ITEM_SEQ), 0) + 1 FROM KLUSER01.INV_ITEM WHERE XML_MSG_ID = #{xmlMsgId} AND XMLDOC_SEQ = '1'),
			A.TRST_PRDT_CD,
			(SELECT PRDT_NM FROM TB_BM01M01 WHERE PRDT_CD = A.TRST_PRDT_CD),
			NULL,
			NULL,
			(SELECT PRDT_SPEC FROM TB_BM01M01 WHERE PRDT_CD = A.TRST_PRDT_CD),
			SUBSTRB(TRSP_RMK,1,35),
			NVL(BILG_AMT, 0),
			NVL(BILG_VAT_AMT, 0),
			NVL(REAL_TRST_UPR, 0),
			'CT',
			(SELECT CODE_NM FROM TB_CM05M01 WHERE CODE_ID = A.PRDT_UNIT),
			NVL(REAL_TRST_QTY, 0),
			NULL,
			NULL,
			SYSDATE
	  FROM TB_AR02M01 A
	WHERE BILG_CERT_NO = #{bilgCertNo}
		  AND CO_CD = #{coCd}
	ORDER BY CO_CD, TRST_CERTI_NO
	</insert>
	
	<insert id="insertItemMinus">
	INSERT INTO KLUSER01.INV_ITEM
	(
		XML_MSG_ID,
		XMLDOC_SEQ,
		LIN_1082,
		ITEM_SEQ,
		ARD_5007,
		ARD_5006,
		ARD_5105,
		ARD_5104,
		DMS_1056,
		DMS_1000,
		MOA10_23,
		MOA10_124,
		MOA10_146,
		MEA10_6311,
		MEA10_6411,
		MEA10_6314,
		MOA10_5004,
		MOA10_6345,
		TIMESTAMP
	)
	SELECT #{xmlMsgId},
			'1',
			ROWNUM,
		 	(SELECT NVL(MAX(ITEM_SEQ), 0) + 1 FROM KLUSER01.INV_ITEM WHERE XML_MSG_ID = #{xmlMsgId} AND XMLDOC_SEQ = '1'),
			A.TRST_PRDT_CD,
			(SELECT PRDT_NM FROM TB_BM01M01 WHERE PRDT_CD = A.TRST_PRDT_CD),
			NULL,
			NULL,
			(SELECT PRDT_SPEC FROM TB_BM01M01 WHERE PRDT_CD = A.TRST_PRDT_CD),
			SUBSTRB(TRSP_RMK,1,35),
			NVL(BILG_AMT, 0) * -1,
			NVL(BILG_VAT_AMT, 0) * -1,
			NVL(REAL_TRST_UPR, 0),
			'CT',
			(SELECT CODE_NM FROM TB_CM05M01 WHERE CODE_ID = A.PRDT_UNIT),
			NVL(REAL_TRST_QTY, 0) * -1,
			NULL,
			NULL,
			SYSDATE
	  FROM TB_AR02M01 A
	WHERE BILG_CERT_NO = #{beforeBilgCertNo}
		  AND CO_CD = #{coCd}
	ORDER BY CO_CD, TRST_CERTI_NO
	</insert>
	
	<select id="selectBilgInfo" resultType="camelMap" parameterType="Map">
	SELECT RFF_GN1
		 , RFF_GN2
		 , NVL(RFF_AEA, 'RFFAEA00') RFF_AEA
		 , NVL(TAX_BILG_NO, '') TAX_BILG_NO
		 , NVL2(TAX_ADMS_YN, 'Y', 'N') TAX_ADMS_YN
	  FROM TB_AR04M01
	 WHERE BILG_CERT_NO = #{bilgCertNo} 
	</select>
	
	<select id="selectTaxHdAmtInfo" resultType="camelMap" parameterType="Map">
	SELECT TAX_MOA5_23
		 , TAX_MOA5_124
		 , TAX_MOA5_388
	  FROM KLUSER01.TAX_HD
	 WHERE BGM_1004 = #{taxBilgNo}
	</select>
	
	<insert id="insertCopyBilgTax" parameterType="Map">
	INSERT INTO TB_AR04M01
	(
		BILG_CERT_NO
		, CO_CD
		, SELL_DT
		, SELPCH_CD
		, CLNT_CD
		, CLNT_NM
		, TAX_DT
		, TAX_BILG_NO
		, TAX_DMS5_7240
		, TAX_MOA5_23
		, TAX_MOA5_124
		, TAX_MOA5_388
		, RFF_CNO
		, RFF_VA
		, TAX_DIV_CD
		, RFF_GN1
		, RFF_GN2
		, RFF_AEA
		, BGM_1225
		, BGM_4343
		, XML_FLOW
		, TAX_CREAT_ID
		, TAX_CREAT_NM
		, TAXIVC_COPRT
		, TAXIVC_COPRT_NO
		, TAXIVC_COPRT_CEO
		, TAXIVC_COPRT_NM
		, TAX_COPRT_BIZCON
		, TAXVIC_COPRT_BSTY
		, CTAII_MD_2
		, COMII_AL
		, COMII_EM
		, COMII_TE
		, COMII_FX
		, CTAIV_BJ_1
		, TAXIVC_RCV_CRN
		, TAXIVC_RCV_CEO
		, TAXIVC_RCV_ADDR
		, TAXIVC_RCV_BIZCON
		, TAXIVC_RCV_BSTY
		, TAX_RCV_SN
		, TAX_RCV_NM
		, TAX_RCV_EMAIL
		, TAX_RCV_EMAIL2
		, TAX_RCV_FAX
		, TAX_RCV_TEL
		, TAX_MOBLPHON
		, FTXAC1_1
		, FTXAC2_1
		, FTXAC3_1
		, TAX_MOA5_22
		, TAX_MOA5_212
		, TAX_MOA5_308
		, TAX_MOA5_9
		, TRST_QTY
		, TRST_WT
		, TRST_UPR
		, TRST_AMT
		, REAL_TRST_QTY
		, REAL_TRST_WT
		, REAL_TRST_UPR
		, REAL_TRST_AMT
		, BILG_QTY
		, BILG_WT
		, BILG_UPR
		, BILG_AMT
		, TRANS_AMT
		, TRST_DC_AMT
		, ETC_AMT
		, SND_YN
		, SND_DTTM
		, SND_PROC_ID
		, CSEQ_RCV_YN
		, CSEQ_RCV_DTTM
		, TAX_ADMS_YN
		, TAX_ADMS_DTTM
		, RCV_YN
		, RCV_DTTM
		, RCV_PROC_ID
		, ACC_SLIP_NO
		, ACC_SLIP_YN
		, ACC_SLIP_DTTM
		, ACC_PROC_ID
		, ETC_FIELD1
		, ETC_FIELD2
		, ETC_FIELD3
		, CREAT_ID
		, CREAT_PGM
		, CREAT_DTTM
		, UDT_ID
		, UDT_PGM
		, UDT_DTTM
		, ORGN_TAX_BILG_NO
		, ERR_CD
		, ERR_CNTS
		, RFF_APG
		, RFF_APG_CHK_ID
	)
	SELECT #{bilgCertNo}
		, CO_CD
		, SELL_DT
		, SELPCH_CD
		, CLNT_CD
		, CLNT_NM
		, TAX_DT
		, #{bgm1004}
		, TAX_DMS5_7240
		, TAX_MOA5_23 * -1
		, TAX_MOA5_124 * -1
		, TAX_MOA5_388 * -1
		, RFF_CNO
		, RFF_VA
		, TAX_DIV_CD
		, #{rffGn1}
		, #{rffGn2}
		, CASE WHEN #{rffAea} = 'RFFAEA00' THEN NULL ELSE #{rffAea} END
		, BGM_1225
		, BGM_4343
		, XML_FLOW
		, TAX_CREAT_ID
		, TAX_CREAT_NM
		, TAXIVC_COPRT
		, TAXIVC_COPRT_NO
		, TAXIVC_COPRT_CEO
		, TAXIVC_COPRT_NM
		, TAX_COPRT_BIZCON
		, TAXVIC_COPRT_BSTY
		, CTAII_MD_2
		, COMII_AL
		, COMII_EM
		, COMII_TE
		, COMII_FX
		, CTAIV_BJ_1
		, TAXIVC_RCV_CRN
		, TAXIVC_RCV_CEO
		, TAXIVC_RCV_ADDR
		, TAXIVC_RCV_BIZCON
		, TAXIVC_RCV_BSTY
		, TAX_RCV_SN
		, TAX_RCV_NM
		, TAX_RCV_EMAIL
		, TAX_RCV_EMAIL2
		, TAX_RCV_FAX
		, TAX_RCV_TEL
		, TAX_MOBLPHON
		, FTXAC1_1
		, FTXAC2_1
		, FTXAC3_1
		, TAX_MOA5_22 * -1
		, TAX_MOA5_212 * -1
		, TAX_MOA5_308 * -1
		, TAX_MOA5_9 * -1
		, TRST_QTY * -1
		, TRST_WT * -1
		, TRST_UPR
		, TRST_AMT * -1
		, REAL_TRST_QTY * -1
		, REAL_TRST_WT * -1
		, REAL_TRST_UPR
		, REAL_TRST_AMT * -1
		, BILG_QTY * -1
		, BILG_WT * -1
		, BILG_UPR
		, BILG_AMT * -1
		, TRANS_AMT * -1
		, TRST_DC_AMT * -1
		, ETC_AMT * -1
		, SND_YN
		, SND_DTTM
		, SND_PROC_ID
		, NULL
		, NULL
		, NULL
		, NULL
		, NULL
		, NULL
		, NULL
		, NULL
		, NULL
		, NULL
		, NULL
		, NULL
		, NULL
		, NULL
		, #{userId}
		, #{pgmId}
		, SYSDATE
		, NULL
		, NULL
		, NULL
		, TAX_BILG_NO
		, ERR_CD
		, ERR_CNTS
		, RFF_APG
		, RFF_APG_CHK_ID
	FROM TB_AR04M01
	WHERE BILG_CERT_NO = #{beforeBilgCertNo}
	  AND ROWNUM = 1
	ORDER BY TAX_BILG_NO DESC
	</insert>

	<update id="updateOrgnTaxBilgNo" parameterType="Map">
	UPDATE TB_AR04M01
	   SET ORGN_TAX_BILG_NO = TAX_BILG_NO
		 , RFF_AEA = #{rffAea}
	 WHERE BILG_CERT_NO = #{beforeBilgCertNo} 
	</update>
	
	<insert id="insertCopyTaxBilgDetail" parameterType="Map">
	INSERT INTO TB_AR04D01
	(
		BILG_CERT_NO
		, BILG_CERT_NO_SEQ
		, MOA9_5004
		, ARD_5006
		, ARD___113A
		, MEA10_6154
		, DMS_1056
		, MEA10_6314
		, MOA10_146
		, MOA10_23
		, MOA10_124
		, DMS_1000
		, ETC_FIELD1
		, ETC_FIELD2
		, ETC_FIELD3
		, CREAT_ID
		, CREAT_PGM
		, CREAT_DTTM
	)
	SELECT #{bilgCertNo}
			, ARD___113A
			, MOA9_5004
			, ARD_5006
			, ARD___113A
			, MEA10_6154
			, DMS_1056
			, MEA10_6314 * -1
			, MOA10_146
			, MOA10_23 * -1
			, MOA10_124 * -1
			, DMS_1000
			, ETC_FIELD1
			, ETC_FIELD2
			, ETC_FIELD3
			, #{userId}
			, #{pgmId}
			, SYSDATE
	FROM TB_AR04D01
	 WHERE BILG_CERT_NO = #{beforeBilgCertNo}
	</insert>
	
	<update id="updateTrstInfo" parameterType="Map">
	UPDATE TB_AR02M01
	   SET BILG_CERT_NO = NULL
	     , ORGN_TAX_BILG_NO = #{orgnTaxBilgNo}
	     , RFF_AEA = #{rffAea}
	     , UDT_ID = #{userId}
	     , UDT_PGM = #{pgmId}
	     , UDT_DTTM = SYSDATE
	WHERE BILG_CERT_NO = #{beforeBilgCertNo}
	</update>
	
	<insert id="insertTaxHdCancel" parameterType="Map">
	INSERT INTO KLUSER01.TAX_HD
	(
		XML_MSG_ID,
		XMLDOC_SEQ,
		XML_FLOW,
		ATTACH,
		BGM_1001,
		BGM_1004,
		BGM_1225,
		BGM_4343,
		BGM_1060,
		RFF_CNO,
		RFF_VA,
		RFF_SZ,
		RFF_GN,
		RFF_AEA,
		RFF_ACD,
		RFF_AMT_1,
		RFF_AMT_2,
		RFF_APG,
		DTM_2380,
		FTXAAI_1,
		FTXAAI_2,
		FTXAC1_1,
		FTXAC2_1,
		FTXAC3_1,
		NADII_3039,
		NADII3124,
		NADII3036A,
		NADII3036B,
		NADII3036C,
		NADII3036D,
		RFF_II_XA,
		RFFIIXA_40,
		CTAII_MD_2,
		CTAII_AK_2,
		CTAII_BJ_2,
		CTAII_MS_1,
		CTAII_MS_2,
		COMII_EM,
		COMII_TE,
		COMII_AL,
		COMII_FX,
		NADIV3039,
		NADIV3124,
		NADIV3036A,
		NADIV3036B,
		NADIV3036C,
		NADIV3036D,
		NADIV3164,
		RFF_IV_XA,
		RFFIVXA_40,
		CTAIV_MD_2,
		CTAIV_AK_2,
		CTAIV_BJ_1,
		CTAIV_BJ_2,
		COMIV_EM,
		COMIV_TE,
		COMIV_AL,
		COMIV_FX,
		CTAIVBF_2,
		CTAIVAL_2,
		COMIV2_EM,
		COMIV2_TE,
		COMIV2_AL,
		NADP13124,
		NADP13036A,
		NADP13036B,
		NADP13036C,
		NADP13036D,
		RFF_P1_XA,
		RFFP1XA_40,
		CTAP1_MD_2,
		CTAP1_AK_2,
		CTAP1_BJ_2,
		COMP1_EM,
		COMP1_TE,
		RFF_P2_XA,
		COMP2_EM,
		COMTE_315E,
		DMS5_7240,
		MOA5_23,
		MOA5_124,
		MOA5_388,
		MOA5_22,
		MOA5_212,
		MOA5_308,
		MOA5_9,
		TIMESTAMP)	
	SELECT #{xmlMsgId},
		'1',
		XML_FLOW,
		ATTACH,
		BGM_1001,
		#{bgm1004},
		BGM_1225,
		BGM_4343,
		BGM_1060,
		RFF_CNO,
		RFF_VA,
		RFF_SZ,
	    (SELECT CODE_ETC FROM TB_CM05M01 WHERE CODE_ID = #{rffGn1}) || (SELECT CODE_ETC FROM TB_CM05M01 WHERE CODE_ID = #{rffGn2}),
		(SELECT CODE_ETC FROM TB_CM05M01 WHERE CODE_ID = #{rffAea}),
		RFF_ACD,
		RFF_AMT_1,
		RFF_AMT_2,
		RFF_APG,
		DTM_2380,
		FTXAAI_1,
		FTXAAI_2,
		FTXAC1_1,
		FTXAC2_1,
		FTXAC3_1,
		NADII_3039,
		NADII3124,
		NADII3036A,
		NADII3036B,
		NADII3036C,
		NADII3036D,
		RFF_II_XA,
		RFFIIXA_40,
		CTAII_MD_2,
		CTAII_AK_2,
		CTAII_BJ_2,
		CTAII_MS_1,
		CTAII_MS_2,
		COMII_EM,
		COMII_TE,
		COMII_AL,
		COMII_FX,
		NADIV3039,
		NADIV3124,
		NADIV3036A,
		NADIV3036B,
		NADIV3036C,
		NADIV3036D,
		NADIV3164,
		RFF_IV_XA,
		RFFIVXA_40,
		CTAIV_MD_2,
		CTAIV_AK_2,
		CTAIV_BJ_1,
		CTAIV_BJ_2,
		COMIV_EM,
		COMIV_TE,
		COMIV_AL,
		COMIV_FX,
		CTAIVBF_2,
		CTAIVAL_2,
		COMIV2_EM,
		COMIV2_TE,
		COMIV2_AL,
		NADP13124,
		NADP13036A,
		NADP13036B,
		NADP13036C,
		NADP13036D,
		RFF_P1_XA,
		RFFP1XA_40,
		CTAP1_MD_2,
		CTAP1_AK_2,
		CTAP1_BJ_2,
		COMP1_EM,
		COMP1_TE,
		RFF_P2_XA,
		COMP2_EM,
		COMTE_315E,
		DMS5_7240,
		MOA5_23,
		MOA5_124,
		MOA5_388,
		MOA5_22,
		MOA5_212,
		MOA5_308,
		MOA5_9,
		SYSDATE
	FROM KLUSER01.TAX_HD
	WHERE BGM_1004 = #{taxBilgNo}
	  AND ROWNUM = 1
	ORDER BY XML_MSG_ID DESC
	</insert>
	
	<insert id="insertInvHdCancel">
	INSERT INTO KLUSER01.INV_HD
	(
		XML_MSG_ID,
		XMLDOC_SEQ,
		XML_FLOW,
		BGM_1004,
		BGM_1060,
		BGM_1225,
		BGM_4343,
		NADII3124,
		NADII3036A,
		NADII3036B,
		NADII3036C,
		NADII3036D,
		CTAII_MS_1,
		CTAII_MS_2,
		CTAII_AK_1,
		CTAII_AK_2,
		CTAII_MD_2,
		COMII_EM,
		COMII_TE,
		COMII_AL,
		COMII_FX,
		RFF_II_XA,
		RFF_VA,
		RFF_ACD,
		RFF_AMT_1,
		RFF_AMT_2,
		RFF_CNO,
		RFF_ACE_1,
		RFF_ACE_2,
		RFF_APG,
		FTXAAI_1,
		FTXAAI_2,
		FTXAAI_3,
		FTXAAI_4,
		FTXAAI_5,
		FTXAC1_1,
		FTXAC1_2,
		FTXAC1_3,
		FTXAC1_4,
		FTXAC1_5,
		FTXAC2_1,
		FTXAC2_2,
		FTXAC2_3,
		FTXAC2_4,
		FTXAC2_5,
		FTXABE_1,
		FTXABE_2,
		DTM_2380,
		DMS5_1056,
		DMS5_1060,
		DMS5_7240,
		MOA5_23,
		MOA5_124,
		MOA5_22,
		MOA5_212,
		MOA5_308,
		MOA5_9,
		NADIV3039,
		NADIV3124,
		NADIV3036A,
		NADIV3036B,
		NADIV3036C,
		NADIV3036D,
		NADIV3164,
		CTAIV_AK_1,
		CTAIV_AK_2,
		CTAIV_MD_2,
		COMIV_EM,
		COMIV_TE,
		COMIV_AL,
		COMIV_FX,
		RFF_IV_XA,
		NADCA3124,
		RFF_P1_XA,
		RFF_P2_XA,
		TIMESTAMP
	)
	SELECT #{xmlMsgId},
		'1',
		XML_FLOW,
		#{bgm1004},
		BGM_1060,
		BGM_1225,
		BGM_4343,
		NADII3124,
		NADII3036A,
		NADII3036B,
		NADII3036C,
		NADII3036D,
		CTAII_MS_1,
		CTAII_MS_2,
		CTAII_AK_1,
		CTAII_AK_2,
		CTAII_MD_2,
		COMII_EM,
		COMII_TE,
		COMII_AL,
		COMII_FX,
		RFF_II_XA,
		RFF_VA,
		RFF_ACD,
		RFF_AMT_1,
		RFF_AMT_2,
		RFF_CNO,
		RFF_ACE_1,
		RFF_ACE_2,
		RFF_APG,
		FTXAAI_1,
		FTXAAI_2,
		FTXAAI_3,
		FTXAAI_4,
		FTXAAI_5,
		FTXAC1_1,
		FTXAC1_2,
		FTXAC1_3,
		FTXAC1_4,
		FTXAC1_5,
		FTXAC2_1,
		FTXAC2_2,
		FTXAC2_3,
		FTXAC2_4,
		FTXAC2_5,
		FTXABE_1,
		FTXABE_2,
		DTM_2380,
		DMS5_1056,
		DMS5_1060,
		DMS5_7240,
		MOA5_23,
		MOA5_124,
		MOA5_22,
		MOA5_212,
		MOA5_308,
		MOA5_9,
		NADIV3039,
		NADIV3124,
		NADIV3036A,
		NADIV3036B,
		NADIV3036C,
		NADIV3036D,
		NADIV3164,
		CTAIV_AK_1,
		CTAIV_AK_2,
		CTAIV_MD_2,
		COMIV_EM,
		COMIV_TE,
		COMIV_AL,
		COMIV_FX,
		RFF_IV_XA,
		NADCA3124,
		RFF_P1_XA,
		RFF_P2_XA,
		TIMESTAMP
	FROM KLUSER01.INV_HD
	WHERE BGM_1004 = #{taxBilgNo}
	  AND ROWNUM = 1
	ORDER BY XML_MSG_ID DESC
	</insert>
	
	<insert id="insertTaxItemCancel">
	INSERT INTO KLUSER01.TAX_ITEM
		(XML_MSG_ID
		 , XMLDOC_SEQ
		 , ITEM_SEQ
		 , MOA9_5004
		 , ARD_5007
		 , ARD_5006
		 , ARD___113A
		 , ARD___113B
		 , ARD___5104
		 , DMS_1056
		 , DMS_1000
		 , MOA10_23
		 , MOA10_124
		 , MOA10_146
		 , MEA10_6154
		 , MEA10_6314
		 , MOA10_5004
		 , MOA10_6345
		 , TIMESTAMP)
	SELECT #{xmlMsgId}
		 , '1' <!-- XMLDOC_SEQ 무조건 1 -->
		 , ROWNUM
		 , MOA9_5004
		 , NULL
		 , ARD_5006
		 , ARD___113A <!-- ARD__113A 중국일떄만 사용 -->
		 , NULL <!-- ARD__113B 중국일떄만 사용 -->
		 , NULL <!-- ARD__5104 중국일떄만 사용 -->
		 , DMS_1056
		 , SUBSTRB(DMS_1000,1,35)
		 , NVL(MOA10_23, 0) 
		 , NVL(MOA10_124, 0)
		 , NVL(MOA10_146, 0)
		 , MEA10_6154
		 , NVL(MEA10_6314, 0)
		 , NULL <!-- MOA10_5004 외화금액 -->
		 , NULL <!-- MOA10_6345 외화통화코드 -->
		 , SYSDATE
		 FROM TB_AR04D01 A
		WHERE BILG_CERT_NO = #{bilgCertNo}
	ORDER BY BILG_CERT_NO
	</insert>
	
	<insert id="insertInvItemCancel">
	INSERT INTO KLUSER01.INV_ITEM
	(
		XML_MSG_ID,
		XMLDOC_SEQ,
		LIN_1082,
		ITEM_SEQ,
		ARD_5007,
		ARD_5006,
		ARD_5105,
		ARD_5104,
		DMS_1056,
		DMS_1000,
		MOA10_23,
		MOA10_124,
		MOA10_146,
		MEA10_6311,
		MEA10_6411,
		MEA10_6314,
		MOA10_5004,
		MOA10_6345,
		TIMESTAMP
	)
	SELECT #{xmlMsgId},
			'1',
			ROWNUM,
		 	(SELECT NVL(MAX(ITEM_SEQ), 0) + 1 FROM KLUSER01.TAX_ITEM WHERE XML_MSG_ID = #{xmlMsgId} AND XMLDOC_SEQ = '1'),
			A.TRST_PRDT_CD,
			(SELECT PRDT_NM FROM TB_BM01M01 WHERE PRDT_CD = A.TRST_PRDT_CD),
			NULL,
			NULL,
			(SELECT PRDT_SPEC FROM TB_BM01M01 WHERE PRDT_CD = A.TRST_PRDT_CD),
			SUBSTRB(TRSP_RMK,1,35),
			(NVL(REAL_TRST_AMT, 0)),
			(NVL(BILG_VAT_AMT, 0)),
			NVL(REAL_TRST_UPR, 0),
			'CT',
			'CT',
			(NVL(REAL_TRST_QTY, 0)),
			NULL,
			NULL,
			SYSDATE
	  FROM TB_AR02M01 A
	WHERE BILG_CERT_NO = #{bilgCertNo}
		  AND CO_CD = #{coCd}
	ORDER BY CO_CD, TRST_CERTI_NO
	</insert>
	
	<update id="updateTaxBilgNoCancel">
	UPDATE TB_AR04M01
	   SET RFF_GN1 = 'RFFGN102'
	     , RFF_AEA = 'RFFAEA03'
	     , TAX_BILG_NO =  #{bgm1004}
	     , TAX_DT = TO_CHAR(SYSDATE, 'YYYYMMDD')
	     , ORGN_TAX_BILG_NO = TAX_BILG_NO
	     , RFF_APG_CHK_ID =  #{userId}
	 WHERE BILG_CERT_NO = #{bilgCertNo}
	   AND CO_CD = #{coCd}
	</update>
	
	<update id="updateBilgRvrs">
	UPDATE TB_AR04M01
	SET TAX_DT = TO_CHAR(SYSDATE, 'YYYYMMDD')
	  , TAX_BILG_NO = '역발행'
      , SND_YN = 'Y'
      , SND_DTTM = SYSDATE
      , SND_PROC_ID = #{userId}
      , CSEQ_RCV_YN = 'Y'
      , CSEQ_RCV_DTTM = SYSDATE
	  , RFF_APG = 'B'
	  , RFF_APG_CHK_ID = #{userId}
	  , UDT_ID = #{userId}
	  , UDT_PGM = #{pgmId}
	  , UDT_DTTM = SYSDATE
	WHERE BILG_CERT_NO = #{bilgCertNo}
	</update>
	
	
	<update id="updateBilgRvrsCancel">
	UPDATE TB_AR04M01
	SET TAX_DT = ''
      , SND_YN = ''
      , SND_DTTM = ''
      , SND_PROC_ID = ''
      , CSEQ_RCV_YN = ''
      , CSEQ_RCV_DTTM = ''
	  , TAX_BILG_NO = ''
	  , RFF_APG = 'S'
	  , RFF_APG_CHK_ID = #{userId}
	  , UDT_ID = #{userId}
	  , UDT_PGM = #{pgmId}
	  , UDT_DTTM = SYSDATE
	WHERE BILG_CERT_NO = #{bilgCertNo}
	</update>

	<select id="selectBgm4343" resultType="String">
	SELECT MAX(NVL(BGM_4343, 0)) + 1 
	  FROM KLUSER01.TAX_HD 
	 WHERE BGM_1004 = #{taxBilgNo}
	  AND ROWNUM = 1
	ORDER BY XML_MSG_ID DESC
	</select>
	
	<insert id="insertTaxHdDelete" parameterType="Map">
	INSERT INTO KLUSER01.TAX_HD
	(
		XML_MSG_ID,
		XMLDOC_SEQ,
		XML_FLOW,
		ATTACH,
		BGM_1001,
		BGM_1004,
		BGM_1225,
		BGM_4343,
		BGM_1060,
		RFF_CNO,
		RFF_VA,
		RFF_SZ,
		RFF_GN,
		RFF_AEA,
		RFF_ACD,
		RFF_AMT_1,
		RFF_AMT_2,
		RFF_APG,
		DTM_2380,
		FTXAAI_1,
		FTXAAI_2,
		FTXAC1_1,
		FTXAC2_1,
		FTXAC3_1,
		NADII_3039,
		NADII3124,
		NADII3036A,
		NADII3036B,
		NADII3036C,
		NADII3036D,
		RFF_II_XA,
		RFFIIXA_40,
		CTAII_MD_2,
		CTAII_AK_2,
		CTAII_BJ_2,
		CTAII_MS_1,
		CTAII_MS_2,
		COMII_EM,
		COMII_TE,
		COMII_AL,
		COMII_FX,
		NADIV3039,
		NADIV3124,
		NADIV3036A,
		NADIV3036B,
		NADIV3036C,
		NADIV3036D,
		NADIV3164,
		RFF_IV_XA,
		RFFIVXA_40,
		CTAIV_MD_2,
		CTAIV_AK_2,
		CTAIV_BJ_1,
		CTAIV_BJ_2,
		COMIV_EM,
		COMIV_TE,
		COMIV_AL,
		COMIV_FX,
		CTAIVBF_2,
		CTAIVAL_2,
		COMIV2_EM,
		COMIV2_TE,
		COMIV2_AL,
		NADP13124,
		NADP13036A,
		NADP13036B,
		NADP13036C,
		NADP13036D,
		RFF_P1_XA,
		RFFP1XA_40,
		CTAP1_MD_2,
		CTAP1_AK_2,
		CTAP1_BJ_2,
		COMP1_EM,
		COMP1_TE,
		RFF_P2_XA,
		COMP2_EM,
		COMTE_315E,
		DMS5_7240,
		MOA5_23,
		MOA5_124,
		MOA5_388,
		MOA5_22,
		MOA5_212,
		MOA5_308,
		MOA5_9,
		TIMESTAMP)	
	SELECT #{xmlMsgId},
		'1',
		XML_FLOW,
		ATTACH,
		BGM_1001,
		#{bgm1004},
		#{bgm1225},
		#{bgm4343},
		BGM_1060,
		RFF_CNO,
		RFF_VA,
		RFF_SZ,
	    RFF_GN,
		RFF_AEA,
		RFF_ACD,
		RFF_AMT_1,
		RFF_AMT_2,
		RFF_APG,
		DTM_2380,
		FTXAAI_1,
		FTXAAI_2,
		FTXAC1_1,
		FTXAC2_1,
		FTXAC3_1,
		NADII_3039,
		NADII3124,
		NADII3036A,
		NADII3036B,
		NADII3036C,
		NADII3036D,
		RFF_II_XA,
		RFFIIXA_40,
		CTAII_MD_2,
		CTAII_AK_2,
		CTAII_BJ_2,
		CTAII_MS_1,
		CTAII_MS_2,
		COMII_EM,
		COMII_TE,
		COMII_AL,
		COMII_FX,
		NADIV3039,
		NADIV3124,
		NADIV3036A,
		NADIV3036B,
		NADIV3036C,
		NADIV3036D,
		NADIV3164,
		RFF_IV_XA,
		RFFIVXA_40,
		CTAIV_MD_2,
		CTAIV_AK_2,
		CTAIV_BJ_1,
		CTAIV_BJ_2,
		COMIV_EM,
		COMIV_TE,
		COMIV_AL,
		COMIV_FX,
		CTAIVBF_2,
		CTAIVAL_2,
		COMIV2_EM,
		COMIV2_TE,
		COMIV2_AL,
		NADP13124,
		NADP13036A,
		NADP13036B,
		NADP13036C,
		NADP13036D,
		RFF_P1_XA,
		RFFP1XA_40,
		CTAP1_MD_2,
		CTAP1_AK_2,
		CTAP1_BJ_2,
		COMP1_EM,
		COMP1_TE,
		RFF_P2_XA,
		COMP2_EM,
		COMTE_315E,
		DMS5_7240,
		MOA5_23,
		MOA5_124,
		MOA5_388,
		MOA5_22,
		MOA5_212,
		MOA5_308,
		MOA5_9,
		SYSDATE
	FROM KLUSER01.TAX_HD
	WHERE BGM_1004 = #{taxBilgNo}
	  AND ROWNUM = 1
	ORDER BY XML_MSG_ID DESC
	</insert>
	
	<insert id="insertTaxItemDelete">
	INSERT INTO KLUSER01.TAX_ITEM
		(XML_MSG_ID
		 , XMLDOC_SEQ
		 , ITEM_SEQ
		 , MOA9_5004
		 , ARD_5007
		 , ARD_5006
		 , ARD___113A
		 , ARD___113B
		 , ARD___5104
		 , DMS_1056
		 , DMS_1000
		 , MOA10_23
		 , MOA10_124
		 , MOA10_146
		 , MEA10_6154
		 , MEA10_6314
		 , MOA10_5004
		 , MOA10_6345
		 , TIMESTAMP)
	SELECT #{xmlMsgId}
		 , '1' <!-- XMLDOC_SEQ 무조건 1 -->
		 , ROWNUM
		 , MOA9_5004
		 , NULL
		 , ARD_5006
		 , ARD___113A <!-- ARD__113A 중국일떄만 사용 -->
		 , NULL <!-- ARD__113B 중국일떄만 사용 -->
		 , NULL <!-- ARD__5104 중국일떄만 사용 -->
		 , DMS_1056
		 , SUBSTRB(DMS_1000,1,35)
		 , NVL(MOA10_23, 0)
		 , NVL(MOA10_124, 0)
		 , NVL(MOA10_146, 0)
		 , MEA10_6154
		 , NVL(MEA10_6314, 0)
		 , NULL <!-- MOA10_5004 외화금액 -->
		 , NULL <!-- MOA10_6345 외화통화코드 -->
		 , SYSDATE
		 FROM TB_AR04D01 A
		WHERE BILG_CERT_NO = #{bilgCertNo}
	ORDER BY BILG_CERT_NO
	</insert>
	
	<insert id="insertInvHdDelete">
	INSERT INTO KLUSER01.INV_HD
	(
		XML_MSG_ID,
		XMLDOC_SEQ,
		XML_FLOW,
		BGM_1004,
		BGM_1060,
		BGM_1225,
		BGM_4343,
		NADII3124,
		NADII3036A,
		NADII3036B,
		NADII3036C,
		NADII3036D,
		CTAII_MS_1,
		CTAII_MS_2,
		CTAII_AK_1,
		CTAII_AK_2,
		CTAII_MD_2,
		COMII_EM,
		COMII_TE,
		COMII_AL,
		COMII_FX,
		RFF_II_XA,
		RFF_VA,
		RFF_ACD,
		RFF_AMT_1,
		RFF_AMT_2,
		RFF_CNO,
		RFF_ACE_1,
		RFF_ACE_2,
		RFF_APG,
		FTXAAI_1,
		FTXAAI_2,
		FTXAAI_3,
		FTXAAI_4,
		FTXAAI_5,
		FTXAC1_1,
		FTXAC1_2,
		FTXAC1_3,
		FTXAC1_4,
		FTXAC1_5,
		FTXAC2_1,
		FTXAC2_2,
		FTXAC2_3,
		FTXAC2_4,
		FTXAC2_5,
		FTXABE_1,
		FTXABE_2,
		DTM_2380,
		DMS5_1056,
		DMS5_1060,
		DMS5_7240,
		MOA5_23,
		MOA5_124,
		MOA5_22,
		MOA5_212,
		MOA5_308,
		MOA5_9,
		NADIV3039,
		NADIV3124,
		NADIV3036A,
		NADIV3036B,
		NADIV3036C,
		NADIV3036D,
		NADIV3164,
		CTAIV_AK_1,
		CTAIV_AK_2,
		CTAIV_MD_2,
		COMIV_EM,
		COMIV_TE,
		COMIV_AL,
		COMIV_FX,
		RFF_IV_XA,
		NADCA3124,
		RFF_P1_XA,
		RFF_P2_XA,
		TIMESTAMP
	)
	SELECT #{xmlMsgId},
		'1',
		XML_FLOW,
		#{bgm1004},
		BGM_1060,
		#{bgm1225},
		#{bgm4343},
		NADII3124,
		NADII3036A,
		NADII3036B,
		NADII3036C,
		NADII3036D,
		CTAII_MS_1,
		CTAII_MS_2,
		CTAII_AK_1,
		CTAII_AK_2,
		CTAII_MD_2,
		COMII_EM,
		COMII_TE,
		COMII_AL,
		COMII_FX,
		RFF_II_XA,
		RFF_VA,
		RFF_ACD,
		RFF_AMT_1,
		RFF_AMT_2,
		RFF_CNO,
		RFF_ACE_1,
		RFF_ACE_2,
		RFF_APG,
		FTXAAI_1,
		FTXAAI_2,
		FTXAAI_3,
		FTXAAI_4,
		FTXAAI_5,
		FTXAC1_1,
		FTXAC1_2,
		FTXAC1_3,
		FTXAC1_4,
		FTXAC1_5,
		FTXAC2_1,
		FTXAC2_2,
		FTXAC2_3,
		FTXAC2_4,
		FTXAC2_5,
		FTXABE_1,
		FTXABE_2,
		DTM_2380,
		DMS5_1056,
		DMS5_1060,
		DMS5_7240,
		MOA5_23,
		MOA5_124,
		MOA5_22,
		MOA5_212,
		MOA5_308,
		MOA5_9,
		NADIV3039,
		NADIV3124,
		NADIV3036A,
		NADIV3036B,
		NADIV3036C,
		NADIV3036D,
		NADIV3164,
		CTAIV_AK_1,
		CTAIV_AK_2,
		CTAIV_MD_2,
		COMIV_EM,
		COMIV_TE,
		COMIV_AL,
		COMIV_FX,
		RFF_IV_XA,
		NADCA3124,
		RFF_P1_XA,
		RFF_P2_XA,
		TIMESTAMP
	FROM KLUSER01.INV_HD
	WHERE BGM_1004 = #{taxBilgNo}
	  AND ROWNUM = 1
	ORDER BY XML_MSG_ID DESC
	</insert>
	
	<insert id="insertInvItemDelete">
	INSERT INTO KLUSER01.INV_ITEM
	(
		XML_MSG_ID,
		XMLDOC_SEQ,
		LIN_1082,
		ITEM_SEQ,
		ARD_5007,
		ARD_5006,
		ARD_5105,
		ARD_5104,
		DMS_1056,
		DMS_1000,
		MOA10_23,
		MOA10_124,
		MOA10_146,
		MEA10_6311,
		MEA10_6411,
		MEA10_6314,
		MOA10_5004,
		MOA10_6345,
		TIMESTAMP
	)
	SELECT #{xmlMsgId},
			'1',
			ROWNUM,
		 	(SELECT NVL(MAX(ITEM_SEQ), 0) + 1 FROM KLUSER01.TAX_ITEM WHERE XML_MSG_ID = #{xmlMsgId} AND XMLDOC_SEQ = '1'),
			A.TRST_PRDT_CD,
			(SELECT PRDT_NM FROM TB_BM01M01 WHERE PRDT_CD = A.TRST_PRDT_CD),
			NULL,
			NULL,
			(SELECT PRDT_SPEC FROM TB_BM01M01 WHERE PRDT_CD = A.TRST_PRDT_CD),
			SUBSTRB(TRSP_RMK,1,35),
			(NVL(REAL_TRST_AMT, 0)),
			(NVL(BILG_VAT_AMT, 0)),
			NVL(REAL_TRST_UPR, 0),
			'CT',
			'CT',
			(NVL(REAL_TRST_QTY, 0)),
			NULL,
			NULL,
			SYSDATE
	  FROM TB_AR02M01 A
	WHERE BILG_CERT_NO = #{bilgCertNo}
		  AND CO_CD = #{coCd}
	ORDER BY CO_CD, TRST_CERTI_NO
	</insert>
	
	<update id="updateTaxBilgNoDelete">
	UPDATE TB_AR04M01
	   SET TAX_BILG_NO = #{bgm1004}
	     , BGM_1225 = 'BGM1225' || #{bgm1225}
	     , BGM_4343 = #{bgm4343}
	 WHERE BILG_CERT_NO = #{bilgCertNo}
	</update>
	
	<select id="selectBilgDetailList" resultType="CamelMap">
	SELECT ROWNUM
		 , BILG_CERT_NO AS BILG_CERT_NO
		 , BILG_CERT_NO_SEQ AS BILG_CERT_NO_SEQ
		 , TO_CHAR(TO_DATE(MOA9_5004, 'YYYYMMDD'), 'YYYY-MM-DD') AS MOA9_5004
		 , ARD_5006 AS ARD_5006
		 , MEA10_6154 AS MEA10_6154
		 , DMS_1056 AS DMS_1056
		 , MEA10_6314 AS MEA10_6314
		 , MOA10_146 AS MOA10_146
		 , MOA10_23 AS MOA10_23
		 , MOA10_124 AS MOA10_124
		 , DMS_1000 AS DMS_1000
		 , ARD___113A AS ARD_113A
	  FROM TB_AR04D01
	 WHERE BILG_CERT_NO = #{bilgCertNo}
	</select>
	
	<delete id="deleteTaxBilgDetail">
	DELETE FROM TB_AR04D01
	 WHERE BILG_CERT_NO = #{bilgCertNo}
	</delete>
	
	<insert id="insertTaxBilgDetail">
	INSERT INTO TB_AR04D01
	(
		BILG_CERT_NO,
		BILG_CERT_NO_SEQ,
		MOA9_5004,
		ARD_5006,
		ARD___113A,
		MEA10_6154,
		DMS_1056,
		MEA10_6314,
		MOA10_146,
		MOA10_23,
		MOA10_124,
		DMS_1000,
		CREAT_ID,
		CREAT_PGM,
		CREAT_DTTM,
		UDT_ID,
		UDT_PGM,
		UDT_DTTM
	) VALUES (
		#{bilgCertNo},
		#{ard113a},
		REPLACE(#{moa95004}, '-', ''),
		#{ard5006},
		#{ard113a},
		#{mea106154},
		#{dms1056},
		#{mea106314},
		#{moa10146},
		#{moa1023},
		#{moa10124},
		#{dms1000},
		#{userId},
		#{pgmId},
		SYSDATE,
		#{userId},
		#{pgmId},
		SYSDATE
	)
	</insert>
  
	<update id="updateBilgAmt">
	UPDATE TB_AR04M01
	SET 
		TRST_QTY      = #{trstQty},
		TRST_WT       = #{trstWt},
		TRST_UPR      = #{trstUpr},
		TRST_AMT      = #{trstAmt},
		REAL_TRST_QTY = #{realTrstQty},
		REAL_TRST_WT  = #{realTrstWt},
		REAL_TRST_UPR = #{realTrstUpr},
		REAL_TRST_AMT = #{realTrstAmt},
		BILG_QTY      = #{bilgQty},
		BILG_WT       = #{bilgWt},
		BILG_UPR      = #{bilgUpr},
		BILG_AMT      = #{bilgAmt},
		TRST_DC_AMT   = #{trstDcAmt},
		ETC_AMT       = #{etcAmt},
		TRANS_AMT     = #{transAmt},
		TAX_MOA5_23   = #{taxMoa523},
		TAX_MOA5_124  = #{taxMoa5124},
		TAX_MOA5_388  = #{taxMoa5388}
	WHERE BILG_CERT_NO = #{bilgCertNo}
	</update>
	
	<insert id="insertKladdiHd" parameterType="Map">
	INSERT INTO KLUSER01.KLADDI_HD
	(
		XML_MSG_ID,
		XMLDOC_SEQ,
		BGM_1001,
		BGM_1000,
		BGM_1004,
		BGM_1225,
		BGM_4343,
		RFFXA_154,
		TIMESTAMP
	)
	VALUES
	(
		#{xmlMsgId},
		'1',
		'6KQ',
		'1',
		#{bgm1004},
		'9',
		'1',
		NULL,
		SYSDATE
	)
	</insert>
	
	<insert id="insertKladdiDtl" parameterType="Map">
	INSERT INTO KLUSER01.KLADDI_DTL
	(
		XML_MSG_ID,
		XMLDOC_SEQ,
		DTLDOC_SEQ,
		LIN_7140,
		FTXACB_440,
		FTXACB_453,
		TIMESTAMP
	)
	VALUES
	(
		#{xmlMsgId},
		'1',
		(SELECT NVL(MAX(DTLDOC_SEQ), 0) + 1 FROM KLUSER01.KLADDI_DTL WHERE XML_MSG_ID = #{xmlMsgId}),
		#{bgm1004},
		#{bgm1004},
		'780',
		SYSDATE
	)
	</insert>
</mapper>