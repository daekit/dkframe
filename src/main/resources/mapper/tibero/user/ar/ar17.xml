<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.dksys.biz.user.ar.ar17.mapper.AR17Mapper">	
	<select id="selectTrmendAmtListCount" resultType="int">
		SELECT COUNT(*) FROM (
			SELECT 
			    AMT.*
			    , FN_CM05M01_CD_TO_NM(AMT.CO_CD) AS CO_NM
			    , AMT.CLNT_NM AS CLNT_NM
			    -- , (SELECT CODE_NM FROM TB_CM05M01 WHERE CODE_ID = (SELECT CODE_RPRC FROM TB_CM05M01 WHERE CODE_ID = AMT.PRDT_DIV)) AS PRDT_GRP
			    , FN_CM05M01_CD_TO_NM(AMT.SELL_CLMN_DIV_CD) AS SELL_CLMN_DIV_NM
			    , FN_CM05M01_CD_TO_NM(AMT.SELL_PMNT_MTD_CD) AS SELL_PMNT_MTD_NM
			    FROM(
					SELECT 
						CO_CD
				        , FN_CM05M01_CD_TO_NM(A.CO_CD) AS CO_NM
				        , TRST_CLNT_CD AS CLNT_CD
				        , B.CLNT_NM AS CLNT_NM
		                -- , A.PRDT_DIV AS PRDT_DIV
				        , SELL_CLMN_DIV_CD
				        , SELL_PMNT_MTD_CD
				        , B.SELL_CLMN_DAY AS SELL_CLMN_DAY
				        , (SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '01', A.BILG_AMT, 0)) + SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '01', A.BILG_VAT_AMT, 0)) - SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '01', A.ETRDPS_AMT, 0))) AS TRMEND_AMT_01
				        , (SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '02', A.BILG_AMT, 0)) + SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '02', A.BILG_VAT_AMT, 0)) - SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '02', A.ETRDPS_AMT, 0))) AS TRMEND_AMT_02
				        , (SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '03', A.BILG_AMT, 0)) + SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '03', A.BILG_VAT_AMT, 0)) - SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '03', A.ETRDPS_AMT, 0))) AS TRMEND_AMT_03
				        , (SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '04', A.BILG_AMT, 0)) + SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '04', A.BILG_VAT_AMT, 0)) - SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '04', A.ETRDPS_AMT, 0))) AS TRMEND_AMT_04
				        , (SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '05', A.BILG_AMT, 0)) + SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '05', A.BILG_VAT_AMT, 0)) - SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '05', A.ETRDPS_AMT, 0))) AS TRMEND_AMT_05
				        , (SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '06', A.BILG_AMT, 0)) + SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '06', A.BILG_VAT_AMT, 0)) - SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '06', A.ETRDPS_AMT, 0))) AS TRMEND_AMT_06
				        , (SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '07', A.BILG_AMT, 0)) + SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '07', A.BILG_VAT_AMT, 0)) - SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '07', A.ETRDPS_AMT, 0))) AS TRMEND_AMT_07
				        , (SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '08', A.BILG_AMT, 0)) + SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '08', A.BILG_VAT_AMT, 0)) - SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '08', A.ETRDPS_AMT, 0))) AS TRMEND_AMT_08
				        , (SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '09', A.BILG_AMT, 0)) + SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '09', A.BILG_VAT_AMT, 0)) - SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '09', A.ETRDPS_AMT, 0))) AS TRMEND_AMT_09
				        , (SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '10', A.BILG_AMT, 0)) + SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '10', A.BILG_VAT_AMT, 0)) - SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '10', A.ETRDPS_AMT, 0))) AS TRMEND_AMT_10
				        , (SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '11', A.BILG_AMT, 0)) + SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '11', A.BILG_VAT_AMT, 0)) - SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '11', A.ETRDPS_AMT, 0))) AS TRMEND_AMT_11
				        , (SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '12', A.BILG_AMT, 0)) + SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '12', A.BILG_VAT_AMT, 0)) - SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '12', A.ETRDPS_AMT, 0))) AS TRMEND_AMT_12
				        , (NVL(SUM(REAL_TRST_AMT), 0) + NVL(SUM(BILG_VAT_AMT), 0) - NVL(SUM(ETRDPS_AMT), 0)) AS TOT_TRMEND_AMT
		
				    FROM TB_AR02M01 A, TB_BM02M01 B
				    WHERE
				        A.TRST_CLNT_CD = B.CLNT_CD
				        AND A.ETRDPS_YN = 'N'
				        AND SUBSTRING(A.TRST_DT, 0, 4) = #{baseDt}
				        AND SELPCH_CD = 'SELPCH2'
				       	<if test= "coCd != null and !coCd.equals('')">
					 		AND A.CO_CD = #{coCd}
						</if>
						<if test= "clntCd != null and !clntCd.equals('')">
					 		AND A.TRST_CLNT_CD = #{clntCd}
						</if>
						<if test= "useYn != null and !useYn.equals('')">
					 		AND B.USE_YN = #{useYn}
						</if>
						<if test= "crn != null and !crn.equals('')">
					 		AND B.CRN = #{crn}
						</if>
						<if test= "clntDiv != null and !clntDiv.equals('')">
					 		AND B.CLNT_DIV = #{clntDiv}
						</if>     
		            GROUP BY CO_CD, TRST_CLNT_CD,  B.CLNT_NM, SELL_CLMN_DIV_CD, SELL_PMNT_MTD_CD, SELL_CLMN_DAY -- , PRDT_DIV
		    	) AMT
		    )
	</select>
	
	<select id="selectTrmendAmtList" resultType="CamelMap">
		SELECT 
		    AMT.*
		    , FN_CM05M01_CD_TO_NM(AMT.CO_CD) AS CO_NM
		    , AMT.CLNT_NM AS CLNT_NM
		    -- , (SELECT CODE_NM FROM TB_CM05M01 WHERE CODE_ID = (SELECT CODE_RPRC FROM TB_CM05M01 WHERE CODE_ID = AMT.PRDT_DIV)) AS PRDT_GRP
		    , FN_CM05M01_CD_TO_NM(AMT.SELL_CLMN_DIV_CD) AS SELL_CLMN_DIV_NM
		    , FN_CM05M01_CD_TO_NM(AMT.SELL_PMNT_MTD_CD) AS SELL_PMNT_MTD_NM
		    FROM(
				SELECT 
					CO_CD
			        , FN_CM05M01_CD_TO_NM(A.CO_CD) AS CO_NM
			        , TRST_CLNT_CD AS CLNT_CD
			        , B.CLNT_NM AS CLNT_NM
	                -- , A.PRDT_DIV AS PRDT_DIV
			        , SELL_CLMN_DIV_CD
			        , SELL_PMNT_MTD_CD
			        , B.SELL_CLMN_DAY AS SELL_CLMN_DAY
			        , (SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '01', A.BILG_AMT, 0)) + SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '01', A.BILG_VAT_AMT, 0)) - SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '01', A.ETRDPS_AMT, 0))) AS TRMEND_AMT_01
			        , (SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '02', A.BILG_AMT, 0)) + SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '02', A.BILG_VAT_AMT, 0)) - SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '02', A.ETRDPS_AMT, 0))) AS TRMEND_AMT_02
			        , (SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '03', A.BILG_AMT, 0)) + SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '03', A.BILG_VAT_AMT, 0)) - SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '03', A.ETRDPS_AMT, 0))) AS TRMEND_AMT_03
			        , (SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '04', A.BILG_AMT, 0)) + SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '04', A.BILG_VAT_AMT, 0)) - SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '04', A.ETRDPS_AMT, 0))) AS TRMEND_AMT_04
			        , (SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '05', A.BILG_AMT, 0)) + SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '05', A.BILG_VAT_AMT, 0)) - SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '05', A.ETRDPS_AMT, 0))) AS TRMEND_AMT_05
			        , (SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '06', A.BILG_AMT, 0)) + SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '06', A.BILG_VAT_AMT, 0)) - SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '06', A.ETRDPS_AMT, 0))) AS TRMEND_AMT_06
			        , (SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '07', A.BILG_AMT, 0)) + SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '07', A.BILG_VAT_AMT, 0)) - SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '07', A.ETRDPS_AMT, 0))) AS TRMEND_AMT_07
			        , (SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '08', A.BILG_AMT, 0)) + SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '08', A.BILG_VAT_AMT, 0)) - SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '08', A.ETRDPS_AMT, 0))) AS TRMEND_AMT_08
			        , (SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '09', A.BILG_AMT, 0)) + SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '09', A.BILG_VAT_AMT, 0)) - SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '09', A.ETRDPS_AMT, 0))) AS TRMEND_AMT_09
			        , (SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '10', A.BILG_AMT, 0)) + SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '10', A.BILG_VAT_AMT, 0)) - SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '10', A.ETRDPS_AMT, 0))) AS TRMEND_AMT_10
			        , (SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '11', A.BILG_AMT, 0)) + SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '11', A.BILG_VAT_AMT, 0)) - SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '11', A.ETRDPS_AMT, 0))) AS TRMEND_AMT_11
			        , (SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '12', A.BILG_AMT, 0)) + SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '12', A.BILG_VAT_AMT, 0)) - SUM(DECODE(SUBSTRING(A.TRST_DT,5,2), '12', A.ETRDPS_AMT, 0))) AS TRMEND_AMT_12
			        , (NVL(SUM(REAL_TRST_AMT), 0) + NVL(SUM(BILG_VAT_AMT), 0) - NVL(SUM(ETRDPS_AMT), 0)) AS TOT_TRMEND_AMT
	
			    FROM TB_AR02M01 A, TB_BM02M01 B
			    WHERE
			        A.TRST_CLNT_CD = B.CLNT_CD
			        AND A.ETRDPS_YN = 'N'
			        AND SUBSTRING(A.TRST_DT, 0, 4) = #{baseDt}
			        AND SELPCH_CD = 'SELPCH2'
			       	<if test= "coCd != null and !coCd.equals('')">
				 		AND A.CO_CD = #{coCd}
					</if>
					<if test= "clntCd != null and !clntCd.equals('')">
				 		AND A.TRST_CLNT_CD = #{clntCd}
					</if>
					<if test= "useYn != null and !useYn.equals('')">
				 		AND B.USE_YN = #{useYn}
					</if>
					<if test= "crn != null and !crn.equals('')">
				 		AND B.CRN = #{crn}
					</if>
					<if test= "clntDiv != null and !clntDiv.equals('')">
				 		AND B.CLNT_DIV = #{clntDiv}
					</if>     
	            GROUP BY CO_CD, TRST_CLNT_CD,  B.CLNT_NM, SELL_CLMN_DIV_CD, SELL_PMNT_MTD_CD, SELL_CLMN_DAY -- , PRDT_DIV
	    	) AMT
	</select>
	


</mapper>

		    