<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.dksys.biz.user.ar.ar07.mapper.AR07Mapper">

	<!-- 당월 마감이 있는 지 확인함. -->
	<select id="selectMtCloseChkCount" resultType="int">
			SELECT COUNT(*)
		  	 FROM TB_AR07M01 C
			  LEFT JOIN TB_BM02M01 BM02 ON BM02.CLNT_CD = C.CLNT_CD 
<!-- 			  WHERE  C.CLOSE_YM = TO_CHAR(SYSDATE,'YYYYMM') -->
             <where>
			 	  <if test="coCd != null and !coCd.equals('')">
				  AND C.CO_CD = #{coCd}				
				  </if>	
				  <if test="clntCd != null and !clntCd.equals('')">
				  AND C.CLNT_CD = #{clntCd}				
				  </if>	
				  <if test="clntNm != null and !clntNm.equals('')">
				   AND BM02.CLNT_NM  LIKE '%' || #{clntNm} ||'%'
				  </if>			
				  <if test="baseDt != null and !baseDt.equals('')">
				   AND  C.CLOSE_YM = SUBSTRING(REPLACE(#{baseDt}, '-', ''),0,6)
                  </if>
				  <if test="closeYm != null and !closeYm.equals('')">
				   AND  C.CLOSE_YM = REPLACE(#{closeYm}, '-', '')
                  </if>
                  <if test="taxivcCoprt != null and !taxivcCoprt.equals('')">
				   AND C.TAXIVC_COPRT = #{taxivcCoprt}
				  </if>
             </where>
	</select>
	<!-- 전월 마감이 있는 지 확인함. -->
	<select id="selectPreMtCloseChkCount" resultType="int">
			SELECT COUNT(*)
		  	 FROM TB_AR07M01 C
			  LEFT JOIN TB_BM02M01 BM02 ON BM02.CLNT_CD = C.CLNT_CD 
			  WHERE  C.CLOSE_YM = TO_CHAR(ADD_MONTHS(SYSDATE,-1),'YYYYMM')
			 	  <if test="coCd != null and !coCd.equals('')">
				  AND C.CO_CD = #{coCd}				
				  </if>	
				  <if test="clntCd != null and !clntCd.equals('')">
				  AND C.CLNT_CD = #{clntCd}				
				  </if>	
				  <if test="clntNm != null and !clntNm.equals('')">
				   AND BM02.CLNT_NM  LIKE '%' || #{clntNm} ||'%'
				  </if>			
				  <if test="closeYm != null and !closeYm.equals('')">
				   AND  C.CLOSE_YM = REPLACE(#{closeYm}, '-', '')
                  </if>
                  <if test="taxivcCoprt != null and !taxivcCoprt.equals('')">
				   AND C.TAXIVC_COPRT = #{taxivcCoprt}
				  </if>
	</select>
	
	
	<select id="selectMtClosCditCount" resultType="int">
		SELECT COUNT(*)
			FROM
			(SELECT   ROWNUM AS RNUM
		              , A.*
		  		      , FN_CM05M01_CD_TO_NM(A.CO_CD)  AS  CO_NM
		  		      , FN_CM05M01_CD_TO_NM(A.PRDT_GRP)  AS PRDT_GRP_NM
		  		      , (SELECT PRJCT_NM FROM  TB_SD05M01 SD05 WHERE SD05.PRJCT_CD = A.PRJCT_CD ) AS PRJCT_NM
		  		      , FN_CM05M01_CD_TO_NM(A.SELL_PAY_DIV_CD)  AS  SELL_PAY_DIV_NM
	    			  , FN_CM05M01_CD_TO_NM(A.SELL_CLMN_DIV_CD) AS  SELL_CLMN_DIV_NM
		              , FN_CM05M01_CD_TO_NM(A.SELL_PMNT_MTD_CD) AS  SELL_PMNT_MTD_NM
		              , FN_CM05M01_CD_TO_NM(A.SELL_VAT_CD)      AS  SELL_VAT_NM
		              , A.TAXIVC_COPRT
		              , FN_CM05M01_CD_TO_NM(A.TAXIVC_COPRT)      AS  TAXIVC_COPRT_NM
		              , BASIS_AMT + TOT_AMT - CLMN_AMT AS TRMEND_AMT	               
		              , F_CREDIT_LOAN_PRDTGRP('T', A.CLNT_CD, A.CO_CD,A.PRDT_GRP, TO_CHAR(LAST_DAY(TO_DATE(REPLACE(#{baseDt},'-',''), 'YYYYMMDD')), 'YYYYMMDD'),0) AS CRDT_LMT  <!-- 여신한도 -->
					  , F_CREDIT_LOAN_PRDTGRP('C', A.CLNT_CD, A.CO_CD,A.PRDT_GRP, TO_CHAR(LAST_DAY(TO_DATE(REPLACE(#{baseDt},'-',''), 'YYYYMMDD')), 'YYYYMMDD'),0) AS CRDT_LOAN 
	
		         FROM (
		            SELECT
		                   CO_CD
				         , CLNT_NM
				         , PRDT_GRP
				         , PRJCT_CD
						 , SELL_PAY_DIV_CD
				  	     , SELL_CLMN_DIV_CD
				  	     , SELL_PMNT_MTD_CD
			  		     , SELL_VAT_CD
			  		     , TAXIVC_COPRT
			  		     , SELL_CLMN_DAY
						 , ETRDPS_YM
						 , CLOSE_YM
						 , CLNT_CD
						 , SUM(BASIS_AMT)          AS BASIS_AMT          <!-- 당월 기초 -->
						 , SUM(CLMN_AMT)           AS CLMN_AMT           <!-- 당월입금 -->
						 , SUM(TOT_AMT)            AS TOT_AMT            <!-- 당월 매출채권 -->
	<!-- 					 , SUM(TRMEND_AMT)         AS TRMEND_AMT         당월기말 -->
						 , SUM(BFR_BASIS_AMT)      AS BFR_BASIS_AMT      <!-- 전월기초 -->
						 , SUM(CLOSE_YM1_CLMN_AMT) AS CLOSE_YM1_CLMN_AMT <!-- 전월수금 -->
					     , SUM(CLOSE_YM1_TOT_AMT)  AS CLOSE_YM1_TOT_AMT  <!-- 전월매출 -->
						 , SUM(CLOSE_YM1)          AS CLOSE_YM1          <!-- 전월기말	 -->		      
						 , SUM(BASIS_CREDIT_AMT)   AS BASIS_CREDIT_AMT   <!-- 전전월기초 -->
						 , SUM(CLOSE_YM2_CLMN_AMT) AS CLOSE_YM2_CLMN_AMT <!-- 전전월수금 -->
						 , SUM(CLOSE_YM2_TOT_AMT)  AS CLOSE_YM2_TOT_AMT  <!-- 전전월매출 -->
						 , SUM(CLOSE_YM2)          AS CLOSE_YM2
				        FROM (
							SELECT  1 AS TYPE1  <!--- 당월 입금 -->
						     , AR05.CO_CD
				             , BM02.CLNT_NM
				             , AR05.PRDT_GRP
						     , NVL(AR05.PRJCT_CD,0) AS PRJCT_CD
						     , BM02.SELL_PAY_DIV_CD
				  		     , NVL(AR05.SELL_CLMN_DIV_CD, BM02.SELL_CLMN_DIV_CD) AS SELL_CLMN_DIV_CD
				  		     , NVL(AR05.SELL_PMNT_MTD_CD, BM02.SELL_PMNT_MTD_CD) AS SELL_PMNT_MTD_CD
				  		     , BM02.SELL_VAT_CD
				  		     , M01.TAXIVC_COPRT AS TAXIVC_COPRT
				  		     , NVL(AR05.SELL_CLMN_DAY, BM02.SELL_CLMN_DAY) AS SELL_CLMN_DAY
							 , SUBSTRING(AR05.ETRDPS_DT, 0, 6) ETRDPS_YM
							 , SUBSTRING(AR05.ETRDPS_DT, 0, 4) || '-' || SUBSTRING( AR05.ETRDPS_DT, 5,2) CLOSE_YM
							 , AR05.CLNT_CD
							 , 0 AS BASIS_AMT   <!--  당월 기초 -->
							 , SUM(AR05.ETRDPS_AMT) CLMN_AMT <!--- 당월입금 -->
							 , 0 AS TOT_AMT           <!-- 당월 매출채권 -->
							 , 0 AS TRMEND_AMT <!-- 당월기말 -->
							 , 0 AS BFR_BASIS_AMT  <!-- 전월기초 -->
							 , 0 AS CLOSE_YM1_CLMN_AMT   <!--전월수금 -->
						     , 0 AS CLOSE_YM1_TOT_AMT    <!--전월매출 -->
							 , 0 AS CLOSE_YM1   <!--  전월 기말	 -->		      
							 , 0 AS BASIS_CREDIT_AMT  <!-- 전전월기초 -->
							 , 0 AS CLOSE_YM2_CLMN_AMT   <!--전전월수금 -->
							 , 0 AS CLOSE_YM2_TOT_AMT    <!--전전월매출	 -->
							 , 0 AS CLOSE_YM2  <!-- 전전월기말 -->
						  FROM TB_AR05D02 AR05
						  INNER JOIN TB_AR05M01 M01 ON M01.CO_CD = AR05.CO_CD AND M01.ETRDPS_SEQ = AR05.ETRDPS_SEQ
						  LEFT JOIN TB_BM02M01 BM02 ON BM02.CLNT_CD = AR05.CLNT_CD 
						  WHERE 'SELPCH2' =  (SELECT NVL(CODE_RPRC,#{selpchCd}) FROM  TB_CM05M01 WHERE CODE_ID= M01.ETRDPS_TYP)
						  <if test="coCd != null and !coCd.equals('')">
						  AND AR05.CO_CD = #{coCd}				
						  </if>	
						  <if test="clntCd != null and !clntCd.equals('')">
						  AND AR05.CLNT_CD = #{clntCd}				
						  </if>			
						   <if test="baseDt != null and !baseDt.equals('')">
						  AND AR05.ETRDPS_DT BETWEEN TO_CHAR(TO_DATE(REPLACE(#{baseDt}, '-', ''),'YYYYMMDD'),'YYYYMM') ||'01'
						                         AND REPLACE(#{baseDt}, '-', '')
						  </if>
						  <if test="clntNm != null and !clntNm.equals('')">
						   AND BM02.CLNT_NM  LIKE '%' || #{clntNm} ||'%'
						  </if>
						  <if test="prdtGrp != null and !prdtGrp.equals('')">
						   AND AR05.PRDT_GRP = #{prdtGrp}
						  </if>
						  <if test="taxivcCoprt != null and !taxivcCoprt.equals('')">
						   AND M01.TAXIVC_COPRT = #{taxivcCoprt}
						  </if>
						  GROUP BY AR05.CO_CD, SUBSTRING(AR05.ETRDPS_DT, 0, 6), AR05.CLNT_CD,  SUBSTRING(AR05.ETRDPS_DT, 0, 4) || '-' || SUBSTRING(AR05.ETRDPS_DT, 5,2) 					  
				             , BM02.CLNT_NM
				             , AR05.PRDT_GRP
						     , NVL(AR05.PRJCT_CD,0)
						     , BM02.SELL_PAY_DIV_CD
				  		     , NVL(AR05.SELL_CLMN_DIV_CD, BM02.SELL_CLMN_DIV_CD)
				  		     , NVL(AR05.SELL_PMNT_MTD_CD, BM02.SELL_PMNT_MTD_CD)
				  		     , BM02.SELL_VAT_CD
				  		     , M01.TAXIVC_COPRT
				  		     , NVL(AR05.SELL_CLMN_DAY, BM02.SELL_CLMN_DAY)
				  		     , AR05.ETRDPS_SEQ
					   UNION ALL
						SELECT   2 AS TYPE1  <!--- 당월 매출 -->
						     , AR02.CO_CD
				             , BM02.CLNT_NM
				             , (SELECT PRDT_GRP FROM TB_BM01M01 BM01 WHERE BM01.PRDT_CD = AR02.TRST_PRDT_CD ) AS PRDT_GRP
						     , AR02.PRJCT_CD
						     , SELL_PAY_DIV_CD
				  		     , NVL(SD05.CLMN_DIV_CD, SELL_CLMN_DIV_CD) AS SELL_CLMN_DIV_CD
				  		     , NVL(SD05.PMNT_MTD_CD, SELL_PMNT_MTD_CD) AS SELL_PMNT_MTD_CD
				  		     , SELL_VAT_CD
				  		     , TAXIVC_COPRT
				  		     , NVL(SD05.CLMN_DAY, SELL_CLMN_DAY) AS SELL_CLMN_DAY
							 , SUBSTRING(TRST_DT, 0, 6) TRST_YM	
							 , SUBSTRING(TRST_DT, 0, 4) || '-' || SUBSTRING(TRST_DT, 5,2) CLOSE_YM	
							 , TRST_CLNT_CD AS CLNT_CD 
							 , 0 AS BASIS_AMT   <!--  당월 기초 -->
							 , 0 AS CLMN_AMT   <!-- 당월수금 -->
							 , SUM(NVL(BILG_AMT, 0 ) + NVL(BILG_VAT_AMT, 0)) AS TOT_AMT           <!-- 당월 매출채권 -->
							 , 0 AS TRMEND_AMT <!-- 당월기말 -->
							 , 0 AS BFR_BASIS_AMT  <!-- 전월기초 -->
							 , 0 AS CLOSE_YM1_CLMN_AMT   <!--전월수금 -->
						     , 0 AS CLOSE_YM1_TOT_AMT    <!--전월매출 -->
							 , 0 AS CLOSE_YM1   <!--  전월 기말 -->			      
							 , 0 AS BASIS_CREDIT_AMT  <!-- 전전월기초 -->
							 , 0 AS CLOSE_YM2_CLMN_AMT   <!--전전월수금 -->
							 , 0 AS CLOSE_YM2_TOT_AMT    <!--전전월매출	 -->
							 , 0 AS CLOSE_YM2  <!-- 전전월기말 -->
						  FROM TB_AR02M01 AR02
						  LEFT JOIN TB_BM02M01 BM02 ON BM02.CLNT_CD = AR02.TRST_CLNT_CD
						  LEFT JOIN TB_SD05M01 SD05 ON SD05.PRJCT_CD = AR02.PRJCT_CD
						  WHERE SELPCH_CD = 'SELPCH2'				  
						  <if test="coCd != null and !coCd.equals('')">
						  AND AR02.CO_CD = #{coCd}				
						  </if>	
						  <if test="clntCd != null and !clntCd.equals('')">
						  AND AR02.TRST_CLNT_CD = #{clntCd}				
						  </if>	
						  <if test="clntNm != null and !clntNm.equals('')">
						   AND BM02.CLNT_NM  LIKE '%' || #{clntNm} ||'%'
						  </if>			
						   <if test="baseDt != null and !baseDt.equals('')">
						   AND TRST_DT BETWEEN TO_CHAR(TO_DATE(REPLACE(#{baseDt}, '-', ''),'YYYYMMDD'),'YYYYMM') ||'01'
						                   AND REPLACE(#{baseDt}, '-', '')
						  </if> 
						  <if test="taxivcCoprt != null and !taxivcCoprt.equals('')">
						   AND AR02.TAXIVC_COPRT = #{taxivcCoprt}
						  </if>
						  <if test="prdtGrp != null and !prdtGrp.equals('')">
						   AND AR02.PRDT_DIV IN (SELECT DISTINCT PRDT_DIV
											FROM TB_BM01M01
										    WHERE PRDT_GRP = #{prdtGrp}
				  						   )
						  </if>
						  GROUP BY AR02.CO_CD, SUBSTRING(TRST_DT, 0, 6), TRST_CLNT_CD , SUBSTRING(TRST_DT, 0, 4) || '-' || SUBSTRING(TRST_DT, 5,2)
				             , BM02.CLNT_NM
				             , AR02.TRST_PRDT_CD
						     , AR02.PRJCT_CD
						     , SELL_PAY_DIV_CD
				  		     , NVL(SD05.CLMN_DIV_CD, SELL_CLMN_DIV_CD)
				  		     , NVL(SD05.PMNT_MTD_CD, SELL_PMNT_MTD_CD)
				  		     , SELL_VAT_CD
				  		     , TAXIVC_COPRT
				  		     , NVL(SD05.CLMN_DAY, SELL_CLMN_DAY)
						UNION  ALL
						  SELECT  3 AS TYPE1  <!--- 전월 매출 -->
						     , C.CO_CD
				             , BM02.CLNT_NM
				             , C.PRDT_GRP
						     , C.PRJCT_CD
						     , SELL_PAY_DIV_CD
				  		     , SELL_CLMN_DIV_CD
				  		     , SELL_PMNT_MTD_CD
				  		     , SELL_VAT_CD
				  		     , TAXIVC_COPRT
				  		     , SELL_CLMN_DAY
						     , SUBSTRING(REPLACE(#{baseDt}, '-', ''), 0, 6)  AS ETRDPS_YM
					         , SUBSTRING(REPLACE(#{baseDt}, '-', ''), 0, 4) || '-' || SUBSTRING(REPLACE(#{baseDt}, '-', ''), 5,2) CLOSE_YM
						     , C.CLNT_CD	
						     , SUM(DECODE(C.CLOSE_YM, TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -1), 'YYYYMM') ,NVL(C.TRMEND_CREDIT_AMT, 0)))  BASIS_AMT  <!-- 당월기초 -->
							 , 0 CLMN_AMT  <!-- 당월수금 -->
							 , 0 TOT_AMT   <!-- 당월매출 -->
							 , 0 TRMEND_AMT <!-- 당월기말 -->
						     , SUM(DECODE(C.CLOSE_YM, TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -1), 'YYYYMM') ,NVL(C.BASIS_CREDIT_AMT, 0)))  BFR_BASIS_AMT  <!-- 전월기초 -->
						     , SUM(DECODE(C.CLOSE_YM, TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -1), 'YYYYMM') ,NVL(C.CELL_CLMN_AMT, 0)))     CLOSE_YM1_CLMN_AMT   <!--전월수금 -->
						     , SUM(DECODE(C.CLOSE_YM, TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -1), 'YYYYMM') ,NVL(C.CELL_TOT_AMT, 0)))      CLOSE_YM1_TOT_AMT    <!--전월매출 -->
						     , SUM(DECODE(C.CLOSE_YM, TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -1), 'YYYYMM') ,NVL(C.TRMEND_CREDIT_AMT, 0))) CLOSE_YM1  <!-- 전월기말		 -->			      
						     , SUM(DECODE(C.CLOSE_YM, TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -2), 'YYYYMM') ,NVL(C.BASIS_CREDIT_AMT, 0)))  BASIS_CREDIT_AMT  <!-- 전전월기초 -->
						     , SUM(DECODE(C.CLOSE_YM, TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -2), 'YYYYMM') ,NVL(C.CELL_CLMN_AMT, 0)))     CLOSE_YM2_CLMN_AMT   <!--전전월수금 -->
						     , SUM(DECODE(C.CLOSE_YM, TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -2), 'YYYYMM') ,NVL(C.CELL_TOT_AMT, 0)))      CLOSE_YM2_TOT_AMT    <!--전전월매출 -->
						     , SUM(DECODE(C.CLOSE_YM, TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -2), 'YYYYMM') ,NVL(C.TRMEND_CREDIT_AMT, 0))) CLOSE_YM2  <!-- 전전월기말 -->
					  	 FROM TB_AR07M01 C
						  LEFT JOIN TB_BM02M01 BM02 ON BM02.CLNT_CD = C.CLNT_CD 
						  WHERE  1 = 1				  
							  <if test="selpchCd != null and !selpchCd.equals('')">
							  AND SELPCH_CD = #{selpchCd}				
							  </if>	
							  <if test="coCd != null and !coCd.equals('')">
							  AND C.CO_CD = #{coCd}				
							  </if>	
							  <if test="clntCd != null and !clntCd.equals('')">
							  AND C.CLNT_CD = #{clntCd}				
							  </if>	
							  <if test="clntNm != null and !clntNm.equals('')">
							   AND BM02.CLNT_NM  LIKE '%' || #{clntNm} ||'%'
							  </if>			
							  <if test="baseDt != null and !baseDt.equals('')">
							   AND  C.CLOSE_YM BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -2), 'YYYYMM')
						       		                 AND TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -1), 'YYYYMM')
			                  </if>
			                  <if test="taxivcCoprt != null and !taxivcCoprt.equals('')">
							   AND TAXIVC_COPRT = #{taxivcCoprt}
							  </if>
							  <if test="prdtGrp != null and !prdtGrp.equals('')">
							   AND PRDT_GRP = #{prdtGrp}
							  </if>
							
					    GROUP BY C.CO_CD
						     , C.CLNT_CD
				             , BM02.CLNT_NM
				             , C.PRDT_GRP
						     , C.PRJCT_CD
						     , SELL_PAY_DIV_CD
				  		     , SELL_CLMN_DIV_CD
				  		     , SELL_PMNT_MTD_CD
				  		     , SELL_VAT_CD
				  		     , TAXIVC_COPRT
				  		     , SELL_CLMN_DAY
				     )
				     GROUP BY
				   		   CO_CD
				         , CLNT_NM
				         , PRDT_GRP
				         , PRJCT_CD
						 , SELL_PAY_DIV_CD
				  	     , SELL_CLMN_DIV_CD
				  	     , SELL_PMNT_MTD_CD
			  		     , SELL_VAT_CD
			  		     , TAXIVC_COPRT
			  		     , SELL_CLMN_DAY
						 , ETRDPS_YM
						 , CLOSE_YM
						 , CLNT_CD
						 
						      
				) A
		)
	</select>
	
	<select id="selectMtClosCditList" resultType="CamelMap">
		SELECT
			*
		FROM
			(SELECT   ROWNUM AS RNUM
		              , A.*
		              , (SELECT CRN FROM TB_BM02M01 BM02M WHERE BM02M.CLNT_CD = A.CLNT_CD) CRN_NO
		  		      , FN_CM05M01_CD_TO_NM(A.CO_CD)  AS  CO_NM
		  		      , FN_CM05M01_CD_TO_NM(A.PRDT_GRP)  AS PRDT_GRP_NM
		  		      , (SELECT PRJCT_NM FROM  TB_SD05M01 SD05 WHERE SD05.PRJCT_CD = A.PRJCT_CD ) AS PRJCT_NM
		  		      , FN_CM05M01_CD_TO_NM(A.SELL_PAY_DIV_CD)  AS  SELL_PAY_DIV_NM
	    			  , FN_CM05M01_CD_TO_NM(A.SELL_CLMN_DIV_CD) AS  SELL_CLMN_DIV_NM
		              , FN_CM05M01_CD_TO_NM(A.SELL_PMNT_MTD_CD) AS  SELL_PMNT_MTD_NM
		              , FN_CM05M01_CD_TO_NM(A.SELL_VAT_CD)      AS  SELL_VAT_NM
		              , A.TAXIVC_COPRT
		              , FN_CM05M01_CD_TO_NM(A.TAXIVC_COPRT)      AS  TAXIVC_COPRT_NM
		              , BASIS_AMT + TOT_AMT - CLMN_AMT AS TRMEND_AMT	               
		              , F_CREDIT_LOAN2('T', A.CLNT_CD, A.CO_CD,A.PRDT_GRP, REPLACE(#{baseDt},'-',''),0) AS CRDT_LMT  <!-- 여신한도 -->
					  , F_CREDIT_LOAN2('C', A.CLNT_CD, A.CO_CD,A.PRDT_GRP, REPLACE(#{baseDt},'-',''),0) AS CRDT_LOAN 
	
		         FROM (
		            SELECT
		                   CO_CD
				         , CLNT_NM
				         , PRDT_GRP
				         , PRJCT_CD
						 , SELL_PAY_DIV_CD
				  	     , SELL_CLMN_DIV_CD
				  	     , SELL_PMNT_MTD_CD
			  		     , SELL_VAT_CD
			  		     , TAXIVC_COPRT
			  		     , SELL_CLMN_DAY
						 , ETRDPS_YM
						 , CLOSE_YM
						 , CLNT_CD
						 , SUM(BASIS_AMT)          AS BASIS_AMT          <!-- 당월 기초 -->
						 , SUM(CLMN_AMT)           AS CLMN_AMT           <!-- 당월입금 -->
						 , SUM(TOT_AMT)            AS TOT_AMT            <!-- 당월 매출채권 -->
	<!-- 					 , SUM(TRMEND_AMT)         AS TRMEND_AMT         당월기말 -->
						 , SUM(BFR_BASIS_AMT)      AS BFR_BASIS_AMT      <!-- 전월기초 -->
						 , SUM(CLOSE_YM1_CLMN_AMT) AS CLOSE_YM1_CLMN_AMT <!-- 전월수금 -->
					     , SUM(CLOSE_YM1_TOT_AMT)  AS CLOSE_YM1_TOT_AMT  <!-- 전월매출 -->
						 , SUM(CLOSE_YM1)          AS CLOSE_YM1          <!-- 전월기말	 -->		      
						 , SUM(BASIS_CREDIT_AMT)   AS BASIS_CREDIT_AMT   <!-- 전전월기초 -->
						 , SUM(CLOSE_YM2_CLMN_AMT) AS CLOSE_YM2_CLMN_AMT <!-- 전전월수금 -->
						 , SUM(CLOSE_YM2_TOT_AMT)  AS CLOSE_YM2_TOT_AMT  <!-- 전전월매출 -->
						 , SUM(CLOSE_YM2)          AS CLOSE_YM2
				        FROM (
							SELECT  1 AS TYPE1  <!--- 당월 입금 -->
						     , AR05.CO_CD
				             , BM02.CLNT_NM
				             , AR05.PRDT_GRP
						     , NVL(AR05.PRJCT_CD,0) AS PRJCT_CD
						     , BM02.SELL_PAY_DIV_CD
				  		     , NVL(AR05.SELL_CLMN_DIV_CD, BM02.SELL_CLMN_DIV_CD) AS SELL_CLMN_DIV_CD
				  		     , NVL(AR05.SELL_PMNT_MTD_CD, BM02.SELL_PMNT_MTD_CD) AS SELL_PMNT_MTD_CD
				  		     , BM02.SELL_VAT_CD
				  		     , M01.TAXIVC_COPRT AS TAXIVC_COPRT
				  		     , NVL(AR05.SELL_CLMN_DAY, BM02.SELL_CLMN_DAY) AS SELL_CLMN_DAY
							 , SUBSTRING(AR05.ETRDPS_DT, 0, 6) ETRDPS_YM
							 , SUBSTRING(AR05.ETRDPS_DT, 0, 4) || '-' || SUBSTRING(AR05.ETRDPS_DT, 5,2) CLOSE_YM
							 , AR05.CLNT_CD
							 , 0 AS BASIS_AMT   <!--  당월 기초 -->
							 , SUM(AR05.ETRDPS_AMT) CLMN_AMT <!--- 당월입금 -->
							 , 0 AS TOT_AMT           <!-- 당월 매출채권 -->
							 , 0 AS TRMEND_AMT <!-- 당월기말 -->
							 , 0 AS BFR_BASIS_AMT  <!-- 전월기초 -->
							 , 0 AS CLOSE_YM1_CLMN_AMT   <!--전월수금 -->
						     , 0 AS CLOSE_YM1_TOT_AMT    <!--전월매출 -->
							 , 0 AS CLOSE_YM1   <!--  전월 기말	 -->		      
							 , 0 AS BASIS_CREDIT_AMT  <!-- 전전월기초 -->
							 , 0 AS CLOSE_YM2_CLMN_AMT   <!--전전월수금 -->
							 , 0 AS CLOSE_YM2_TOT_AMT    <!--전전월매출	 -->
							 , 0 AS CLOSE_YM2  <!-- 전전월기말 -->
						  FROM TB_AR05D02 AR05
						  INNER JOIN TB_AR05M01 M01 ON M01.CO_CD = AR05.CO_CD AND M01.ETRDPS_SEQ = AR05.ETRDPS_SEQ
						  LEFT JOIN TB_BM02M01 BM02 ON BM02.CLNT_CD = AR05.CLNT_CD 
                          WHERE #{selpchCd} =  (SELECT NVL(CODE_RPRC,#{selpchCd}) FROM  TB_CM05M01 WHERE CODE_ID= M01.ETRDPS_TYP)
						 <!-- ETRDPS_TYP IN ('ETRDPS01','ETRDPS03','ETRDPS05')  --> 
						  AND  NVL(AR05.ETRDPS_AMT,0)<![CDATA[ != ]]> 0 					  					  
						  <if test="coCd != null and !coCd.equals('')">
						  AND AR05.CO_CD = #{coCd}				
						  </if>	
						  <if test="clntCd != null and !clntCd.equals('')">
						  AND AR05.CLNT_CD = #{clntCd}				
						  </if>			
						   <if test="baseDt != null and !baseDt.equals('')">
						  AND AR05.ETRDPS_DT BETWEEN  TO_CHAR(TO_DATE(REPLACE(#{baseDt}, '-', ''),'YYYYMMDD'),'YYYYMM') ||'01'
						                         AND  REPLACE(#{baseDt}, '-', '')
						  </if>
						  <if test="clntNm != null and !clntNm.equals('')">
						   AND BM02.CLNT_NM  LIKE '%' || #{clntNm} ||'%'
						  </if>
						  <if test="prdtGrp != null and !prdtGrp.equals('')">
						   AND AR05.PRDT_GRP = #{prdtGrp}
						  </if>
						  <if test="taxivcCoprt != null and !taxivcCoprt.equals('')">
						   AND M01.TAXIVC_COPRT = #{taxivcCoprt}
						  </if>
						  GROUP BY AR05.CO_CD, SUBSTRING(AR05.ETRDPS_DT, 0, 6), AR05.CLNT_CD,  SUBSTRING(AR05.ETRDPS_DT, 0, 4) || '-' || SUBSTRING(AR05.ETRDPS_DT, 5,2) 					  
				             , BM02.CLNT_NM
				             , AR05.PRDT_GRP
						     , NVL(AR05.PRJCT_CD,0)
						     , BM02.SELL_PAY_DIV_CD
				  		     , NVL(AR05.SELL_CLMN_DIV_CD, BM02.SELL_CLMN_DIV_CD)
				  		     , NVL(AR05.SELL_PMNT_MTD_CD, BM02.SELL_PMNT_MTD_CD)
				  		     , BM02.SELL_VAT_CD
				  		     , M01.TAXIVC_COPRT
				  		     , NVL(AR05.SELL_CLMN_DAY, BM02.SELL_CLMN_DAY)
				  		     , AR05.ETRDPS_SEQ
					   UNION ALL
						SELECT   2 AS TYPE1  <!--- 당월 매출 -->
						     , AR02.CO_CD
				             , BM02.CLNT_NM
				             , (SELECT PRDT_GRP FROM TB_BM01M01 BM01 WHERE BM01.PRDT_CD = AR02.TRST_PRDT_CD ) AS PRDT_GRP
						     , AR02.PRJCT_CD
						     , SELL_PAY_DIV_CD
				  		     , NVL(SD05.CLMN_DIV_CD, SELL_CLMN_DIV_CD) AS SELL_CLMN_DIV_CD
				  		     , NVL(SD05.PMNT_MTD_CD, SELL_PMNT_MTD_CD) AS SELL_PMNT_MTD_CD
				  		     , SELL_VAT_CD
				  		     , TAXIVC_COPRT
				  		     , NVL(SD05.CLMN_DAY, SELL_CLMN_DAY) AS SELL_CLMN_DAY
							 , SUBSTRING(TRST_DT, 0, 6) TRST_YM	
							 , SUBSTRING(TRST_DT, 0, 4) || '-' || SUBSTRING(TRST_DT, 5,2) CLOSE_YM	
							 , TRST_CLNT_CD AS CLNT_CD 
							 , 0 AS BASIS_AMT   <!--  당월 기초 -->
							 , 0 AS CLMN_AMT   <!-- 당월수금 -->
							 , SUM(NVL(BILG_AMT, 0 ) + NVL(BILG_VAT_AMT, 0)) AS TOT_AMT           <!-- 당월 매출채권 -->
							 , 0 AS TRMEND_AMT <!-- 당월기말 -->
							 , 0 AS BFR_BASIS_AMT  <!-- 전월기초 -->
							 , 0 AS CLOSE_YM1_CLMN_AMT   <!--전월수금 -->
						     , 0 AS CLOSE_YM1_TOT_AMT    <!--전월매출 -->
							 , 0 AS CLOSE_YM1   <!--  전월 기말 -->			      
							 , 0 AS BASIS_CREDIT_AMT  <!-- 전전월기초 -->
							 , 0 AS CLOSE_YM2_CLMN_AMT   <!--전전월수금 -->
							 , 0 AS CLOSE_YM2_TOT_AMT    <!--전전월매출	 -->
							 , 0 AS CLOSE_YM2  <!-- 전전월기말 -->
						  FROM TB_AR02M01 AR02
						  LEFT JOIN TB_BM02M01 BM02 ON BM02.CLNT_CD = AR02.TRST_CLNT_CD
						  LEFT JOIN TB_SD05M01 SD05 ON SD05.PRJCT_CD = AR02.PRJCT_CD
						  WHERE 1 = 1				  
						  <if test="selpchCd != null and !selpchCd.equals('')">
						  AND SELPCH_CD = #{selpchCd}				
						  </if>				  
						  <if test="coCd != null and !coCd.equals('')">
						  AND AR02.CO_CD = #{coCd}				
						  </if>	
						  <if test="clntCd != null and !clntCd.equals('')">
						  AND AR02.TRST_CLNT_CD = #{clntCd}				
						  </if>	
						  <if test="clntNm != null and !clntNm.equals('')">
						   AND BM02.CLNT_NM  LIKE '%' || #{clntNm} ||'%'
						  </if>			
						   <if test="baseDt != null and !baseDt.equals('')">
						   AND TRST_DT  BETWEEN  TO_CHAR(TO_DATE(REPLACE(#{baseDt}, '-', ''),'YYYYMMDD'),'YYYYMM') ||'01'
						                    AND  REPLACE(#{baseDt}, '-', '')
						  </if>
						  <if test="taxivcCoprt != null and !taxivcCoprt.equals('')">
						   AND AR02.TAXIVC_COPRT = #{taxivcCoprt}
						  </if>
						  <if test="prdtGrp != null and !prdtGrp.equals('')">
						   AND AR02.PRDT_DIV IN (SELECT DISTINCT PRDT_DIV
											FROM TB_BM01M01
										    WHERE PRDT_GRP = #{prdtGrp}
				  						   )
						  </if>
						  GROUP BY AR02.CO_CD, SUBSTRING(TRST_DT, 0, 6), TRST_CLNT_CD , SUBSTRING(TRST_DT, 0, 4) || '-' || SUBSTRING(TRST_DT, 5,2)
				             , BM02.CLNT_NM
				             , AR02.TRST_PRDT_CD
						     , AR02.PRJCT_CD
						     , SELL_PAY_DIV_CD
				  		     , NVL(SD05.CLMN_DIV_CD, SELL_CLMN_DIV_CD)
				  		     , NVL(SD05.PMNT_MTD_CD, SELL_PMNT_MTD_CD)
				  		     , SELL_VAT_CD
				  		     , TAXIVC_COPRT
				  		     , NVL(SD05.CLMN_DAY, SELL_CLMN_DAY)
						UNION  ALL
						  SELECT  3 AS TYPE1  <!--- 전월 매출 -->
						     , C.CO_CD
				             , BM02.CLNT_NM
				             , C.PRDT_GRP
						     , C.PRJCT_CD
						     , SELL_PAY_DIV_CD
				  		     , SELL_CLMN_DIV_CD
				  		     , SELL_PMNT_MTD_CD
				  		     , SELL_VAT_CD
				  		     , TAXIVC_COPRT
				  		     , SELL_CLMN_DAY
						     , SUBSTRING(REPLACE(#{baseDt}, '-', ''), 0, 6) AS ETRDPS_YM
					         , SUBSTRING(REPLACE(#{baseDt}, '-', ''), 0, 4) || '-' || SUBSTRING(REPLACE(#{baseDt}, '-', ''), 5,2) CLOSE_YM
						     , C.CLNT_CD	
						     , SUM(DECODE(C.CLOSE_YM, TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -1), 'YYYYMM') ,NVL(C.TRMEND_CREDIT_AMT, 0)))  BASIS_AMT  <!-- 당월기초 -->
							 , 0 CLMN_AMT  <!-- 당월수금 -->
							 , 0 TOT_AMT   <!-- 당월매출 -->
							 , 0 TRMEND_AMT <!-- 당월기말 -->
						     , SUM(DECODE(C.CLOSE_YM, TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -1), 'YYYYMM') ,NVL(C.BASIS_CREDIT_AMT, 0)))  BFR_BASIS_AMT  <!-- 전월기초 -->
						     , SUM(DECODE(C.CLOSE_YM, TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -1), 'YYYYMM') ,NVL(C.CELL_CLMN_AMT, 0)))     CLOSE_YM1_CLMN_AMT   <!--전월수금 -->
						     , SUM(DECODE(C.CLOSE_YM, TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -1), 'YYYYMM') ,NVL(C.CELL_TOT_AMT, 0)))      CLOSE_YM1_TOT_AMT    <!--전월매출 -->
						     , SUM(DECODE(C.CLOSE_YM, TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -1), 'YYYYMM') ,NVL(C.TRMEND_CREDIT_AMT, 0))) CLOSE_YM1  <!-- 전월기말		 -->			      
						     , SUM(DECODE(C.CLOSE_YM, TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -2), 'YYYYMM') ,NVL(C.BASIS_CREDIT_AMT, 0)))  BASIS_CREDIT_AMT  <!-- 전전월기초 -->
						     , SUM(DECODE(C.CLOSE_YM, TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -2), 'YYYYMM') ,NVL(C.CELL_CLMN_AMT, 0)))     CLOSE_YM2_CLMN_AMT   <!--전전월수금 -->
						     , SUM(DECODE(C.CLOSE_YM, TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -2), 'YYYYMM') ,NVL(C.CELL_TOT_AMT, 0)))      CLOSE_YM2_TOT_AMT    <!--전전월매출 -->
						     , SUM(DECODE(C.CLOSE_YM, TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -2), 'YYYYMM') ,NVL(C.TRMEND_CREDIT_AMT, 0))) CLOSE_YM2  <!-- 전전월기말 -->
					  	 FROM TB_AR07M01 C
						  LEFT JOIN TB_BM02M01 BM02 ON BM02.CLNT_CD = C.CLNT_CD 
						  WHERE 1 = 1				  
							  <if test="selpchCd != null and !selpchCd.equals('')">
							  AND SELPCH_CD = #{selpchCd}				
							  </if>				  
							  <if test="coCd != null and !coCd.equals('')">
							  AND C.CO_CD = #{coCd}				
							  </if>	
							  <if test="clntCd != null and !clntCd.equals('')">
							  AND C.CLNT_CD = #{clntCd}				
							  </if>	
							  <if test="clntNm != null and !clntNm.equals('')">
							   AND BM02.CLNT_NM  LIKE '%' || #{clntNm} ||'%'
							  </if>			
							  <if test="closeYm != null and !closeYm.equals('')">
							   AND  C.CLOSE_YM BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -2), 'YYYYMM')
						       		               AND TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -1), 'YYYYMM')
			                  </if>
			                  <if test="taxivcCoprt != null and !taxivcCoprt.equals('')">
							   AND TAXIVC_COPRT = #{taxivcCoprt}
							  </if>
							  <if test="prdtGrp != null and !prdtGrp.equals('')">
							   AND PRDT_GRP = #{prdtGrp}
							  </if>
					    GROUP BY C.CO_CD
						     , C.CLNT_CD
				             , BM02.CLNT_NM
				             , C.PRDT_GRP
						     , C.PRJCT_CD
						     , SELL_PAY_DIV_CD
				  		     , SELL_CLMN_DIV_CD
				  		     , SELL_PMNT_MTD_CD
				  		     , SELL_VAT_CD
				  		     , TAXIVC_COPRT
				  		     , SELL_CLMN_DAY
				     )
				     GROUP BY
				   		   CO_CD
				         , CLNT_NM
				         , PRDT_GRP
				         , PRJCT_CD
						 , SELL_PAY_DIV_CD
				  	     , SELL_CLMN_DIV_CD
				  	     , SELL_PMNT_MTD_CD
			  		     , SELL_VAT_CD
			  		     , TAXIVC_COPRT
			  		     , SELL_CLMN_DAY
						 , ETRDPS_YM
						 , CLOSE_YM
						 , CLNT_CD
					ORDER BY CO_CD, CLNT_NM, PRDT_GRP, PRJCT_CD
						      
				) A
		)
	WHERE RNUM BETWEEN #{firstIndex} AND #{lastIndex}
	</select>

	<select id="selectMtClosCditPreCount" resultType="int">
		SELECT COUNT(*)
			FROM
			(
			  	  SELECT  C.CO_CD,
					      C.CLOSE_YM AS ETRDPS_YM,
				          SUBSTRING(C.CLOSE_YM, 0, 4) || '-' || SUBSTRING( C.CLOSE_YM, 5,2) CLOSE_YM,
					      C.CLNT_CD ,
					      BM02.CLNT_NM,
					      C.PRJCT_CD,
					      SELL_PAY_DIV_CD,
			  		      SELL_CLMN_DIV_CD,
			  		      SELL_PMNT_MTD_CD,
			  		      SELL_VAT_CD,
			  		      SELL_CLMN_DAY,
					      SUM(DECODE(C.CLOSE_YM, TO_CHAR(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'),'YYYYMM') ,NVL(C.BASIS_CREDIT_AMT, 0)))   BASIS_AMT,  <!-- 당월기초 -->
					      SUM(DECODE(C.CLOSE_YM, TO_CHAR(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), 'YYYYMM') ,NVL(C.CELL_CLMN_AMT, 0)))     CLMN_AMT,   <!-- 당월수금 -->
					      SUM(DECODE(C.CLOSE_YM, TO_CHAR(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), 'YYYYMM') ,NVL(C.CELL_TOT_AMT, 0)))      TOT_AMT,    <!-- 당월매출 -->
					      SUM(DECODE(C.CLOSE_YM, TO_CHAR(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), 'YYYYMM') ,NVL(C.TRMEND_CREDIT_AMT, 0))) TRMEND_AMT, <!-- 당월기말 -->
					      SUM(DECODE(C.CLOSE_YM, TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -1), 'YYYYMM') ,NVL(C.BASIS_CREDIT_AMT, 0)))  BFR_BASIS_AMT,  <!--전월기초 -->
					      SUM(DECODE(C.CLOSE_YM, TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -1), 'YYYYMM') ,NVL(C.CELL_CLMN_AMT, 0)))     CLOSE_YM1_CLMN_AMT,   <!---전월수금 -->
					      SUM(DECODE(C.CLOSE_YM, TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -1), 'YYYYMM') ,NVL(C.CELL_TOT_AMT, 0)))      CLOSE_YM1_TOT_AMT,    <!--전월매출 -->
					      SUM(DECODE(C.CLOSE_YM, TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -1), 'YYYYMM') ,NVL(C.TRMEND_CREDIT_AMT, 0))) CLOSE_YM1,  <!-- 전월기말	 -->				      
					      SUM(DECODE(C.CLOSE_YM, TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -2), 'YYYYMM') ,NVL(C.BASIS_CREDIT_AMT, 0)))  BASIS_CREDIT_AMT,  <!-- 전전월기초 -->
					      SUM(DECODE(C.CLOSE_YM, TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -2), 'YYYYMM') ,NVL(C.CELL_CLMN_AMT, 0)))     CLOSE_YM2_CLMN_AMT,   <!--전전월수금 -->
					      SUM(DECODE(C.CLOSE_YM, TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -2), 'YYYYMM') ,NVL(C.CELL_TOT_AMT, 0)))      CLOSE_YM2_TOT_AMT,    <!--전전월매출 -->
					      SUM(DECODE(C.CLOSE_YM, TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -2), 'YYYYMM') ,NVL(C.TRMEND_CREDIT_AMT, 0))) CLOSE_YM2  <!-- 전전월기말 -->
				  	 FROM TB_AR07M01 C
				  	 LEFT JOIN TB_BM02M01 BM02 ON BM02.CLNT_CD = C.CLNT_CD
				      WHERE 1 = 1				  
					  <if test="selpchCd != null and !selpchCd.equals('')">
					  AND SELPCH_CD = #{selpchCd}				
					  </if>					  
					   <if test="baseDt != null and !baseDt.equals('')">
					   AND C.CLOSE_YM BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -2), 'YYYYMM')
				       		              AND REPLACE(#{baseDt}, '-', '')	
					   </if>
					  <if test="clntNm != null and !clntNm.equals('')">
					   AND BM02.CLNT_NM  LIKE '%' || #{clntNm} ||'%'
					  </if>
					  <if test="coCd != null and !coCd.equals('')">
					  AND C.CO_CD = #{coCd}				
					  </if>	
					  <if test="clntCd != null and !clntCd.equals('')">
					  AND C.CLNT_CDD = #{clntCd}				
					  </if>
	                  <if test="taxivcCoprt != null and !taxivcCoprt.equals('')">
					   AND C.TAXIVC_COPRT = #{taxivcCoprt}
					  </if>
					  <if test="prdtGrp != null and !prdtGrp.equals('')">
					   AND PRDT_GRP = #{prdtGrp}
					  </if>
				    GROUP BY C.CO_CD,
					      C.CLOSE_YM ,
					      C.CLNT_CD ,
					      BM02.CLNT_NM,
					      C.PRJCT_CD,
					      SELL_PAY_DIV_CD,
			  		      SELL_CLMN_DIV_CD,
			  		      SELL_PMNT_MTD_CD,
			  		      SELL_VAT_CD,
			  		      SELL_CLMN_DAY
		) A
	</select>  
	
	<select id="selectMtCloseCditPreList" resultType="CamelMap">
	SELECT
		*
	FROM
	(
		SELECT
			ROWNUM AS RNUM, A.*
		 FROM (
			  SELECT  C.CO_CD
	  		        , FN_CM05M01_CD_TO_NM(C.CO_CD)  AS  CO_NM
				    , SUBSTRING(REPLACE(#{baseDt}, '-', ''), 0, 6) AS ETRDPS_YM
			        , SUBSTRING(REPLACE(#{baseDt}, '-', ''), 0, 4) || '-' || SUBSTRING(REPLACE(#{baseDt}, '-', ''), 5,2) CLOSE_YM
				    , C.CLNT_CD
				    , BM02.CLNT_NM
					, C.PRJCT_CD
					, (SELECT PRJCT_NM FROM TB_SD05M01 SD05 WHERE SD05.PRJCT_CD = C.PRJCT_CD  ) AS PRJCT_NM
					, C.PRDT_GRP
					, FN_CM05M01_CD_TO_NM(C.PRDT_GRP)  AS  PRDT_GRP_NM
				    , SELL_PAY_DIV_CD
		  		    , NVL(CLMN_DIV_CD,SELL_CLMN_DIV_CD) AS SELL_CLMN_DIV_CD
		  		    , NVL(PMNT_MTD_CD,SELL_PMNT_MTD_CD) AS SELL_PMNT_MTD_CD 
		  		    , SELL_VAT_CD
		  		    , NVL(CLMN_DAY,SELL_CLMN_DAY) AS SELL_CLMN_DAY
		  		    , FN_CM05M01_CD_TO_NM(BM02.SELL_PAY_DIV_CD)  AS  SELL_PAY_DIV_NM
           			, FN_CM05M01_CD_TO_NM(NVL(CLMN_DIV_CD,BM02.SELL_CLMN_DIV_CD)) AS  SELL_CLMN_DIV_NM
		            , FN_CM05M01_CD_TO_NM(NVL(PMNT_MTD_CD,BM02.SELL_PMNT_MTD_CD)) AS  SELL_PMNT_MTD_NM
		            , FN_CM05M01_CD_TO_NM(BM02.SELL_VAT_CD)      AS  SELL_VAT_NM
				    , SUM(DECODE(C.CLOSE_YM, TO_CHAR(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'),'YYYYMM') ,NVL(C.BASIS_CREDIT_AMT, 0)))   BASIS_AMT  <!-- 당월기초 -->
				    , SUM(DECODE(C.CLOSE_YM, TO_CHAR(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), 'YYYYMM') ,NVL(C.CELL_CLMN_AMT, 0)))     CLMN_AMT   <!-- 당월수금 -->
				    , SUM(DECODE(C.CLOSE_YM, TO_CHAR(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), 'YYYYMM') ,NVL(C.CELL_TOT_AMT, 0)))      TOT_AMT    <!-- 당월매출 -->
				    , SUM(DECODE(C.CLOSE_YM, TO_CHAR(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), 'YYYYMM') ,NVL(C.TRMEND_CREDIT_AMT, 0))) TRMEND_AMT <!-- 당월기말 -->
				    , SUM(DECODE(C.CLOSE_YM, TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -1), 'YYYYMM') ,NVL(C.BASIS_CREDIT_AMT, 0)))  BFR_BASIS_AMT  <!--전월기초 -->
				    , SUM(DECODE(C.CLOSE_YM, TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -1), 'YYYYMM') ,NVL(C.CELL_CLMN_AMT, 0)))     CLOSE_YM1_CLMN_AMT   <!---전월수금 -->
				    , SUM(DECODE(C.CLOSE_YM, TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -1), 'YYYYMM') ,NVL(C.CELL_TOT_AMT, 0)))      CLOSE_YM1_TOT_AMT    <!--전월매출 -->
				    , SUM(DECODE(C.CLOSE_YM, TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -1), 'YYYYMM') ,NVL(C.TRMEND_CREDIT_AMT, 0))) CLOSE_YM1  <!-- 전월기말	 -->				      
				    , SUM(DECODE(C.CLOSE_YM, TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -2), 'YYYYMM') ,NVL(C.BASIS_CREDIT_AMT, 0)))  BASIS_CREDIT_AMT  <!-- 전전월기초 -->
				    , SUM(DECODE(C.CLOSE_YM, TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -2), 'YYYYMM') ,NVL(C.CELL_CLMN_AMT, 0)))     CLOSE_YM2_CLMN_AMT   <!--전전월수금 -->
				    , SUM(DECODE(C.CLOSE_YM, TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -2), 'YYYYMM') ,NVL(C.CELL_TOT_AMT, 0)))      CLOSE_YM2_TOT_AMT    <!--전전월매출 -->
				    , SUM(DECODE(C.CLOSE_YM, TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -2), 'YYYYMM') ,NVL(C.TRMEND_CREDIT_AMT, 0))) CLOSE_YM2  <!-- 전전월기말 -->
				    , F_CREDIT_LOAN_PRDTGRP('T',C.CLNT_CD,C.CO_CD,C.PRDT_GRP,TO_CHAR(LAST_DAY(TO_DATE(REPLACE(#{baseDt},'-',''), 'YYYYMMDD')), 'YYYYMMDD'),0) AS CRDT_LMT  <!-- 여신한도 -->
			        , F_CREDIT_LOAN_PRDTGRP('C',C.CLNT_CD,C.CO_CD,C.PRDT_GRP,TO_CHAR(LAST_DAY(TO_DATE(REPLACE(#{baseDt},'-',''), 'YYYYMMDD')), 'YYYYMMDD'),0) AS CRDT_LOAN  	
			  	 FROM TB_AR07M01 C
			  	 LEFT JOIN TB_BM02M01 BM02 ON BM02.CLNT_CD  = C.CLNT_CD
			  	 LEFT JOIN TB_SD05M01 SD05 ON SD05.PRJCT_CD = C.PRJCT_CD
				 WHERE  1 = 1				  
					  <if test="selpchCd != null and !selpchCd.equals('')">
					  AND SELPCH_CD = #{selpchCd}				
					  </if>					  
				   <if test="baseDt != null and !baseDt.equals('')">
				   AND C.CLOSE_YM BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -2), 'YYYYMM')
			       		              AND REPLACE(#{baseDt}, '-', '')	
				   </if>
				  <if test="clntNm != null and !clntNm.equals('')">
				   AND BM02.CLNT_NM  LIKE '%' || #{clntNm} ||'%'
				  </if>
				  <if test="coCd != null and !coCd.equals('')">
				   AND C.CO_CD = #{coCd}				
				  </if>	
				  <if test="clntCd != null and !clntCd.equals('')">
				   AND C.CLNT_CDD = #{clntCd}				
				  </if>
                  <if test="taxivcCoprt != null and !taxivcCoprt.equals('')">
				   AND C.TAXIVC_COPRT = #{taxivcCoprt}
				  </if>
				  <if test="prdtGrp != null and !prdtGrp.equals('')">
				   AND C.PRDT_GRP = #{prdtGrp}
				  </if>
			    GROUP BY C.CO_CD,
				      C.CLNT_CD ,
				      BM02.CLNT_NM,
					  C.PRJCT_CD,
					  C.PRDT_GRP,
				      SELL_PAY_DIV_CD,
					  NVL(CLMN_DIV_CD,SELL_CLMN_DIV_CD),
		  		      NVL(PMNT_MTD_CD,SELL_PMNT_MTD_CD),
		  		      SELL_VAT_CD,
		  		      NVL(CLMN_DAY,SELL_CLMN_DAY)
		) A
	)
	WHERE RNUM BETWEEN #{firstIndex} AND #{lastIndex}
	</select>

	<select id="selectClosCditList" resultType="CamelMap">
	SELECT AR07.*
	      , CUR_CREDIT_AMT_T  - CUR_CREDIT_AMT  AS CUR_CREDIT_AMT_R
	      , PRE1_CREDIT_AMT_T - PRE1_CREDIT_AMT AS PRE1_CREDIT_AMT_R
	      , PRE2_CREDIT_AMT_T - PRE2_CREDIT_AMT AS PRE2_CREDIT_AMT_R
	      , PRE3_CREDIT_AMT_T - PRE3_CREDIT_AMT AS PRE3_CREDIT_AMT_R
	      , CUR_TRMEND_CREDIT_AMT_T - CUR_TRMEND_CREDIT_AMT AS CUR_TRMEND_CREDIT_AMT_R	
	      , (SELECT NAME FROM TB_CM06M01 WHERE ID = AR07.SALES_EMP_ID  ) AS SALES_EMP_NM
	      , (SELECT PRJCT_NM FROM TB_SD05M01 SD05 WHERE SD05.PRJCT_CD = AR07.PRJCT_CD  ) AS PRJCT_NM
	  	  , FN_CM05M01_CD_TO_NM(AR07.PRDT_GRP)  AS PRDT_GRP_NM
	      , FN_CM05M01_CD_TO_NM(AR07.CO_CD) AS CO_NM
		  , FN_CM05M01_CD_TO_NM(AR07.SELL_PAY_DIV_CD) AS SELL_PAY_DIV_NM
		  , FN_CM05M01_CD_TO_NM(AR07.SELL_CLMN_DIV_CD) AS SELL_CLMN_DIV_NM
		  , FN_CM05M01_CD_TO_NM(AR07.SELL_PMNT_MTD_CD) AS SELL_PMNT_MTD_NM
		  , FN_CM05M01_CD_TO_NM(AR07.SELL_VAT_CD) AS SELL_VAT_NM
		  , (SELECT SALES_EMP_ID FROM TB_BM02D01 BM02D01 WHERE BM02D01.CLNT_CD = AR07.CLNT_CD AND BM02D01.SALES_CO_CD = AR07.CO_CD AND BM02D01.USE_YN = 'Y' AND ROWNUM = 1 )  SALES_EMP_ID
	      , F_CREDIT_LOAN2('T',AR07.CLNT_CD,AR07.CO_CD,AR07.PRDT_GRP,TO_CHAR(LAST_DAY(TO_DATE(REPLACE(#{baseDt},'-',''), 'YYYYMMDD')), 'YYYYMMDD'),0) AS CRDT_LMT   -- 총여신금액
		  , F_CREDIT_LOAN2('C',AR07.CLNT_CD,AR07.CO_CD,AR07.PRDT_GRP,TO_CHAR(LAST_DAY(TO_DATE(REPLACE(#{baseDt},'-',''), 'YYYYMMDD')), 'YYYYMMDD'),0) AS CRDT_LOAN  -- 여신잔액
		  , NVL((SELECT SUM(ETRDPS_AMT) FROM TB_AR05M01 AR05 
		           INNER JOIN TB_AR05D01 AR05D  
		                 ON AR05D.CO_CD = AR05.CO_CD AND AR05D.CLNT_CD = AR05.CLNT_CD AND AR05D.BIL_NO = AR05.BIL_NO
		         WHERE AR05.ETRDPS_DT  <![CDATA[<= ]]>TO_CHAR(LAST_DAY(TO_DATE(REPLACE(#{baseDt},'-',''),'YYYYMMDD')),'YYYYMMDD')
		           AND AR05D.EXPRTN_DT <![CDATA[>  ]]>TO_CHAR(LAST_DAY(TO_DATE(REPLACE(#{baseDt},'-',''),'YYYYMMDD')),'YYYYMMDD')
		           AND AR05.CO_CD = AR07.CO_CD
		           AND AR05.CLNT_CD = AR07.CLNT_CD),0) AS UNSETL_BIL_AMT -- 미결제어음
		   ,(SELECT SUM(NVL(PLDG_AMT,0) /100 * NVL(PLDG_RCOGN_RATE,1)) 
		       FROM TB_BM02D02 BM02D02
		      WHERE BM02D02.CLNT_CD = AR07.CLNT_CD AND BM02D02.CO_CD = AR07.CO_CD AND BM02D02.USE_YN = 'Y'
		        AND NVL(EXPRTN_DT,TO_CHAR(LAST_DAY(TO_DATE(REPLACE(#{baseDt},'-',''),'YYYYMMDD')),'YYYYMMDD')) <![CDATA[<= ]]> TO_CHAR(LAST_DAY(TO_DATE(REPLACE(#{baseDt},'-',''),'YYYYMMDD')),'YYYYMMDD')) AS PLDG_AMT -- 담보금액
	FROM (
			SELECT CO_CD
				 , CLNT_CD 
            	 , CLNT_NM
            	 , CRN_NO
			     , PRDT_GRP
			     , PRJCT_CD
			     ,  (SELECT SALES_EMP_ID FROM TB_BM02D01 BM02D01 WHERE BM02D01.CLNT_CD = A.CLNT_CD AND BM02D01.SALES_CO_CD = A.CO_CD AND BM02D01.USE_YN = 'Y' AND ROWNUM = 1 )  SALES_EMP_ID
	  		     , SELL_CLMN_DAY
	   		     , SELL_CLMN_RMK
			     , SELL_PAY_DIV_CD
	  		     , SELL_CLMN_DIV_CD
	  		     , SELL_PMNT_MTD_CD
	  		     , SELL_VAT_CD
	  		     , SUM(DECODE(SUBSTRING(TRST_DT,0,6),TO_CHAR(ADD_MONTHS(TO_DATE(#{baseDt},'YYYYMMDD'),-0),'YYYYMM'), TOT_AMT,0)) AS CUR_CREDIT_AMT_T
	  		     , SUM(DECODE(SUBSTRING(TRST_DT,0,6),TO_CHAR(ADD_MONTHS(TO_DATE(#{baseDt},'YYYYMMDD'),-1),'YYYYMM'), TOT_AMT,0)) AS PRE1_CREDIT_AMT_T
	  		     , SUM(DECODE(SUBSTRING(TRST_DT,0,6),TO_CHAR(ADD_MONTHS(TO_DATE(#{baseDt},'YYYYMMDD'),-2),'YYYYMM'), TOT_AMT,0)) AS PRE2_CREDIT_AMT_T
	  		     , SUM(CASE WHEN TO_DATE(TRST_DT,'YYYYMMDD') <![CDATA[ <= ]]> LAST_DAY(ADD_MONTHS(TO_DATE(#{baseDt},'YYYYMMDD'),-3)) THEN TOT_AMT ELSE 0 END)  AS PRE3_CREDIT_AMT_T
	  		     , SUM(TOT_AMT) AS CUR_TRMEND_CREDIT_AMT_T
  		     
	  		     , SUM(DECODE(SUBSTRING(TRST_DT,0,6),TO_CHAR(ADD_MONTHS(TO_DATE(#{baseDt},'YYYYMMDD'),-0),'YYYYMM'), CASE WHEN PCHS_CLMN_DAY <![CDATA[  < ]]>  REPLACE(#{baseDt}, '-', '') THEN TOT_AMT ELSE 0 END,0)) AS CUR_CREDIT_AMT
	  		     , SUM(DECODE(SUBSTRING(TRST_DT,0,6),TO_CHAR(ADD_MONTHS(TO_DATE(#{baseDt},'YYYYMMDD'),-1),'YYYYMM'), CASE WHEN PCHS_CLMN_DAY <![CDATA[  < ]]>  REPLACE(#{baseDt}, '-', '') THEN TOT_AMT ELSE 0 END,0)) AS PRE1_CREDIT_AMT
	  		     , SUM(DECODE(SUBSTRING(TRST_DT,0,6),TO_CHAR(ADD_MONTHS(TO_DATE(#{baseDt},'YYYYMMDD'),-2),'YYYYMM'), CASE WHEN PCHS_CLMN_DAY <![CDATA[  < ]]>  REPLACE(#{baseDt}, '-', '') THEN TOT_AMT ELSE 0 END,0)) AS PRE2_CREDIT_AMT
	  		     , SUM(CASE WHEN TO_DATE(TRST_DT,'YYYYMMDD') <![CDATA[ <= ]]> LAST_DAY(ADD_MONTHS(TO_DATE(#{baseDt},'YYYYMMDD'),-3)) THEN 
	  		         CASE WHEN PCHS_CLMN_DAY <![CDATA[  < ]]>  REPLACE(#{baseDt}, '-', '') THEN TOT_AMT ELSE 0 END ELSE 0 END)  AS PRE3_CREDIT_AMT
	  		     , SUM(CASE WHEN PCHS_CLMN_DAY <![CDATA[  < ]]>  REPLACE(#{baseDt}, '-', '') THEN TOT_AMT ELSE 0 END) AS CUR_TRMEND_CREDIT_AMT
	  		     
			FROM (  SELECT 0 AS TYPE1 
				         , AR02.CO_CD
						 , TRST_CLNT_CD AS CLNT_CD 
		            	 , BM02.CLNT_NM
		            	 , BM02.CRN AS CRN_NO
		            	 , AR02.TRST_DT
		            	 , AR02.TRST_CERTI_NO
					     , CASE
					    	WHEN NVL(SD05.CLMN_DAY   ,NVL(BM02.SELL_CLMN_DAY,0))       = NVL(BM02.SELL_CLMN_DAY,0) 
					    	 AND NVL(SD05.CLMN_DIV_CD,NVL(BM02.SELL_CLMN_DIV_CD ,'@')) = NVL(BM02.SELL_CLMN_DIV_CD ,'@')
					    	 AND NVL(SD05.PMNT_MTD_CD,NVL(BM02.SELL_PMNT_MTD_CD ,'@')) = NVL(BM02.SELL_PMNT_MTD_CD ,'@')
					    	     THEN ''
					    	ELSE BM01.PRDT_GRP END
			               AS PRDT_GRP
					     , CASE
					    	WHEN NVL(SD05.CLMN_DAY   ,NVL(BM02.SELL_CLMN_DAY,0))       = NVL(BM02.SELL_CLMN_DAY,0) 
					    	 AND NVL(SD05.CLMN_DIV_CD,NVL(BM02.SELL_CLMN_DIV_CD ,'@')) = NVL(BM02.SELL_CLMN_DIV_CD ,'@')
					    	 AND NVL(SD05.PMNT_MTD_CD,NVL(BM02.SELL_PMNT_MTD_CD ,'@')) = NVL(BM02.SELL_PMNT_MTD_CD ,'@')
					    	     THEN 0
					    	ELSE AR02.PRJCT_CD END
					    	AS PRJCT_CD
			  		     , NVL(SD05.CLMN_DAY, BM02.SELL_CLMN_DAY) AS SELL_CLMN_DAY
			   		     , BM02.SELL_CLMN_RMK
					     , SELL_PAY_DIV_CD
			  		     , NVL(SD05.CLMN_DIV_CD, BM02.SELL_CLMN_DIV_CD) AS SELL_CLMN_DIV_CD
			  		     , NVL(SD05.PMNT_MTD_CD, BM02.SELL_PMNT_MTD_CD) AS SELL_PMNT_MTD_CD
			  		     , SELL_VAT_CD
			  		     , CASE
							    WHEN CM05M01.CODE_RPRC = 'MON' THEN TO_CHAR(LAST_DAY(ADD_MONTHS(TRUNC(TO_DATE(AR02.TRST_DT,'YYYYMMDD'),'MM'), NVL(CM05M01.CODE_ETC,0)) -1) + NVL(NVL(SD05.CLMN_DAY, BM02.SELL_CLMN_DAY) ,0), 'YYYYMMDD')
							   	WHEN CM05M01.CODE_RPRC = 'DAY' THEN TO_CHAR(TO_DATE(AR02.TRST_DT,'YYYYMMDD')+ NVL(NVL(SD05.CLMN_DAY, BM02.SELL_CLMN_DAY) ,0), 'YYYYMMDD')
						  END AS PCHS_CLMN_DAY
				         ,NVL(BILG_AMT, 0 ) + NVL(BILG_VAT_AMT, 0) - SUM(NVL(AR05D02.ETRDPS_AMT,0)) AS TOT_AMT  -- 매출채권금액
				         ,SUM(NVL(AR05D02.ETRDPS_AMT,0)) AS ETRDPS_AMT -- 수금금액
				  FROM TB_AR02M01 AR02
			 	  INNER JOIN TB_BM01M01 BM01 ON BM01.PRDT_CD  = AR02.TRST_PRDT_CD
				  INNER JOIN TB_BM02M01 BM02 ON BM02.CLNT_CD  = AR02.TRST_CLNT_CD
				   LEFT JOIN TB_SD05M01 SD05 ON SD05.PRJCT_CD = AR02.PRJCT_CD
				   LEFT JOIN TB_CM05M01 CM05M01 ON  NVL(SD05.CLMN_DIV_CD, BM02.SELL_CLMN_DIV_CD) = CM05M01.CODE_ID
				   LEFT JOIN TB_AR05D02 AR05D02 ON AR02.TRST_CERTI_NO = AR05D02.TRST_CERTI_NO AND AR05D02.ETRDPS_DT <![CDATA[  <= ]]>   REPLACE(#{baseDt},'-','')
				  WHERE  SELPCH_CD = 'SELPCH2'
 		  	       AND AR02.TRST_DT       <![CDATA[ <= ]]>  REPLACE(#{baseDt},'-','')		  	       
		  	       AND (AR02.ETRDPS_YN = 'N' OR 
		  	            AR02.TRST_CERTI_NO IN (SELECT DISTINCT D02.TRST_CERTI_NO FROM TB_AR05D02 D02 
		  	                                              WHERE D02.ETRDPS_DT   <![CDATA[  > ]]>  REPLACE(#{baseDt},'-','')))
		  	       <if test="coCd != null and !coCd.equals('')">
			       AND AR02.CO_CD = #{coCd}				
			       </if>	
			       <if test="clntCd != null and !clntCd.equals('')">
			        AND AR02.TRST_CLNT_CD = #{clntCd}				
			       </if>
			       <if test="clntNm != null and !clntNm.equals('')">
				    AND BM02.CLNT_NM  LIKE '%' || #{clntNm} ||'%'
				   </if>
			       <if test="taxivcCoprt != null and !taxivcCoprt.equals('')">
                    AND AR02.TAXIVC_COPRT = #{taxivcCoprt}
                   </if>
                   <if test="prdtGrp != null and !prdtGrp.equals('')">
                    AND BM01.PRDT_GRP = #{prdtGrp}
                   </if>
             GROUP BY AR02.CO_CD
						 , TRST_CLNT_CD
		            	 , BM02.CLNT_NM
		            	 , BM02.CRN
		            	 , AR02.TRST_DT
		            	 , AR02.TRST_CERTI_NO
					     , CASE
					    	WHEN NVL(SD05.CLMN_DAY   ,NVL(BM02.SELL_CLMN_DAY,0))       = NVL(BM02.SELL_CLMN_DAY,0) 
					    	 AND NVL(SD05.CLMN_DIV_CD,NVL(BM02.SELL_CLMN_DIV_CD ,'@')) = NVL(BM02.SELL_CLMN_DIV_CD ,'@')
					    	 AND NVL(SD05.PMNT_MTD_CD,NVL(BM02.SELL_PMNT_MTD_CD ,'@')) = NVL(BM02.SELL_PMNT_MTD_CD ,'@')
					    	     THEN ''
					    	ELSE BM01.PRDT_GRP END
					     , CASE
					    	WHEN NVL(SD05.CLMN_DAY   ,NVL(BM02.SELL_CLMN_DAY,0))       = NVL(BM02.SELL_CLMN_DAY,0) 
					    	 AND NVL(SD05.CLMN_DIV_CD,NVL(BM02.SELL_CLMN_DIV_CD ,'@')) = NVL(BM02.SELL_CLMN_DIV_CD ,'@')
					    	 AND NVL(SD05.PMNT_MTD_CD,NVL(BM02.SELL_PMNT_MTD_CD ,'@')) = NVL(BM02.SELL_PMNT_MTD_CD ,'@')
					    	     THEN 0
					    	ELSE AR02.PRJCT_CD END
			  		     , NVL(SD05.CLMN_DAY, BM02.SELL_CLMN_DAY)
			   		     , BM02.SELL_CLMN_RMK
					     , SELL_PAY_DIV_CD
			  		     , NVL(SD05.CLMN_DIV_CD, BM02.SELL_CLMN_DIV_CD)
			  		     , NVL(SD05.PMNT_MTD_CD, BM02.SELL_PMNT_MTD_CD)
			  		     , SELL_VAT_CD
			  		     , CASE
							    WHEN CM05M01.CODE_RPRC = 'MON' THEN TO_CHAR(LAST_DAY(ADD_MONTHS(TRUNC(TO_DATE(AR02.TRST_DT,'YYYYMMDD'),'MM'), NVL(CM05M01.CODE_ETC,0)) -1) + NVL(NVL(SD05.CLMN_DAY, BM02.SELL_CLMN_DAY) ,0), 'YYYYMMDD')
							   	WHEN CM05M01.CODE_RPRC = 'DAY' THEN TO_CHAR(TO_DATE(AR02.TRST_DT,'YYYYMMDD')+ NVL(NVL(SD05.CLMN_DAY, BM02.SELL_CLMN_DAY) ,0), 'YYYYMMDD')
						  END
				         ,NVL(BILG_AMT, 0 ) + NVL(BILG_VAT_AMT, 0)
			) A   
			WHERE TOT_AMT != 0			
<!-- 			  AND PCHS_CLMN_DAY <![CDATA[  < ]]>  REPLACE(#{baseDt}, '-', '') -->
			GROUP BY 
			       CO_CD
				 , CLNT_CD 
            	 , CLNT_NM
            	 , CRN_NO
			     , PRDT_GRP
			     , PRJCT_CD
	  		     , SELL_CLMN_DAY
	   		     , SELL_CLMN_RMK
			     , SELL_PAY_DIV_CD
	  		     , SELL_CLMN_DIV_CD
	  		     , SELL_PMNT_MTD_CD
	  		     , SELL_VAT_CD
<!-- 	  		     , CASE WHEN PCHS_CLMN_DAY <![CDATA[  < ]]>  REPLACE('20210907', '-', '') THEN 'Y' ELSE 'N' END -->
	     ) AR07
	   WHERE CUR_TRMEND_CREDIT_AMT != 0
       ORDER BY  CO_CD
								 , CLNT_CD 
				            	 , CLNT_NM
							     , PRDT_GRP
							     , PRJCT_CD
		       
	</select>
	
	
	
		<select id="selectEtrdpsSellList" resultType="CamelMap">
		SELECT
			*
		FROM
			(SELECT   ROWNUM AS RNUM
		              , A.*
		  		      , FN_CM05M01_CD_TO_NM(A.CO_CD)  AS  CO_NM
		  		      , FN_CM05M01_CD_TO_NM(A.PRDT_GRP)  AS PRDT_GRP_NM
		  		      , (SELECT PRJCT_NM FROM  TB_SD05M01 SD05 WHERE SD05.PRJCT_CD = A.PRJCT_CD ) AS PRJCT_NM
		  		      , FN_CM05M01_CD_TO_NM(A.SELL_PAY_DIV_CD)  AS  SELL_PAY_DIV_NM
	    			  , FN_CM05M01_CD_TO_NM(A.SELL_CLMN_DIV_CD) AS  SELL_CLMN_DIV_NM
		              , FN_CM05M01_CD_TO_NM(A.SELL_PMNT_MTD_CD) AS  SELL_PMNT_MTD_NM
		              , FN_CM05M01_CD_TO_NM(A.SELL_VAT_CD)      AS  SELL_VAT_NM
<!-- 		              , A.TAXIVC_COPRT -->
<!-- 		              , FN_CM05M01_CD_TO_NM(A.TAXIVC_COPRT)      AS  TAXIVC_COPRT_NM -->
		              , F_CREDIT_LOAN2('T', A.CLNT_CD, A.CO_CD, A.PRDT_GRP, REPLACE(#{baseDt},'-',''),0) AS CRDT_LMT  <!-- 여신한도 -->
					  , F_CREDIT_LOAN2('C', A.CLNT_CD, A.CO_CD, A.PRDT_GRP, REPLACE(#{baseDt},'-',''),0) AS CRDT_LOAN 
	                  , TOT_AMT - CLMN_AMT AS CUR_CREDIT_AMT <!-- 당월 채권 -->
	                  , CLOSE_YM1_TOT_AMT - CLOSE_YM1_CLMN_AMT AS CLOSE_YM1_CREDIT_AMT <!-- 전월 채권 -->
	                  , CLOSE_YM2_TOT_AMT - CLOSE_YM2_CLMN_AMT AS CLOSE_YM2_CREDIT_AMT <!-- 전전월 채권 -->
	                  , BASIS_CREDIT_AMT - ( ETRDPS_ALL_AMT - CLMN_AMT - CLOSE_YM1_CLMN_AMT - CLOSE_YM2_CLMN_AMT ) AS BASIS_CREDIT_CLNT_AMT <!-- 전전월 기초 채권 - 전전월 이전 입금 -->
                      , BASIS_AMT + TOT_AMT - CUR_CLMN_AMT AS TRMEND_AMT <!--  미수금총액  -->
                      , ETRDPS_ALL_AMT -  TOT_MATCH_AMT AS NOT_MAPPNG_AMT  <!--  매출과 매핑되지 않은 수금금액 -->
		         FROM (
		            SELECT
		                   CO_CD
				         , CLNT_NM
				         , MIN(PRDT_GRP) AS PRDT_GRP
				         , MIN(PRJCT_CD) AS PRJCT_CD
						 , SELL_PAY_DIV_CD
				  	     , SELL_CLMN_DIV_CD
				  	     , SELL_PMNT_MTD_CD
			  		     , SELL_VAT_CD
<!-- 			  		     , TAXIVC_COPRT -->
			  		     , DECODE(SELL_CLMN_DAY,0,'',SELL_CLMN_DAY) AS SELL_CLMN_DAY
<!-- 						 , ETRDPS_YM -->
<!-- 						 , CLOSE_YM -->
						 , CLNT_CD
						 , SUM(BASIS_AMT)          AS BASIS_AMT          <!-- 당월 기초 -->
						 , SUM(CLMN_AMT)           AS CLMN_AMT           <!-- 당월입금 -->
						 , SUM(TOT_AMT)            AS TOT_AMT            <!-- 당월 매출채권 -->
<!-- 	    				 , SUM(TRMEND_AMT)         AS TRMEND_AMT         당월기말 -->
						 , SUM(BFR_BASIS_AMT)      AS BFR_BASIS_AMT      <!-- 전월기초 -->
						 , SUM(CLOSE_YM1_CLMN_AMT) AS CLOSE_YM1_CLMN_AMT <!-- 전월수금 -->
					     , SUM(CLOSE_YM1_TOT_AMT)  AS CLOSE_YM1_TOT_AMT  <!-- 전월매출 -->
						 , SUM(CLOSE_YM1)          AS CLOSE_YM1          <!-- 전월기말	 -->		      
						 , SUM(BASIS_CREDIT_AMT)   AS BASIS_CREDIT_AMT   <!-- 전전월기초 -->
						 , SUM(CLOSE_YM2_CLMN_AMT) AS CLOSE_YM2_CLMN_AMT <!-- 전전월수금 -->
						 , SUM(CLOSE_YM2_TOT_AMT)  AS CLOSE_YM2_TOT_AMT  <!-- 전전월매출 -->
						 , SUM(CLOSE_YM2)          AS CLOSE_YM2          <!-- 전전월기말	 -->	
						 , SUM(ETRDPS_AMT)         AS ETRDPS_ALL_AMT     <!-- 전체 수금금액 -->
                         , SUM(CUR_CLMN_AMT)       AS CUR_CLMN_AMT       <!-- 입금일이 당월 금액 -->    
                         , SUM(TOT_MATCH_AMT)      AS TOT_MATCH_AMT      <!-- 전체 매칭금액 -->
				        FROM (
							SELECT  1 AS TYPE1  <!--- 당월 입금 -->
						     , AR05.CO_CD
				             , BM02.CLNT_NM
				             , CASE
							    	WHEN NVL(AR05.SELL_CLMN_DAY   ,NVL(BM02.SELL_CLMN_DAY,0))       = NVL(BM02.SELL_CLMN_DAY,0) 
							    	 AND NVL(AR05.SELL_CLMN_DIV_CD,NVL(BM02.SELL_CLMN_DIV_CD ,'@')) = NVL(BM02.SELL_CLMN_DIV_CD ,'@')
							    	 AND NVL(AR05.SELL_PMNT_MTD_CD,NVL(BM02.SELL_PMNT_MTD_CD ,'@')) = NVL(BM02.SELL_PMNT_MTD_CD ,'@')
				    	   		  THEN ''
				    		   ELSE  AR05.PRDT_GRP END 
				    		   AS PRDT_GRP 
				             , CASE
							    	WHEN NVL(AR05.SELL_CLMN_DAY   ,NVL(BM02.SELL_CLMN_DAY,0))       = NVL(BM02.SELL_CLMN_DAY,0) 
							    	 AND NVL(AR05.SELL_CLMN_DIV_CD,NVL(BM02.SELL_CLMN_DIV_CD ,'@')) = NVL(BM02.SELL_CLMN_DIV_CD ,'@')
							    	 AND NVL(AR05.SELL_PMNT_MTD_CD,NVL(BM02.SELL_PMNT_MTD_CD ,'@')) = NVL(BM02.SELL_PMNT_MTD_CD ,'@')
				    	   		  THEN 0
				    		   ELSE  NVL(AR05.PRJCT_CD,0) END 
				    		   AS PRJCT_CD
						     , BM02.SELL_PAY_DIV_CD
				  		     , NVL(AR05.SELL_CLMN_DIV_CD, BM02.SELL_CLMN_DIV_CD) AS SELL_CLMN_DIV_CD
				  		     , NVL(AR05.SELL_PMNT_MTD_CD, BM02.SELL_PMNT_MTD_CD) AS SELL_PMNT_MTD_CD
				  		     , BM02.SELL_VAT_CD
				  		     , M01.TAXIVC_COPRT AS TAXIVC_COPRT
				  		     , NVL(AR05.SELL_CLMN_DAY, BM02.SELL_CLMN_DAY) AS SELL_CLMN_DAY
							 , SUBSTRING(AR05.TRST_DT, 0, 6) ETRDPS_YM
							 , SUBSTRING(AR05.TRST_DT, 0, 4) || '-' || SUBSTRING(AR05.TRST_DT, 5,2) CLOSE_YM
							 , AR05.CLNT_CD
							 , 0 AS BASIS_AMT   <!--  당월 기초 -->
							 , SUM( DECODE(SUBSTRING(AR05.TRST_DT,0,6), SUBSTRING(REPLACE(#{baseDt}, '-', ''),0,6) ,NVL(AR05.ETRDPS_AMT, 0)))  AS CLMN_AMT <!--- 당월입금 -->		      
                             , 0 AS TOT_AMT           <!-- 당월 매출채권 -->
							 , 0 AS TRMEND_AMT <!-- 당월기말 -->
							 , 0 AS BFR_BASIS_AMT  <!-- 전월기초 -->
							 , SUM(DECODE(SUBSTRING(AR05.TRST_DT, 0, 6), TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -1), 'YYYYMM') ,NVL(AR05.ETRDPS_AMT, 0)))  AS CLOSE_YM1_CLMN_AMT   <!--전월수금 -->	      
                             , 0 AS CLOSE_YM1_TOT_AMT    <!--전월매출 -->
							 , 0 AS CLOSE_YM1   <!--  전월 기말	 -->		      
							 , 0 AS BASIS_CREDIT_AMT  <!-- 전전월기초 -->
							 , SUM(DECODE(SUBSTRING(AR05.TRST_DT, 0, 6), TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -2), 'YYYYMM') ,NVL(AR05.ETRDPS_AMT, 0)))  AS CLOSE_YM2_CLMN_AMT   <!--전전월수금 -->
                             , 0  AS CLOSE_YM2_TOT_AMT    <!--전전월매출     -->
							 , 0 AS CLOSE_YM2  <!-- 전전월기말 -->
							 , SUM(NVL(AR05.ETRDPS_AMT, 0))  AS ETRDPS_AMT   <!--전체 수금액 -->
                             , SUM(DECODE(SUBSTRING(AR05.ETRDPS_DT, 0, 6), SUBSTRING(REPLACE(#{baseDt}, '-', ''),0,6) ,NVL(AR05.ETRDPS_AMT, 0)))  AS CUR_CLMN_AMT <!--- 입금일이 당월입금 -->        
                             , SUM(DECODE(NVL(AR05.TRST_DT, 0),0,0 ,NVL(AR05.ETRDPS_AMT, 0)))  AS TOT_MATCH_AMT               	                 	      
						  FROM TB_AR05D02 AR05
						  INNER JOIN TB_AR05M01 M01 ON M01.CO_CD = AR05.CO_CD AND M01.ETRDPS_SEQ = AR05.ETRDPS_SEQ
						  LEFT JOIN TB_BM02M01 BM02 ON BM02.CLNT_CD = AR05.CLNT_CD 
						  WHERE #{selpchCd} =  (SELECT NVL(CODE_RPRC,#{selpchCd}) FROM  TB_CM05M01 WHERE CODE_ID= M01.ETRDPS_TYP)
						 <!-- ETRDPS_TYP IN ('ETRDPS01','ETRDPS03','ETRDPS05')  --> 
						  AND  NVL(AR05.ETRDPS_AMT,0)<![CDATA[ != ]]> 0 					  					  
						  <if test="coCd != null and !coCd.equals('')">
						  AND AR05.CO_CD = #{coCd}				
						  </if>	
						  <if test="clntCd != null and !clntCd.equals('')">
						  AND AR05.CLNT_CD = #{clntCd}				
						  </if>			
						   <if test="baseDt != null and !baseDt.equals('')">
						  AND AR05.ETRDPS_DT BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -2), 'YYYYMM') ||'01'
						       		             AND REPLACE(#{baseDt}, '-', '')
						  </if>
						  <if test="clntNm != null and !clntNm.equals('')">
						   AND BM02.CLNT_NM  LIKE '%' || #{clntNm} ||'%'
						  </if>
						  <if test="prdtGrp != null and !prdtGrp.equals('')">
						   AND AR05.PRDT_GRP = #{prdtGrp}
						  </if>
						  <if test="taxivcCoprt != null and !taxivcCoprt.equals('')">
						   AND M01.TAXIVC_COPRT = #{taxivcCoprt}
						  </if>
						  GROUP BY AR05.CO_CD, SUBSTRING(AR05.TRST_DT, 0, 6), AR05.CLNT_CD,  SUBSTRING(AR05.TRST_DT, 0, 4) || '-' || SUBSTRING(AR05.TRST_DT, 5,2) 					  
				             , BM02.CLNT_NM
				             , CASE
							    	WHEN NVL(AR05.SELL_CLMN_DAY   ,NVL(BM02.SELL_CLMN_DAY,0))       = NVL(BM02.SELL_CLMN_DAY,0) 
							    	 AND NVL(AR05.SELL_CLMN_DIV_CD,NVL(BM02.SELL_CLMN_DIV_CD ,'@')) = NVL(BM02.SELL_CLMN_DIV_CD ,'@')
							    	 AND NVL(AR05.SELL_PMNT_MTD_CD,NVL(BM02.SELL_PMNT_MTD_CD ,'@')) = NVL(BM02.SELL_PMNT_MTD_CD ,'@')
				    	   		  THEN ''
				    		   ELSE  AR05.PRDT_GRP END 
				             ,CASE
							    	WHEN NVL(AR05.SELL_CLMN_DAY   ,NVL(BM02.SELL_CLMN_DAY,0))       = NVL(BM02.SELL_CLMN_DAY,0) 
							    	 AND NVL(AR05.SELL_CLMN_DIV_CD,NVL(BM02.SELL_CLMN_DIV_CD ,'@')) = NVL(BM02.SELL_CLMN_DIV_CD ,'@')
							    	 AND NVL(AR05.SELL_PMNT_MTD_CD,NVL(BM02.SELL_PMNT_MTD_CD ,'@')) = NVL(BM02.SELL_PMNT_MTD_CD ,'@')
				    	   		  THEN 0
				    		   ELSE  NVL(AR05.PRJCT_CD,0) END 
						     , BM02.SELL_PAY_DIV_CD
				  		     , NVL(AR05.SELL_CLMN_DIV_CD, BM02.SELL_CLMN_DIV_CD)
				  		     , NVL(AR05.SELL_PMNT_MTD_CD, BM02.SELL_PMNT_MTD_CD)
				  		     , BM02.SELL_VAT_CD
				  		     , M01.TAXIVC_COPRT
				  		     , NVL(AR05.SELL_CLMN_DAY, BM02.SELL_CLMN_DAY)
					   UNION ALL
						SELECT   2 AS TYPE1  <!--- 당월 매출 -->
						     , AR02.CO_CD
				             , BM02.CLNT_NM
				             , CASE
									    WHEN NVL(SD05.CLMN_DAY   ,NVL(BM02.SELL_CLMN_DAY,0))       = NVL(BM02.SELL_CLMN_DAY,0) 
									     AND NVL(SD05.CLMN_DIV_CD,NVL(BM02.SELL_CLMN_DIV_CD ,'@')) = NVL(BM02.SELL_CLMN_DIV_CD ,'@')
									     AND NVL(SD05.PMNT_MTD_CD,NVL(BM02.SELL_PMNT_MTD_CD ,'@')) = NVL(BM02.SELL_PMNT_MTD_CD ,'@')
						    	   		  THEN ''
						    		   ELSE  BM01.PRDT_GRP END
						     AS PRDT_GRP 
				             ,CASE
							    	WHEN NVL(SD05.CLMN_DAY   ,NVL(BM02.SELL_CLMN_DAY,0))       = NVL(BM02.SELL_CLMN_DAY,0) 
							    	 AND NVL(SD05.CLMN_DIV_CD,NVL(BM02.SELL_CLMN_DIV_CD ,'@')) = NVL(BM02.SELL_CLMN_DIV_CD ,'@')
							    	 AND NVL(SD05.PMNT_MTD_CD,NVL(BM02.SELL_PMNT_MTD_CD ,'@')) = NVL(BM02.SELL_PMNT_MTD_CD ,'@')
				    	   		  THEN 0
				    		   ELSE  NVL(AR02.PRJCT_CD,0) END 
						       AS PRJCT_CD
						     , SELL_PAY_DIV_CD
				  		     , NVL(SD05.CLMN_DIV_CD, SELL_CLMN_DIV_CD) AS SELL_CLMN_DIV_CD
				  		     , NVL(SD05.PMNT_MTD_CD, SELL_PMNT_MTD_CD) AS SELL_PMNT_MTD_CD
				  		     , SELL_VAT_CD
				  		     , TAXIVC_COPRT
				  		     , NVL(SD05.CLMN_DAY, SELL_CLMN_DAY) AS SELL_CLMN_DAY
							 , SUBSTRING(TRST_DT, 0, 6) TRST_YM	
							 , SUBSTRING(TRST_DT, 0, 4) || '-' || SUBSTRING(TRST_DT, 5,2) CLOSE_YM	
							 , TRST_CLNT_CD AS CLNT_CD 
							 , 0 AS BASIS_AMT   <!--  당월 기초 -->
							 , 0 AS CLMN_AMT   <!-- 당월수금 -->
                             , SUM( DECODE(SUBSTRING(AR02.TRST_DT,0,6 ),SUBSTRING(REPLACE(#{baseDt}, '-', ''),0,6), NVL(BILG_AMT, 0 ) + NVL(BILG_VAT_AMT, 0),0)) AS TOT_AMT           <!-- 당월 매출채권 -->
							 , 0 AS TRMEND_AMT <!-- 당월기말 -->
							 , 0 AS BFR_BASIS_AMT  <!-- 전월기초 -->
							 , 0 AS CLOSE_YM1_CLMN_AMT   <!--전월수금 -->
                             , SUM( DECODE(SUBSTRING(AR02.TRST_DT,0,6 ),TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -1),'YYYYMM'), NVL(BILG_AMT, 0 ) + NVL(BILG_VAT_AMT, 0))) AS CLOSE_YM1_TOT_AMT    <!--전월매출 -->
							 , 0 AS CLOSE_YM1   <!--  전월 기말 -->			      
							 , 0 AS BASIS_CREDIT_AMT  <!-- 전전월기초 -->
							 , 0 AS CLOSE_YM2_CLMN_AMT   <!--전전월수금 -->
                             , SUM( DECODE(SUBSTRING(AR02.TRST_DT,0,6 ),TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -2),'YYYYMM'), NVL(BILG_AMT, 0 ) + NVL(BILG_VAT_AMT, 0)))  AS CLOSE_YM2_TOT_AMT    <!--전전월매출     -->
							 , 0 AS CLOSE_YM2  <!-- 전전월기말 -->
							 , 0 AS ETRDPS_AMT   <!--전체 수금액 -->
							 , 0 AS CUR_AMT   <!--  입금일이 당월 -->
							 , 0 AS TOT_MATCH_AMT
						  FROM TB_AR02M01 AR02
						  INNER JOIN TB_BM01M01 BM01 ON BM01.PRDT_CD = AR02.TRST_PRDT_CD 
						  LEFT JOIN TB_BM02M01 BM02 ON BM02.CLNT_CD = AR02.TRST_CLNT_CD
						  LEFT JOIN TB_SD05M01 SD05 ON SD05.PRJCT_CD = AR02.PRJCT_CD
						  WHERE 1 = 1				  
						  <if test="selpchCd != null and !selpchCd.equals('')">
						  AND SELPCH_CD = #{selpchCd}				
						  </if>				  
						  <if test="coCd != null and !coCd.equals('')">
						  AND AR02.CO_CD = #{coCd}				
						  </if>	
						  <if test="clntCd != null and !clntCd.equals('')">
						  AND AR02.TRST_CLNT_CD = #{clntCd}				
						  </if>	
						  <if test="clntNm != null and !clntNm.equals('')">
						   AND BM02.CLNT_NM  LIKE '%' || #{clntNm} ||'%'
						  </if>			
						   <if test="baseDt != null and !baseDt.equals('')">
                           AND TRST_DT  BETWEEN  TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -2), 'YYYYMM')||'01'
                                            AND  REPLACE(#{baseDt}, '-', '')
						  </if>
						  <if test="taxivcCoprt != null and !taxivcCoprt.equals('')">
						   AND AR02.TAXIVC_COPRT = #{taxivcCoprt}
						  </if>
						  <if test="prdtGrp != null and !prdtGrp.equals('')">
						   AND AR02.PRDT_DIV IN (SELECT DISTINCT PRDT_DIV
											FROM TB_BM01M01
										    WHERE PRDT_GRP = #{prdtGrp}
				  						   )
						  </if>
						  GROUP BY AR02.CO_CD, SUBSTRING(TRST_DT, 0, 6), TRST_CLNT_CD , SUBSTRING(TRST_DT, 0, 4) || '-' || SUBSTRING(TRST_DT, 5,2)
				             , BM02.CLNT_NM
				             , CASE
									    WHEN NVL(SD05.CLMN_DAY   ,NVL(BM02.SELL_CLMN_DAY,0))       = NVL(BM02.SELL_CLMN_DAY,0) 
									     AND NVL(SD05.CLMN_DIV_CD,NVL(BM02.SELL_CLMN_DIV_CD ,'@')) = NVL(BM02.SELL_CLMN_DIV_CD ,'@')
									     AND NVL(SD05.PMNT_MTD_CD,NVL(BM02.SELL_PMNT_MTD_CD ,'@')) = NVL(BM02.SELL_PMNT_MTD_CD ,'@')
						    	   		  THEN ''
						    		   ELSE  BM01.PRDT_GRP END
						     , CASE
							    	WHEN NVL(SD05.CLMN_DAY   ,NVL(BM02.SELL_CLMN_DAY,0))       = NVL(BM02.SELL_CLMN_DAY,0) 
							    	 AND NVL(SD05.CLMN_DIV_CD,NVL(BM02.SELL_CLMN_DIV_CD ,'@')) = NVL(BM02.SELL_CLMN_DIV_CD ,'@')
							    	 AND NVL(SD05.PMNT_MTD_CD,NVL(BM02.SELL_PMNT_MTD_CD ,'@')) = NVL(BM02.SELL_PMNT_MTD_CD ,'@')
				    	   		  THEN 0
				    		   ELSE  NVL(AR02.PRJCT_CD,0) END 
						     , SELL_PAY_DIV_CD
				  		     , NVL(SD05.CLMN_DIV_CD, SELL_CLMN_DIV_CD)
				  		     , NVL(SD05.PMNT_MTD_CD, SELL_PMNT_MTD_CD)
				  		     , SELL_VAT_CD
				  		     , TAXIVC_COPRT
				  		     , NVL(SD05.CLMN_DAY, SELL_CLMN_DAY)
						UNION ALL
						  SELECT  3 AS TYPE1  <!--- 전월 매출 -->
						     , C.CO_CD
				             , BM02.CLNT_NM
				             ,  CASE
							    	WHEN NVL(SD05.CLMN_DAY   ,NVL(BM02.SELL_CLMN_DAY,0))       = NVL(BM02.SELL_CLMN_DAY,0) 
							    	 AND NVL(SD05.CLMN_DIV_CD,NVL(BM02.SELL_CLMN_DIV_CD ,'@')) = NVL(BM02.SELL_CLMN_DIV_CD ,'@')
							    	 AND NVL(SD05.PMNT_MTD_CD,NVL(BM02.SELL_PMNT_MTD_CD ,'@')) = NVL(BM02.SELL_PMNT_MTD_CD ,'@')
						    	   		  THEN ''
						    		   ELSE  C.PRDT_GRP END 
						       PRDT_GRP
						     ,CASE
							    	WHEN NVL(SD05.CLMN_DAY   ,NVL(BM02.SELL_CLMN_DAY,0))       = NVL(BM02.SELL_CLMN_DAY,0) 
							    	 AND NVL(SD05.CLMN_DIV_CD,NVL(BM02.SELL_CLMN_DIV_CD ,'@')) = NVL(BM02.SELL_CLMN_DIV_CD ,'@')
							    	 AND NVL(SD05.PMNT_MTD_CD,NVL(BM02.SELL_PMNT_MTD_CD ,'@')) = NVL(BM02.SELL_PMNT_MTD_CD ,'@')
				    	   		  THEN 0
				    		   ELSE  NVL(C.PRJCT_CD,0) END 
				    		   AS PRJCT_CD
						     , SELL_PAY_DIV_CD
				  		     , SELL_CLMN_DIV_CD
				  		     , SELL_PMNT_MTD_CD
				  		     , SELL_VAT_CD
				  		     , TAXIVC_COPRT
				  		     , SELL_CLMN_DAY
						     , SUBSTRING(REPLACE(#{baseDt}, '-', ''),0,6) AS ETRDPS_YM
					         , SUBSTRING(REPLACE(#{baseDt}, '-', ''), 0, 4) || '-' || SUBSTRING(REPLACE(#{baseDt}, '-', ''), 5,2) CLOSE_YM
						     , C.CLNT_CD	
						     , SUM(DECODE(C.CLOSE_YM, TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -1), 'YYYYMM') ,NVL(C.TRMEND_CREDIT_AMT, 0)))  BASIS_AMT  <!-- 당월기초 -->
							 , 0 CLMN_AMT  <!-- 당월수금 -->
							 , 0 TOT_AMT   <!-- 당월매출 -->
							 , 0 TRMEND_AMT <!-- 당월기말 -->
						     , 0 AS  BFR_BASIS_AMT  <!-- 전월기초 -->
                             , 0 AS  CLOSE_YM1_CLMN_AMT   <!--전월수금 -->
                             , 0 AS  CLOSE_YM1_TOT_AMT    <!--전월매출 -->
						     , 0 AS  CLOSE_YM1  <!-- 전월기말		 -->			      
						     , SUM(DECODE(C.CLOSE_YM, TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -2), 'YYYYMM') ,NVL(C.BASIS_CREDIT_AMT, 0)))  BASIS_CREDIT_AMT  <!-- 전전월기초 -->
                             , 0 AS  CLOSE_YM2_CLMN_AMT   <!--전전월수금 -->
                             , 0 AS  CLOSE_YM2_TOT_AMT    <!--전전월매출 -->
						     , 0 AS  CLOSE_YM2  <!-- 전전월기말 -->
                             , 0 AS  ETRDPS_AMT   <!--전체 수금액 -->
                             , 0 AS  CUR_AMT   <!--  입금일이 당월 -->
							 , 0 AS TOT_MATCH_AMT
					  	 FROM TB_AR07M01 C
						  LEFT JOIN TB_BM02M01 BM02 ON BM02.CLNT_CD = C.CLNT_CD 
						  LEFT JOIN TB_SD05M01 SD05 ON SD05.PRJCT_CD = C.PRJCT_CD
						  WHERE 1 = 1				  
							  <if test="selpchCd != null and !selpchCd.equals('')">
							  AND SELPCH_CD = #{selpchCd}				
							  </if>				  
							  <if test="coCd != null and !coCd.equals('')">
							  AND C.CO_CD = #{coCd}				
							  </if>	
							  <if test="clntCd != null and !clntCd.equals('')">
							  AND C.CLNT_CD = #{clntCd}				
							  </if>	
							  <if test="clntNm != null and !clntNm.equals('')">
							   AND BM02.CLNT_NM  LIKE '%' || #{clntNm} ||'%'
							  </if>			
							  <if test="baseDt != null and !baseDt.equals('')">
							   AND  C.CLOSE_YM BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -2), 'YYYYMM')
                                                   AND TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -1), 'YYYYMM')
			                  </if>
			                  <if test="taxivcCoprt != null and !taxivcCoprt.equals('')">
							   AND TAXIVC_COPRT = #{taxivcCoprt}
							  </if>
							  <if test="prdtGrp != null and !prdtGrp.equals('')">
							   AND PRDT_GRP = #{prdtGrp}
							  </if>
					    GROUP BY C.CO_CD
						     , C.CLNT_CD
				             , BM02.CLNT_NM
				             ,  CASE
							    	WHEN NVL(SD05.CLMN_DAY   ,NVL(BM02.SELL_CLMN_DAY,0))       = NVL(BM02.SELL_CLMN_DAY,0) 
							    	 AND NVL(SD05.CLMN_DIV_CD,NVL(BM02.SELL_CLMN_DIV_CD ,'@')) = NVL(BM02.SELL_CLMN_DIV_CD ,'@')
							    	 AND NVL(SD05.PMNT_MTD_CD,NVL(BM02.SELL_PMNT_MTD_CD ,'@')) = NVL(BM02.SELL_PMNT_MTD_CD ,'@')
						    	   		  THEN ''
						    		   ELSE  C.PRDT_GRP END 
						     ,CASE
							    	WHEN NVL(SD05.CLMN_DAY   ,NVL(BM02.SELL_CLMN_DAY,0))       = NVL(BM02.SELL_CLMN_DAY,0) 
							    	 AND NVL(SD05.CLMN_DIV_CD,NVL(BM02.SELL_CLMN_DIV_CD ,'@')) = NVL(BM02.SELL_CLMN_DIV_CD ,'@')
							    	 AND NVL(SD05.PMNT_MTD_CD,NVL(BM02.SELL_PMNT_MTD_CD ,'@')) = NVL(BM02.SELL_PMNT_MTD_CD ,'@')
				    	   		  THEN 0
				    		   ELSE  NVL(C.PRJCT_CD,0) END 
						     , SELL_PAY_DIV_CD
				  		     , SELL_CLMN_DIV_CD
				  		     , SELL_PMNT_MTD_CD
				  		     , SELL_VAT_CD
				  		     , TAXIVC_COPRT
				  		     , SELL_CLMN_DAY
				     )
				     GROUP BY
				   		   CO_CD
				         , CLNT_NM
<!-- 				         , PRDT_GRP -->
<!-- 				         , PRJCT_CD -->
						 , SELL_PAY_DIV_CD
				  	     , SELL_CLMN_DIV_CD
				  	     , SELL_PMNT_MTD_CD
			  		     , SELL_VAT_CD
			  		   --  , TAXIVC_COPRT
			  		     , DECODE(SELL_CLMN_DAY,0,'',SELL_CLMN_DAY)
						 , CLNT_CD
						 
						      
				) A
		)
<!-- 	WHERE RNUM BETWEEN #{firstIndex} AND #{lastIndex} -->
	</select>
	
	
		<select id="selectPreMtClosCditCount" resultType="int">
		SELECT COUNT(*)
			FROM
			(SELECT   ROWNUM AS RNUM
		              , A.*
	
		         FROM (
		            SELECT
		                   CO_CD
				         , CLNT_NM
				         , PRDT_GRP
				         , PRJCT_CD
						 , SELL_PAY_DIV_CD
				  	     , SELL_CLMN_DIV_CD
				  	     , SELL_PMNT_MTD_CD
			  		     , SELL_VAT_CD
			  		     , TAXIVC_COPRT
			  		     , SELL_CLMN_DAY
						 , ETRDPS_YM
						 , CLOSE_YM
						 , CLNT_CD
<!-- 						 , SUM(BASIS_AMT)          AS BASIS_AMT          당월 기초 -->
						 , SUM(CLMN_AMT)           AS CLMN_AMT           <!-- 당월입금 -->
						 , SUM(TOT_AMT)            AS TOT_AMT            <!-- 당월 매출채권 -->
	<!-- 					 , SUM(TRMEND_AMT)         AS TRMEND_AMT         당월기말 -->
						 , SUM(BFR_BASIS_AMT)      AS BFR_BASIS_AMT      <!-- 전월기초 -->
						 , SUM(CLOSE_YM1_CLMN_AMT) AS CLOSE_YM1_CLMN_AMT <!-- 전월수금 -->
					     , SUM(CLOSE_YM1_TOT_AMT)  AS CLOSE_YM1_TOT_AMT  <!-- 전월매출 -->
<!-- 						 , SUM(CLOSE_YM1)          AS CLOSE_YM1          전월기말			       -->
						 , SUM(BASIS_CREDIT_AMT)   AS BASIS_CREDIT_AMT   <!-- 전전월기초 -->
						 , SUM(CLOSE_YM2_CLMN_AMT) AS CLOSE_YM2_CLMN_AMT <!-- 전전월수금 -->
						 , SUM(CLOSE_YM2_TOT_AMT)  AS CLOSE_YM2_TOT_AMT  <!-- 전전월매출 -->
						 , SUM(CLOSE_YM2)          AS CLOSE_YM2
				        FROM (
							SELECT  1 AS TYPE1  <!--- 당월 입금 -->
						     , AR05.CO_CD
				             , BM02.CLNT_NM
				             , AR05.PRDT_GRP
						     , NVL(AR05.PRJCT_CD,0) AS PRJCT_CD
						     , BM02.SELL_PAY_DIV_CD
				  		     , NVL(AR05.SELL_CLMN_DIV_CD, BM02.SELL_CLMN_DIV_CD) AS SELL_CLMN_DIV_CD
				  		     , NVL(AR05.SELL_PMNT_MTD_CD, BM02.SELL_PMNT_MTD_CD) AS SELL_PMNT_MTD_CD
				  		     , BM02.SELL_VAT_CD
				  		     , M01.TAXIVC_COPRT AS TAXIVC_COPRT
				  		     , NVL(AR05.SELL_CLMN_DAY, BM02.SELL_CLMN_DAY) AS SELL_CLMN_DAY
<!-- 							 , SUBSTRING(AR05.ETRDPS_DT, 0, 6) ETRDPS_YM -->
<!-- 							 , SUBSTRING(AR05.ETRDPS_DT, 0, 4) || '-' || SUBSTRING(AR05.ETRDPS_DT, 5,2) CLOSE_YM -->
						     , SUBSTRING(REPLACE(#{baseDt}, '-', ''), 0, 6) AS ETRDPS_YM
					         , SUBSTRING(REPLACE(#{baseDt}, '-', ''), 0, 4) || '-' || SUBSTRING(REPLACE(#{baseDt}, '-', ''), 5,2) CLOSE_YM
							 , AR05.CLNT_CD
							 , 0 AS BASIS_AMT   <!--  당월 기초 -->
							 , SUM(DECODE(SUBSTRING(AR05.ETRDPS_DT, 0, 6),SUBSTRING(REPLACE(#{baseDt}, '-', ''), 0, 6), AR05.ETRDPS_AMT,0)) CLMN_AMT <!--- 당월입금 -->
							 , 0 AS TOT_AMT           <!-- 당월 매출채권 -->
							 , 0 AS TRMEND_AMT <!-- 당월기말 -->
							 , 0 AS BFR_BASIS_AMT  <!-- 전월기초 -->
							 , SUM(DECODE(SUBSTRING(AR05.ETRDPS_DT, 0, 6),TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -1),'YYYYMM'), AR05.ETRDPS_AMT,0)) AS  CLOSE_YM1_CLMN_AMT   <!--전월수금 -->
						     , 0 AS CLOSE_YM1_TOT_AMT    <!--전월매출 -->
							 , 0 AS CLOSE_YM1   <!--  전월 기말	 -->		      
							 , 0 AS BASIS_CREDIT_AMT  <!-- 전전월기초 -->
							 , 0 AS CLOSE_YM2_CLMN_AMT   <!--전전월수금 -->
							 , 0 AS CLOSE_YM2_TOT_AMT    <!--전전월매출	 -->
							 , 0 AS CLOSE_YM2  <!-- 전전월기말 -->
						  FROM TB_AR05D02 AR05
						  INNER JOIN TB_AR05M01 M01 ON M01.CO_CD = AR05.CO_CD AND M01.ETRDPS_SEQ = AR05.ETRDPS_SEQ
						  LEFT JOIN TB_BM02M01 BM02 ON BM02.CLNT_CD = AR05.CLNT_CD 
                          WHERE #{selpchCd} =  (SELECT NVL(CODE_RPRC,#{selpchCd}) FROM  TB_CM05M01 WHERE CODE_ID= M01.ETRDPS_TYP)
						 <!-- ETRDPS_TYP IN ('ETRDPS01','ETRDPS03','ETRDPS05')  --> 
						  AND  NVL(AR05.ETRDPS_AMT,0)<![CDATA[ != ]]> 0 					  					  
						  <if test="coCd != null and !coCd.equals('')">
						  AND AR05.CO_CD = #{coCd}				
						  </if>	
						  <if test="clntCd != null and !clntCd.equals('')">
						  AND AR05.CLNT_CD = #{clntCd}				
						  </if>			
						   <if test="baseDt != null and !baseDt.equals('')">
						  AND AR05.ETRDPS_DT BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -1), 'YYYYMM')||'01'
						       		             AND REPLACE(#{baseDt}, '-', '')  		                 
						  </if>
						  <if test="clntNm != null and !clntNm.equals('')">
						   AND BM02.CLNT_NM  LIKE '%' || #{clntNm} ||'%'
						  </if>
						  <if test="prdtGrp != null and !prdtGrp.equals('')">
						   AND AR05.PRDT_GRP = #{prdtGrp}
						  </if>
						  <if test="taxivcCoprt != null and !taxivcCoprt.equals('')">
						   AND M01.TAXIVC_COPRT = #{taxivcCoprt}
						  </if>
						  GROUP BY AR05.CO_CD, AR05.CLNT_CD					  
				             , BM02.CLNT_NM
				             , AR05.PRDT_GRP
						     , NVL(AR05.PRJCT_CD,0)
						     , BM02.SELL_PAY_DIV_CD
				  		     , NVL(AR05.SELL_CLMN_DIV_CD, BM02.SELL_CLMN_DIV_CD)
				  		     , NVL(AR05.SELL_PMNT_MTD_CD, BM02.SELL_PMNT_MTD_CD)
				  		     , BM02.SELL_VAT_CD
				  		     , M01.TAXIVC_COPRT
				  		     , NVL(AR05.SELL_CLMN_DAY, BM02.SELL_CLMN_DAY)
<!-- 				  		     , AR05.ETRDPS_SEQ -->
					   UNION ALL
						SELECT   2 AS TYPE1  <!--- 당월 매출 -->
						     , AR02.CO_CD
				             , BM02.CLNT_NM
				             , (SELECT PRDT_GRP FROM TB_BM01M01 BM01 WHERE BM01.PRDT_CD = AR02.TRST_PRDT_CD ) AS PRDT_GRP
						     , AR02.PRJCT_CD
						     , SELL_PAY_DIV_CD
				  		     , NVL(SD05.CLMN_DIV_CD, SELL_CLMN_DIV_CD) AS SELL_CLMN_DIV_CD
				  		     , NVL(SD05.PMNT_MTD_CD, SELL_PMNT_MTD_CD) AS SELL_PMNT_MTD_CD
				  		     , SELL_VAT_CD
				  		     , TAXIVC_COPRT
				  		     , NVL(SD05.CLMN_DAY, SELL_CLMN_DAY) AS SELL_CLMN_DAY
<!-- 							 , SUBSTRING(TRST_DT, 0, 6) TRST_YM	 -->
<!-- 							 , SUBSTRING(TRST_DT, 0, 4) || '-' || SUBSTRING(TRST_DT, 5,2) CLOSE_YM	 -->
						     , SUBSTRING(REPLACE(#{baseDt}, '-', ''), 0, 6) AS ETRDPS_YM
					         , SUBSTRING(REPLACE(#{baseDt}, '-', ''), 0, 4) || '-' || SUBSTRING(REPLACE(#{baseDt}, '-', ''), 5,2) CLOSE_YM
							 , TRST_CLNT_CD AS CLNT_CD 
							 , 0 AS BASIS_AMT   <!--  당월 기초 -->
							 , 0 AS CLMN_AMT   <!-- 당월수금 -->
							 , SUM(DECODE(SUBSTRING(AR02.TRST_DT, 0, 6),SUBSTRING(REPLACE(#{baseDt}, '-', ''), 0, 6), NVL(BILG_AMT, 0 ) + NVL(BILG_VAT_AMT, 0),0)) AS TOT_AMT           <!-- 당월 매출채권 -->
							 , 0 AS TRMEND_AMT <!-- 당월기말 -->
							 , 0 AS BFR_BASIS_AMT  <!-- 전월기초 -->
							 , 0 AS CLOSE_YM1_CLMN_AMT   <!--전월수금 -->
						     , SUM(DECODE(SUBSTRING(AR02.TRST_DT, 0, 6),TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -1),'YYYYMM'), NVL(BILG_AMT, 0 ) + NVL(BILG_VAT_AMT, 0),0)) AS CLOSE_YM1_TOT_AMT    <!--전월매출 -->
							 , 0 AS CLOSE_YM1   <!--  전월 기말 -->			      
							 , 0 AS BASIS_CREDIT_AMT  <!-- 전전월기초 -->
							 , 0 AS CLOSE_YM2_CLMN_AMT   <!--전전월수금 -->
							 , 0 AS CLOSE_YM2_TOT_AMT    <!--전전월매출	 -->
							 , 0 AS CLOSE_YM2  <!-- 전전월기말 -->
						  FROM TB_AR02M01 AR02
						  LEFT JOIN TB_BM02M01 BM02 ON BM02.CLNT_CD = AR02.TRST_CLNT_CD
						  LEFT JOIN TB_SD05M01 SD05 ON SD05.PRJCT_CD = AR02.PRJCT_CD
						  WHERE 1 = 1				  
						  <if test="selpchCd != null and !selpchCd.equals('')">
						  AND SELPCH_CD = #{selpchCd}				
						  </if>				  
						  <if test="coCd != null and !coCd.equals('')">
						  AND AR02.CO_CD = #{coCd}				
						  </if>	
						  <if test="clntCd != null and !clntCd.equals('')">
						  AND AR02.TRST_CLNT_CD = #{clntCd}				
						  </if>	
						  <if test="clntNm != null and !clntNm.equals('')">
						   AND BM02.CLNT_NM  LIKE '%' || #{clntNm} ||'%'
						  </if>			
						   <if test="baseDt != null and !baseDt.equals('')">
						   AND TRST_DT BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -1), 'YYYYMM')||'01'
						       		       AND REPLACE(#{baseDt}, '-', '')
						  </if>
						  <if test="taxivcCoprt != null and !taxivcCoprt.equals('')">
						   AND AR02.TAXIVC_COPRT = #{taxivcCoprt}
						  </if>
						  <if test="prdtGrp != null and !prdtGrp.equals('')">
						   AND AR02.PRDT_DIV IN (SELECT DISTINCT PRDT_DIV
											FROM TB_BM01M01
										    WHERE PRDT_GRP = #{prdtGrp}
				  						   )
						  </if>
						  GROUP BY AR02.CO_CD, TRST_CLNT_CD
				             , BM02.CLNT_NM
				             , AR02.TRST_PRDT_CD
						     , AR02.PRJCT_CD
						     , SELL_PAY_DIV_CD
				  		     , NVL(SD05.CLMN_DIV_CD, SELL_CLMN_DIV_CD)
				  		     , NVL(SD05.PMNT_MTD_CD, SELL_PMNT_MTD_CD)
				  		     , SELL_VAT_CD
				  		     , TAXIVC_COPRT
				  		     , NVL(SD05.CLMN_DAY, SELL_CLMN_DAY)
						UNION  ALL
						  SELECT  3 AS TYPE1  <!--- 전월 매출 -->
						     , C.CO_CD
				             , BM02.CLNT_NM
				             , C.PRDT_GRP
						     , C.PRJCT_CD
						     , SELL_PAY_DIV_CD
				  		     , SELL_CLMN_DIV_CD
				  		     , SELL_PMNT_MTD_CD
				  		     , SELL_VAT_CD
				  		     , TAXIVC_COPRT
				  		     , SELL_CLMN_DAY
						     , SUBSTRING(REPLACE(#{baseDt}, '-', ''), 0, 6) AS ETRDPS_YM
					         , SUBSTRING(REPLACE(#{baseDt}, '-', ''), 0, 4) || '-' || SUBSTRING(REPLACE(#{baseDt}, '-', ''), 5,2) CLOSE_YM
						     , C.CLNT_CD	
						     , 0 BASIS_AMT  <!-- 당월기초 -->
							 , 0 CLMN_AMT   <!-- 당월수금 -->
							 , 0 TOT_AMT    <!-- 당월매출 -->
							 , 0 TRMEND_AMT <!-- 당월기말 -->
						     , SUM(DECODE(C.CLOSE_YM, TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -2), 'YYYYMM') ,NVL(C.TRMEND_CREDIT_AMT, 0))) AS  BFR_BASIS_AMT  <!-- 전월기초 -->
						     , 0 CLOSE_YM1_CLMN_AMT   <!-- 전월수금 -->
						     , 0 CLOSE_YM1_TOT_AMT    <!-- 전월매출 -->
						     , 0 CLOSE_YM1            <!-- 전월기말  -->			      
						     , SUM(DECODE(C.CLOSE_YM, TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -2), 'YYYYMM') ,NVL(C.BASIS_CREDIT_AMT, 0)))  BASIS_CREDIT_AMT     <!-- 전전월기초 -->
						     , SUM(DECODE(C.CLOSE_YM, TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -2), 'YYYYMM') ,NVL(C.CELL_CLMN_AMT, 0)))     CLOSE_YM2_CLMN_AMT   <!--전전월수금 -->
						     , SUM(DECODE(C.CLOSE_YM, TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -2), 'YYYYMM') ,NVL(C.CELL_TOT_AMT, 0)))      CLOSE_YM2_TOT_AMT    <!--전전월매출 -->
						     , SUM(DECODE(C.CLOSE_YM, TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -2), 'YYYYMM') ,NVL(C.TRMEND_CREDIT_AMT, 0))) CLOSE_YM2            <!-- 전전월기말 -->
					  	 FROM TB_AR07M01 C
						  LEFT JOIN TB_BM02M01 BM02 ON BM02.CLNT_CD = C.CLNT_CD 
						  WHERE 1 = 1				  
							  <if test="selpchCd != null and !selpchCd.equals('')">
							  AND SELPCH_CD = #{selpchCd}				
							  </if>				  
							  <if test="coCd != null and !coCd.equals('')">
							  AND C.CO_CD = #{coCd}				
							  </if>	
							  <if test="clntCd != null and !clntCd.equals('')">
							  AND C.CLNT_CD = #{clntCd}				
							  </if>	
							  <if test="clntNm != null and !clntNm.equals('')">
							   AND BM02.CLNT_NM  LIKE '%' || #{clntNm} ||'%'
							  </if>			
							  <if test="baseDt != null and !baseDt.equals('')">
							   AND  C.CLOSE_YM BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -2), 'YYYYMM')
						       		               AND TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -1), 'YYYYMM')
			                  </if>
			                  <if test="taxivcCoprt != null and !taxivcCoprt.equals('')">
							   AND TAXIVC_COPRT = #{taxivcCoprt}
							  </if>
							  <if test="prdtGrp != null and !prdtGrp.equals('')">
							   AND PRDT_GRP = #{prdtGrp}
							  </if>
					    GROUP BY C.CO_CD
						     , C.CLNT_CD
				             , BM02.CLNT_NM
				             , C.PRDT_GRP
						     , C.PRJCT_CD
						     , SELL_PAY_DIV_CD
				  		     , SELL_CLMN_DIV_CD
				  		     , SELL_PMNT_MTD_CD
				  		     , SELL_VAT_CD
				  		     , TAXIVC_COPRT
				  		     , SELL_CLMN_DAY
				     )
				     GROUP BY
				   		   CO_CD
				         , CLNT_NM
				         , PRDT_GRP
				         , PRJCT_CD
						 , SELL_PAY_DIV_CD
				  	     , SELL_CLMN_DIV_CD
				  	     , SELL_PMNT_MTD_CD
			  		     , SELL_VAT_CD
			  		     , TAXIVC_COPRT
			  		     , SELL_CLMN_DAY
						 , ETRDPS_YM
						 , CLOSE_YM
						 , CLNT_CD
						 
						      
				) A
		)
	</select>
	
	<select id="selectPreMtClosCditList" resultType="CamelMap">
		SELECT
			*
		FROM
			(SELECT   ROWNUM AS RNUM
		              , A.*
		              , (SELECT CRN FROM TB_BM02M01 BM02M WHERE BM02M.CLNT_CD = A.CLNT_CD) CRN_NO
		  		      , FN_CM05M01_CD_TO_NM(A.CO_CD)  AS  CO_NM
		  		      , FN_CM05M01_CD_TO_NM(A.PRDT_GRP)  AS PRDT_GRP_NM
		  		      , (SELECT PRJCT_NM FROM  TB_SD05M01 SD05 WHERE SD05.PRJCT_CD = A.PRJCT_CD ) AS PRJCT_NM
		  		      , FN_CM05M01_CD_TO_NM(A.SELL_PAY_DIV_CD)  AS  SELL_PAY_DIV_NM
	    			  , FN_CM05M01_CD_TO_NM(A.SELL_CLMN_DIV_CD) AS  SELL_CLMN_DIV_NM
		              , FN_CM05M01_CD_TO_NM(A.SELL_PMNT_MTD_CD) AS  SELL_PMNT_MTD_NM
		              , FN_CM05M01_CD_TO_NM(A.SELL_VAT_CD)      AS  SELL_VAT_NM
		              , A.TAXIVC_COPRT
		              , FN_CM05M01_CD_TO_NM(A.TAXIVC_COPRT)      AS  TAXIVC_COPRT_NM
		              , BFR_BASIS_AMT + CLOSE_YM1_TOT_AMT - CLOSE_YM1_CLMN_AMT + TOT_AMT - CLMN_AMT AS TRMEND_AMT <!--  전월기말 + 매출 - 수금 = 당월기말 -->    
		              , BFR_BASIS_AMT + CLOSE_YM1_TOT_AMT - CLOSE_YM1_CLMN_AMT AS CLOSE_YM1	   <!-- 전월기말 -->            
		              , F_CREDIT_LOAN_PRDTGRP('T', A.CLNT_CD, A.CO_CD,A.PRDT_GRP, REPLACE(#{baseDt},'-',''),0) AS CRDT_LMT  <!-- 여신한도 -->
					  , F_CREDIT_LOAN_PRDTGRP('C', A.CLNT_CD, A.CO_CD,A.PRDT_GRP, REPLACE(#{baseDt},'-',''),0) AS CRDT_LOAN 
	
		         FROM (
		            SELECT
		                   CO_CD
				         , CLNT_NM
				         , PRDT_GRP
				         , PRJCT_CD
						 , SELL_PAY_DIV_CD
				  	     , SELL_CLMN_DIV_CD
				  	     , SELL_PMNT_MTD_CD
			  		     , SELL_VAT_CD
			  		     , TAXIVC_COPRT
			  		     , SELL_CLMN_DAY
						 , ETRDPS_YM
						 , CLOSE_YM
						 , CLNT_CD
<!-- 						 , SUM(BASIS_AMT)          AS BASIS_AMT          당월 기초 -->
						 , SUM(CLMN_AMT)           AS CLMN_AMT           <!-- 당월입금 -->
						 , SUM(TOT_AMT)            AS TOT_AMT            <!-- 당월 매출채권 -->
	<!-- 					 , SUM(TRMEND_AMT)         AS TRMEND_AMT         당월기말 -->
						 , SUM(BFR_BASIS_AMT)      AS BFR_BASIS_AMT      <!-- 전월기초 -->
						 , SUM(CLOSE_YM1_CLMN_AMT) AS CLOSE_YM1_CLMN_AMT <!-- 전월수금 -->
					     , SUM(CLOSE_YM1_TOT_AMT)  AS CLOSE_YM1_TOT_AMT  <!-- 전월매출 -->
<!-- 						 , SUM(CLOSE_YM1)          AS CLOSE_YM1          전월기말			       -->
						 , SUM(BASIS_CREDIT_AMT)   AS BASIS_CREDIT_AMT   <!-- 전전월기초 -->
						 , SUM(CLOSE_YM2_CLMN_AMT) AS CLOSE_YM2_CLMN_AMT <!-- 전전월수금 -->
						 , SUM(CLOSE_YM2_TOT_AMT)  AS CLOSE_YM2_TOT_AMT  <!-- 전전월매출 -->
						 , SUM(CLOSE_YM2)          AS CLOSE_YM2
				        FROM (
							SELECT  1 AS TYPE1  <!--- 당월 입금 -->
						     , AR05.CO_CD
				             , BM02.CLNT_NM
				             , AR05.PRDT_GRP
						     , NVL(AR05.PRJCT_CD,0) AS PRJCT_CD
						     , BM02.SELL_PAY_DIV_CD
				  		     , NVL(AR05.SELL_CLMN_DIV_CD, BM02.SELL_CLMN_DIV_CD) AS SELL_CLMN_DIV_CD
				  		     , NVL(AR05.SELL_PMNT_MTD_CD, BM02.SELL_PMNT_MTD_CD) AS SELL_PMNT_MTD_CD
				  		     , BM02.SELL_VAT_CD
				  		     , M01.TAXIVC_COPRT AS TAXIVC_COPRT
				  		     , NVL(AR05.SELL_CLMN_DAY, BM02.SELL_CLMN_DAY) AS SELL_CLMN_DAY
<!-- 							 , SUBSTRING(AR05.ETRDPS_DT, 0, 6) ETRDPS_YM -->
<!-- 							 , SUBSTRING(AR05.ETRDPS_DT, 0, 4) || '-' || SUBSTRING(AR05.ETRDPS_DT, 5,2) CLOSE_YM -->
						     , SUBSTRING(REPLACE(#{baseDt}, '-', ''), 0, 6) AS ETRDPS_YM
					         , SUBSTRING(REPLACE(#{baseDt}, '-', ''), 0, 4) || '-' || SUBSTRING(REPLACE(#{baseDt}, '-', ''), 5,2) CLOSE_YM
							 , AR05.CLNT_CD
							 , 0 AS BASIS_AMT   <!--  당월 기초 -->
							 , SUM(DECODE(SUBSTRING(AR05.ETRDPS_DT, 0, 6),SUBSTRING(REPLACE(#{baseDt}, '-', ''), 0, 6), AR05.ETRDPS_AMT,0)) CLMN_AMT <!--- 당월입금 -->
							 , 0 AS TOT_AMT           <!-- 당월 매출채권 -->
							 , 0 AS TRMEND_AMT <!-- 당월기말 -->
							 , 0 AS BFR_BASIS_AMT  <!-- 전월기초 -->
							 , SUM(DECODE(SUBSTRING(AR05.ETRDPS_DT, 0, 6),TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -1),'YYYYMM'), AR05.ETRDPS_AMT,0)) AS  CLOSE_YM1_CLMN_AMT   <!--전월수금 -->
						     , 0 AS CLOSE_YM1_TOT_AMT    <!--전월매출 -->
							 , 0 AS CLOSE_YM1   <!--  전월 기말	 -->		      
							 , 0 AS BASIS_CREDIT_AMT  <!-- 전전월기초 -->
							 , 0 AS CLOSE_YM2_CLMN_AMT   <!--전전월수금 -->
							 , 0 AS CLOSE_YM2_TOT_AMT    <!--전전월매출	 -->
							 , 0 AS CLOSE_YM2  <!-- 전전월기말 -->
						  FROM TB_AR05D02 AR05
						  INNER JOIN TB_AR05M01 M01 ON M01.CO_CD = AR05.CO_CD AND M01.ETRDPS_SEQ = AR05.ETRDPS_SEQ
						  LEFT JOIN TB_BM02M01 BM02 ON BM02.CLNT_CD = AR05.CLNT_CD 
                          WHERE #{selpchCd} =  (SELECT NVL(CODE_RPRC,#{selpchCd}) FROM  TB_CM05M01 WHERE CODE_ID= M01.ETRDPS_TYP)
						 <!-- ETRDPS_TYP IN ('ETRDPS01','ETRDPS03','ETRDPS05')  --> 
						  AND  NVL(AR05.ETRDPS_AMT,0)<![CDATA[ != ]]> 0 					  					  
						  <if test="coCd != null and !coCd.equals('')">
						  AND AR05.CO_CD = #{coCd}				
						  </if>	
						  <if test="clntCd != null and !clntCd.equals('')">
						  AND AR05.CLNT_CD = #{clntCd}				
						  </if>			
						   <if test="baseDt != null and !baseDt.equals('')">
						  AND AR05.ETRDPS_DT BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -1), 'YYYYMM')||'01'
						       		             AND REPLACE(#{baseDt}, '-', '')	                 
						  </if>
						  <if test="clntNm != null and !clntNm.equals('')">
						   AND BM02.CLNT_NM  LIKE '%' || #{clntNm} ||'%'
						  </if>
						  <if test="prdtGrp != null and !prdtGrp.equals('')">
						   AND AR05.PRDT_GRP = #{prdtGrp}
						  </if>
						  <if test="taxivcCoprt != null and !taxivcCoprt.equals('')">
						   AND M01.TAXIVC_COPRT = #{taxivcCoprt}
						  </if>
						  GROUP BY AR05.CO_CD, AR05.CLNT_CD					  
				             , BM02.CLNT_NM
				             , AR05.PRDT_GRP
						     , NVL(AR05.PRJCT_CD,0)
						     , BM02.SELL_PAY_DIV_CD
				  		     , NVL(AR05.SELL_CLMN_DIV_CD, BM02.SELL_CLMN_DIV_CD)
				  		     , NVL(AR05.SELL_PMNT_MTD_CD, BM02.SELL_PMNT_MTD_CD)
				  		     , BM02.SELL_VAT_CD
				  		     , M01.TAXIVC_COPRT
				  		     , NVL(AR05.SELL_CLMN_DAY, BM02.SELL_CLMN_DAY)
<!-- 				  		     , AR05.ETRDPS_SEQ -->
					   UNION ALL
						SELECT   2 AS TYPE1  <!--- 당월 매출 -->
						     , AR02.CO_CD
				             , BM02.CLNT_NM
				             , (SELECT PRDT_GRP FROM TB_BM01M01 BM01 WHERE BM01.PRDT_CD = AR02.TRST_PRDT_CD ) AS PRDT_GRP
						     , AR02.PRJCT_CD
						     , SELL_PAY_DIV_CD
				  		     , NVL(SD05.CLMN_DIV_CD, SELL_CLMN_DIV_CD) AS SELL_CLMN_DIV_CD
				  		     , NVL(SD05.PMNT_MTD_CD, SELL_PMNT_MTD_CD) AS SELL_PMNT_MTD_CD
				  		     , SELL_VAT_CD
				  		     , TAXIVC_COPRT
				  		     , NVL(SD05.CLMN_DAY, SELL_CLMN_DAY) AS SELL_CLMN_DAY
<!-- 							 , SUBSTRING(TRST_DT, 0, 6) TRST_YM	 -->
<!-- 							 , SUBSTRING(TRST_DT, 0, 4) || '-' || SUBSTRING(TRST_DT, 5,2) CLOSE_YM	 -->
						     , SUBSTRING(REPLACE(#{baseDt}, '-', ''), 0, 6) AS ETRDPS_YM
					         , SUBSTRING(REPLACE(#{baseDt}, '-', ''), 0, 4) || '-' || SUBSTRING(REPLACE(#{baseDt}, '-', ''), 5,2) CLOSE_YM
							 , TRST_CLNT_CD AS CLNT_CD 
							 , 0 AS BASIS_AMT   <!--  당월 기초 -->
							 , 0 AS CLMN_AMT   <!-- 당월수금 -->
							 , SUM(DECODE(SUBSTRING(AR02.TRST_DT, 0, 6),SUBSTRING(REPLACE(#{baseDt}, '-', ''), 0, 6), NVL(BILG_AMT, 0 ) + NVL(BILG_VAT_AMT, 0),0)) AS TOT_AMT           <!-- 당월 매출채권 -->
							 , 0 AS TRMEND_AMT <!-- 당월기말 -->
							 , 0 AS BFR_BASIS_AMT  <!-- 전월기초 -->
							 , 0 AS CLOSE_YM1_CLMN_AMT   <!--전월수금 -->
						     , SUM(DECODE(SUBSTRING(AR02.TRST_DT, 0, 6),TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -1),'YYYYMM'), NVL(BILG_AMT, 0 ) + NVL(BILG_VAT_AMT, 0),0)) AS CLOSE_YM1_TOT_AMT    <!--전월매출 -->
							 , 0 AS CLOSE_YM1   <!--  전월 기말 -->			      
							 , 0 AS BASIS_CREDIT_AMT  <!-- 전전월기초 -->
							 , 0 AS CLOSE_YM2_CLMN_AMT   <!--전전월수금 -->
							 , 0 AS CLOSE_YM2_TOT_AMT    <!--전전월매출	 -->
							 , 0 AS CLOSE_YM2  <!-- 전전월기말 -->
						  FROM TB_AR02M01 AR02
						  LEFT JOIN TB_BM02M01 BM02 ON BM02.CLNT_CD = AR02.TRST_CLNT_CD
						  LEFT JOIN TB_SD05M01 SD05 ON SD05.PRJCT_CD = AR02.PRJCT_CD
						  WHERE 1 = 1				  
						  <if test="selpchCd != null and !selpchCd.equals('')">
						  AND SELPCH_CD = #{selpchCd}				
						  </if>				  
						  <if test="coCd != null and !coCd.equals('')">
						  AND AR02.CO_CD = #{coCd}				
						  </if>	
						  <if test="clntCd != null and !clntCd.equals('')">
						  AND AR02.TRST_CLNT_CD = #{clntCd}				
						  </if>	
						  <if test="clntNm != null and !clntNm.equals('')">
						   AND BM02.CLNT_NM  LIKE '%' || #{clntNm} ||'%'
						  </if>			
						   <if test="baseDt != null and !baseDt.equals('')">
						   AND TRST_DT BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -1), 'YYYYMM')||'01'
						       		       AND REPLACE(#{baseDt}, '-', '')
						  </if>
						  <if test="taxivcCoprt != null and !taxivcCoprt.equals('')">
						   AND AR02.TAXIVC_COPRT = #{taxivcCoprt}
						  </if>
						  <if test="prdtGrp != null and !prdtGrp.equals('')">
						   AND AR02.PRDT_DIV IN (SELECT DISTINCT PRDT_DIV
											FROM TB_BM01M01
										    WHERE PRDT_GRP = #{prdtGrp}
				  						   )
						  </if>
						  GROUP BY AR02.CO_CD, TRST_CLNT_CD
				             , BM02.CLNT_NM
				             , AR02.TRST_PRDT_CD
						     , AR02.PRJCT_CD
						     , SELL_PAY_DIV_CD
				  		     , NVL(SD05.CLMN_DIV_CD, SELL_CLMN_DIV_CD)
				  		     , NVL(SD05.PMNT_MTD_CD, SELL_PMNT_MTD_CD)
				  		     , SELL_VAT_CD
				  		     , TAXIVC_COPRT
				  		     , NVL(SD05.CLMN_DAY, SELL_CLMN_DAY)
						UNION  ALL
						  SELECT  3 AS TYPE1  <!--- 전월 매출 -->
						     , C.CO_CD
				             , BM02.CLNT_NM
				             , C.PRDT_GRP
						     , C.PRJCT_CD
						     , SELL_PAY_DIV_CD
				  		     , SELL_CLMN_DIV_CD
				  		     , SELL_PMNT_MTD_CD
				  		     , SELL_VAT_CD
				  		     , TAXIVC_COPRT
				  		     , SELL_CLMN_DAY
						     , SUBSTRING(REPLACE(#{baseDt}, '-', ''), 0, 6) AS ETRDPS_YM
					         , SUBSTRING(REPLACE(#{baseDt}, '-', ''), 0, 4) || '-' || SUBSTRING(REPLACE(#{baseDt}, '-', ''), 5,2) CLOSE_YM
						     , C.CLNT_CD	
						     , 0 BASIS_AMT  <!-- 당월기초 -->
							 , 0 CLMN_AMT   <!-- 당월수금 -->
							 , 0 TOT_AMT    <!-- 당월매출 -->
							 , 0 TRMEND_AMT <!-- 당월기말 -->
						     , SUM(DECODE(C.CLOSE_YM, TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -2), 'YYYYMM') ,NVL(C.TRMEND_CREDIT_AMT, 0))) AS  BFR_BASIS_AMT  <!-- 전월기초 -->
						     , 0 CLOSE_YM1_CLMN_AMT   <!-- 전월수금 -->
						     , 0 CLOSE_YM1_TOT_AMT    <!-- 전월매출 -->
						     , 0 CLOSE_YM1            <!-- 전월기말  -->			      
						     , SUM(DECODE(C.CLOSE_YM, TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -2), 'YYYYMM') ,NVL(C.BASIS_CREDIT_AMT, 0)))  BASIS_CREDIT_AMT  <!-- 전전월기초 -->
						     , SUM(DECODE(C.CLOSE_YM, TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -2), 'YYYYMM') ,NVL(C.CELL_CLMN_AMT, 0)))     CLOSE_YM2_CLMN_AMT   <!--전전월수금 -->
						     , SUM(DECODE(C.CLOSE_YM, TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -2), 'YYYYMM') ,NVL(C.CELL_TOT_AMT, 0)))      CLOSE_YM2_TOT_AMT    <!--전전월매출 -->
						     , SUM(DECODE(C.CLOSE_YM, TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -2), 'YYYYMM') ,NVL(C.TRMEND_CREDIT_AMT, 0))) CLOSE_YM2  <!-- 전전월기말 -->
					  	 FROM TB_AR07M01 C
						  LEFT JOIN TB_BM02M01 BM02 ON BM02.CLNT_CD = C.CLNT_CD 
						  WHERE 1 = 1				  
							  <if test="selpchCd != null and !selpchCd.equals('')">
							  AND SELPCH_CD = #{selpchCd}				
							  </if>				  
							  <if test="coCd != null and !coCd.equals('')">
							  AND C.CO_CD = #{coCd}				
							  </if>	
							  <if test="clntCd != null and !clntCd.equals('')">
							  AND C.CLNT_CD = #{clntCd}				
							  </if>	
							  <if test="clntNm != null and !clntNm.equals('')">
							   AND BM02.CLNT_NM  LIKE '%' || #{clntNm} ||'%'
							  </if>			
							  <if test="baseDt != null and !baseDt.equals('')">
							   AND  C.CLOSE_YM BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -2), 'YYYYMM')
						       		               AND TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt}, '-', ''), 'YYYYMMDD'), -1), 'YYYYMM')
			                  </if>
			                  <if test="taxivcCoprt != null and !taxivcCoprt.equals('')">
							   AND TAXIVC_COPRT = #{taxivcCoprt}
							  </if>
							  <if test="prdtGrp != null and !prdtGrp.equals('')">
							   AND PRDT_GRP = #{prdtGrp}
							  </if>
					    GROUP BY C.CO_CD
						     , C.CLNT_CD
				             , BM02.CLNT_NM
				             , C.PRDT_GRP
						     , C.PRJCT_CD
						     , SELL_PAY_DIV_CD
				  		     , SELL_CLMN_DIV_CD
				  		     , SELL_PMNT_MTD_CD
				  		     , SELL_VAT_CD
				  		     , TAXIVC_COPRT
				  		     , SELL_CLMN_DAY
				     )
				     GROUP BY
				   		   CO_CD
				         , CLNT_NM
				         , PRDT_GRP
				         , PRJCT_CD
						 , SELL_PAY_DIV_CD
				  	     , SELL_CLMN_DIV_CD
				  	     , SELL_PMNT_MTD_CD
			  		     , SELL_VAT_CD
			  		     , TAXIVC_COPRT
			  		     , SELL_CLMN_DAY
						 , ETRDPS_YM
						 , CLOSE_YM
						 , CLNT_CD
						 
						      
				) A
		)
	WHERE RNUM BETWEEN #{firstIndex} AND #{lastIndex}
	</select>


	<select id="selectClosCditList2" resultType="CamelMap">
	SELECT AR07.*, (SELECT NAME FROM TB_CM06M01 WHERE ID = AR07.SALES_EMP_ID  ) AS SALES_EMP_NM
	      , (SELECT PRJCT_NM FROM TB_SD05M01 SD05 WHERE SD05.PRJCT_CD = AR07.PRJCT_CD  ) AS PRJCT_NM
	  	  , FN_CM05M01_CD_TO_NM(AR07.PRDT_GRP)  AS PRDT_GRP_NM
	      ,F_CREDIT_LOAN2('T',AR07.CLNT_CD,AR07.CO_CD,AR07.PRDT_GRP,TO_CHAR(LAST_DAY(TO_DATE(REPLACE(#{baseDt},'-',''), 'YYYYMMDD')), 'YYYYMMDD'),0) AS CRDT_LMT    <!-- 총여신금액 -->
		  ,F_CREDIT_LOAN2('C',AR07.CLNT_CD,AR07.CO_CD,AR07.PRDT_GRP,TO_CHAR(LAST_DAY(TO_DATE(REPLACE(#{baseDt},'-',''), 'YYYYMMDD')), 'YYYYMMDD'),0) AS CRDT_LOAN    <!--여신잔액 -->
		  ,NVL((SELECT SUM(ETRDPS_AMT) FROM TB_AR05M01 AR05 
		           INNER JOIN TB_AR05D01 AR05D  
		                 ON AR05D.CO_CD = AR05.CO_CD AND AR05D.CLNT_CD = AR05.CLNT_CD AND AR05D.BIL_NO = AR05.BIL_NO
		         WHERE AR05.ETRDPS_DT  <![CDATA[<= ]]>TO_CHAR(LAST_DAY(TO_DATE(REPLACE(#{baseDt},'-',''),'YYYYMMDD')),'YYYYMMDD')
		           AND AR05D.EXPRTN_DT <![CDATA[>  ]]>TO_CHAR(LAST_DAY(TO_DATE(REPLACE(#{baseDt},'-',''),'YYYYMMDD')),'YYYYMMDD')
		           AND AR05.CO_CD = AR07.CO_CD
		           AND AR05.CLNT_CD = AR07.CLNT_CD),0) AS UNSETL_BIL_AMT   <!--미결제어음 -->
		   ,(SELECT SUM(NVL(PLDG_AMT,0) /100 * NVL(PLDG_RCOGN_RATE,1)) 
		       FROM TB_BM02D02 BM02D02
		      WHERE BM02D02.CLNT_CD = AR07.CLNT_CD AND BM02D02.CO_CD = AR07.CO_CD AND BM02D02.USE_YN = 'Y'
		        AND NVL(EXPRTN_DT,TO_CHAR(LAST_DAY(TO_DATE(REPLACE(#{baseDt},'-',''),'YYYYMMDD')),'YYYYMMDD')) <![CDATA[<= ]]> TO_CHAR(LAST_DAY(TO_DATE(REPLACE(#{baseDt},'-',''),'YYYYMMDD')),'YYYYMMDD')) AS PLDG_AMT  <!-- 담보금액 -->
		  ,(SELECT CRN FROM TB_BM02M01 BM02M WHERE BM02M.CLNT_CD = AR07.CLNT_CD) CRN_NO 
	FROM (
	
	    SELECT
	             A.CO_CD
		       , FN_CM05M01_CD_TO_NM(A.CO_CD) AS CO_NM
		       , A.CLNT_CD 
		       , A.CLNT_NM
		       , MIN(A.PRDT_GRP) AS PRDT_GRP
		       , MIN(A.PRJCT_CD) AS PRJCT_CD
		       , DECODE(A.SELL_CLMN_DAY,0,'',A.SELL_CLMN_DAY) AS SELL_CLMN_DAY
		       , A.SELL_CLMN_RMK
		       , A.SELL_PAY_DIV_CD
		       , FN_CM05M01_CD_TO_NM(A.SELL_PAY_DIV_CD) AS SELL_PAY_DIV_NM
		       , A.SELL_CLMN_DIV_CD
		       , FN_CM05M01_CD_TO_NM(A.SELL_CLMN_DIV_CD) AS SELL_CLMN_DIV_NM
		       , A.PMNT_MTD_CD
		       , FN_CM05M01_CD_TO_NM(A.PMNT_MTD_CD) AS SELL_PMNT_MTD_NM
		       , A.SELL_VAT_CD
		       , FN_CM05M01_CD_TO_NM(A.SELL_VAT_CD) AS SELL_VAT_NM
		       , (SELECT SALES_EMP_ID FROM TB_BM02D01 BM02D01 WHERE BM02D01.CLNT_CD = A.CLNT_CD AND BM02D01.SALES_CO_CD = A.CO_CD AND BM02D01.USE_YN = 'Y' AND ROWNUM = 1 )  SALES_EMP_ID
		       , PRE3_PCHS_CLMN_DAY  <!-- 3개월전 결제예정일 -->
			   , PRE2_PCHS_CLMN_DAY  <!-- 2개월전 결제예정일 -->
			   , PRE1_PCHS_CLMN_DAY  <!-- 1개월전 결제예정일 -->
			   , PRE0_PCHS_CLMN_DAY  <!-- 0개월전 결제예정일     -->  
		       , SUM(PRE3_TRMEND_AMT)        AS PRE3_TRMEND_AMT        <!-- 3개월전 채권잔액       -->
		       , SUM(PRE2_CELL_CLMN_AMT)     AS PRE2_CELL_CLMN_AMT     <!-- 2개월전 수금           -->
		       , SUM(PRE2_CELL_TOT_AMT)      AS PRE2_CELL_TOT_AMT      <!-- 2개월전 매출           -->
		       , SUM(PRE2_TRMEND_AMT)        AS PRE2_TRMEND_AMT        <!-- 2개월전 채권잔액      -->
		       , SUM(PRE1_CELL_CLMN_AMT)     AS PRE1_CELL_CLMN_AMT     <!-- 1개월전 수금           -->
		       , SUM(PRE1_CELL_TOT_AMT)      AS PRE1_CELL_TOT_AMT      <!-- 1개월전 매출           -->
		       , SUM(PRE1_TRMEND_AMT)        AS PRE1_TRMEND_AMT        <!-- 1개월전 채권잔액      -->
		       , SUM(CUR_CELL_TOT_AMT)       AS CUR_CELL_TOT_AMT       <!-- 현재월 매출            -->
 		       , SUM(CUR_CELL_CLMN_AMT)      AS CUR_CELL_CLMN_AMT      <!-- 현재월 수금            -->
		       , SUM(CUR_TRMEND_CREDIT_AMT)  AS CUR_TRMEND_CREDIT_AMT  <!-- 현재월 채권잔액      -->
	    
	    FROM (
				    SELECT 0 AS TYPE1  <!--  마감 자료 -->
				           ,AR07.CO_CD
					       ,AR07.CLNT_CD 
					       ,BM02.CLNT_NM
					       ,CASE
							    	WHEN NVL(SD05.CLMN_DAY   ,NVL(BM02.SELL_CLMN_DAY,0))       = NVL(BM02.SELL_CLMN_DAY,0) 
							    	 AND NVL(SD05.CLMN_DIV_CD,NVL(BM02.SELL_CLMN_DIV_CD ,'@')) = NVL(BM02.SELL_CLMN_DIV_CD ,'@')
							    	 AND NVL(SD05.PMNT_MTD_CD,NVL(BM02.SELL_PMNT_MTD_CD ,'@')) = NVL(BM02.SELL_PMNT_MTD_CD ,'@')
							    	     THEN ''
							    	ELSE AR07.PRDT_GRP END 
					        AS PRDT_GRP
					       ,CASE
							    	WHEN NVL(SD05.CLMN_DAY   ,NVL(BM02.SELL_CLMN_DAY,0))       = NVL(BM02.SELL_CLMN_DAY,0) 
							    	 AND NVL(SD05.CLMN_DIV_CD,NVL(BM02.SELL_CLMN_DIV_CD ,'@')) = NVL(BM02.SELL_CLMN_DIV_CD ,'@')
							    	 AND NVL(SD05.PMNT_MTD_CD,NVL(BM02.SELL_PMNT_MTD_CD ,'@')) = NVL(BM02.SELL_PMNT_MTD_CD ,'@')
							    	     THEN 0
							    	ELSE AR07.PRJCT_CD END 
							AS PRJCT_CD
					       ,NVL(SD05.CLMN_DAY, BM02.SELL_CLMN_DAY) AS SELL_CLMN_DAY
					       ,BM02.SELL_CLMN_RMK
					       ,BM02.SELL_PAY_DIV_CD
					       ,NVL(SD05.CLMN_DIV_CD, BM02.SELL_CLMN_DIV_CD) AS SELL_CLMN_DIV_CD
					       ,NVL(SD05.PMNT_MTD_CD, BM02.SELL_PMNT_MTD_CD) AS PMNT_MTD_CD
					       ,BM02.SELL_VAT_CD
					       ,CASE
						    	WHEN CM05M01.CODE_RPRC = 'MON' THEN TO_CHAR(LAST_DAY(ADD_MONTHS(TRUNC(ADD_MONTHS(TO_DATE(CLOSE_YM,'YYYYMM'),-1),'MM'), NVL(CM05M01.CODE_ETC,0)) -1) + NVL(SD05.CLMN_DAY, NVL(BM02.SELL_CLMN_DAY,0)), 'YYYYMMDD')
						    	WHEN CM05M01.CODE_RPRC = 'DAY' THEN TO_CHAR(TO_DATE(CLOSE_YM,'YYYYMM') + NVL(SD05.CLMN_DAY, NVL(BM02.SELL_CLMN_DAY,0)), 'YYYYMMDD')
							  END AS PRE3_PCHS_CLMN_DAY
						   ,'' AS PRE2_PCHS_CLMN_DAY
						   ,'' AS PRE1_PCHS_CLMN_DAY
						   ,'' AS PRE0_PCHS_CLMN_DAY    
					       ,SUM(AR07.BASIS_CREDIT_AMT)  AS PRE3_TRMEND_AMT      <!-- 3개월전 채권잔액  -->   
					       ,0 AS PRE2_CELL_CLMN_AMT    <!-- 2개월전 수금         -->
					       ,0 AS PRE2_CELL_TOT_AMT     <!-- 2개월전 매출     -->
					       ,0 AS PRE2_TRMEND_AMT       <!-- 2개월전 채권잔액        -->
					       ,0 AS PRE1_CELL_CLMN_AMT    <!-- 1개월전 수금          -->
					       ,0 AS PRE1_CELL_TOT_AMT     <!-- 1개월전 매출            -->
					       ,0 AS PRE1_TRMEND_AMT       <!-- 1개월전 채권잔액           -->
			 		       ,0 AS CUR_CELL_CLMN_AMT     <!-- 현재월 수금        -->
					       ,0 AS CUR_CELL_TOT_AMT      <!-- 현재월 매출        -->
					       ,0 AS CUR_TRMEND_CREDIT_AMT <!-- 현재월 채권잔액   -->
					FROM TB_AR07M01 AR07
					INNER JOIN TB_BM02M01 BM02
					        ON BM02.CLNT_CD = AR07.CLNT_CD
				    LEFT JOIN TB_SD05M01 SD05 ON SD05.PRJCT_CD = AR07.PRJCT_CD
				    LEFT JOIN TB_CM05M01 CM05M01 ON NVL(SD05.CLMN_DIV_CD, BM02.SELL_CLMN_DIV_CD) = CM05M01.CODE_ID
					WHERE CLOSE_YM BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt},'-',''),'YYYYMMDD'),-2),'YYYYMM') AND  SUBSTRING(REPLACE(#{baseDt},'-',''),0,6)
					<if test= "coCd != null and !coCd.equals('')">
					AND  AR07.CO_CD = #{coCd}
					</if>
					AND  AR07.SELPCH_CD = 'SELPCH2'
					<if test= "clntNm != null and !clntNm.equals('')">
					AND  BM02.CLNT_NM like '%'||#{clntNm} ||'%'
					</if>
					<if test= "clntCd != null and !clntCd.equals('')">
					AND  AR07.CLNT_CD = #{clntCd}
					</if>
					<if test="prdtGrp != null and !prdtGrp.equals('')">
					AND AR07.PRDT_GRP = #{prdtGrp}
					</if>
					<if test="taxivcCoprt != null and !taxivcCoprt.equals('')">
					AND AR07.TAXIVC_COPRT = #{taxivcCoprt}
					</if>
					GROUP BY AR07.CO_CD
					       ,AR07.CLNT_CD 
					       ,BM02.CLNT_NM
					       ,CASE
							    	WHEN NVL(SD05.CLMN_DAY   ,NVL(BM02.SELL_CLMN_DAY,0))       = NVL(BM02.SELL_CLMN_DAY,0) 
							    	 AND NVL(SD05.CLMN_DIV_CD,NVL(BM02.SELL_CLMN_DIV_CD ,'@')) = NVL(BM02.SELL_CLMN_DIV_CD ,'@')
							    	 AND NVL(SD05.PMNT_MTD_CD,NVL(BM02.SELL_PMNT_MTD_CD ,'@')) = NVL(BM02.SELL_PMNT_MTD_CD ,'@')
							    	     THEN ''
							    	ELSE AR07.PRDT_GRP END 
					       ,CASE
							    	WHEN NVL(SD05.CLMN_DAY,NVL(BM02.SELL_CLMN_DAY,0))  = NVL(BM02.SELL_CLMN_DAY,0) 
							    	 AND NVL(SD05.CLMN_DIV_CD,NVL(BM02.SELL_CLMN_DIV_CD ,'@')) = NVL(BM02.SELL_CLMN_DIV_CD ,'@')
							    	 AND NVL(SD05.PMNT_MTD_CD,NVL(BM02.SELL_PMNT_MTD_CD ,'@')) = NVL(BM02.SELL_PMNT_MTD_CD,'@')
							    	     THEN 0
							    	ELSE AR07.PRJCT_CD
					         END
					       ,BM02.SELL_VAT_CD
					       ,NVL(SD05.CLMN_DAY, BM02.SELL_CLMN_DAY)
					       ,BM02.SELL_CLMN_RMK
					       ,BM02.SELL_PAY_DIV_CD
					       ,NVL(SD05.CLMN_DIV_CD,BM02.SELL_CLMN_DIV_CD)
					       ,NVL(SD05.PMNT_MTD_CD, BM02.SELL_PMNT_MTD_CD)
					       ,CASE
						    	WHEN CM05M01.CODE_RPRC = 'MON' THEN TO_CHAR(LAST_DAY(ADD_MONTHS(TRUNC(ADD_MONTHS(TO_DATE(CLOSE_YM,'YYYYMM'),-1),'MM'), NVL(CM05M01.CODE_ETC,0)) -1) + NVL(SD05.CLMN_DAY, NVL(BM02.SELL_CLMN_DAY,0)), 'YYYYMMDD')
						    	WHEN CM05M01.CODE_RPRC = 'DAY' THEN TO_CHAR(TO_DATE(CLOSE_YM,'YYYYMM') + NVL(SD05.CLMN_DAY, NVL(BM02.SELL_CLMN_DAY,0)), 'YYYYMMDD')
							  END 
					UNION ALL
						 SELECT  1 AS TYPE1  <!-- 당월 입금  -->
							     , AR05.CO_CD
					             , AR05.CLNT_CD 
					             , BM02.CLNT_NM
					             , CASE
							    	WHEN NVL(AR05.SELL_CLMN_DAY   ,NVL(BM02.SELL_CLMN_DAY,0))       = NVL(BM02.SELL_CLMN_DAY,0) 
							    	 AND NVL(AR05.SELL_CLMN_DIV_CD,NVL(BM02.SELL_CLMN_DIV_CD ,'@')) = NVL(BM02.SELL_CLMN_DIV_CD ,'@')
							    	 AND NVL(AR05.SELL_PMNT_MTD_CD,NVL(BM02.SELL_PMNT_MTD_CD ,'@')) = NVL(BM02.SELL_PMNT_MTD_CD ,'@')
							    	     THEN ''
							    	ELSE AR05.PRDT_GRP END
					              AS PRDT_GRP
					             , CASE
							    	WHEN NVL(AR05.SELL_CLMN_DAY   ,NVL(BM02.SELL_CLMN_DAY,0))       = NVL(BM02.SELL_CLMN_DAY,0) 
							    	 AND NVL(AR05.SELL_CLMN_DIV_CD,NVL(BM02.SELL_CLMN_DIV_CD ,'@')) = NVL(BM02.SELL_CLMN_DIV_CD ,'@')
							    	 AND NVL(AR05.SELL_PMNT_MTD_CD,NVL(BM02.SELL_PMNT_MTD_CD ,'@')) = NVL(BM02.SELL_PMNT_MTD_CD ,'@')
							    	     THEN 0
							    	ELSE AR05.PRJCT_CD END
					               AS PRJCT_CD
					  		     , NVL(AR05.SELL_CLMN_DAY, BM02.SELL_CLMN_DAY) AS SELL_CLMN_DAY
					   		     , BM02.SELL_CLMN_RMK
							     , BM02.SELL_PAY_DIV_CD
					  		     , NVL(AR05.SELL_CLMN_DIV_CD, BM02.SELL_CLMN_DIV_CD) AS SELL_CLMN_DIV_CD
					  		     , NVL(AR05.SELL_PMNT_MTD_CD, BM02.SELL_PMNT_MTD_CD) AS SELL_PMNT_MTD_CD
					  		     , BM02.SELL_VAT_CD
					  		     ,'' AS PRE3_PCHS_CLMN_DAY
								 ,'' AS PRE2_PCHS_CLMN_DAY
								 ,'' AS PRE1_PCHS_CLMN_DAY
								 ,'' AS PRE0_PCHS_CLMN_DAY					   
						         , 0 AS PRE3_TRMEND_AMT     <!--3개월전 채권잔액      -->
						         , SUM(DECODE(SUBSTRING(AR05.ETRDPS_DT,0,6) ,TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt},'-',''),'YYYYMMDD'),-2),'YYYYMM'), AR05.ETRDPS_AMT,0)) AS PRE2_CELL_CLMN_AMT  <!--2개월전 수금        -->
						         , 0 AS PRE2_CELL_TOT_AMT   <!--2개월전 매출         -->
						         , 0 AS PRE2_TRMEND_AMT     <!--2개월전 채권잔액    -->
						         , SUM(DECODE(SUBSTRING(AR05.ETRDPS_DT,0,6) ,TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt},'-',''),'YYYYMMDD'),-1),'YYYYMM'), AR05.ETRDPS_AMT,0)) AS PRE1_CELL_CLMN_AMT  <!--1개월전 수금       -->
						         , 0 AS PRE1_CELL_TOT_AMT   <!--1개월전 매출        -->
						         , 0 AS PRE1_TRMEND_AMT     <!--1개월전 채권잔액          -->
				 		         , SUM(DECODE(SUBSTRING(AR05.ETRDPS_DT,0,6) ,TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt},'-',''),'YYYYMMDD'),0),'YYYYMM'), AR05.ETRDPS_AMT,0)) AS CUR_CELL_CLMN_AMT       <!--현재월 수금 -->
						         , 0 AS CUR_CELL_TOT_AMT    <!--현재월 매출 -->
						         , 0  AS CUR_TRMEND_CREDIT_AMT  <!-- 현재월 채권잔액-->
						   FROM TB_AR05D02 AR05
						  INNER JOIN TB_AR05M01 M01 ON M01.CO_CD = AR05.CO_CD AND M01.ETRDPS_SEQ = AR05.ETRDPS_SEQ
						   LEFT JOIN TB_BM02M01 BM02 ON BM02.CLNT_CD = AR05.CLNT_CD 
			              WHERE 'SELPCH2' =  (SELECT NVL(CODE_RPRC,'SELPCH2') FROM  TB_CM05M01 WHERE CODE_ID= M01.ETRDPS_TYP)
					  	    AND AR05.ETRDPS_DT BETWEEN  TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt},'-',''),'YYYYMMDD'),-2),'YYYYMM')  || '01'
					  	                           AND  REPLACE(#{baseDt}, '-', '')
						  <if test="coCd != null and !coCd.equals('')">
						 	  AND AR05.CO_CD = #{coCd}				
						  </if>
							  AND  NVL(AR05.ETRDPS_AMT,0)<![CDATA[ != ]]> 0 					  					  
						  <if test="clntCd != null and !clntCd.equals('')">
						 	  AND AR05.CLNT_CD = #{clntCd}				
						  </if>			
						  <if test="clntNm != null and !clntNm.equals('')">
						   AND BM02.CLNT_NM  LIKE '%' || #{clntNm} ||'%'
						  </if>
						  <if test="prdtGrp != null and !prdtGrp.equals('')">
						   AND AR05.PRDT_GRP = #{prdtGrp}
						  </if>
						  <if test="taxivcCoprt != null and !taxivcCoprt.equals('')">
						   AND M01.TAXIVC_COPRT = #{taxivcCoprt}
						  </if>
						  GROUP BY AR05.CO_CD
					             , AR05.CLNT_CD 
					             , BM02.CLNT_NM
					             , CASE
							    	WHEN NVL(AR05.SELL_CLMN_DAY   ,NVL(BM02.SELL_CLMN_DAY,0))       = NVL(BM02.SELL_CLMN_DAY,0) 
							    	 AND NVL(AR05.SELL_CLMN_DIV_CD,NVL(BM02.SELL_CLMN_DIV_CD ,'@')) = NVL(BM02.SELL_CLMN_DIV_CD ,'@')
							    	 AND NVL(AR05.SELL_PMNT_MTD_CD,NVL(BM02.SELL_PMNT_MTD_CD ,'@')) = NVL(BM02.SELL_PMNT_MTD_CD ,'@')
							    	     THEN ''
							    	ELSE AR05.PRDT_GRP END
					             , CASE
							    	WHEN NVL(AR05.SELL_CLMN_DAY   ,NVL(BM02.SELL_CLMN_DAY,0))       = NVL(BM02.SELL_CLMN_DAY,0) 
							    	 AND NVL(AR05.SELL_CLMN_DIV_CD,NVL(BM02.SELL_CLMN_DIV_CD ,'@')) = NVL(BM02.SELL_CLMN_DIV_CD ,'@')
							    	 AND NVL(AR05.SELL_PMNT_MTD_CD,NVL(BM02.SELL_PMNT_MTD_CD ,'@')) = NVL(BM02.SELL_PMNT_MTD_CD ,'@')
							    	     THEN 0
							    	ELSE AR05.PRJCT_CD END
					  		     , NVL(AR05.SELL_CLMN_DAY, BM02.SELL_CLMN_DAY)
					   		     , BM02.SELL_CLMN_RMK
							     , BM02.SELL_PAY_DIV_CD
					  		     , NVL(AR05.SELL_CLMN_DIV_CD, BM02.SELL_CLMN_DIV_CD)
					  		     , NVL(AR05.SELL_PMNT_MTD_CD, BM02.SELL_PMNT_MTD_CD)
					  		     , BM02.SELL_VAT_CD
					   UNION ALL
							SELECT   2 AS TYPE1   <!-- 당월 매출 -->
							     , CO_CD
								 , CLNT_CD 
				            	 , CLNT_NM
							     , PRDT_GRP
							     , PRJCT_CD
					  		     , SELL_CLMN_DAY
					   		     , SELL_CLMN_RMK
							     , SELL_PAY_DIV_CD
					  		     , SELL_CLMN_DIV_CD
					  		     , SELL_PMNT_MTD_CD
					  		     , SELL_VAT_CD
					  		     , '' AS PRE3_PCHS_CLMN_DAY <!--3개월전 결제예정일      -->
								 , DECODE(SUBSTRING(TRST_DT,0,6) ,TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt},'-',''),'YYYYMMDD'),-2),'YYYYMM') ,PCHS_CLMN_DAY) AS PRE2_PCHS_CLMN_DAY <!--2개월전 결제예정일      -->
								 , DECODE(SUBSTRING(TRST_DT,0,6) ,TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt},'-',''),'YYYYMMDD'),-1),'YYYYMM') ,PCHS_CLMN_DAY) AS PRE1_PCHS_CLMN_DAY <!--1개월전 결제예정일      -->
								 , DECODE(SUBSTRING(TRST_DT,0,6) ,TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt},'-',''),'YYYYMMDD'), 0),'YYYYMM') ,PCHS_CLMN_DAY) AS PRE0_PCHS_CLMN_DAY	<!--0개월전 결제예정일      -->
						         , 0    AS PRE3_TRMEND_AMT        <!--3개월전 채권잔액      -->
						         , 0    AS PRE2_CELL_CLMN_AMT    <!--2개월전 수금        -->
						         , SUM(PRE2_CELL_TOT_AMT)     AS PRE2_CELL_TOT_AMT      <!--2개월전 매출         -->
						         , 0    AS PRE2_TRMEND_AMT        <!--2개월전 채권잔액    -->
						         , 0    AS PRE1_CELL_CLMN_AMT     <!--1개월전 수금       -->
						         , SUM(PRE1_CELL_TOT_AMT)     AS PRE1_CELL_TOT_AMT      <!--1개월전 매출        -->
						         , 0    AS PRE1_TRMEND_AMT        <!--1개월전 채권잔액      -->
						         , 0    AS CUR_CELL_CLMN_AMT      <!--현재월 수금 -->
						         , SUM(CUR_CELL_TOT_AMT)      AS CUR_CELL_TOT_AMT       <!--현재월 매출 -->
				 		         , 0    AS CUR_TRMEND_CREDIT_AMT  <!--현재월 채권잔액-->
				 		       FROM (
									   SELECT 
									       AR02.CO_CD
									     , AR02.TRST_DT
										 , TRST_CLNT_CD AS CLNT_CD 
						            	 , BM02.CLNT_NM
									     , CASE
									    	WHEN NVL(SD05.CLMN_DAY   ,NVL(BM02.SELL_CLMN_DAY,0))       = NVL(BM02.SELL_CLMN_DAY,0) 
									    	 AND NVL(SD05.CLMN_DIV_CD,NVL(BM02.SELL_CLMN_DIV_CD ,'@')) = NVL(BM02.SELL_CLMN_DIV_CD ,'@')
									    	 AND NVL(SD05.PMNT_MTD_CD,NVL(BM02.SELL_PMNT_MTD_CD ,'@')) = NVL(BM02.SELL_PMNT_MTD_CD ,'@')
									    	     THEN ''
									    	ELSE BM01.PRDT_GRP END
							               AS PRDT_GRP
									     , CASE
									    	WHEN NVL(SD05.CLMN_DAY   ,NVL(BM02.SELL_CLMN_DAY,0))       = NVL(BM02.SELL_CLMN_DAY,0) 
									    	 AND NVL(SD05.CLMN_DIV_CD,NVL(BM02.SELL_CLMN_DIV_CD ,'@')) = NVL(BM02.SELL_CLMN_DIV_CD ,'@')
									    	 AND NVL(SD05.PMNT_MTD_CD,NVL(BM02.SELL_PMNT_MTD_CD ,'@')) = NVL(BM02.SELL_PMNT_MTD_CD ,'@')
									    	     THEN 0
									    	ELSE AR02.PRJCT_CD END
									    	AS PRJCT_CD
							  		     , NVL(SD05.CLMN_DAY, SELL_CLMN_DAY) AS SELL_CLMN_DAY
							   		     , BM02.SELL_CLMN_RMK
									     , SELL_PAY_DIV_CD
							  		     , NVL(SD05.CLMN_DIV_CD, SELL_CLMN_DIV_CD) AS SELL_CLMN_DIV_CD
							  		     , NVL(SD05.PMNT_MTD_CD, SELL_PMNT_MTD_CD) AS SELL_PMNT_MTD_CD
							  		     , SELL_VAT_CD
							  		     ,CASE
									    	 WHEN CM05M01.CODE_RPRC = 'MON' THEN TO_CHAR(LAST_DAY(ADD_MONTHS(TRUNC(TO_DATE(TRST_DT,'YYYYMMDD'),'MM'), NVL(CM05M01.CODE_ETC,0)) -1) + NVL(NVL(SD05.CLMN_DAY, BM02.SELL_CLMN_DAY) ,0), 'YYYYMMDD')
									      	 WHEN CM05M01.CODE_RPRC = 'DAY' THEN TO_CHAR(TO_DATE(TRST_DT,'YYYYMMDD')+ NVL(NVL(SD05.CLMN_DAY, BM02.SELL_CLMN_DAY) ,0), 'YYYYMMDD')
										  END AS PCHS_CLMN_DAY	<!-- 결제예정일      -->
								         , DECODE(SUBSTRING(TRST_DT,0,6) ,TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt},'-',''),'YYYYMMDD'),-2),'YYYYMM'),NVL(BILG_AMT, 0 ) + NVL(BILG_VAT_AMT, 0),0) AS PRE2_CELL_TOT_AMT   <!--2개월전 매출         -->
								         , DECODE(SUBSTRING(TRST_DT,0,6) ,TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt},'-',''),'YYYYMMDD'),-1),'YYYYMM'),NVL(BILG_AMT, 0 ) + NVL(BILG_VAT_AMT, 0),0) AS PRE1_CELL_TOT_AMT   <!--1개월전 매출        -->
								         , DECODE(SUBSTRING(TRST_DT,0,6) ,TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt},'-',''),'YYYYMMDD'), 0),'YYYYMM'),NVL(BILG_AMT, 0 ) + NVL(BILG_VAT_AMT, 0),0) AS CUR_CELL_TOT_AMT   <!--현재월 매출 -->
									  FROM TB_AR02M01 AR02
									  INNER JOIN TB_BM01M01 BM01 ON BM01.PRDT_CD = AR02.TRST_PRDT_CD
									   LEFT JOIN TB_BM02M01 BM02 ON BM02.CLNT_CD = AR02.TRST_CLNT_CD
									   LEFT JOIN TB_SD05M01 SD05 ON SD05.PRJCT_CD = AR02.PRJCT_CD
						 			   LEFT JOIN TB_CM05M01 CM05M01 ON NVL(SD05.CLMN_DIV_CD, SELL_CLMN_DIV_CD) = CM05M01.CODE_ID
									  WHERE  SELPCH_CD = 'SELPCH2'
									  <if test="coCd != null and !coCd.equals('')">
									  AND AR02.CO_CD = #{coCd}				
									  </if>	
									  <if test="clntCd != null and !clntCd.equals('')">
									  AND AR02.TRST_CLNT_CD = #{clntCd}				
									  </if>	
									  <if test="clntNm != null and !clntNm.equals('')">
									   AND BM02.CLNT_NM  LIKE '%' || #{clntNm} ||'%'
									  </if>			
									   <if test="baseDt != null and !baseDt.equals('')">
							  	       AND TRST_DT BETWEEN  TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt},'-',''),'YYYYMMDD'),-2),'YYYYMM') || '01'
							  	                       AND  REPLACE(#{baseDt}, '-', '')
									  </if>
									  <if test="taxivcCoprt != null and !taxivcCoprt.equals('')">
									   AND AR02.TAXIVC_COPRT = #{taxivcCoprt}
									  </if>
									  <if test="prdtGrp != null and !prdtGrp.equals('')">
									   AND AR02.PRDT_DIV IN (SELECT DISTINCT PRDT_DIV
														FROM TB_BM01M01
													    WHERE PRDT_GRP = #{prdtGrp}
							  						   )
									  </if>
							  ) AR02
							  GROUP BY CO_CD
								 , CLNT_CD 
				            	 , CLNT_NM
							     , PRDT_GRP
							     , PRJCT_CD
					  		     , SELL_CLMN_DAY
					   		     , SELL_CLMN_RMK
							     , SELL_PAY_DIV_CD
					  		     , SELL_CLMN_DIV_CD
					  		     , SELL_PMNT_MTD_CD
					  		     , SELL_VAT_CD
					  		     , DECODE(SUBSTRING(TRST_DT,0,6) ,TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt},'-',''),'YYYYMMDD'),-2),'YYYYMM') ,PCHS_CLMN_DAY) 
								 , DECODE(SUBSTRING(TRST_DT,0,6) ,TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt},'-',''),'YYYYMMDD'),-1),'YYYYMM') ,PCHS_CLMN_DAY) 
								 , DECODE(SUBSTRING(TRST_DT,0,6) ,TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt},'-',''),'YYYYMMDD'), 0),'YYYYMM') ,PCHS_CLMN_DAY)
    
		      ) A
		      GROUP BY   A.CO_CD
				       , A.CLNT_CD 
				       , A.CLNT_NM
 				       , PRDT_GRP
 				       , PRJCT_CD 
				       , DECODE(A.SELL_CLMN_DAY,0,'',A.SELL_CLMN_DAY)
				       , A.SELL_CLMN_RMK
				       , A.SELL_PAY_DIV_CD
				       , A.SELL_CLMN_DIV_CD
				       , A.PMNT_MTD_CD
				       , A.SELL_VAT_CD
				       , PRE3_PCHS_CLMN_DAY  <!-- 3개월전 결제예정일 -->
					   , PRE2_PCHS_CLMN_DAY  <!-- 2개월전 결제예정일 -->
					   , PRE1_PCHS_CLMN_DAY  <!-- 1개월전 결제예정일 -->
					   , PRE0_PCHS_CLMN_DAY  <!-- 0개월전 결제예정일     -->  
	) AS AR07
    ORDER BY   CO_CD
		       , CLNT_CD 
		       , PRDT_GRP
		       , PRJCT_CD
		       , SELL_PAY_DIV_NM
		       , SELL_CLMN_DIV_NM
		       , SELL_PMNT_MTD_NM
		       , SELL_CLMN_DAY		       
		       
		       
	</select>
	
	
		
	
	
</mapper>


<!-- 	<select id="selectMtClosCditList" resultType="CamelMap"> -->
<!-- 	WITH AR05 AS ( -->
<!-- 	SELECT CO_CD -->
<!-- 		 , SUBSTRING(ETRDPS_DT, 0, 6) ETRDPS_YM -->
<!-- 		 , CLNT_CD -->
<!-- 		 , SUM(ETRDPS_AMT) ETRDPS_AMT -->
<!-- 	  FROM TB_AR05M01 -->
<!-- 	  WHERE ETRDPS_TYP IN ('ETRDPS01','ETRDPS03')  수금, 상계 -->
<!-- 	  <if test="coCd != null and !coCd.equals('')"> -->
<!-- 	  AND CO_CD = #{coCd}				 -->
<!-- 	  </if>	 -->
<!-- 	  <if test="closeYm != null and !closeYm.equals('')"> -->
<!-- 	  AND SUBSTRING(ETRDPS_DT, 0, 6) = REPLACE(#{closeYm}, '-', '')				 -->
<!-- 	  </if> -->
<!-- 	  <if test="clntCd != null and !clntCd.equals('')"> -->
<!-- 	  AND CLNT_CD = #{clntCd}				 -->
<!-- 	  </if> -->
<!-- 	  GROUP BY CO_CD, SUBSTRING(ETRDPS_DT, 0, 6), CLNT_CD -->
<!-- 	), -->
<!-- 	AR02 AS ( -->
<!-- 	SELECT CO_CD -->
<!-- 		 , TRST_CLNT_CD CLNT_CD -->
<!-- 		 , SUBSTRING(TRST_DT, 0, 6) TRST_YM -->
<!-- 		 , SUM(NVL(BILG_AMT, 0 ) + NVL(BILG_VAT_AMT, 0)) BILG_AMT -->
<!-- 	  FROM TB_AR02M01 -->
<!-- 	  WHERE SELPCH_CD = 'SELPCH2' -->
<!-- 	  <if test="coCd != null and !coCd.equals('')"> -->
<!-- 	  AND CO_CD = #{coCd}				 -->
<!-- 	  </if>	 -->
<!-- 	  <if test="closeYm != null and !closeYm.equals('')"> -->
<!-- 	  AND SUBSTRING(TRST_DT, 0, 6) = REPLACE(#{closeYm}, '-', '')				 -->
<!-- 	  </if> -->
<!-- 	  <if test="clntCd != null and !clntCd.equals('')"> -->
<!-- 	  AND TRST_CLNT_CD = #{clntCd}				 -->
<!-- 	  </if> -->
<!-- 	  GROUP BY CO_CD, SUBSTRING(TRST_DT, 0, 6), TRST_CLNT_CD  -->
<!-- 	) -->
<!-- 	SELECT -->
<!-- 		* -->
<!-- 	FROM -->
<!-- 	( -->
<!-- 		SELECT -->
<!-- 			ROWNUM AS RNUM, A.* -->
<!-- 			, (SELECT SUM(BASIS_CREDIT_AMT)  FROM TB_AR07M01 A3 WHERE A3.CO_CD = A.CO_CD AND A3.CLOSE_YM  = TO_CHAR(ADD_MONTHS(TO_DATE(A.ETRDPS_YM,'YYYYMM'),-2),'YYYYMM') AND A3.CLNT_CD = A.CLNT_CD) AS BASIS_CREDIT_AMT   -->
<!-- 			, (SELECT SUM(TRMEND_CREDIT_AMT) FROM TB_AR07M01 A2 WHERE A2.CO_CD = A.CO_CD AND A2.CLOSE_YM  = TO_CHAR(ADD_MONTHS(TO_DATE(A.ETRDPS_YM,'YYYYMM'),-2),'YYYYMM') AND A2.CLNT_CD = A.CLNT_CD) AS CLOSE_YM2 -->
<!-- 			, (SELECT SUM(CELL_CLMN_AMT)     FROM TB_AR07M01 A2 WHERE A2.CO_CD = A.CO_CD AND A2.CLOSE_YM  = TO_CHAR(ADD_MONTHS(TO_DATE(A.ETRDPS_YM,'YYYYMM'),-2),'YYYYMM') AND A2.CLNT_CD = A.CLNT_CD) AS CLOSE_YM2_CLMN_AMT -->
<!-- 			, (SELECT SUM(CELL_TOT_AMT)      FROM TB_AR07M01 A2 WHERE A2.CO_CD = A.CO_CD AND A2.CLOSE_YM  = TO_CHAR(ADD_MONTHS(TO_DATE(A.ETRDPS_YM,'YYYYMM'),-2),'YYYYMM') AND A2.CLNT_CD = A.CLNT_CD) AS CLOSE_YM2_TOT_AMT	 -->
<!-- 			, (SELECT SUM(TRMEND_CREDIT_AMT) FROM TB_AR07M01 A1 WHERE A1.CO_CD = A.CO_CD AND A1.CLOSE_YM  = TO_CHAR(ADD_MONTHS(TO_DATE(A.ETRDPS_YM,'YYYYMM'),-1),'YYYYMM') AND A1.CLNT_CD = A.CLNT_CD) AS CLOSE_YM1 -->
<!-- 			, (SELECT SUM(CELL_CLMN_AMT)     FROM TB_AR07M01 A1 WHERE A1.CO_CD = A.CO_CD AND A1.CLOSE_YM  = TO_CHAR(ADD_MONTHS(TO_DATE(A.ETRDPS_YM,'YYYYMM'),-1),'YYYYMM') AND A1.CLNT_CD = A.CLNT_CD) AS CLOSE_YM1_CLMN_AMT -->
<!-- 			, (SELECT SUM(CELL_TOT_AMT)      FROM TB_AR07M01 A1 WHERE A1.CO_CD = A.CO_CD AND A1.CLOSE_YM  = TO_CHAR(ADD_MONTHS(TO_DATE(A.ETRDPS_YM,'YYYYMM'),-1),'YYYYMM') AND A1.CLNT_CD = A.CLNT_CD) AS CLOSE_YM1_TOT_AMT -->
<!-- 			, FN_CM05M01_CD_TO_NM(A.SELL_PAY_DIV_CD)  AS  SELL_PAY_DIV_NM -->
<!-- 			, FN_CM05M01_CD_TO_NM(A.SELL_CLMN_DIV_CD) AS  SELL_CLMN_DIV_NM -->
<!-- 			, FN_CM05M01_CD_TO_NM(A.SELL_PMNT_MTD_CD) AS  SELL_PMNT_MTD_NM -->
<!-- 			, FN_CM05M01_CD_TO_NM(A.SELL_VAT_CD)      AS  SELL_VAT_NM -->
<!-- 		FROM -->
<!-- 		( -->
<!-- 			SELECT TT.CO_CD, -->
<!-- 			       (SELECT CODE_NM FROM TB_CM05M01 WHERE CODE_ID = TT.CO_CD) AS CO_NM, -->
<!-- 			       ETRDPS_YM, -->
<!-- 				   SUBSTRING(ETRDPS_YM, 0, 4) || '-' || SUBSTRING(ETRDPS_YM, 5,2) CLOSE_YM, -->
<!-- 				   TT.CLNT_CD, -->
<!-- 				   (SELECT CLNT_NM FROM TB_BM02M01 WHERE CLNT_CD = TT.CLNT_CD) AS CLNT_NM, -->
<!-- 			  		SELL_PAY_DIV_CD, -->
<!-- 			  		SELL_CLMN_DIV_CD, -->
<!-- 			  		SELL_PMNT_MTD_CD, -->
<!-- 			  		SELL_VAT_CD, -->
<!-- 				   CASE WHEN ETRDPS_YM = TO_CHAR(SYSDATE, 'YYYYMM') THEN BASIS_AMT -->
<!-- 				   		ELSE BFR_BASIS_AMT END BASIS_AMT, -->
<!-- 				   CASE WHEN ETRDPS_YM = TO_CHAR(SYSDATE, 'YYYYMM') THEN CLMN_AMT -->
<!-- 				   		ELSE BFR_CLMN_AMT END CLMN_AMT, -->
<!-- 				   CASE WHEN ETRDPS_YM = TO_CHAR(SYSDATE, 'YYYYMM') THEN TOT_AMT -->
<!-- 				   		ELSE BFR_TOT_AMT END TOT_AMT, -->
<!-- 				   CASE WHEN ETRDPS_YM = TO_CHAR(SYSDATE, 'YYYYMM') THEN BASIS_AMT + TOT_AMT - CLMN_AMT -->
<!-- 				   		ELSE BFR_TRMEND_AMT END TRMEND_AMT, -->
<!-- 				   NVL(T3.BASIS_CDTLN_AMT + T2.DEPOSIT, 0)  CRDT_LMT,   그룹기본여신 + 담보금액 = 여신한도 -->
<!-- 				   F_CREDIT_LOAN('T',TT.CLNT_CD,TT.CO_CD,TO_CHAR(LAST_DAY(TO_DATE(REPLACE(#{closeYm},'-',''), 'YYYYMM')), 'YYYYMMDD'),0) AS CRDT_LMT,   여신한도 -->
<!-- 				   F_CREDIT_LOAN('C',TT.CLNT_CD,TT.CO_CD,TO_CHAR(LAST_DAY(TO_DATE(REPLACE(#{closeYm},'-',''), 'YYYYMM')), 'YYYYMMDD'),0) AS CRDT_LOAN  	 -->
<!-- 			  FROM  -->
<!-- 			  (SELECT T.CO_CD -->
<!-- 			  		, T.ETRDPS_YM -->
<!-- 			  		, T.CLNT_CD -->
<!-- 			  		, SELL_PAY_DIV_CD -->
<!-- 			  		, SELL_CLMN_DIV_CD -->
<!-- 			  		, SELL_PMNT_MTD_CD -->
<!-- 			  		, SELL_VAT_CD -->
<!-- 			  		, SUM(BASIS_AMT) BASIS_AMT -->
<!-- 			  		, SUM(CLMN_AMT) CLMN_AMT -->
<!-- 			  		, SUM(TOT_AMT) TOT_AMT -->
<!-- 			  		, SUM(BFR_BASIS_AMT) BFR_BASIS_AMT -->
<!-- 			  		, SUM(BFR_CLMN_AMT) BFR_CLMN_AMT -->
<!-- 			  		, SUM(BFR_TOT_AMT) BFR_TOT_AMT -->
<!-- 			  		, SUM(BFR_TRMEND_AMT) BFR_TRMEND_AMT -->
<!-- 			  		FROM -->
<!-- 				  (SELECT CASE WHEN A.CO_CD IS NOT NULL THEN A.CO_CD -->
<!-- 				  			   WHEN B.CO_CD IS NOT NULL THEN B.CO_CD -->
<!-- 				  			   WHEN C.CO_CD IS NOT NULL THEN C.CO_CD END CO_CD, -->
<!-- 					      CASE WHEN A.ETRDPS_YM IS NOT NULL THEN A.ETRDPS_YM -->
<!-- 				  			   WHEN B.TRST_YM IS NOT NULL THEN B.TRST_YM -->
<!-- 				  			   WHEN C.CLOSE_YM IS NOT NULL THEN CASE WHEN REPLACE(#{closeYm}, '-', '') = TO_CHAR(SYSDATE, 'YYYYMM') THEN TO_CHAR(ADD_MONTHS(TO_DATE(C.CLOSE_YM, 'YYYYMM'), +1), 'YYYYMM') -->
<!-- 				  			   										 ELSE TO_CHAR(TO_DATE(C.CLOSE_YM, 'YYYYMM'), 'YYYYMM') END END ETRDPS_YM, -->
<!-- 					      CASE WHEN A.CLNT_CD IS NOT NULL THEN A.CLNT_CD -->
<!-- 				  			   WHEN B.CLNT_CD IS NOT NULL THEN B.CLNT_CD -->
<!-- 				  			   WHEN C.CLNT_CD IS NOT NULL THEN C.CLNT_CD END CLNT_CD, -->
<!-- 					      NVL(C.TRMEND_CREDIT_AMT, 0) BASIS_AMT,     --> <!--전월 기말잔액 (당월기초) -->
<!-- 					      NVL(A.ETRDPS_AMT, 0)        CLMN_AMT,      --> <!-- 입금관리 당월 입금(당월수금) -->
<!-- 					      NVL(B.BILG_AMT, 0)     TOT_AMT,        매출거래내역 당월매출(당월매출) -->
<!-- 					      NVL(C.BASIS_CREDIT_AMT, 0)  BFR_BASIS_AMT,  전월기초 -->
<!-- 					      NVL(C.CELL_CLMN_AMT, 0)     BFR_CLMN_AMT,  전월수금 -->
<!-- 					      NVL(C.CELL_TOT_AMT, 0)      BFR_TOT_AMT,   전월매출 -->
<!-- 					      NVL(C.TRMEND_CREDIT_AMT, 0) BFR_TRMEND_AMT 전월기말 -->
<!-- 				  	 FROM AR05 A -->
<!-- 				  	 FULL OUTER JOIN AR02 B -->
<!-- 				     	ON  A.CO_CD     = B.CO_CD -->
<!-- 				     	AND A.ETRDPS_YM = B.TRST_YM -->
<!-- 				     	AND A.CLNT_CD   = B.CLNT_CD -->
<!-- 				     FULL OUTER JOIN TB_AR07M01 C -->
<!-- 				       ON  A.CO_CD     = C.CO_CD -->
<!-- 				       AND A.ETRDPS_YM = C.CLOSE_YM -->
<!-- 				       AND A.CLNT_CD   = C.CLNT_CD -->
<!-- 					<where> -->
<!-- 					   <if test="closeYm != null and !closeYm.equals('')"> -->
<!-- 				       AND (SUBSTRING(C.CLOSE_YM , 0, 6) =  -->
<!-- 				       CASE WHEN REPLACE(#{closeYm}, '-', '') = TO_CHAR(SYSDATE, 'YYYYMM') THEN TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{closeYm}, '-', ''), 'YYYYMM'), -1), 'YYYYMM') -->
<!-- 				       		ELSE REPLACE(#{closeYm}, '-', '') END				       			 -->
<!-- 				       		 OR C.CLOSE_YM IS NULL) -->
<!-- 					   </if> -->
<!-- 					 </where> -->
<!-- 				) T,TB_BM02M01 T3 -->
<!-- 					WHERE T.CLNT_CD = T3.CLNT_CD(+) -->
<!-- 				GROUP BY CO_CD, T.ETRDPS_YM, T.CLNT_CD -->
<!-- 			  		, SELL_PAY_DIV_CD -->
<!-- 			  		, SELL_CLMN_DIV_CD -->
<!-- 			  		, SELL_PMNT_MTD_CD -->
<!-- 			  		, SELL_VAT_CD -->
<!-- 				ORDER BY T.CO_CD, T.CLNT_CD -->
<!-- 			)TT -->
<!-- 		) A -->
<!-- 		<where> -->
<!-- 		  <if test="clntNm != null and !clntNm.equals('')"> -->
<!-- 		       CLNT_NM  LIKE '%' || #{clntNm} ||'%' -->
<!-- 		  </if> -->
<!-- 		</where> -->
<!-- 	) -->
<!-- 	WHERE RNUM BETWEEN #{firstIndex} AND #{lastIndex} -->
<!-- 	</select> -->
<!-- 	<select id="selectMtClosCditCount" resultType="int"> -->
<!-- 	WITH AR05 AS ( -->
<!-- 	SELECT CO_CD -->
<!-- 		 , SUBSTRING(ETRDPS_DT, 0, 6) ETRDPS_YM -->
<!-- 		 , CLNT_CD -->
<!-- 		 , SUM(ETRDPS_AMT) ETRDPS_AMT -->
<!-- 	  FROM TB_AR05M01 -->
<!-- 	  WHERE ETRDPS_TYP IN ('ETRDPS01','ETRDPS01')  수금, 상계 -->
<!-- 	  <if test="coCd != null and !coCd.equals('')"> -->
<!-- 	  AND CO_CD = #{coCd}				 -->
<!-- 	  </if>	 -->
<!-- 	  <if test="closeYm != null and !closeYm.equals('')"> -->
<!-- 	  AND SUBSTRING(ETRDPS_DT, 0, 6) = REPLACE(#{closeYm}, '-', '')				 -->
<!-- 	  </if> -->
<!-- 	  <if test="clntCd != null and !clntCd.equals('')"> -->
<!-- 	  AND CLNT_CD = #{clntCd}				 -->
<!-- 	  </if> -->
<!-- 	  <if test="selpchCd != null and !selpchCd.equals('')"> -->
<!-- 	  AND SELPCH_CD = #{selpchCd} -->
<!-- 	  </if> -->
<!-- 	  GROUP BY CO_CD, SUBSTRING(ETRDPS_DT, 0, 6), CLNT_CD -->
<!-- 	), -->
<!-- 	AR02 AS ( -->
<!-- 	SELECT CO_CD -->
<!-- 		 , TRST_CLNT_CD CLNT_CD -->
<!-- 		 , SUBSTRING(TRST_DT, 0, 6) TRST_YM -->
<!-- 		 , SUM(NVL(BILG_AMT, 0 ) + NVL(BILG_VAT_AMT, 0)) BILG_AMT -->
<!-- 	  FROM TB_AR02M01 -->
<!-- 	  WHERE SELPCH_CD = 'SELPCH2' -->
<!-- 	  <if test="coCd != null and !coCd.equals('')"> -->
<!-- 	  AND CO_CD = #{coCd}				 -->
<!-- 	  </if>	 -->
<!-- 	  <if test="closeYm != null and !closeYm.equals('')"> -->
<!-- 	  AND SUBSTRING(TRST_DT, 0, 6) = REPLACE(#{closeYm}, '-', '')				 -->
<!-- 	  </if> -->
<!-- 	  <if test="clntCd != null and !clntCd.equals('')"> -->
<!-- 	  AND TRST_CLNT_CD = #{clntCd}				 -->
<!-- 	  </if> -->
<!-- 	  <if test="selpchCd != null and !selpchCd.equals('')"> -->
<!-- 	  AND SELPCH_CD = #{selpchCd} -->
<!-- 	  </if> -->
<!-- 	  GROUP BY CO_CD, SUBSTRING(TRST_DT, 0, 6), TRST_CLNT_CD  -->
<!-- 	), -->
<!-- 	BM02D02 AS ( -->
<!-- 	SELECT CLNT_CD -->
<!-- 		 , SUM(PLDG_AMT * PLDG_RCOGN_RATE /100) AS DEPOSIT  -->
<!-- 		 FROM TB_BM02D02 -->
<!-- 		 WHERE USE_YN  = 'Y' -->
<!-- 		 AND   SELPCH_CD = 'SELPCH2' -->
<!-- 		   <if test="coCd != null and !coCd.equals('')"> -->
<!-- 		    AND CO_CD = #{coCd}				 -->
<!-- 		</if> -->
<!-- 	    <if test="clntCd != null and !clntCd.equals('')"> -->
<!-- 	        AND CLNT_CD = #{clntCd}				 -->
<!-- 	    </if>	     -->
<!-- 	    <if test="selpchCd != null and !selpchCd.equals('')"> -->
<!-- 	        AND SELPCH_CD = #{selpchCd} -->
<!-- 	    </if> -->
<!-- 	GROUP BY CLNT_CD -->
<!-- 	) -->
<!-- 	SELECT COUNT(*) -->
<!-- 		FROM -->
<!-- 		( -->
<!-- 			SELECT (SELECT CODE_NM FROM TB_CM05M01 WHERE CODE_ID = TT.CO_CD) AS CO_NM, -->
<!-- 				   SUBSTRING(ETRDPS_YM, 0, 4) || '-' || SUBSTRING(ETRDPS_YM, 5,2) CLOSE_YM, -->
<!-- 				   (SELECT CLNT_NM FROM TB_BM02M01 WHERE CLNT_CD = TT.CLNT_CD) AS CLNT_NM, -->
<!-- 				   CASE WHEN ETRDPS_YM = TO_CHAR(SYSDATE, 'YYYYMM') THEN BASIS_AMT -->
<!-- 				   		ELSE BFR_BASIS_AMT END BASIS_AMT, -->
<!-- 				   CASE WHEN ETRDPS_YM = TO_CHAR(SYSDATE, 'YYYYMM') THEN CLMN_AMT -->
<!-- 				   		ELSE BFR_CLMN_AMT END CLMN_AMT, -->
<!-- 				   CASE WHEN ETRDPS_YM = TO_CHAR(SYSDATE, 'YYYYMM') THEN TOT_AMT -->
<!-- 				   		ELSE BFR_TOT_AMT END TOT_AMT, -->
<!-- 				   CASE WHEN ETRDPS_YM = TO_CHAR(SYSDATE, 'YYYYMM') THEN BASIS_AMT + TOT_AMT - CLMN_AMT -->
<!-- 				   		ELSE BFR_TRMEND_AMT END TRMEND_AMT, -->
<!-- 				   NVL(T3.BASIS_CDTLN_AMT + T2.DEPOSIT, 0)  CRDT_LMT,  그룹기본여신 + 담보금액 = 여신한도 -->
<!-- 				   F_CREDIT_LOAN('T',TT.CLNT_CD,TT.CO_CD,TO_CHAR(LAST_DAY(TO_DATE(REPLACE(#{closeYm},'-',''), 'YYYYMM')), 'YYYYMMDD'),0) AS CRDT_LMT,  여신한도 -->
<!-- 				   F_CREDIT_LOAN('C',TT.CLNT_CD,TT.CO_CD,TO_CHAR(LAST_DAY(TO_DATE(REPLACE(#{closeYm},'-',''), 'YYYYMM')), 'YYYYMMDD'),0) AS CRDT_LOAN  	 -->
<!-- 			  FROM  -->
<!-- 			  (SELECT T.CO_CD -->
<!-- 			  		, T.ETRDPS_YM -->
<!-- 			  		, T.CLNT_CD -->
<!-- 			  		, SUM(BASIS_AMT) BASIS_AMT -->
<!-- 			  		, SUM(CLMN_AMT) CLMN_AMT -->
<!-- 			  		, SUM(TOT_AMT) TOT_AMT -->
<!-- 			  		, SUM(BFR_BASIS_AMT) BFR_BASIS_AMT -->
<!-- 			  		, SUM(BFR_CLMN_AMT) BFR_CLMN_AMT -->
<!-- 			  		, SUM(BFR_TOT_AMT) BFR_TOT_AMT -->
<!-- 			  		, SUM(BFR_TRMEND_AMT) BFR_TRMEND_AMT -->
<!-- 			  		FROM -->
<!-- 				  (SELECT CASE WHEN A.CO_CD IS NOT NULL THEN A.CO_CD -->
<!-- 				  			   WHEN B.CO_CD IS NOT NULL THEN B.CO_CD -->
<!-- 				  			   WHEN C.CO_CD IS NOT NULL THEN C.CO_CD END CO_CD, -->
<!-- 					      CASE WHEN A.ETRDPS_YM IS NOT NULL THEN A.ETRDPS_YM -->
<!-- 				  			   WHEN B.TRST_YM IS NOT NULL THEN B.TRST_YM -->
<!-- 				  			   WHEN C.CLOSE_YM IS NOT NULL THEN CASE WHEN REPLACE(#{closeYm}, '-', '') = TO_CHAR(SYSDATE, 'YYYYMM') THEN TO_CHAR(ADD_MONTHS(TO_DATE(C.CLOSE_YM, 'YYYYMM'), +1), 'YYYYMM') -->
<!-- 				  			   										 ELSE TO_CHAR(TO_DATE(C.CLOSE_YM, 'YYYYMM'), 'YYYYMM') END END ETRDPS_YM, -->
<!-- 					      CASE WHEN A.CLNT_CD IS NOT NULL THEN A.CLNT_CD -->
<!-- 				  			   WHEN B.CLNT_CD IS NOT NULL THEN B.CLNT_CD -->
<!-- 				  			   WHEN C.CLNT_CD IS NOT NULL THEN C.CLNT_CD END CLNT_CD, -->
<!-- 					      NVL(C.TRMEND_CREDIT_AMT, 0) BASIS_AMT,     전월 기말잔액 (당월기초) -->
<!-- 					      NVL(A.ETRDPS_AMT, 0)        CLMN_AMT,      입금관리 당월 입금(당월수금) -->
<!-- 					      NVL(B.BILG_AMT, 0)     TOT_AMT,       매출거래내역 당월매출(당월매출) -->
<!-- 					      NVL(C.BASIS_CREDIT_AMT, 0)  BFR_BASIS_AMT, 전월기초 -->
<!-- 					      NVL(C.CELL_CLMN_AMT, 0)     BFR_CLMN_AMT, 전월수금 -->
<!-- 					      NVL(C.CELL_TOT_AMT, 0)      BFR_TOT_AMT,   전월매출 -->
<!-- 					      NVL(C.TRMEND_CREDIT_AMT, 0) BFR_TRMEND_AMT 전월기말 -->
<!-- 				  	 FROM AR05 A -->
<!-- 				  	 FULL OUTER JOIN AR02 B -->
<!-- 				     	ON  A.CO_CD     = B.CO_CD -->
<!-- 				     	AND A.ETRDPS_YM = B.TRST_YM -->
<!-- 				     	AND A.CLNT_CD   = B.CLNT_CD -->
<!-- 				     FULL OUTER JOIN TB_AR07M01 C -->
<!-- 				       ON  A.CO_CD     = C.CO_CD -->
<!-- 				       AND A.ETRDPS_YM = C.CLOSE_YM -->
<!-- 				       AND A.CLNT_CD   = C.CLNT_CD -->
<!-- 					<where> -->
<!-- 					   <if test="closeYm != null and !closeYm.equals('')"> -->
<!-- 				       AND (SUBSTRING(C.CLOSE_YM , 0, 6) =  -->
<!-- 				       CASE WHEN REPLACE(#{closeYm}, '-', '') = TO_CHAR(SYSDATE, 'YYYYMM') THEN TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{closeYm}, '-', ''), 'YYYYMM'), -1), 'YYYYMM') -->
<!-- 				       		ELSE REPLACE(#{closeYm}, '-', '') END				       			 -->
<!-- 				       		 OR C.CLOSE_YM IS NULL) -->
<!-- 					   </if> -->
<!-- 					 </where> -->
<!-- 				) T, TB_BM02M01 T3 -->
<!-- 					WHERE T.CLNT_CD = T3.CLNT_CD(+) -->
<!-- 				GROUP BY CO_CD, T.ETRDPS_YM, T.CLNT_CD -->
<!-- 			)TT -->
<!-- 		) A -->
<!-- 	</select> -->



<!-- 연체현황을 보는 쿼리.. 수정전 2021.09.03 -->
<!-- 	<select id="selectClosCditList" resultType="CamelMap"> -->
<!-- 	SELECT AR07.*, (SELECT NAME FROM TB_CM06M01 WHERE ID = AR07.SALES_EMP_ID  ) AS SALES_EMP_NM -->
<!-- 	      , (SELECT PRJCT_NM FROM TB_SD05M01 SD05 WHERE SD05.PRJCT_CD = AR07.PRJCT_CD  ) AS PRJCT_NM -->
<!-- 	  	  , FN_CM05M01_CD_TO_NM(AR07.PRDT_GRP)  AS PRDT_GRP_NM -->
<!-- 	      ,F_CREDIT_LOAN2('T',AR07.CLNT_CD,AR07.CO_CD,AR07.PRDT_GRP,TO_CHAR(LAST_DAY(TO_DATE(REPLACE(#{baseDt},'-',''), 'YYYYMMDD')), 'YYYYMMDD'),0) AS CRDT_LMT    총여신금액 -->
<!-- 		  ,F_CREDIT_LOAN2('C',AR07.CLNT_CD,AR07.CO_CD,AR07.PRDT_GRP,TO_CHAR(LAST_DAY(TO_DATE(REPLACE(#{baseDt},'-',''), 'YYYYMMDD')), 'YYYYMMDD'),0) AS CRDT_LOAN   여신잔액 -->
<!-- 		  ,NVL((SELECT SUM(ETRDPS_AMT) FROM TB_AR05M01 AR05  -->
<!-- 		           INNER JOIN TB_AR05D01 AR05D   -->
<!-- 		                 ON AR05D.CO_CD = AR05.CO_CD AND AR05D.CLNT_CD = AR05.CLNT_CD AND AR05D.BIL_NO = AR05.BIL_NO -->
<!-- 		         WHERE AR05.ETRDPS_DT  <![CDATA[<= ]]>TO_CHAR(LAST_DAY(TO_DATE(REPLACE(#{baseDt},'-',''),'YYYYMMDD')),'YYYYMMDD') -->
<!-- 		           AND AR05D.EXPRTN_DT <![CDATA[>  ]]>TO_CHAR(LAST_DAY(TO_DATE(REPLACE(#{baseDt},'-',''),'YYYYMMDD')),'YYYYMMDD') -->
<!-- 		           AND AR05.CO_CD = AR07.CO_CD -->
<!-- 		           AND AR05.CLNT_CD = AR07.CLNT_CD),0) AS UNSETL_BIL_AMT  미결제어음 -->
<!-- 		   ,(SELECT SUM(NVL(PLDG_AMT,0) /100 * NVL(PLDG_RCOGN_RATE,1))  -->
<!-- 		       FROM TB_BM02D02 BM02D02 -->
<!-- 		      WHERE BM02D02.CLNT_CD = AR07.CLNT_CD AND BM02D02.CO_CD = AR07.CO_CD AND BM02D02.USE_YN = 'Y' -->
<!-- 		        AND NVL(EXPRTN_DT,TO_CHAR(LAST_DAY(TO_DATE(REPLACE(#{baseDt},'-',''),'YYYYMMDD')),'YYYYMMDD')) <![CDATA[<= ]]> TO_CHAR(LAST_DAY(TO_DATE(REPLACE(#{baseDt},'-',''),'YYYYMMDD')),'YYYYMMDD')) AS PLDG_AMT  담보금액 -->
<!--   		 ,CASE -->
<!-- 				    	WHEN CM05M01.CODE_RPRC = 'MON' THEN TO_CHAR(LAST_DAY(ADD_MONTHS(TRUNC(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt},'-',''),'YYYYMMDD'),-3),'MM'), NVL(CM05M01.CODE_ETC,0)) -1) + NVL(SELL_CLMN_DAY,0), 'YYYYMMDD') -->
<!-- 				    	WHEN CM05M01.CODE_RPRC = 'DAY' THEN TO_CHAR(TRUNC(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt},'-',''),'YYYYMMDD'),-2),'MM') -1 + NVL(CM05M01.CODE_ETC,0) + NVL(SELL_CLMN_DAY,0), 'YYYYMMDD') -->
<!-- 		  END AS PRE3_PCHS_CLMN_DAY -->
<!-- 		 ,CASE -->
<!-- 				    	WHEN CM05M01.CODE_RPRC = 'MON' THEN TO_CHAR(LAST_DAY(ADD_MONTHS(TRUNC(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt},'-',''),'YYYYMMDD'),-2),'MM'), NVL(CM05M01.CODE_ETC,0)) -1) + NVL(SELL_CLMN_DAY,0), 'YYYYMMDD') -->
<!-- 				    	WHEN CM05M01.CODE_RPRC = 'DAY' THEN TO_CHAR(TRUNC(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt},'-',''),'YYYYMMDD'),-1),'MM') -1 + NVL(CM05M01.CODE_ETC,0) + NVL(SELL_CLMN_DAY,0), 'YYYYMMDD') -->
<!-- 		  END AS PRE2_PCHS_CLMN_DAY -->
<!-- 		 ,CASE -->
<!-- 				    	WHEN CM05M01.CODE_RPRC = 'MON' THEN TO_CHAR(LAST_DAY(ADD_MONTHS(TRUNC(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt},'-',''),'YYYYMMDD'),-1),'MM'), NVL(CM05M01.CODE_ETC,0)) -1) + NVL(SELL_CLMN_DAY,0), 'YYYYMMDD') -->
<!-- 				    	WHEN CM05M01.CODE_RPRC = 'DAY' THEN TO_CHAR(TRUNC(TO_DATE(REPLACE(#{baseDt},'-',''),'YYYYMMDD'),'MM') -1 + NVL(CM05M01.CODE_ETC,0) + NVL(SELL_CLMN_DAY,0), 'YYYYMMDD') -->
<!-- 		  END AS PRE1_PCHS_CLMN_DAY -->
<!-- 		 ,CASE -->
<!-- 				    	WHEN CM05M01.CODE_RPRC = 'MON' THEN TO_CHAR(LAST_DAY(ADD_MONTHS(TRUNC(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt},'-',''),'YYYYMMDD'),0),'MM'), NVL(CM05M01.CODE_ETC,0)) -1) + NVL(SELL_CLMN_DAY,0), 'YYYYMMDD') -->
<!-- 				    	WHEN CM05M01.CODE_RPRC = 'DAY' THEN TO_CHAR(LAST_DAY(TO_DATE(REPLACE(#{baseDt},'-',''),'YYYYMMDD')) + NVL(CM05M01.CODE_ETC,0) + NVL(SELL_CLMN_DAY,0), 'YYYYMMDD') -->
<!-- 		  END AS PRE0_PCHS_CLMN_DAY     -->
<!-- 		  ,(SELECT CRN FROM TB_BM02M01 BM02M WHERE BM02M.CLNT_CD = AR07.CLNT_CD) CRN_NO  -->
<!-- 	FROM ( -->
	
<!-- 	    SELECT -->
<!-- 	             A.CO_CD -->
<!-- 		       , FN_CM05M01_CD_TO_NM(A.CO_CD) AS CO_NM -->
<!-- 		       , A.CLNT_CD  -->
<!-- 		       , A.CLNT_NM -->
<!-- 		       , MIN(A.PRDT_GRP) AS PRDT_GRP -->
<!-- 		       , MIN(A.PRJCT_CD) AS PRJCT_CD -->
<!-- 		       , DECODE(A.SELL_CLMN_DAY,0,'',A.SELL_CLMN_DAY) AS SELL_CLMN_DAY -->
<!-- 		       , A.SELL_CLMN_RMK -->
<!-- 		       , A.SELL_PAY_DIV_CD -->
<!-- 		       , FN_CM05M01_CD_TO_NM(A.SELL_PAY_DIV_CD) AS SELL_PAY_DIV_NM -->
<!-- 		       , A.SELL_CLMN_DIV_CD -->
<!-- 		       , FN_CM05M01_CD_TO_NM(A.SELL_CLMN_DIV_CD) AS SELL_CLMN_DIV_NM -->
<!-- 		       , A.PMNT_MTD_CD -->
<!-- 		       , FN_CM05M01_CD_TO_NM(A.PMNT_MTD_CD) AS SELL_PMNT_MTD_NM -->
<!-- 		       , A.SELL_VAT_CD -->
<!-- 		       , FN_CM05M01_CD_TO_NM(A.SELL_VAT_CD) AS SELL_VAT_NM -->
<!-- 		       , (SELECT SALES_EMP_ID FROM TB_BM02D01 BM02D01 WHERE BM02D01.CLNT_CD = A.CLNT_CD AND BM02D01.SALES_CO_CD = A.CO_CD AND BM02D01.USE_YN = 'Y' AND ROWNUM = 1 )  SALES_EMP_ID -->
<!-- 		       , SUM(PRE3_TRMEND_AMT)        AS PRE3_TRMEND_AMT         3개월전 채권잔액       -->
<!-- 		       , SUM(PRE2_CELL_CLMN_AMT)     AS PRE2_CELL_CLMN_AMT      2개월전 수금           -->
<!-- 		       , SUM(PRE2_CELL_TOT_AMT)      AS PRE2_CELL_TOT_AMT       2개월전 매출           -->
<!-- 		       , SUM(PRE2_TRMEND_AMT)        AS PRE2_TRMEND_AMT         2개월전 채권잔액      -->
<!-- 		       , SUM(PRE1_CELL_CLMN_AMT)     AS PRE1_CELL_CLMN_AMT      1개월전 수금           -->
<!-- 		       , SUM(PRE1_CELL_TOT_AMT)      AS PRE1_CELL_TOT_AMT       1개월전 매출           -->
<!-- 		       , SUM(PRE1_TRMEND_AMT)        AS PRE1_TRMEND_AMT         1개월전 채권잔액      -->
<!-- 		       , SUM(CUR_CELL_TOT_AMT)       AS CUR_CELL_TOT_AMT        현재월 매출            -->
<!--  		       , SUM(CUR_CELL_CLMN_AMT)      AS CUR_CELL_CLMN_AMT       현재월 수금            -->
<!-- 		       , SUM(CUR_TRMEND_CREDIT_AMT)  AS CUR_TRMEND_CREDIT_AMT   현재월 채권잔액       -->
	    
<!-- 	    FROM ( -->
<!-- 				    SELECT 0 AS TYPE1  - 마감 자료 -->
<!-- 				           ,AR07.CO_CD -->
<!-- 					       ,AR07.CLNT_CD  -->
<!-- 					       ,BM02.CLNT_NM -->
<!-- 					       ,CASE -->
<!-- 							    	WHEN NVL(SD05.CLMN_DAY   ,NVL(BM02.SELL_CLMN_DAY,0))       = NVL(BM02.SELL_CLMN_DAY,0)  -->
<!-- 							    	 AND NVL(SD05.CLMN_DIV_CD,NVL(BM02.SELL_CLMN_DIV_CD ,'@')) = NVL(BM02.SELL_CLMN_DIV_CD ,'@') -->
<!-- 							    	 AND NVL(SD05.PMNT_MTD_CD,NVL(BM02.SELL_PMNT_MTD_CD ,'@')) = NVL(BM02.SELL_PMNT_MTD_CD ,'@') -->
<!-- 							    	     THEN '' -->
<!-- 							    	ELSE AR07.PRDT_GRP END  -->
<!-- 					        AS PRDT_GRP -->
<!-- 					       ,CASE -->
<!-- 							    	WHEN NVL(SD05.CLMN_DAY   ,NVL(BM02.SELL_CLMN_DAY,0))       = NVL(BM02.SELL_CLMN_DAY,0)  -->
<!-- 							    	 AND NVL(SD05.CLMN_DIV_CD,NVL(BM02.SELL_CLMN_DIV_CD ,'@')) = NVL(BM02.SELL_CLMN_DIV_CD ,'@') -->
<!-- 							    	 AND NVL(SD05.PMNT_MTD_CD,NVL(BM02.SELL_PMNT_MTD_CD ,'@')) = NVL(BM02.SELL_PMNT_MTD_CD ,'@') -->
<!-- 							    	     THEN 0 -->
<!-- 							    	ELSE AR07.PRJCT_CD END  -->
<!-- 							AS PRJCT_CD -->
<!-- 					       ,NVL(SD05.CLMN_DAY, BM02.SELL_CLMN_DAY) AS SELL_CLMN_DAY -->
<!-- 					       ,BM02.SELL_CLMN_RMK -->
<!-- 					       ,BM02.SELL_PAY_DIV_CD -->
<!-- 					       ,NVL(SD05.CLMN_DIV_CD, BM02.SELL_CLMN_DIV_CD) AS SELL_CLMN_DIV_CD -->
<!-- 					       ,NVL(SD05.PMNT_MTD_CD, BM02.SELL_PMNT_MTD_CD) AS PMNT_MTD_CD -->
<!-- 					       ,BM02.SELL_VAT_CD -->
<!-- 					       ,SUM(DECODE(CLOSE_YM ,TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt},'-',''),'YYYYMMDD'),-2),'YYYYMM'),AR07.BASIS_CREDIT_AMT,0))  AS PRE3_TRMEND_AMT     3개월전 채권잔액      -->
<!-- 					       ,SUM(DECODE(CLOSE_YM ,TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt},'-',''),'YYYYMMDD'),-2),'YYYYMM'),AR07.CELL_CLMN_AMT,0))     AS PRE2_CELL_CLMN_AMT  2개월전 수금         -->
<!-- 					       ,SUM(DECODE(CLOSE_YM ,TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt},'-',''),'YYYYMMDD'),-2),'YYYYMM'),AR07.CELL_TOT_AMT,0))      AS PRE2_CELL_TOT_AMT   2개월전 매출    -->
<!-- 					       ,SUM(DECODE(CLOSE_YM ,TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt},'-',''),'YYYYMMDD'),-2),'YYYYMM'),AR07.TRMEND_CREDIT_AMT,0)) AS PRE2_TRMEND_AMT     2개월전 채권잔액       -->
<!-- 					       ,SUM(DECODE(CLOSE_YM ,TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt},'-',''),'YYYYMMDD'),-1),'YYYYMM'),AR07.CELL_CLMN_AMT,0))     AS PRE1_CELL_CLMN_AMT  1개월전 수금         -->
<!-- 					       ,SUM(DECODE(CLOSE_YM ,TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt},'-',''),'YYYYMMDD'),-1),'YYYYMM'),AR07.CELL_TOT_AMT,0))      AS PRE1_CELL_TOT_AMT   1개월전 매출           -->
<!-- 					       ,SUM(DECODE(CLOSE_YM ,TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt},'-',''),'YYYYMMDD'),-1),'YYYYMM'),AR07.TRMEND_CREDIT_AMT,0)) AS PRE1_TRMEND_AMT     1개월전 채권잔액          -->
<!-- 					       ,SUM(DECODE(CLOSE_YM ,TO_CHAR(TO_DATE(REPLACE(#{baseDt},'-',''),'YYYYMMDD'),'YYYYMM'),AR07.CELL_TOT_AMT,0))                     AS CUR_CELL_TOT_AMT       현재월 매출       -->
<!-- 			 		       ,SUM(DECODE(CLOSE_YM ,TO_CHAR(TO_DATE(REPLACE(#{baseDt},'-',''),'YYYYMMDD'),'YYYYMM'),AR07.CELL_CLMN_AMT,0))                    AS CUR_CELL_CLMN_AMT      현재월 수금       -->
<!-- 					       ,SUM(DECODE(CLOSE_YM ,TO_CHAR(TO_DATE(REPLACE(#{baseDt},'-',''),'YYYYMMDD'),'YYYYMM'),AR07.TRMEND_CREDIT_AMT,0))                AS CUR_TRMEND_CREDIT_AMT  현재월 채권잔액  -->
<!-- 					FROM TB_AR07M01 AR07 -->
<!-- 					INNER JOIN TB_BM02M01 BM02 -->
<!-- 					        ON BM02.CLNT_CD = AR07.CLNT_CD -->
<!-- 				    LEFT JOIN TB_SD05M01 SD05 ON SD05.PRJCT_CD = AR07.PRJCT_CD -->
<!-- 					WHERE CLOSE_YM BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(REPLACE(#{baseDt},'-',''),'YYYYMMDD'),-2),'YYYYMM') AND  SUBSTRING(REPLACE(#{baseDt},'-',''),0,6) -->
<!-- 					<if test= "coCd != null and !coCd.equals('')"> -->
<!-- 					AND  AR07.CO_CD = #{coCd} -->
<!-- 					</if> -->
<!-- 					AND  AR07.SELPCH_CD = 'SELPCH2' -->
<!-- 					<if test= "clntNm != null and !clntNm.equals('')"> -->
<!-- 					AND  BM02.CLNT_NM like '%'||#{clntNm} ||'%' -->
<!-- 					</if> -->
<!-- 					<if test= "clntCd != null and !clntCd.equals('')"> -->
<!-- 					AND  AR07.CLNT_CD = #{clntCd} -->
<!-- 					</if> -->
<!-- 					<if test="prdtGrp != null and !prdtGrp.equals('')"> -->
<!-- 					AND AR07.PRDT_GRP = #{prdtGrp} -->
<!-- 					</if> -->
<!-- 					<if test="taxivcCoprt != null and !taxivcCoprt.equals('')"> -->
<!-- 					AND AR07.TAXIVC_COPRT = #{taxivcCoprt} -->
<!-- 					</if> -->
<!-- 					GROUP BY AR07.CO_CD -->
<!-- 					       ,AR07.CLNT_CD  -->
<!-- 					       ,BM02.CLNT_NM -->
<!-- 					       ,CASE -->
<!-- 							    	WHEN NVL(SD05.CLMN_DAY   ,NVL(BM02.SELL_CLMN_DAY,0))       = NVL(BM02.SELL_CLMN_DAY,0)  -->
<!-- 							    	 AND NVL(SD05.CLMN_DIV_CD,NVL(BM02.SELL_CLMN_DIV_CD ,'@')) = NVL(BM02.SELL_CLMN_DIV_CD ,'@') -->
<!-- 							    	 AND NVL(SD05.PMNT_MTD_CD,NVL(BM02.SELL_PMNT_MTD_CD ,'@')) = NVL(BM02.SELL_PMNT_MTD_CD ,'@') -->
<!-- 							    	     THEN '' -->
<!-- 							    	ELSE AR07.PRDT_GRP END  -->
<!-- 					       ,CASE -->
<!-- 							    	WHEN NVL(SD05.CLMN_DAY,NVL(BM02.SELL_CLMN_DAY,0))  = NVL(BM02.SELL_CLMN_DAY,0)  -->
<!-- 							    	 AND NVL(SD05.CLMN_DIV_CD,NVL(BM02.SELL_CLMN_DIV_CD ,'@')) = NVL(BM02.SELL_CLMN_DIV_CD ,'@') -->
<!-- 							    	 AND NVL(SD05.PMNT_MTD_CD,NVL(BM02.SELL_PMNT_MTD_CD ,'@')) = NVL(BM02.SELL_PMNT_MTD_CD,'@') -->
<!-- 							    	     THEN 0 -->
<!-- 							    	ELSE AR07.PRJCT_CD -->
<!-- 					         END -->
<!-- 					       ,BM02.SELL_VAT_CD -->
<!-- 					       ,NVL(SD05.CLMN_DAY, BM02.SELL_CLMN_DAY) -->
<!-- 					       ,BM02.SELL_CLMN_RMK -->
<!-- 					       ,BM02.SELL_PAY_DIV_CD -->
<!-- 					       ,NVL(SD05.CLMN_DIV_CD,BM02.SELL_CLMN_DIV_CD) -->
<!-- 					       ,NVL(SD05.PMNT_MTD_CD, BM02.SELL_PMNT_MTD_CD) -->
					       
<!-- 		   <if test='curDataYn != null and curDataYn.equals("Y")'> -->
<!-- 					UNION ALL -->
<!-- 						 SELECT  1 AS TYPE1  - 당월 입금 -->
<!-- 							     , AR05.CO_CD -->
<!-- 					             , AR05.CLNT_CD  -->
<!-- 					             , BM02.CLNT_NM -->
<!-- 					             , CASE -->
<!-- 							    	WHEN NVL(AR05.SELL_CLMN_DAY   ,NVL(BM02.SELL_CLMN_DAY,0))       = NVL(BM02.SELL_CLMN_DAY,0)  -->
<!-- 							    	 AND NVL(AR05.SELL_CLMN_DIV_CD,NVL(BM02.SELL_CLMN_DIV_CD ,'@')) = NVL(BM02.SELL_CLMN_DIV_CD ,'@') -->
<!-- 							    	 AND NVL(AR05.SELL_PMNT_MTD_CD,NVL(BM02.SELL_PMNT_MTD_CD ,'@')) = NVL(BM02.SELL_PMNT_MTD_CD ,'@') -->
<!-- 							    	     THEN '' -->
<!-- 							    	ELSE AR05.PRDT_GRP END -->
<!-- 					              AS PRDT_GRP -->
<!-- 					             , CASE -->
<!-- 							    	WHEN NVL(AR05.SELL_CLMN_DAY   ,NVL(BM02.SELL_CLMN_DAY,0))       = NVL(BM02.SELL_CLMN_DAY,0)  -->
<!-- 							    	 AND NVL(AR05.SELL_CLMN_DIV_CD,NVL(BM02.SELL_CLMN_DIV_CD ,'@')) = NVL(BM02.SELL_CLMN_DIV_CD ,'@') -->
<!-- 							    	 AND NVL(AR05.SELL_PMNT_MTD_CD,NVL(BM02.SELL_PMNT_MTD_CD ,'@')) = NVL(BM02.SELL_PMNT_MTD_CD ,'@') -->
<!-- 							    	     THEN 0 -->
<!-- 							    	ELSE AR05.PRJCT_CD END -->
<!-- 					               AS PRJCT_CD -->
<!-- 					  		     , NVL(AR05.SELL_CLMN_DAY, BM02.SELL_CLMN_DAY) AS SELL_CLMN_DAY -->
<!-- 					   		     , BM02.SELL_CLMN_RMK -->
<!-- 							     , BM02.SELL_PAY_DIV_CD -->
<!-- 					  		     , NVL(AR05.SELL_CLMN_DIV_CD, BM02.SELL_CLMN_DIV_CD) AS SELL_CLMN_DIV_CD -->
<!-- 					  		     , NVL(AR05.SELL_PMNT_MTD_CD, BM02.SELL_PMNT_MTD_CD) AS SELL_PMNT_MTD_CD -->
<!-- 					  		     , BM02.SELL_VAT_CD -->
<!-- 						         , 0 AS PRE3_TRMEND_AMT     3개월전 채권잔액       -->
<!-- 						         , 0 AS PRE2_CELL_CLMN_AMT  2개월전 수금         -->
<!-- 						         , 0 AS PRE2_CELL_TOT_AMT   2개월전 매출          -->
<!-- 						         , 0 AS PRE2_TRMEND_AMT     2개월전 채권잔액     -->
<!-- 						         , 0 AS PRE1_CELL_CLMN_AMT  1개월전 수금        -->
<!-- 						         , 0 AS PRE1_CELL_TOT_AMT   1개월전 매출         -->
<!-- 						         , 0 AS PRE1_TRMEND_AMT     1개월전 채권잔액           -->
<!-- 						         , 0 AS CUR_CELL_TOT_AMT   현재월 매출  -->
<!-- 				 		         , SUM(AR05.ETRDPS_AMT) AS CUR_CELL_CLMN_AMT       현재월 수금  -->
<!-- 						         , 0  AS CUR_TRMEND_CREDIT_AMT  현재월 채권잔액 -->
<!-- 						   FROM TB_AR05D02 AR05 -->
<!-- 						  INNER JOIN TB_AR05M01 M01 ON M01.CO_CD = AR05.CO_CD AND M01.ETRDPS_SEQ = AR05.ETRDPS_SEQ -->
<!-- 						   LEFT JOIN TB_BM02M01 BM02 ON BM02.CLNT_CD = AR05.CLNT_CD  -->
<!-- 			              WHERE 'SELPCH2' =  (SELECT NVL(CODE_RPRC,'SELPCH2') FROM  TB_CM05M01 WHERE CODE_ID= M01.ETRDPS_TYP) -->
<!-- 					  	    AND AR05.ETRDPS_DT BETWEEN  SUBSTRING(REPLACE(#{baseDt}, '-', ''),0,6) || '01' -->
<!-- 					  	                           AND  REPLACE(#{baseDt}, '-', '') -->
<!-- 						  <if test="coCd != null and !coCd.equals('')"> -->
<!-- 						 	  AND AR05.CO_CD = #{coCd}				 -->
<!-- 						  </if> -->
<!-- 							  AND  NVL(AR05.ETRDPS_AMT,0)<![CDATA[ != ]]> 0 					  					   -->
<!-- 						  <if test="clntCd != null and !clntCd.equals('')"> -->
<!-- 						 	  AND AR05.CLNT_CD = #{clntCd}				 -->
<!-- 						  </if>			 -->
<!-- 						  <if test="clntNm != null and !clntNm.equals('')"> -->
<!-- 						   AND BM02.CLNT_NM  LIKE '%' || #{clntNm} ||'%' -->
<!-- 						  </if> -->
<!-- 						  <if test="prdtGrp != null and !prdtGrp.equals('')"> -->
<!-- 						   AND AR05.PRDT_GRP = #{prdtGrp} -->
<!-- 						  </if> -->
<!-- 						  <if test="taxivcCoprt != null and !taxivcCoprt.equals('')"> -->
<!-- 						   AND M01.TAXIVC_COPRT = #{taxivcCoprt} -->
<!-- 						  </if> -->
<!-- 						  GROUP BY AR05.CO_CD -->
<!-- 					             , AR05.CLNT_CD  -->
<!-- 					             , BM02.CLNT_NM -->
<!-- 					             , CASE -->
<!-- 							    	WHEN NVL(AR05.SELL_CLMN_DAY   ,NVL(BM02.SELL_CLMN_DAY,0))       = NVL(BM02.SELL_CLMN_DAY,0)  -->
<!-- 							    	 AND NVL(AR05.SELL_CLMN_DIV_CD,NVL(BM02.SELL_CLMN_DIV_CD ,'@')) = NVL(BM02.SELL_CLMN_DIV_CD ,'@') -->
<!-- 							    	 AND NVL(AR05.SELL_PMNT_MTD_CD,NVL(BM02.SELL_PMNT_MTD_CD ,'@')) = NVL(BM02.SELL_PMNT_MTD_CD ,'@') -->
<!-- 							    	     THEN '' -->
<!-- 							    	ELSE AR05.PRDT_GRP END -->
<!-- 					             , CASE -->
<!-- 							    	WHEN NVL(AR05.SELL_CLMN_DAY   ,NVL(BM02.SELL_CLMN_DAY,0))       = NVL(BM02.SELL_CLMN_DAY,0)  -->
<!-- 							    	 AND NVL(AR05.SELL_CLMN_DIV_CD,NVL(BM02.SELL_CLMN_DIV_CD ,'@')) = NVL(BM02.SELL_CLMN_DIV_CD ,'@') -->
<!-- 							    	 AND NVL(AR05.SELL_PMNT_MTD_CD,NVL(BM02.SELL_PMNT_MTD_CD ,'@')) = NVL(BM02.SELL_PMNT_MTD_CD ,'@') -->
<!-- 							    	     THEN 0 -->
<!-- 							    	ELSE AR05.PRJCT_CD END -->
<!-- 					  		     , NVL(AR05.SELL_CLMN_DAY, BM02.SELL_CLMN_DAY) -->
<!-- 					   		     , BM02.SELL_CLMN_RMK -->
<!-- 							     , BM02.SELL_PAY_DIV_CD -->
<!-- 					  		     , NVL(AR05.SELL_CLMN_DIV_CD, BM02.SELL_CLMN_DIV_CD) -->
<!-- 					  		     , NVL(AR05.SELL_PMNT_MTD_CD, BM02.SELL_PMNT_MTD_CD) -->
<!-- 					  		     , BM02.SELL_VAT_CD -->
<!-- 					   UNION ALL -->
<!-- 							SELECT   2 AS TYPE1  - 당월 매출 -->
<!-- 							     , AR02.CO_CD -->
<!-- 								 , TRST_CLNT_CD AS CLNT_CD  -->
<!-- 				            	 , BM02.CLNT_NM -->
<!-- 							     , CASE -->
<!-- 							    	WHEN NVL(SD05.CLMN_DAY   ,NVL(BM02.SELL_CLMN_DAY,0))       = NVL(BM02.SELL_CLMN_DAY,0)  -->
<!-- 							    	 AND NVL(SD05.CLMN_DIV_CD,NVL(BM02.SELL_CLMN_DIV_CD ,'@')) = NVL(BM02.SELL_CLMN_DIV_CD ,'@') -->
<!-- 							    	 AND NVL(SD05.PMNT_MTD_CD,NVL(BM02.SELL_PMNT_MTD_CD ,'@')) = NVL(BM02.SELL_PMNT_MTD_CD ,'@') -->
<!-- 							    	     THEN '' -->
<!-- 							    	ELSE BM01.PRDT_GRP END -->
<!-- 					               AS PRDT_GRP -->
<!-- 							     , CASE -->
<!-- 							    	WHEN NVL(SD05.CLMN_DAY   ,NVL(BM02.SELL_CLMN_DAY,0))       = NVL(BM02.SELL_CLMN_DAY,0)  -->
<!-- 							    	 AND NVL(SD05.CLMN_DIV_CD,NVL(BM02.SELL_CLMN_DIV_CD ,'@')) = NVL(BM02.SELL_CLMN_DIV_CD ,'@') -->
<!-- 							    	 AND NVL(SD05.PMNT_MTD_CD,NVL(BM02.SELL_PMNT_MTD_CD ,'@')) = NVL(BM02.SELL_PMNT_MTD_CD ,'@') -->
<!-- 							    	     THEN 0 -->
<!-- 							    	ELSE AR02.PRJCT_CD END -->
<!-- 							    	AS PRJCT_CD -->
<!-- 					  		     , NVL(SD05.CLMN_DAY, SELL_CLMN_DAY) AS SELL_CLMN_DAY -->
<!-- 					   		     , BM02.SELL_CLMN_RMK -->
<!-- 							     , SELL_PAY_DIV_CD -->
<!-- 					  		     , NVL(SD05.CLMN_DIV_CD, SELL_CLMN_DIV_CD) AS SELL_CLMN_DIV_CD -->
<!-- 					  		     , NVL(SD05.PMNT_MTD_CD, SELL_PMNT_MTD_CD) AS SELL_PMNT_MTD_CD -->
<!-- 					  		     , SELL_VAT_CD -->
<!-- 						         , 0 AS PRE3_TRMEND_AMT     3개월전 채권잔액       -->
<!-- 						         , 0 AS PRE2_CELL_CLMN_AMT  2개월전 수금         -->
<!-- 						         , 0 AS PRE2_CELL_TOT_AMT   2개월전 매출          -->
<!-- 						         , 0 AS PRE2_TRMEND_AMT     2개월전 채권잔액     -->
<!-- 						         , 0 AS PRE1_CELL_CLMN_AMT  1개월전 수금        -->
<!-- 						         , 0 AS PRE1_CELL_TOT_AMT   1개월전 매출         -->
<!-- 						         , 0 AS PRE1_TRMEND_AMT     1개월전 채권잔액       -->
<!-- 						         , SUM(NVL(BILG_AMT, 0 ) + NVL(BILG_VAT_AMT, 0)) AS CUR_CELL_TOT_AMT   현재월 매출  -->
<!-- 				 		         , 0 AS CUR_CELL_CLMN_AMT       현재월 수금  -->
<!-- 						         , 0  AS CUR_TRMEND_CREDIT_AMT  현재월 채권잔액 -->
<!-- 							  FROM TB_AR02M01 AR02 -->
<!-- 							  INNER JOIN TB_BM01M01 BM01 ON BM01.PRDT_CD = AR02.TRST_PRDT_CD -->
<!-- 							   LEFT JOIN TB_BM02M01 BM02 ON BM02.CLNT_CD = AR02.TRST_CLNT_CD -->
<!-- 							   LEFT JOIN TB_SD05M01 SD05 ON SD05.PRJCT_CD = AR02.PRJCT_CD -->
<!-- 							  WHERE  SELPCH_CD = 'SELPCH2' -->
<!-- 							  <if test="coCd != null and !coCd.equals('')"> -->
<!-- 							  AND AR02.CO_CD = #{coCd}				 -->
<!-- 							  </if>	 -->
<!-- 							  <if test="clntCd != null and !clntCd.equals('')"> -->
<!-- 							  AND AR02.TRST_CLNT_CD = #{clntCd}				 -->
<!-- 							  </if>	 -->
<!-- 							  <if test="clntNm != null and !clntNm.equals('')"> -->
<!-- 							   AND BM02.CLNT_NM  LIKE '%' || #{clntNm} ||'%' -->
<!-- 							  </if>			 -->
<!-- 							   <if test="baseDt != null and !baseDt.equals('')"> -->
<!-- 					  	       AND TRST_DT BETWEEN  SUBSTRING(REPLACE(#{baseDt}, '-', ''),0,6) || '01' -->
<!-- 					  	                       AND  REPLACE(#{baseDt}, '-', '') -->
<!-- 							  </if> -->
<!-- 							  <if test="taxivcCoprt != null and !taxivcCoprt.equals('')"> -->
<!-- 							   AND AR02.TAXIVC_COPRT = #{taxivcCoprt} -->
<!-- 							  </if> -->
<!-- 							  <if test="prdtGrp != null and !prdtGrp.equals('')"> -->
<!-- 							   AND AR02.PRDT_DIV IN (SELECT DISTINCT PRDT_DIV -->
<!-- 												FROM TB_BM01M01 -->
<!-- 											    WHERE PRDT_GRP = #{prdtGrp} -->
<!-- 					  						   ) -->
<!-- 							  </if> -->
<!-- 							  GROUP BY AR02.CO_CD -->
<!-- 								 , TRST_CLNT_CD -->
<!-- 				            	 , BM02.CLNT_NM -->
<!-- 							     , CASE -->
<!-- 							    	WHEN NVL(SD05.CLMN_DAY   ,NVL(BM02.SELL_CLMN_DAY,0))       = NVL(BM02.SELL_CLMN_DAY,0)  -->
<!-- 							    	 AND NVL(SD05.CLMN_DIV_CD,NVL(BM02.SELL_CLMN_DIV_CD ,'@')) = NVL(BM02.SELL_CLMN_DIV_CD ,'@') -->
<!-- 							    	 AND NVL(SD05.PMNT_MTD_CD,NVL(BM02.SELL_PMNT_MTD_CD ,'@')) = NVL(BM02.SELL_PMNT_MTD_CD ,'@') -->
<!-- 							    	     THEN '' -->
<!-- 							    	ELSE BM01.PRDT_GRP END -->
<!-- 							     , CASE -->
<!-- 							    	WHEN NVL(SD05.CLMN_DAY   ,NVL(BM02.SELL_CLMN_DAY,0))       = NVL(BM02.SELL_CLMN_DAY,0)  -->
<!-- 							    	 AND NVL(SD05.CLMN_DIV_CD,NVL(BM02.SELL_CLMN_DIV_CD ,'@')) = NVL(BM02.SELL_CLMN_DIV_CD ,'@') -->
<!-- 							    	 AND NVL(SD05.PMNT_MTD_CD,NVL(BM02.SELL_PMNT_MTD_CD ,'@')) = NVL(BM02.SELL_PMNT_MTD_CD ,'@') -->
<!-- 							    	     THEN 0 -->
<!-- 							    	ELSE AR02.PRJCT_CD END -->
<!-- 					  		     , NVL(SD05.CLMN_DAY, SELL_CLMN_DAY) -->
<!-- 					   		     , BM02.SELL_CLMN_RMK -->
<!-- 							     , SELL_PAY_DIV_CD -->
<!-- 					  		     , NVL(SD05.CLMN_DIV_CD, SELL_CLMN_DIV_CD) -->
<!-- 					  		     , NVL(SD05.PMNT_MTD_CD, SELL_PMNT_MTD_CD) -->
<!-- 					  		     , SELL_VAT_CD -->
					            
		
<!-- 		</if>      -->
<!-- 		      ) A -->
<!-- 		      GROUP BY   A.CO_CD -->
<!-- 				       , A.CLNT_CD  -->
<!-- 				       , A.CLNT_NM -->
<!--  				       , PRDT_GRP -->
<!--  				       , PRJCT_CD  -->
<!-- 				       , DECODE(A.SELL_CLMN_DAY,0,'',A.SELL_CLMN_DAY) -->
<!-- 				       , A.SELL_CLMN_RMK -->
<!-- 				       , A.SELL_PAY_DIV_CD -->
<!-- 				       , A.SELL_CLMN_DIV_CD -->
<!-- 				       , A.PMNT_MTD_CD -->
<!-- 				       , A.SELL_VAT_CD -->
<!-- 	) AS AR07 -->
<!-- 		LEFT JOIN TB_CM05M01 CM05M01 ON  AR07.SELL_CLMN_DIV_CD = CM05M01.CODE_ID -->
<!--     ORDER BY   CO_CD -->
<!-- 		       , CLNT_CD  -->
<!-- 		       , PRDT_GRP -->
<!-- 		       , PRJCT_CD -->
<!-- 		       , SELL_PAY_DIV_NM -->
<!-- 		       , SELL_CLMN_DIV_NM -->
<!-- 		       , SELL_PMNT_MTD_NM -->
<!-- 		       , SELL_CLMN_DAY		        -->
		       
		       
<!-- 	</select> -->
	
<!-- 	<select id="selectClosCditList" resultType="CamelMap"> -->
<!-- 	SELECT AR07.*, (SELECT NAME FROM TB_CM06M01 WHERE ID = AR07.SALES_EMP_ID  ) AS SALES_EMP_NM -->
<!-- 	      , (SELECT PRJCT_NM FROM TB_SD05M01 SD05 WHERE SD05.PRJCT_CD = AR07.PRJCT_CD  ) AS PRJCT_NM -->
<!-- 	  	  , FN_CM05M01_CD_TO_NM(AR07.PRDT_GRP)  AS PRDT_GRP_NM -->
<!-- 	      , FN_CM05M01_CD_TO_NM(AR07.CO_CD) AS CO_NM -->
<!-- 		  , FN_CM05M01_CD_TO_NM(AR07.SELL_PAY_DIV_CD) AS SELL_PAY_DIV_NM -->
<!-- 		  , FN_CM05M01_CD_TO_NM(AR07.SELL_CLMN_DIV_CD) AS SELL_CLMN_DIV_NM -->
<!-- 		  , FN_CM05M01_CD_TO_NM(AR07.SELL_PMNT_MTD_CD) AS SELL_PMNT_MTD_NM -->
<!-- 		  , FN_CM05M01_CD_TO_NM(AR07.SELL_VAT_CD) AS SELL_VAT_NM -->
<!-- 		  , (SELECT SALES_EMP_ID FROM TB_BM02D01 BM02D01 WHERE BM02D01.CLNT_CD = AR07.CLNT_CD AND BM02D01.SALES_CO_CD = AR07.CO_CD AND BM02D01.USE_YN = 'Y' AND ROWNUM = 1 )  SALES_EMP_ID -->
<!-- 	      , F_CREDIT_LOAN2('T',AR07.CLNT_CD,AR07.CO_CD,AR07.PRDT_GRP,TO_CHAR(LAST_DAY(TO_DATE(REPLACE(#{baseDt},'-',''), 'YYYYMMDD')), 'YYYYMMDD'),0) AS CRDT_LMT    총여신금액 -->
<!-- 		  , F_CREDIT_LOAN2('C',AR07.CLNT_CD,AR07.CO_CD,AR07.PRDT_GRP,TO_CHAR(LAST_DAY(TO_DATE(REPLACE(#{baseDt},'-',''), 'YYYYMMDD')), 'YYYYMMDD'),0) AS CRDT_LOAN   여신잔액 -->
<!-- 		  , NVL((SELECT SUM(ETRDPS_AMT) FROM TB_AR05M01 AR05  -->
<!-- 		           INNER JOIN TB_AR05D01 AR05D   -->
<!-- 		                 ON AR05D.CO_CD = AR05.CO_CD AND AR05D.CLNT_CD = AR05.CLNT_CD AND AR05D.BIL_NO = AR05.BIL_NO -->
<!-- 		         WHERE AR05.ETRDPS_DT  <![CDATA[<= ]]>TO_CHAR(LAST_DAY(TO_DATE(REPLACE(#{baseDt},'-',''),'YYYYMMDD')),'YYYYMMDD') -->
<!-- 		           AND AR05D.EXPRTN_DT <![CDATA[>  ]]>TO_CHAR(LAST_DAY(TO_DATE(REPLACE(#{baseDt},'-',''),'YYYYMMDD')),'YYYYMMDD') -->
<!-- 		           AND AR05.CO_CD = AR07.CO_CD -->
<!-- 		           AND AR05.CLNT_CD = AR07.CLNT_CD),0) AS UNSETL_BIL_AMT  미결제어음 -->
<!-- 		   ,(SELECT SUM(NVL(PLDG_AMT,0) /100 * NVL(PLDG_RCOGN_RATE,1))  -->
<!-- 		       FROM TB_BM02D02 BM02D02 -->
<!-- 		      WHERE BM02D02.CLNT_CD = AR07.CLNT_CD AND BM02D02.CO_CD = AR07.CO_CD AND BM02D02.USE_YN = 'Y' -->
<!-- 		        AND NVL(EXPRTN_DT,TO_CHAR(LAST_DAY(TO_DATE(REPLACE(#{baseDt},'-',''),'YYYYMMDD')),'YYYYMMDD')) <![CDATA[<= ]]> TO_CHAR(LAST_DAY(TO_DATE(REPLACE(#{baseDt},'-',''),'YYYYMMDD')),'YYYYMMDD')) AS PLDG_AMT  담보금액 -->
<!-- 	FROM ( -->
<!-- 			SELECT CO_CD -->
<!-- 				 , CLNT_CD  -->
<!--             	 , CLNT_NM -->
<!--             	 , CRN_NO -->
<!-- 			     , PRDT_GRP -->
<!-- 			     , PRJCT_CD -->
<!-- 			     ,  (SELECT SALES_EMP_ID FROM TB_BM02D01 BM02D01 WHERE BM02D01.CLNT_CD = A.CLNT_CD AND BM02D01.SALES_CO_CD = A.CO_CD AND BM02D01.USE_YN = 'Y' AND ROWNUM = 1 )  SALES_EMP_ID -->
<!-- 	  		     , SELL_CLMN_DAY -->
<!-- 	   		     , SELL_CLMN_RMK -->
<!-- 			     , SELL_PAY_DIV_CD -->
<!-- 	  		     , SELL_CLMN_DIV_CD -->
<!-- 	  		     , SELL_PMNT_MTD_CD -->
<!-- 	  		     , SELL_VAT_CD -->
<!-- 	  		     , SUM(DECODE(SUBSTRING(TRST_DT,0,6),TO_CHAR(ADD_MONTHS(TO_DATE(#{baseDt},'YYYYMMDD'),-0),'YYYYMM'), TOT_AMT,0)) AS CUR_CREDIT_AMT -->
<!-- 	  		     , SUM(DECODE(SUBSTRING(TRST_DT,0,6),TO_CHAR(ADD_MONTHS(TO_DATE(#{baseDt},'YYYYMMDD'),-1),'YYYYMM'), TOT_AMT,0)) AS PRE1_CREDIT_AMT -->
<!-- 	  		     , SUM(DECODE(SUBSTRING(TRST_DT,0,6),TO_CHAR(ADD_MONTHS(TO_DATE(#{baseDt},'YYYYMMDD'),-2),'YYYYMM'), TOT_AMT,0)) AS PRE2_CREDIT_AMT -->
<!-- 	  		     , SUM(CASE WHEN TO_DATE(TRST_DT,'YYYYMMDD') <![CDATA[ <= ]]> LAST_DAY(ADD_MONTHS(TO_DATE(#{baseDt},'YYYYMMDD'),-3)) THEN TOT_AMT ELSE 0 END)  AS PRE3_CREDIT_AMT -->
<!-- 	  		     , SUM(TOT_AMT) AS CUR_TRMEND_CREDIT_AMT -->
<!-- 			FROM (  SELECT  -->
<!-- 					      AR02.CO_CD -->
<!-- 						 , TRST_CLNT_CD AS CLNT_CD  -->
<!-- 		            	 , BM02.CLNT_NM -->
<!-- 		            	 , BM02.CRN AS CRN_NO -->
<!-- 		            	 , AR02.TRST_DT -->
<!-- 					     , CASE -->
<!-- 					    	WHEN NVL(SD05.CLMN_DAY   ,NVL(BM02.SELL_CLMN_DAY,0))       = NVL(BM02.SELL_CLMN_DAY,0)  -->
<!-- 					    	 AND NVL(SD05.CLMN_DIV_CD,NVL(BM02.SELL_CLMN_DIV_CD ,'@')) = NVL(BM02.SELL_CLMN_DIV_CD ,'@') -->
<!-- 					    	 AND NVL(SD05.PMNT_MTD_CD,NVL(BM02.SELL_PMNT_MTD_CD ,'@')) = NVL(BM02.SELL_PMNT_MTD_CD ,'@') -->
<!-- 					    	     THEN '' -->
<!-- 					    	ELSE BM01.PRDT_GRP END -->
<!-- 			               AS PRDT_GRP -->
<!-- 					     , CASE -->
<!-- 					    	WHEN NVL(SD05.CLMN_DAY   ,NVL(BM02.SELL_CLMN_DAY,0))       = NVL(BM02.SELL_CLMN_DAY,0)  -->
<!-- 					    	 AND NVL(SD05.CLMN_DIV_CD,NVL(BM02.SELL_CLMN_DIV_CD ,'@')) = NVL(BM02.SELL_CLMN_DIV_CD ,'@') -->
<!-- 					    	 AND NVL(SD05.PMNT_MTD_CD,NVL(BM02.SELL_PMNT_MTD_CD ,'@')) = NVL(BM02.SELL_PMNT_MTD_CD ,'@') -->
<!-- 					    	     THEN 0 -->
<!-- 					    	ELSE AR02.PRJCT_CD END -->
<!-- 					    	AS PRJCT_CD -->
<!-- 			  		     , NVL(SD05.CLMN_DAY, BM02.SELL_CLMN_DAY) AS SELL_CLMN_DAY -->
<!-- 			   		     , BM02.SELL_CLMN_RMK -->
<!-- 					     , SELL_PAY_DIV_CD -->
<!-- 			  		     , NVL(SD05.CLMN_DIV_CD, BM02.SELL_CLMN_DIV_CD) AS SELL_CLMN_DIV_CD -->
<!-- 			  		     , NVL(SD05.PMNT_MTD_CD, BM02.SELL_PMNT_MTD_CD) AS SELL_PMNT_MTD_CD -->
<!-- 			  		     , SELL_VAT_CD -->
<!-- 			  		     , CASE -->
<!-- 							    WHEN CM05M01.CODE_RPRC = 'MON' THEN TO_CHAR(LAST_DAY(ADD_MONTHS(TRUNC(TO_DATE(TRST_DT,'YYYYMMDD'),'MM'), NVL(CM05M01.CODE_ETC,0)) -1) + NVL(NVL(SD05.CLMN_DAY, BM02.SELL_CLMN_DAY) ,0), 'YYYYMMDD') -->
<!-- 							   	WHEN CM05M01.CODE_RPRC = 'DAY' THEN TO_CHAR(TO_DATE(TRST_DT,'YYYYMMDD')+ NVL(NVL(SD05.CLMN_DAY, BM02.SELL_CLMN_DAY) ,0), 'YYYYMMDD') -->
<!-- 						  END AS PCHS_CLMN_DAY -->
<!-- 	  		             , CASE WHEN  CASE -->
<!-- 									    WHEN CM05M01.CODE_RPRC = 'MON' THEN TO_CHAR(LAST_DAY(ADD_MONTHS(TRUNC(TO_DATE(TRST_DT,'YYYYMMDD'),'MM'), NVL(CM05M01.CODE_ETC,0)) -1) + NVL(NVL(SD05.CLMN_DAY, BM02.SELL_CLMN_DAY) ,0), 'YYYYMMDD') -->
<!-- 									   	WHEN CM05M01.CODE_RPRC = 'DAY' THEN TO_CHAR(TO_DATE(TRST_DT,'YYYYMMDD')+ NVL(NVL(SD05.CLMN_DAY, BM02.SELL_CLMN_DAY) ,0), 'YYYYMMDD') -->
<!-- 								      END -->
<!-- 							   	 <![CDATA[  < ]]>  REPLACE(#{baseDt}, '-', '') THEN 'Y' ELSE 'N' END AS DELAY_YN -->
<!-- 				         ,NVL(BILG_AMT, 0 ) + NVL(BILG_VAT_AMT, 0) - NVL(AR02.ETRDPS_AMT,0) AS TOT_AMT   매출채권금액 -->
<!-- 				         ,AR02.ETRDPS_AMT AS ETRDPS_AMT  수금금액 -->
<!-- 				         ,(SELECT SUM(AR05D02.ETRDPS_AMT) FROM TB_AR05D02 AR05D02 WHERE AR05D02.CO_CD = AR02.CO_CD AND  AR05D02.TRST_CERTI_NO = AR02.TRST_CERTI_NO ) AS ETRDPS_AMT2 -->
<!-- 				  FROM TB_AR02M01 AR02 -->
<!-- 			 	  INNER JOIN TB_BM01M01 BM01 ON BM01.PRDT_CD  = AR02.TRST_PRDT_CD -->
<!-- 				  INNER JOIN TB_BM02M01 BM02 ON BM02.CLNT_CD  = AR02.TRST_CLNT_CD -->
<!-- 				   LEFT JOIN TB_SD05M01 SD05 ON SD05.PRJCT_CD = AR02.PRJCT_CD -->
<!-- 				   LEFT JOIN TB_CM05M01 CM05M01 ON  NVL(SD05.CLMN_DIV_CD, BM02.SELL_CLMN_DIV_CD) = CM05M01.CODE_ID -->
<!-- 				  WHERE  SELPCH_CD = 'SELPCH2' -->
<!--  	현재일기준	  	       AND AR02.TRST_DT <![CDATA[ <= ]]>  REPLACE(#{baseDt}, '-', '')  -->
<!-- 		  	       AND AR02.ETRDPS_YN = 'N' -->
<!-- 		  	       <if test="coCd != null and !coCd.equals('')"> -->
<!-- 			       AND AR02.CO_CD = #{coCd}				 -->
<!-- 			       </if>	 -->
<!-- 			       <if test="clntCd != null and !clntCd.equals('')"> -->
<!-- 			        AND AR02.TRST_CLNT_CD = #{clntCd}				 -->
<!-- 			       </if> -->
<!-- 			       <if test="clntNm != null and !clntNm.equals('')"> -->
<!-- 				    AND BM02.CLNT_NM  LIKE '%' || #{clntNm} ||'%' -->
<!-- 				   </if> -->
<!-- 			       <if test="taxivcCoprt != null and !taxivcCoprt.equals('')"> -->
<!--                     AND AR02.TAXIVC_COPRT = #{taxivcCoprt} -->
<!--                    </if> -->
<!--                    <if test="prdtGrp != null and !prdtGrp.equals('')"> -->
<!--                     AND BM01.PRDT_GRP = #{prdtGrp} -->
<!--                    </if> -->
<!-- 			) A    -->
<!-- 			WHERE PCHS_CLMN_DAY <![CDATA[  < ]]>  REPLACE(#{baseDt}, '-', '') -->
<!-- 			GROUP BY  -->
<!-- 			       CO_CD -->
<!-- 				 , CLNT_CD  -->
<!--             	 , CLNT_NM -->
<!--             	 , CRN_NO -->
<!-- 			     , PRDT_GRP -->
<!-- 			     , PRJCT_CD -->
<!-- 	  		     , SELL_CLMN_DAY -->
<!-- 	   		     , SELL_CLMN_RMK -->
<!-- 			     , SELL_PAY_DIV_CD -->
<!-- 	  		     , SELL_CLMN_DIV_CD -->
<!-- 	  		     , SELL_PMNT_MTD_CD -->
<!-- 	  		     , SELL_VAT_CD -->
<!-- 	  		     , CASE WHEN PCHS_CLMN_DAY <![CDATA[  < ]]>  REPLACE('20210907', '-', '') THEN 'Y' ELSE 'N' END -->
<!-- 	     ) AR07 -->
<!-- 	   WHERE CUR_TRMEND_CREDIT_AMT != 0 -->
<!--        ORDER BY  CO_CD -->
<!-- 								 , CLNT_CD  -->
<!-- 				            	 , CLNT_NM -->
<!-- 							     , PRDT_GRP -->
<!-- 							     , PRJCT_CD -->
		       
<!-- 	</select> -->
	
	