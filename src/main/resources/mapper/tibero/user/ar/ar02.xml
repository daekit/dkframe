<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.dksys.biz.user.ar.ar02.mapper.AR02Mapper">

	<insert id="insertPchsSell" parameterType="Map">
		<selectKey keyProperty="trstCertiNo" resultType="String" order="BEFORE">
			SELECT TB_AR02M01_SQ01.NEXTVAL FROM DUAL
		</selectKey>
		INSERT INTO TB_AR02M01 
		(
			<if test='pgmId != null and pgmId == "AR0202P01"'>
				<if test='transSeq != null and transSeq != ""'>
				TRANS_SEQ,
				</if>
			</if>
			CO_CD,
			TRST_CERTI_NO,
			SELPCH_CD,
			TAXIVC_COPRT,
			TRST_DT,
			TRST_CLNT_CD,
			TRST_PRDT_CD,
			<if test='ownerCd != null and ownerCd != ""'>
			OWNER_CD,
			</if>
			IMP_YN,
			TYP_CD,
			TRSP_TYP_CD,
			<if test='trstRprcSeq != null and trstRprcSeq != ""'>
			TRST_RPRC_SEQ,
			</if>
			<if test='trstDtlSeq != null and trstDtlSeq != ""'>
			TRST_DTL_SEQ,
			</if>
			PRDT_LEN,
			<if test='odrNo != null and odrNo != ""'>
			ODR_NO,
			</if>
			SALES_MNG,
			PRJCT_CD,
			<if test='makrCd != null and makrCd != ""'>
			MAKR_CD,
			</if>
			WH_CD,
			<if test='mngTel != null and mngTel != ""'>
			MNG_TEL,
			</if>
			DLVR_DTTM,
			<if test='realDlvrDttm != null and realDlvrDttm != ""'>
			REAL_DLVR_DTTM,
			</if>
			DIRTRS_YN,
			PRDT_DIV,
			PRDT_STKN,
			<if test='prdtSize != null and prdtSize != ""'>
			PRDT_SIZE,
			</if>
			PRDT_UNIT,
			PRDT_UPR,
			STOCK_UPR,
			PCHS_UPR,
			SELL_UPR,
			TRST_QTY,
			TRST_WT,
			TRST_UPR,
			TRST_AMT,
			REAL_TRST_QTY,
			REAL_TRST_WT,
			REAL_TRST_UPR,
			REAL_TRST_AMT,
			BILG_QTY,
			BILG_WT,
			BILG_UPR,
			BILG_AMT,
			TRST_DC_AMT,
			ETC_AMT,
			TRSP_RMK,
			TRANS_AMT,
			SHIP_VEH_NO,
			CLNT_NM,
			BILG_CERT_NO,
			LOSS_RATE,
			ODR_CREAT_DIV,
			ETC_FIELD1,
			ETC_FIELD2,
			ETC_FIELD3,
			CREAT_ID,
			CREAT_PGM,
			CREAT_DTTM,
			UDT_ID,
			UDT_PGM,
			UDT_DTTM, 
			<if test='salesAreaCd != null and salesAreaCd != ""'>
	        SALES_AREA_CD,
	        </if>
	        SITE_CD,
	        
	        <if test='prdtSpec != null and prdtSpec != ""'>
	        PRDT_SPEC,
	        </if>
	        <if test='shipCnt != null and shipCnt != ""'>
	        SHIP_CNT,
	        </if>
	        <if test='subClntCd != null and subClntCd != ""'>
	        SUB_CLNT_CD,
	        SUB_CLNT_NM,
	        </if>
	        BILG_VAT_AMT
		)
		VALUES 
		(
			<if test='pgmId != null and pgmId == "AR0202P01"'>
				<if test='transSeq != null and transSeq != ""'>
				#{transSeq},
				</if>
			</if>
			#{coCd},
			#{trstCertiNo},
			#{selpchCd},
			#{taxivcCoprt, jdbcType=VARCHAR},
			#{trstDt,   jdbcType=VARCHAR},
			#{clntCd,   jdbcType=VARCHAR},
			#{prdtCd,   jdbcType=VARCHAR},
			<if test='ownerCd != null and ownerCd != ""'>
				#{ownerCd,  jdbcType=VARCHAR},
			</if>
			#{impYn},
			#{typCd},
			#{trspTypCd ,  jdbcType=VARCHAR},
			<if test='trstRprcSeq != null and trstRprcSeq != ""'>
				#{trstRprcSeq, jdbcType=VARCHAR},
			</if>
			<if test='trstDtlSeq != null and trstDtlSeq != ""'>
				#{trstDtlSeq,  jdbcType=VARCHAR},
			</if>
			#{prdtLen,     jdbcType=VARCHAR},
			<if test='odrNo != null and odrNo != ""'>
				#{odrNo,       jdbcType=VARCHAR},
			</if>
			#{salesMng,    jdbcType=VARCHAR},
			#{prjctCd},
			<if test='makrCd != null and makrCd != ""'>
				#{makrCd},
			</if>
			#{whCd,     jdbcType=VARCHAR},
			<if test='mngTel != null and mngTel != ""'>
				#{mngTel,   jdbcType=VARCHAR},
			</if>
			#{dlvrDttm, jdbcType=VARCHAR},
			<if test='realDlvrDttm != null and realDlvrDttm != ""'>
				#{realDlvrDttm, jdbcType=VARCHAR},
			</if>
			#{dirtrsYn, jdbcType=VARCHAR},
			#{prdtDiv,  jdbcType=VARCHAR},
			#{prdtStkn, jdbcType=VARCHAR},
			<if test='prdtSize != null and prdtSize != ""'>
				#{prdtSize, jdbcType=VARCHAR},
			</if>
			#{prdtUnit, jdbcType=VARCHAR},
			#{prdtUpr,  jdbcType=VARCHAR},
			NULL,
			#{pchsUpr, jdbcType=VARCHAR},
			#{sellUpr, jdbcType=VARCHAR},
			#{trstQty, jdbcType=VARCHAR},
			#{trstWt,  jdbcType=VARCHAR},
			#{trstUpr, jdbcType=VARCHAR},
			#{trstAmt, jdbcType=VARCHAR},
			#{realTrstQty, jdbcType=VARCHAR},
			#{realTrstWt,  jdbcType=VARCHAR},
			#{realTrstUpr, jdbcType=VARCHAR},
			#{realTrstAmt, jdbcType=VARCHAR},
			#{bilgQty,   jdbcType=VARCHAR},
			#{bilgWt,    jdbcType=VARCHAR},
			#{bilgUpr,   jdbcType=VARCHAR},
			#{bilgAmt,   jdbcType=VARCHAR},
			NVL(#{trstDcAmt, jdbcType=VARCHAR}, 0),
			NVL(#{etcAmt,  	 jdbcType=VARCHAR}, 0),
			#{trspRmk,   	 jdbcType=VARCHAR},
			NVL(#{transAmt,  jdbcType=VARCHAR}, 0),
			#{shipVehNo, jdbcType=VARCHAR},
			#{clntNm,    jdbcType=VARCHAR},
			NULL,
			#{lossRate,    jdbcType=VARCHAR},
			NVL(#{odrCreatDiv, jdbcType=VARCHAR},'ERP'),
			NULL,
			NULL,
			NULL,
			#{userId},
			#{pgmId},
			SYSDATE,
			#{userId},
			<choose>
				<when test="updatePgmId != null and !updatePgmId.equals('')">
					#{updatePgmId},
				</when>
				<otherwise>
					#{pgmId},
				</otherwise>
			</choose>
			SYSDATE,
			<if test='salesAreaCd != null and salesAreaCd != ""'>
	        	#{salesAreaCd, jdbcType=VARCHAR},
	        </if>
	        NVL(#{siteCd,  jdbcType=VARCHAR},0),
	        
	        <if test='prdtSpec != null and prdtSpec != ""'>
	        	#{prdtSpec,    jdbcType=VARCHAR},
	        </if>
	        <if test='shipCnt != null and shipCnt != ""'>
	        	#{shipCnt,     jdbcType=VARCHAR},
	        </if>
	        <if test='subClntCd != null and subClntCd != ""'>
	        	#{subClntCd},
	        	#{subClntNm},
	        </if>
	        #{bilgVatAmt,  jdbcType=VARCHAR}
		)
	</insert>
	
	<select id="selectSellMainCount" parameterType="Map" resultType="int">
		SELECT
			COUNT(*)
		FROM
		(
			SELECT 
				T.CO_CD,
				T.TRST_CLNT_CD,
				T.CLNT_NM,
			    T.TAXIVC_COPRT,
			    FN_CM05M01_CD_TO_NM(T.TAXIVC_COPRT) AS TAXIVC_COPRT_NM,
			    <if test='siteDivYn != null and siteDivYn == "Y"'>
				    T.SITE_CD,
				    SD09M01.SITE_NM,
			    </if>
		        <if test="selpchCd == 'SELPCH2' or selpchCd == 'SELPCH4'">
				   (SELECT CLNT_NM FROM TB_BM02M01  BM02
	                     INNER JOIN  TB_OD01M01 OD01M01  ON BM02.CLNT_CD = OD01M01.CLNT_CD 
	                     WHERE  T.TRST_RPRC_SEQ = OD01M01.ORDRG_SEQ  AND T.CREAT_PGM LIKE 'OD'||'%') AS PCHS_CLNT_NM, 
			    </if>
			    SUM(T.BILG_QTY) BILG_QTY,
			    SUM(T.BILG_WT) BILG_WT,
			    SUM(T.BILG_UPR) BILG_UPR,
			    SUM(T.BILG_AMT) BILG_AMT,
			    NVL(SUM(T.ETC_AMT), '0') AS ETC_AMT,
			    NVL(SUM(T.TRANS_AMT), '0') AS TRANS_AMT,
			    NVL(SUM(T.TRST_DC_AMT), '0') AS TRST_DC_AMT,
			    SUM(T.BILG_VAT_AMT) BILG_VAT_AMT,
			    SUM(T.BILG_VAT_AMT) + SUM(T.BILG_AMT) AS TOT_AMT
			FROM 
				TB_AR02M01 T
				LEFT JOIN TB_SD09M01 SD09M01 ON T.SITE_CD = SD09M01.SITE_CD
				LEFT JOIN TB_CM06M01 CM06M01 ON T.SALES_MNG = CM06M01.ID
				LEFT JOIN TB_BM01M01 BM01    ON T.TRST_PRDT_CD = BM01.PRDT_CD
		 	WHERE 
		 		SELPCH_CD = #{selpchCd}
			<if test="coCd != null and !coCd.equals('')">
				AND T.CO_CD = #{coCd}				
			</if>
			<if test="reqDtFrom != null and !reqDtFrom.equals('')">
				AND T.TRST_DT BETWEEN #{reqDtFrom} AND #{reqDtTo}		
			</if>
			<if test="clntCd != null and !clntCd.equals('')">
				AND T.TRST_CLNT_CD = #{clntCd}
			</if>
			<if test="clntNm != null and !clntNm.equals('')">
				AND T.CLNT_NM LIKE '%${clntNm}%'
			</if>
			<if test="prdtDiv != null and !prdtDiv.equals('')">
				AND T.PRDT_DIV = #{prdtDiv}				
			</if>
			<if test="estCoprt != null and !estCoprt.equals('')">
				AND T.TAXIVC_COPRT = #{estCoprt}				
			</if>
			<if test="taxivcCoprt != null and !taxivcCoprt.equals('')">
				AND T.TAXIVC_COPRT = #{taxivcCoprt}				
			</if>
			<if test="dirtrsYn != null and !dirtrsYn.equals('')">
				AND T.DIRTRS_YN = #{dirtrsYn}				
			</if>
			<if test="typCd != null and !typCd.equals('')">
				AND T.TYP_CD = #{typCd}				
			</if>
			<if test="prjctCd != null and !prjctCd.equals('')">
				AND T.PRJCT_CD = #{prjctCd}				
			</if>
			<if test="siteCd != null and !siteCd.equals('')">
				AND T.SITE_CD = #{siteCd}				
			</if>
			<if test="siteNm != null and !siteNm.equals('')">
				AND SD09M01.SITE_NM LIKE '%'|| #{siteNm} || '%'				
			</if>
			<if test="pdsk != null and !pdsk.equals('')">
				AND T.PRDT_STKN = #{pdsk}				
			</if>
			<if test="bilgYn != null and !bilgYn.equals('')">
				<choose>
					<when test='bilgYn == "Y"'>
						AND T.BILG_CERT_NO IS NOT NULL 		
					</when>
					<otherwise>
						AND T.BILG_CERT_NO IS NULL 
					</otherwise>
				</choose>
			</if>
			<if test="salesMng != null and !salesMng.equals('')">
				AND T.SALES_MNG = #{salesMng}				
			</if>
			<if test="salesMngNm != null and !salesMngNm.equals('')">
				AND CM06M01.NAME LIKE '%'|| #{salesMngNm} || '%'				
			</if>
			<if test="whCd != null and !whCd.equals('')">
				AND T.WH_CD = #{whCd}
			</if>
			<if test="trspRmk != null and !trspRmk.equals('')">
				AND T.TRSP_RMK LIKE '%'|| #{trspRmk} || '%'
			</if>
			<if test="prdtGrp != null and !prdtGrp.equals('')">
				AND BM01.PRDT_GRP = #{prdtGrp}
			</if>
			<if test="trspTypCd != null and !trspTypCd.equals('')">
				AND T.TRSP_TYP_CD = #{trspTypCd}
			</if>
			<if test="makrCd != null and !makrCd.equals('')">
				AND T.MAKR_CD = #{makrCd}
			</if>
			GROUP BY 
				T.CO_CD
				, T.TRST_CLNT_CD
				, T.CLNT_NM 
				, T.TAXIVC_COPRT
				<if test='siteDivYn != null and siteDivYn == "Y"'>
					, T.SITE_CD
					, SD09M01.SITE_NM
				</if>
				<if test="selpchCd == 'SELPCH2' or selpchCd == 'SELPCH4'">
				   ,T.TRST_RPRC_SEQ
				   ,T.CREAT_PGM
			    </if>
		)
		<if test="selpchCd == 'SELPCH2' or selpchCd == 'SELPCH4'">
			<if test="pchsClntNm != null and !pchsClntNm.equals('')">
				WHERE PCHS_CLNT_NM LIKE '%'|| #{pchsClntNm} || '%'
			</if>
		</if>
	</select>
	
	<select id="selectSellMainList" parameterType="Map" resultType="CamelMap">
		SELECT
			*
		FROM
		(
			SELECT
				A.*,
				ROWNUM AS RNUM
			FROM
			(
			 	SELECT 
					T.CO_CD,
					T.TRST_CLNT_CD,
					T.CLNT_NM,
				    T.TAXIVC_COPRT,
				    FN_CM05M01_CD_TO_NM(T.TAXIVC_COPRT) AS TAXIVC_COPRT_NM,
				    <if test='siteDivYn != null and siteDivYn == "Y"'>
					    T.SITE_CD,
				    	SD09M01.SITE_NM,
					    T.PRJCT_CD,
				    </if>
 				    <if test="selpchCd == 'SELPCH2' or selpchCd == 'SELPCH4'">
 					   (SELECT CLNT_NM FROM TB_BM02M01  BM02
 		                     INNER JOIN  TB_OD01M01 OD01M01  ON BM02.CLNT_CD = OD01M01.CLNT_CD 
 		                     WHERE  T.TRST_RPRC_SEQ = OD01M01.ORDRG_SEQ  AND T.CREAT_PGM LIKE 'OD'||'%') AS PCHS_CLNT_NM, 
 				    </if> 
 				    <if test="selpchCd == 'SELPCH1' or selpchCd == 'SELPCH3'">
 					   (SELECT CLNT_NM FROM TB_BM02M01  BM02
 		                     INNER JOIN  TB_OD01M01 OD01M01  ON BM02.CLNT_CD = OD01M01.SELL_CLNT_CD 
 		                     WHERE  T.TRST_RPRC_SEQ = OD01M01.ORDRG_SEQ  AND T.CREAT_PGM LIKE 'OD'||'%') AS SELL_CLNT_NM, 
 				    </if>
				    SUM(T.BILG_QTY) BILG_QTY,
				    SUM(T.BILG_WT) BILG_WT,
				    SUM(T.BILG_UPR) BILG_UPR,
				    SUM(T.BILG_AMT) BILG_AMT,
				    NVL(SUM(T.ETC_AMT), '0') AS ETC_AMT,
				    NVL(SUM(T.TRANS_AMT), '0') AS TRANS_AMT,
				    NVL(SUM(T.TRST_DC_AMT), '0') AS TRST_DC_AMT,
				    SUM(T.BILG_VAT_AMT) BILG_VAT_AMT,
				    SUM(T.BILG_VAT_AMT) + SUM(T.BILG_AMT) AS TOT_AMT
				FROM 
					TB_AR02M01 T
					LEFT JOIN TB_SD09M01 SD09M01 ON T.SITE_CD = SD09M01.SITE_CD
					LEFT JOIN TB_CM06M01 CM06M01 ON T.SALES_MNG = CM06M01.ID
					LEFT JOIN TB_BM01M01 BM01    ON T.TRST_PRDT_CD = BM01.PRDT_CD
			 	WHERE 
			 		SELPCH_CD = #{selpchCd}
				<if test="coCd != null and !coCd.equals('')">
					AND T.CO_CD = #{coCd}				
				</if>
				<if test="reqDtFrom != null and !reqDtFrom.equals('')">
					AND T.TRST_DT BETWEEN #{reqDtFrom} AND #{reqDtTo}		
				</if>
				<if test="clntCd != null and !clntCd.equals('')">
					AND T.TRST_CLNT_CD = #{clntCd}
				</if>
				<if test="clntNm != null and !clntNm.equals('')">
					AND T.CLNT_NM LIKE '%${clntNm}%'
				</if>
				<if test="prdtDiv != null and !prdtDiv.equals('')">
					AND T.PRDT_DIV = #{prdtDiv}				
				</if>
				<if test="prdtSpec != null and !prdtSpec.equals('')">
					AND T.PRDT_SPEC LIKE '%${prdtSpec}%'
				</if>
				<if test="taxivcCoprt != null and !taxivcCoprt.equals('')">
					AND T.TAXIVC_COPRT = #{taxivcCoprt}				
				</if>
				<if test="dirtrsYn != null and !dirtrsYn.equals('')">
					AND T.DIRTRS_YN = #{dirtrsYn}				
				</if>
				<if test="typCd != null and !typCd.equals('')">
					AND T.TYP_CD = #{typCd}				
				</if>
				<if test="prjctCd != null and !prjctCd.equals('')">
					AND T.PRJCT_CD = #{prjctCd}				
				</if>
				<if test="siteCd != null and !siteCd.equals('')">
					AND T.SITE_CD = #{siteCd}				
				</if>
				<if test="siteNm != null and !siteNm.equals('')">
					AND SD09M01.SITE_NM LIKE '%'|| #{siteNm} || '%'				
				</if>
				<if test="pdsk != null and !pdsk.equals('')">
					AND T.PRDT_STKN = #{pdsk}				
				</if>
				<if test="bilgYn != null and !bilgYn.equals('')">
					<choose>
						<when test='bilgYn == "Y"'>
							AND T.BILG_CERT_NO IS NOT NULL 		
						</when>
						<otherwise>
							AND T.BILG_CERT_NO IS NULL 
						</otherwise>
					</choose>
				</if>
				<if test="salesMng != null and !salesMng.equals('')">
					AND T.SALES_MNG = #{salesMng}				
				</if>
				<if test="salesMngNm != null and !salesMngNm.equals('')">
					AND CM06M01.NAME LIKE '%'|| #{salesMngNm} || '%'				
				</if>
				<if test="whCd != null and !whCd.equals('')">
					AND T.WH_CD = #{whCd}
				</if>
				<if test="trspRmk != null and !trspRmk.equals('')">
					AND T.TRSP_RMK LIKE '%'|| #{trspRmk} || '%'
				</if>
				<if test="prdtGrp != null and !prdtGrp.equals('')">
					AND BM01.PRDT_GRP = #{prdtGrp}
				</if>
				<if test="trspTypCd != null and !trspTypCd.equals('')">
					AND T.TRSP_TYP_CD = #{trspTypCd}
				</if>
				<if test="makrCd != null and !makrCd.equals('')">
					AND T.MAKR_CD = #{makrCd}
				</if>
				GROUP BY 
					T.CO_CD
					, T.TRST_CLNT_CD
					, T.CLNT_NM 
					, T.TAXIVC_COPRT
					<if test='siteDivYn != null and siteDivYn == "Y"'>
						, T.SITE_CD
						, SD09M01.SITE_NM
					    , T.PRJCT_CD
					</if>
 					<if test="selpchCd == 'SELPCH2' or selpchCd == 'SELPCH4' or selpchCd == 'SELPCH1' or selpchCd == 'SELPCH3'">
					   ,T.TRST_RPRC_SEQ
					   ,T.CREAT_PGM
 				    </if> 
				ORDER BY 
					T.CLNT_NM
					, TAXIVC_COPRT_NM
					<if test='siteDivYn != null and siteDivYn == "Y"'>
						,SD09M01.SITE_NM
					</if>
			) A
			 <if test="selpchCd == 'SELPCH2' or selpchCd == 'SELPCH4'">
				<if test="pchsClntNm != null and !pchsClntNm.equals('')">
					WHERE PCHS_CLNT_NM LIKE '%'|| #{pchsClntNm} || '%'
				</if>
			</if>
			<!-- 
			<if test="selpchCd == 'SELPCH1' or selpchCd == 'SELPCH3'">
				<if test="sellClntNm != null and !sellClntNm.equals('')">
					WHERE SELL_CLNT_NM LIKE '%'|| #{sellClntNm} || '%'
				</if>
			</if>
			 -->
		)
		WHERE
			RNUM BETWEEN #{firstIndex} AND #{lastIndex}
	</select>
	
	<select id="selectSellCount" parameterType="Map" resultType="int">
			SELECT
				COUNT(*)
			FROM
			(
			 	SELECT 
					T.CO_CD
				    <if test="selpchCd == 'SELPCH2' or selpchCd == 'SELPCH4'">
					   , (SELECT CLNT_NM FROM TB_BM02M01  BM02
					                     INNER JOIN  TB_OD01M01 OD01M01  ON BM02.CLNT_CD = OD01M01.CLNT_CD 
					                     WHERE  T.TRST_RPRC_SEQ = OD01M01.ORDRG_SEQ  AND T.CREAT_PGM LIKE 'OD'||'%' ) AS PCHS_CLNT_NM
				    </if>
				    <if test="selpchCd != 'SELPCH2' and selpchCd != 'SELPCH4'">
					 ,   '' AS PCHS_CLNT_NM
				    </if>
				    <if test="selpchCd == 'SELPCH1' or selpchCd == 'SELPCH3'">
					   , (SELECT CLNT_NM FROM TB_BM02M01  BM02
					                     INNER JOIN  TB_OD01M01 OD01M01  ON BM02.CLNT_CD = OD01M01.SELL_CLNT_CD 
					                     WHERE  T.TRST_RPRC_SEQ = OD01M01.ORDRG_SEQ  AND T.CREAT_PGM LIKE 'OD'||'%' ) AS SELL_CLNT_NM
				    </if>
				    <if test="selpchCd != 'SELPCH1' and selpchCd != 'SELPCH3'">
					 ,   '' AS SELL_CLNT_NM
				    </if>
				    , T.SUB_CLNT_NM
				FROM 
					TB_AR02M01 T
					LEFT JOIN TB_BM01M01 BM01M01 ON T.TRST_PRDT_CD = BM01M01.PRDT_CD
					LEFT JOIN TB_BM02M01 BM02M01 ON T.TRST_CLNT_CD = BM02M01.CLNT_CD
					LEFT JOIN TB_SD05M01 SD05M01 ON T.PRJCT_CD = SD05M01.PRJCT_CD
					LEFT JOIN TB_SD09M01 SD09M01 ON T.SITE_CD = SD09M01.SITE_CD
					LEFT JOIN TB_CM05M01 CM05M01 ON NVL(SD05M01.CLMN_DIV_CD, BM02M01.SELL_CLMN_DIV_CD) = CM05M01.CODE_ID
					LEFT JOIN TB_CM06M01 CM06M01 ON T.SALES_MNG = CM06M01.ID
					<if test="selpchCd == 'SELPCH1' or selpchCd == 'SELPCH3'">
						LEFT JOIN TB_OD01M01 OD01M01 ON T.TRST_RPRC_SEQ = OD01M01.ORDRG_SEQ	AND T.CREAT_PGM LIKE 'OD'||'%' 
					</if>
			 	WHERE 
			 		SELPCH_CD = #{selpchCd}
					<if test="coCd != null and !coCd.equals('')">
						AND T.CO_CD = #{coCd}				
					</if>
					<if test="reqDtFrom != null and !reqDtFrom.equals('')">
						AND T.TRST_DT BETWEEN #{reqDtFrom} AND #{reqDtTo}		
					</if>
					<if test="realDlvrDtFrom != null and !realDlvrDtFrom.equals('')">
						AND T.REAL_DLVR_DTTM BETWEEN #{realDlvrDtFrom} AND #{realDlvrDtTo}		
					</if>
					<if test="clntCd != null and !clntCd.equals('')">
						AND T.TRST_CLNT_CD = #{clntCd}
					</if>
					<if test="clntNm != null and !clntNm.equals('')">
						AND T.CLNT_NM LIKE '%${clntNm}%'
					</if>
					<if test="prdtDiv != null and !prdtDiv.equals('')">
						AND T.PRDT_DIV = #{prdtDiv}				
					</if>
					<if test="prdtSpec != null and !prdtSpec.equals('')">
						AND T.PRDT_SPEC LIKE '%${prdtSpec}%'
					</if>
					<if test="taxivcCoprt != null and !taxivcCoprt.equals('')">
						AND T.TAXIVC_COPRT = #{taxivcCoprt}				
					</if>
					<if test="dirtrsYn != null and !dirtrsYn.equals('')">
						AND T.DIRTRS_YN = #{dirtrsYn}				
					</if>
					<if test="typCd != null and !typCd.equals('')">
						AND T.TYP_CD = #{typCd}				
					</if>
					<if test="prjctCd != null and !prjctCd.equals('')">
						AND T.PRJCT_CD = #{prjctCd}				
					</if>
					<if test="siteCd != null and !siteCd.equals('')">
						AND T.SITE_CD = #{siteCd}				
					</if>
					<if test="siteNm != null and !siteNm.equals('')">
						AND SD09M01.SITE_NM LIKE '%'|| #{siteNm} || '%'				
					</if>
					<if test="pdsk != null and !pdsk.equals('')">
						AND T.PRDT_STKN = #{pdsk}				
					</if>
					<if test="bilgYn != null and !bilgYn.equals('')">
						<choose>
							<when test='bilgYn == "Y"'>
								AND T.BILG_CERT_NO IS NOT NULL 		
							</when>
							<otherwise>
								AND T.BILG_CERT_NO IS NULL 
							</otherwise>
						</choose>
					</if>
					<if test="salesMng != null and !salesMng.equals('')">
						AND T.SALES_MNG = #{salesMng}				
					</if>
					<if test="salesMngNm != null and !salesMngNm.equals('')">
						AND CM06M01.NAME LIKE '%'|| #{salesMngNm} || '%'				
					</if>
					<if test="whCd != null and !whCd.equals('')">
						AND T.WH_CD = #{whCd}
					</if>
					<if test="impYn != null and !impYn.equals('')">
						AND T.IMP_YN = #{impYn}
					</if>
					<if test="trspRmk != null and !trspRmk.equals('')">
						AND T.TRSP_RMK LIKE '%'|| #{trspRmk} || '%'
					</if>
					<if test="prdtGrp != null and !prdtGrp.equals('')">
						AND BM01M01.PRDT_GRP = #{prdtGrp}
					</if>
					<if test="trspTypCd != null and !trspTypCd.equals('')">
						AND T.TRSP_TYP_CD = #{trspTypCd}
					</if>
					<if test="makrCd != null and !makrCd.equals('')">
					    AND T.MAKR_CD = #{makrCd}
					</if>
					<if test="prdtNm != null and !prdtNm.equals('')">
						AND BM01M01.PRDT_NM LIKE '%' || #{prdtNm} || '%'
					</if>
					ORDER BY TRST_DT DESC, T.CLNT_NM, T.TYP_CD, TRST_PRDT_CD, T.PRDT_STKN, T.PRDT_SIZE, T.PRDT_LEN
			) A
		    <if test="selpchCd == 'SELPCH2' or selpchCd == 'SELPCH4'">
				<if test="pchsClntNm != null and !pchsClntNm.equals('')">
					WHERE DECODE(PCHS_CLNT_NM, NULL, SUB_CLNT_NM, PCHS_CLNT_NM) LIKE '%'|| #{pchsClntNm} || '%'
				</if>
			</if>
		    <if test="selpchCd == 'SELPCH1' or selpchCd == 'SELPCH3'">
				<if test="sellClntNm != null and !sellClntNm.equals('')">
					WHERE DECODE(SELL_CLNT_NM, NULL, SUB_CLNT_NM, SELL_CLNT_NM) LIKE '%'|| #{sellClntNm} || '%'
				</if>
			</if>
	</select>
	
	<select id="selectSellList" parameterType="Map" resultType="CamelMap">
		SELECT
			*
		FROM
		(
			SELECT
				A.*,
				ROWNUM AS RNUM
			FROM
			(
			 	SELECT 
					T.CO_CD,
				    T.TRST_CERTI_NO,
				    T.SELPCH_CD,
				    FN_CM05M01_CD_TO_NM(T.SELPCH_CD) AS SELPCH_NM,
				    T.TAXIVC_COPRT,
				    FN_CM05M01_CD_TO_NM(T.TAXIVC_COPRT) AS TAXIVC_COPRT_NM,
				    TO_CHAR(TO_DATE(T.TRST_DT), 'YYYY-MM-DD') AS TRST_DT,
				    TO_CHAR(T.REAL_DLVR_DTTM, 'YYYY-MM-DD') AS REAL_DLVR_DTTM,
				    BM02M01.SELL_VAT_CD,
				    NVL((SELECT CODE_RPRC FROM TB_CM05M01 WHERE CODE_ID = BM02M01.SELL_VAT_CD), 10) AS SELL_VAT, 
				    NVL(SD05M01.CLMN_DIV_CD, BM02M01.SELL_CLMN_DIV_CD) AS PCHS_CLMN_DIV_CD,
		   			CASE WHEN SD05M01.CLMN_DIV_CD IS NULL THEN FN_CM05M01_CD_TO_NM(BM02M01.SELL_CLMN_DIV_CD) || ' ' || 
                                           NVL2(BM02M01.SELL_CLMN_DAY,FN_CM05M01_CD_TO_NM(BM02M01.SELL_CLMN_DAY)||'일','')  || 
                                           FN_CM05M01_CD_TO_NM(BM02M01.SELL_PMNT_MTD_CD)
					     ELSE FN_CM05M01_CD_TO_NM(SD05M01.CLMN_DIV_CD)
					     END AS PCHS_CLMN_DIV_NM ,
		   			CASE
				    	WHEN CM05M01.CODE_RPRC = 'MON' THEN TO_CHAR(LAST_DAY(ADD_MONTHS(TRUNC(TO_DATE(T.TRST_DT),'MM'), NVL(CM05M01.CODE_ETC,0)) -1) + NVL(NVL(SD05M01.CLMN_DAY,BM02M01.SELL_CLMN_DAY),0), 'YYYY-MM-DD')
				    	WHEN CM05M01.CODE_RPRC = 'DAY' THEN TO_CHAR(TO_DATE(T.TRST_DT) -1 + NVL(CM05M01.CODE_ETC,0) + NVL(NVL(SD05M01.CLMN_DAY,BM02M01.SELL_CLMN_DAY),0), 'YYYY-MM-DD')
				    END AS PCHS_CLMN_DAY,
				 	T.TRST_CLNT_CD,
				    T.TRST_CLNT_CD AS CLNT_CD,
				    T.TRST_PRDT_CD,
				    T.TRST_PRDT_CD AS PRDT_CD,
				    BM01M01.PRDT_NM,
				    BM01M01.PRDT_GRP,
				    FN_CM05M01_CD_TO_NM(BM01M01.PRDT_GRP) PRDT_GRP_NM,
				    T.OWNER_CD,
				    FN_CM05M01_CD_TO_NM(T.OWNER_CD) AS OWNER_NM,
				    T.IMP_YN,
				    T.TYP_CD,
				    FN_CM05M01_CD_TO_NM(T.TYP_CD) AS TYP_NM,
				    T.TRSP_TYP_CD,
				    FN_CM05M01_CD_TO_NM(T.TRSP_TYP_CD) AS TRSP_TYP_NM,
				    T.TRST_RPRC_SEQ,
				    DECODE(T.CREAT_PGM, 'OD0102V01', TRST_RPRC_SEQ, NULL) AS ORDRG_SEQ,
				    DECODE(T.CREAT_PGM, 'AR0102V01', TRST_RPRC_SEQ, NULL) AS SHIP_SEQ,
				    T.TRST_DTL_SEQ,
				    T.PRDT_LEN,
				    T.ODR_NO,
				    T.SALES_MNG,
				    CM06M01.NAME AS SALES_MNG_NM,
				    CM06M01.DEPT_ID AS DEPT_ID,
				    (SELECT DEPT_NM FROM TB_CM04M01 WHERE DEPT_ID = CM06M01.DEPT_ID) AS DEPT_NM,
				    T.PRJCT_CD,
				    SD05M01.PRJCT_NM,
				    T.MAKR_CD,
				    FN_CM05M01_CD_TO_NM(T.MAKR_CD) AS MAKR_NM,
				    T.WH_CD,
				    FN_CM05M01_CD_TO_NM(T.WH_CD) AS WH_NM,
				    T.MNG_TEL,
				    TO_CHAR(T.DLVR_DTTM, 'YYYY-MM-DD') AS DLVR_DTTM,
				    TO_CHAR(T.REAL_DLVR_DTTM, 'YYYY-MM-DD') AS REAL_DLVR_DTTM,
				    T.DIRTRS_YN,
				    T.PRDT_DIV,
				    T.PRDT_STKN,
				    DECODE(BM01M01.PRDT_COIL_YN,'Y',FN_CM05M01_CD_TO_NM(T.PRDT_STKN)||'C', FN_CM05M01_CD_TO_NM(T.PRDT_STKN)) AS PRDT_STKN_NM,
				    T.PRDT_SIZE,
				    NVL(FN_CM05M01_CD_TO_NM(T.PRDT_SIZE), T.PRDT_SIZE) AS PRDT_SIZE_NM,
				    T.PRDT_UNIT,
				    T.PRDT_UPR,
				    T.STOCK_UPR,
				    T.PCHS_UPR,
				    T.SELL_UPR,
				    T.TRST_QTY,
				    T.TRST_WT,
				    T.TRST_UPR,
				    T.TRST_AMT,
				    T.REAL_TRST_QTY,
				    T.REAL_TRST_WT,
				    T.REAL_TRST_UPR,
				    T.REAL_TRST_AMT,
				    T.BILG_QTY,
				    T.BILG_WT,
				    T.BILG_UPR,
				    T.BILG_AMT,
				    NVL(T.TRST_DC_AMT, '0') AS TRST_DC_AMT,
				    NVL(T.ETC_AMT, '0') AS ETC_AMT,
				    T.TRSP_RMK,
				    NVL(T.TRANS_AMT, '0') AS TRANS_AMT,
				    T.SHIP_VEH_NO,
				    T.CLNT_NM,
				    T.BILG_CERT_NO,
				    CASE WHEN T.BILG_CERT_NO IS NOT NULL THEN 'Y' ELSE 'N' END BILG_YN,
				    <![CDATA[ CASE WHEN T.BILG_AMT < 0 THEN 'Y' ELSE 'N' END RETURN_YN,]]>
				    NVL(T.LOSS_RATE, '0') AS LOSS_RATE,
				    T.ODR_CREAT_DIV,
				    T.ETC_FIELD1,
				    T.ETC_FIELD2,
				    T.ETC_FIELD3,
				    T.CREAT_ID,
				    (SELECT NAME FROM TB_CM06M01 WHERE ID = T.CREAT_ID) AS CREAT_NM,
				    T.CREAT_PGM,
				    TO_CHAR(T.CREAT_DTTM, 'yyyy-MM-dd') AS CREAT_DTTM,
				    T.UDT_ID,
				    (SELECT NAME FROM TB_CM06M01 WHERE ID = T.UDT_ID) AS UDT_NM,
				    T.UDT_PGM,
				    TO_CHAR(T.UDT_DTTM, 'yyyy-MM-dd') AS UDT_DTTM,
				    T.SALES_AREA_CD,
				    T.SITE_CD,
				    SD09M01.SITE_NM,
				    T.BILG_VAT_AMT,
				    T.BILG_VAT_AMT + T.BILG_AMT AS TOT_AMT, 
				    T.PRDT_SPEC,
				    T.RFF_AEA,
				    T.ORGN_TAX_BILG_NO,
				    T.RFF_APG,
				    T.SHIP_CNT,
				    T.SUB_CLNT_CD,
				    T.SUB_CLNT_NM,
				    BM01M01.PRDT_CNVRSN_WT
				    <if test="selpchCd == 'SELPCH2' or selpchCd == 'SELPCH4'">
<!-- 				    	OD01M01.CLNT_CD AS PCHS_CLNT_CD -->
					   , DECODE(T.SUB_CLNT_CD, NULL, (SELECT CLNT_NM FROM TB_BM02M01  BM02
					                     INNER JOIN  TB_OD01M01 OD01M01  ON BM02.CLNT_CD = OD01M01.CLNT_CD 
					                     WHERE  T.TRST_RPRC_SEQ = OD01M01.ORDRG_SEQ  AND T.CREAT_PGM LIKE 'OD'||'%' ),
					                     T.SUB_CLNT_NM) AS PCHS_CLNT_NM


<!-- 
					   , (SELECT CLNT_NM FROM TB_BM02M01  BM02
					                     INNER JOIN  TB_OD01M01 OD01M01  ON BM02.CLNT_CD = OD01M01.CLNT_CD 
					                     WHERE  T.TRST_RPRC_SEQ = OD01M01.ORDRG_SEQ  AND T.CREAT_PGM LIKE 'OD'||'%' ) AS PCHS_CLNT_NM
 -->
				    </if>
				    <if test="selpchCd != 'SELPCH2' and selpchCd != 'SELPCH4'">
<!-- 				    	'' AS PCHS_CLNT_CD -->
					 ,   '' AS PCHS_CLNT_NM
				    </if>
				    
				    <if test="selpchCd == 'SELPCH1' or selpchCd == 'SELPCH3'">
						, OD01M01.SELL_CLNT_CD AS SELL_CLNT_CD
						, DECODE(T.SUB_CLNT_CD, NULL, (SELECT CLNT_NM FROM TB_BM02M01 BM02 WHERE OD01M01.SELL_CLNT_CD = BM02.CLNT_CD),
								 T.SUB_CLNT_NM) AS SELL_CLNT_NM
					</if>
				FROM 
					TB_AR02M01 T
					LEFT JOIN TB_BM01M01 BM01M01 ON T.TRST_PRDT_CD = BM01M01.PRDT_CD
					LEFT JOIN TB_BM02M01 BM02M01 ON T.TRST_CLNT_CD = BM02M01.CLNT_CD
					LEFT JOIN TB_SD05M01 SD05M01 ON T.PRJCT_CD = SD05M01.PRJCT_CD
					LEFT JOIN TB_SD09M01 SD09M01 ON T.SITE_CD = SD09M01.SITE_CD
					LEFT JOIN TB_CM05M01 CM05M01 ON NVL(SD05M01.CLMN_DIV_CD, BM02M01.SELL_CLMN_DIV_CD) = CM05M01.CODE_ID
					LEFT JOIN TB_CM06M01 CM06M01 ON T.SALES_MNG = CM06M01.ID
					<if test="selpchCd == 'SELPCH1' or selpchCd == 'SELPCH3'">
						LEFT JOIN TB_OD01M01 OD01M01 ON T.TRST_RPRC_SEQ = OD01M01.ORDRG_SEQ	 AND T.CREAT_PGM LIKE 'OD'||'%'
					</if>
			 	WHERE 
			 		SELPCH_CD = #{selpchCd}
					<if test="coCd != null and !coCd.equals('')">
						AND T.CO_CD = #{coCd}				
					</if>
					<if test="reqDtFrom != null and !reqDtFrom.equals('')">
						AND T.TRST_DT BETWEEN #{reqDtFrom} AND #{reqDtTo}		
					</if>
					<if test="realDlvrDtFrom != null and !realDlvrDtFrom.equals('')">
						AND T.REAL_DLVR_DTTM BETWEEN #{realDlvrDtFrom} AND #{realDlvrDtTo}		
					</if>
					<if test="clntCd != null and !clntCd.equals('')">
						AND T.TRST_CLNT_CD = #{clntCd}
					</if>
					<if test="clntNm != null and !clntNm.equals('')">
						AND T.CLNT_NM LIKE '%${clntNm}%'
					</if>
					<if test="prdtDiv != null and !prdtDiv.equals('')">
						AND T.PRDT_DIV = #{prdtDiv}				
					</if>
					<if test="prdtSpec != null and !prdtSpec.equals('')">
						AND T.PRDT_SPEC LIKE '%${prdtSpec}%'
					</if>
					<if test="taxivcCoprt != null and !taxivcCoprt.equals('')">
						AND T.TAXIVC_COPRT = #{taxivcCoprt}				
					</if>
					<if test="dirtrsYn != null and !dirtrsYn.equals('')">
						AND T.DIRTRS_YN = #{dirtrsYn}				
					</if>
					<if test="typCd != null and !typCd.equals('')">
						AND T.TYP_CD = #{typCd}				
					</if>
					<if test="prjctCd != null and !prjctCd.equals('')">
						AND T.PRJCT_CD = #{prjctCd}				
					</if>
					<if test="siteCd != null and !siteCd.equals('')">
						AND T.SITE_CD = #{siteCd}				
					</if>
					<if test="siteNm != null and !siteNm.equals('')">
						AND SD09M01.SITE_NM LIKE '%'|| #{siteNm} || '%'				
					</if>
					<if test="pdsk != null and !pdsk.equals('')">
						AND T.PRDT_STKN = #{pdsk}				
					</if>
					<if test="bilgYn != null and !bilgYn.equals('')">
						<choose>
							<when test='bilgYn == "Y"'>
								AND T.BILG_CERT_NO IS NOT NULL 		
							</when>
							<otherwise>
								AND T.BILG_CERT_NO IS NULL 
							</otherwise>
						</choose>
					</if>
					<if test="salesMng != null and !salesMng.equals('')">
						AND T.SALES_MNG = #{salesMng}				
					</if>
					<if test="salesMngNm != null and !salesMngNm.equals('')">
						AND CM06M01.NAME LIKE '%'|| #{salesMngNm} || '%'				
					</if>
					<if test="whCd != null and !whCd.equals('')">
						AND T.WH_CD = #{whCd}
					</if>
					<if test="impYn != null and !impYn.equals('')">
						AND T.IMP_YN = #{impYn}
					</if>
					<if test="trspRmk != null and !trspRmk.equals('')">
						AND UPPER(T.TRSP_RMK) LIKE '%'|| UPPER(#{trspRmk}) || '%'
					</if>
					<if test="prdtGrp != null and !prdtGrp.equals('')">
						AND BM01M01.PRDT_GRP = #{prdtGrp}
					</if>
					<if test="trspTypCd != null and !trspTypCd.equals('')">
						AND T.TRSP_TYP_CD = #{trspTypCd}
					</if>
					<if test="makrCd != null and !makrCd.equals('')">
					    AND T.MAKR_CD = #{makrCd}
					</if>
					<if test="prdtNm != null and !prdtNm.equals('')">
						AND BM01M01.PRDT_NM LIKE '%' || #{prdtNm} || '%'
					</if>
					ORDER BY TRST_DT DESC, T.CLNT_NM, T.TYP_CD, TRST_RPRC_SEQ, TRST_DTL_SEQ, TRST_PRDT_CD, T.PRDT_STKN, T.PRDT_SIZE, T.PRDT_LEN
			) A
		    <if test="selpchCd == 'SELPCH2' or selpchCd == 'SELPCH4'">
				<if test="pchsClntNm != null and !pchsClntNm.equals('')">
					WHERE DECODE(PCHS_CLNT_NM, NULL, SUB_CLNT_NM, PCHS_CLNT_NM) LIKE '%'|| #{pchsClntNm} || '%'
				</if>
			</if>
		    <if test="selpchCd == 'SELPCH1' or selpchCd == 'SELPCH3'">
				<if test="sellClntNm != null and !sellClntNm.equals('')">
					WHERE DECODE(SELL_CLNT_NM, NULL, SUB_CLNT_NM, SELL_CLNT_NM) LIKE '%'|| #{sellClntNm} || '%'
				</if>
			</if>
		)
		<if test='pageYn != null and pageYn.equals("Y")'>
			WHERE
				RNUM BETWEEN #{firstIndex} AND #{lastIndex}
		</if>
	</select>
	
	<update id="updatePchsSell" parameterType="Map">
	BEGIN
		<!-- 매출 정산 버튼시 해당 매출 매칭 삭제 -->
		
		
		<if test="countSell == 0">
		INSERT INTO TB_AR05D02
			(CO_CD ,ETRDPS_SEQ ,ETRDPS_DTL_SEQ 																		 		,BILG_CERT_NO ,TRST_CERTI_NO ,ETRDPS_DT ,TRST_DT ,CLNT_CD ,SELL_CLMN_DIV_CD ,SELL_PMNT_MTD_CD ,SELL_CLMN_DAY ,TAX_BILG_NO ,PRJCT_CD ,ETRDPS_AMT ,PRDT_GRP ,CREAT_ID ,CREAT_PGM ,CREAT_DTTM)                 
			SELECT CO_CD ,ETRDPS_SEQ ,1 + (SELECT MAX(ETRDPS_DTL_SEQ) FROM TB_AR05D02 D WHERE ETRDPS_SEQ = #{etrdpsSeqFind}) ,'0' 		   ,'0' 		  ,ETRDPS_DT ,NULL 	  ,CLNT_CD ,NULL 			 ,NULL 			   ,NULL 		  ,'0' 		   ,NULL 	 ,'0' 		 ,PRDT_GRP ,#{userId} ,'MATCH_AR02' ,SYSDATE
			FROM TB_AR05D02 D02 
				WHERE ETRDPS_SEQ = #{etrdpsSeqFind} GROUP BY CO_CD, ETRDPS_SEQ, ETRDPS_DT, CLNT_CD, PRDT_GRP;
		</if>
		
		UPDATE 
			TB_AR05D02 D02 
				SET ETRDPS_AMT = D02.ETRDPS_AMT + (SELECT SUM(ETRDPS_AMT) FROM TB_AR05D02 WHERE TRST_CERTI_NO = #{trstCertiNo} AND ETRDPS_SEQ = #{etrdpsSeqFind}) 
				WHERE TRST_CERTI_NO = '0'
				AND ETRDPS_SEQ = #{etrdpsSeqFind};
		
		
		
		<!-- 
		UPDATE 
			TB_AR05D02
		SET   
			  BILG_CERT_NO     = 0
			, TRST_CERTI_NO    = 0
			, TRST_DT          = ''
			, SELL_CLMN_DIV_CD = ''
			, SELL_PMNT_MTD_CD = ''
			, SELL_CLMN_DAY    = ''
			, TAX_BILG_NO      = ''
			, PRJCT_CD         = ''
		WHERE TRST_CERTI_NO = #{trstCertiNo};
		 -->
		
		<!-- 
		UPDATE 
			TB_AR02M01
		SET
			TRST_CLNT_CD	= #{clntCd},
			CLNT_NM         = #{clntNm},
			REAL_TRST_QTY	= #{realTrstQty},
			REAL_TRST_WT	= #{realTrstWt},
			REAL_TRST_AMT	= #{realTrstAmt},
	        BILG_QTY        = #{bilgQty},
	        BILG_WT         = #{bilgWt},
	        BILG_UPR        = #{bilgUpr},
	        BILG_AMT        = #{bilgAmt},
	        BILG_VAT_AMT    = #{bilgVatAmt},
	        TRST_DC_AMT     = #{trstDcAmt},
	        ETC_AMT         = #{etcAmt},
	        TRSP_RMK    	= #{trspRmk, jdbcType=VARCHAR},
	        TRANS_AMT       = #{transAmt},
			SHIP_VEH_NO 	= #{shipVehNo, jdbcType=VARCHAR},
	        LOSS_RATE       = #{lossRate},
	        UDT_ID          = #{userId},
	        ETRDPS_YN       = 'N',
            ETRDPS_AMT      = 0,
	        <choose>
				<when test="updatePgmId != null and !updatePgmId.equals('')">
					UDT_PGM = #{updatePgmId},
				</when>
				<otherwise>
					UDT_PGM = #{pgmId},
				</otherwise>
			</choose>
	        UDT_DTTM        = SYSDATE
		WHERE 
			TRST_CERTI_NO = #{trstCertiNo};
		 -->
	END;
	</update>
	
	<update id="updatePchsSellPart2" parameterType="Map">
	BEGIN
		
		UPDATE 
			TB_AR02M01
		SET
			<if test='pgmId != null and pgmId == "AR0202P01"'>
				TRANS_SEQ	= #{transSeq},
			</if>
			TRST_CLNT_CD	= #{clntCd},
			CLNT_NM         = #{clntNm},
			REAL_TRST_QTY	= #{realTrstQty},
			REAL_TRST_WT	= #{realTrstWt},
			REAL_TRST_AMT	= #{realTrstAmt},
	        BILG_QTY        = #{bilgQty},
	        BILG_WT         = #{bilgWt},
	        BILG_UPR        = #{bilgUpr},
	        BILG_AMT        = #{bilgAmt},
	        BILG_VAT_AMT    = #{bilgVatAmt},
	        TRST_DC_AMT     = #{trstDcAmt},
	        ETC_AMT         = #{etcAmt},
	        TRSP_RMK    	= #{trspRmk, jdbcType=VARCHAR},
	        TRANS_AMT       = #{transAmt},
			SHIP_VEH_NO 	= #{shipVehNo, jdbcType=VARCHAR},
	        LOSS_RATE       = #{lossRate},
	        UDT_ID          = #{userId},
	        ETRDPS_YN       = 'N',
            ETRDPS_AMT      = 0,
	        <choose>
				<when test="updatePgmId != null and !updatePgmId.equals('')">
					UDT_PGM = #{updatePgmId},
				</when>
				<otherwise>
					UDT_PGM = #{pgmId},
				</otherwise>
			</choose>
	        UDT_DTTM        = SYSDATE
		WHERE 
			TRST_CERTI_NO = #{trstCertiNo};

	END;
	</update>
	
	<update id="updatePchsSellPart" parameterType="Map">
		UPDATE 
			TB_AR02M01
		SET  
	        TRSP_TYP_CD    	= #{trspTypCd, jdbcType=VARCHAR},
	        PRJCT_CD     	= #{prjctCd, jdbcType=VARCHAR},
	        SITE_CD     	= #{siteCd, jdbcType=VARCHAR},
	        SALES_AREA_CD  	= #{salesAreaCd, jdbcType=VARCHAR},
	        SALES_MNG    	= #{salesMng, jdbcType=VARCHAR},
	        TRSP_RMK    	= #{trspRmk, jdbcType=VARCHAR},
	        TRANS_AMT       = #{transAmt},
	        SUB_CLNT_CD		= #{subClntCd},
	        SUB_CLNT_NM		= #{subClntNm},
	        UDT_ID          = #{userId},
			UDT_PGM			= #{pgmId},
	        UDT_DTTM        = SYSDATE
		WHERE 
			TRST_CERTI_NO = #{trstCertiNo}
	</update>
	
	<delete id="deleteSell" parameterType="Map">
	BEGIN
		<!-- 
		DELETE 
			FROM TB_AR02M01
		WHERE
			TRST_CERTI_NO = #{trstCertiNo};
		-->
		
		<if test="countSell == 0">
		INSERT INTO TB_AR05D02
			(CO_CD ,ETRDPS_SEQ ,ETRDPS_DTL_SEQ 																		 		 ,BILG_CERT_NO ,TRST_CERTI_NO ,ETRDPS_DT ,TRST_DT ,CLNT_CD ,SELL_CLMN_DIV_CD ,SELL_PMNT_MTD_CD ,SELL_CLMN_DAY ,TAX_BILG_NO ,PRJCT_CD ,ETRDPS_AMT ,PRDT_GRP ,CREAT_ID ,CREAT_PGM ,CREAT_DTTM)                 
			SELECT CO_CD ,ETRDPS_SEQ ,1 + (SELECT MAX(ETRDPS_DTL_SEQ) FROM TB_AR05D02 D WHERE ETRDPS_SEQ = #{etrdpsSeqFind}) ,'0' 		   ,'0' 		  ,ETRDPS_DT ,NULL 	  ,CLNT_CD ,NULL 			 ,NULL 			   ,NULL 		  ,'0' 		   ,NULL 	 ,'0' 		 ,PRDT_GRP ,#{userId} ,'MATCH_AR02' ,SYSDATE
			FROM TB_AR05D02 D02 
				WHERE ETRDPS_SEQ = #{etrdpsSeqFind} GROUP BY CO_CD, ETRDPS_SEQ, ETRDPS_DT, CLNT_CD, PRDT_GRP;
		</if>
		
		UPDATE 
			TB_AR05D02 D02 
				SET ETRDPS_AMT = D02.ETRDPS_AMT + (SELECT SUM(ETRDPS_AMT) FROM TB_AR05D02 WHERE TRST_CERTI_NO = #{trstCertiNo} AND ETRDPS_SEQ = #{etrdpsSeqFind}) 
				WHERE TRST_CERTI_NO = '0'
				AND ETRDPS_SEQ = #{etrdpsSeqFind};
		
		
		<!-- 
		UPDATE 
			TB_AR05D02 D02 
				SET ETRDPS_AMT = D02.ETRDPS_AMT + (SELECT ETRDPS_AMT FROM TB_AR05D02 WHERE TRST_CERTI_NO = #{trstCertiNo} AND ROWNUM = 1) 
				WHERE TRST_CERTI_NO = '0'
				AND ETRDPS_SEQ = (SELECT ETRDPS_SEQ FROM TB_AR05D02 WHERE TRST_CERTI_NO = #{trstCertiNo} AND ROWNUM = 1);
		 -->


		
		<!-- 			
		 UPDATE 
		 	TB_AR05D02
		SET   
			  BILG_CERT_NO     = 0
			, TRST_CERTI_NO    = 0
			, TRST_DT          = ''
			, SELL_CLMN_DIV_CD = ''
			, SELL_PMNT_MTD_CD = ''
			, SELL_CLMN_DAY    = ''
			, TAX_BILG_NO      = ''
			, PRJCT_CD         = ''
		 WHERE TRST_CERTI_NO = #{trstCertiNo};
		-->
		
	 END;
	</delete>
	
	<delete id="deleteSellReal" parameterType="Map">
		BEGIN
			DELETE 
				FROM TB_AR02M01
			WHERE
				TRST_CERTI_NO = #{trstCertiNo};
				
				
			
			DELETE
				FROM TB_AR05D02
					WHERE TRST_CERTI_NO = #{trstCertiNo};
		END;
	</delete>
	
		<delete id="deleteSell05D" parameterType="Map">
		BEGIN
		<!-- 
			DELETE 
				FROM TB_AR02M01
			WHERE
				TRST_CERTI_NO = #{trstCertiNo};
		 -->	
				
			
			DELETE
				FROM TB_AR05D02
					WHERE TRST_CERTI_NO = #{trstCertiNo};
		END;
	</delete>
	
	<delete id="deletePchsSell" parameterType="Map">
	BEGIN
		UPDATE 
			TB_AR05D02
		SET   
		 	  BILG_CERT_NO     = 0
			, TRST_CERTI_NO    = 0
			, TRST_DT          = ''
			, SELL_CLMN_DIV_CD = ''
			, SELL_PMNT_MTD_CD = ''
			, SELL_CLMN_DAY    = ''
			, TAX_BILG_NO      = ''
			, PRJCT_CD         = ''
		WHERE 
			TRST_CERTI_NO IN (
								SELECT 
									TRST_CERTI_NO
								FROM 
									TB_AR02M01
								WHERE TRST_RPRC_SEQ = #{trstRprcSeq}
								  AND TRST_DTL_SEQ = #{trstDtlSeq}
								  AND CREAT_PGM = #{pgmId}
								  <if test="selpchCd != null and !selpchCd.equals('')">
								  AND SELPCH_CD     = #{selpchCd}
								  </if>
								 	 );
	
		DELETE FROM TB_AR02M01
		WHERE TRST_RPRC_SEQ = #{trstRprcSeq}
		  AND TRST_DTL_SEQ = #{trstDtlSeq}
		  AND CREAT_PGM = #{pgmId}
		  <if test="selpchCd != null and !selpchCd.equals('')">
		  AND SELPCH_CD     = #{selpchCd}
		  </if>;
	 END; 
	 
	</delete>
	
	<select id="checkBilg" parameterType="Map" resultType="CamelMap">
		SELECT NVL(BILG_CERT_NO, 0) AS BILG_CERT_NO 
		FROM TB_AR02M01
		WHERE TRST_RPRC_SEQ = #{trstRprcSeq}
		  AND TRST_DTL_SEQ = #{trstDtlSeq}
		  AND CREAT_PGM = #{pgmId}
		  <if test="selpchCd != null and !selpchCd.equals('')">
		  AND SELPCH_CD     = #{selpchCd}
		  </if>
	</select>
	
	<select id="selectSellInfo" parameterType="Map" resultType="CamelMap">
		SELECT 
			T.CO_CD,
	        T.TRST_CERTI_NO,
	        T.SELPCH_CD,
	        FN_CM05M01_CD_TO_NM(T.SELPCH_CD) AS SELPCH_NM,
	        T.TAXIVC_COPRT,
	        T.TAXIVC_COPRT AS EST_COPRT,
	        FN_CM05M01_CD_TO_NM(T.TAXIVC_COPRT) AS TAXIVC_COPRT_NM,
	        TO_CHAR(TO_DATE(T.TRST_DT), 'YYYY-MM-DD') AS TRST_DT,
	        T.TRST_CLNT_CD,
	        T.TRST_CLNT_CD AS CLNT_CD,
	        T.TRST_PRDT_CD,
	        T.TRST_PRDT_CD AS PRDT_CD,
	        (SELECT PRDT_NM FROM TB_BM01M01 WHERE PRDT_CD = T.TRST_PRDT_CD) AS PRDT_NM,
	        BM01.PRDT_GRP,
	        FN_CM05M01_CD_TO_NM(BM01.PRDT_GRP) AS PRDT_GRP_NM,
	        T.OWNER_CD,
	        FN_CM05M01_CD_TO_NM(T.OWNER_CD) AS OWNER_NM,
	        T.IMP_YN,
	        T.TYP_CD,
	        FN_CM05M01_CD_TO_NM(T.TYP_CD) AS TYP_NM,
	        T.TRSP_TYP_CD,
		    FN_CM05M01_CD_TO_NM(T.TRSP_TYP_CD) AS TRSP_TYP_NM,
	        T.TRST_RPRC_SEQ,
	        T.TRST_DTL_SEQ,
	        T.PRDT_LEN,
	        T.ODR_NO,
	        T.SALES_MNG,
	        (SELECT NAME FROM TB_CM06M01 WHERE ID = T.SALES_MNG) AS SALES_MNG_NM,
			(SELECT DEPT_ID FROM TB_CM06M01 WHERE ID = T.SALES_MNG) AS DEPT_ID,
		    (SELECT DEPT_NM FROM TB_CM06M01 A, TB_CM04M01 B WHERE ID = T.SALES_MNG AND A.DEPT_ID = B.DEPT_ID) AS DEPT_NM,
	        T.PRJCT_CD,
	        T.MAKR_CD,
	        FN_CM05M01_CD_TO_NM(T.MAKR_CD) AS MAKR_NM,
	        T.WH_CD,
	        FN_CM05M01_CD_TO_NM(T.WH_CD) AS WH_NM,
	        T.MNG_TEL,
	        TO_CHAR(T.DLVR_DTTM, 'YYYY-MM-DD') AS DLVR_DTTM,
	        TO_CHAR(T.REAL_DLVR_DTTM, 'YYYY-MM-DD') AS REAL_DLVR_DTTM,
	        T.DIRTRS_YN,
	        T.PRDT_DIV,
	        FN_CM05M01_CD_TO_NM(T.PRDT_DIV) AS PRDT_DIV_NM,
	        T.PRDT_STKN,
	        FN_CM05M01_CD_TO_NM(T.PRDT_STKN) AS PRDT_STKN_NM,
	        T.PRDT_SIZE,
	        NVL(FN_CM05M01_CD_TO_NM(T.PRDT_SIZE), T.PRDT_SIZE) AS PRDT_SIZE_NM,
	        T.PRDT_UNIT,
	        FN_CM05M01_CD_TO_NM(T.PRDT_UNIT) AS PRDT_UNIT_NM,
	        T.PRDT_UPR,
	        T.STOCK_UPR,
	        T.PCHS_UPR,
	        T.SELL_UPR,
	        T.TRST_QTY,
	        T.TRST_WT,
	        T.TRST_UPR,
	        T.TRST_AMT,
	        T.REAL_TRST_QTY,
	        T.REAL_TRST_WT,
	        T.REAL_TRST_UPR,
	        T.REAL_TRST_AMT,
	        T.BILG_QTY,
	        T.BILG_WT,
	        T.BILG_UPR,
	        T.BILG_AMT,
	        NVL(T.TRST_DC_AMT, '0') AS TRST_DC_AMT,
	        NVL(T.ETC_AMT, '0') AS ETC_AMT,
	        T.TRSP_RMK,
	        NVL(T.TRANS_AMT, '0') AS TRANS_AMT,
	        T.SHIP_VEH_NO,
	        T.CLNT_NM,
	        T.BILG_CERT_NO,
	        CASE WHEN T.BILG_CERT_NO IS NOT NULL THEN 'Y' ELSE 'N' END BILG_YN,
	        NVL(T.LOSS_RATE, '0') AS LOSS_RATE,
	        T.ODR_CREAT_DIV,
	        T.ETC_FIELD1,
	        T.ETC_FIELD2,
	        T.ETC_FIELD3,
	        T.CREAT_ID,
	        T.CREAT_PGM,
	        TO_CHAR(T.CREAT_DTTM, 'yyyy-MM-dd') AS CREAT_DTTM,
	        T.UDT_ID,
	        T.UDT_PGM,
	        TO_CHAR(T.UDT_DTTM, 'yyyy-MM-dd') AS UDT_DTTM,
	        T.SALES_AREA_CD,
	        T.SITE_CD,
		    (SELECT SITE_NM FROM TB_SD09M01 WHERE SITE_CD = T.SITE_CD) AS SITE_NM,
	        T.BILG_VAT_AMT,
	        T.PRDT_SPEC,
	        T.RFF_AEA,
	        T.ORGN_TAX_BILG_NO,
	        T.RFF_APG,
	        BM01.PRDT_CNVRSN_WT,
	        BM01.PRDT_STOCK_CD,
	        T.TRANS_SEQ,
	        T.SUB_CLNT_CD,
	        T.SUB_CLNT_NM
		FROM 
			TB_AR02M01 T
			LEFT OUTER JOIN TB_BM01M01 BM01 ON BM01.PRDT_CD = T.TRST_PRDT_CD
		WHERE TRST_CERTI_NO = #{trstCertiNo}
	</select>
	
	<select id="selectBilgInfo" parameterType="Map" resultType="CamelMap">
		SELECT 
			 T1.*,
			 NVL(B.SELL_PAY_DIV_CD, 'PAYDIV02') AS RFF_CNO,
			 NVL(B.SELL_VAT_CD, 'VAT01') AS RFF_VA,  
			 B.CRN AS TAXIVC_COPRT_NO,
			 B.REPST_NM AS TAXIVC_COPRT_CEO,
			 B.CLNT_NM AS TAXIVC_COPRT_NM,
			 NVL(B.BIZCON_NM, '-') AS TAX_COPRT_BIZCON,	        
			 NVL(B.BSTY_NM, '-') AS TAXVIC_COPRT_BSTY,
			 (SELECT CRN FROM TB_BM02M01 WHERE CLNT_CD = T1.CLNT_CD) AS TAXIVC_RCV_CRN,
			 (SELECT REPST_NM FROM TB_BM02M01 WHERE CLNT_CD = T1.CLNT_CD) AS TAXIVC_RCV_CEO,
			 (SELECT BIZ_ADDR || ' ' ||BIZ_ADDR_DTL FROM TB_BM02M01 WHERE CLNT_CD = T1.CLNT_CD) AS TAXIVC_RCV_ADDR,
			 (SELECT BIZCON_NM FROM TB_BM02M01 WHERE CLNT_CD = T1.CLNT_CD) AS TAXIVC_RCV_BIZCON,
			 (SELECT BSTY_NM FROM TB_BM02M01 WHERE CLNT_CD = T1.CLNT_CD) AS TAXIVC_RCV_BSTY,
			 '1' AS COMII_EM,
			 B.BIZ_TEL_NO AS COMII_TE,
			 B.BIZ_FAX_NO AS COMII_FX,	
			 (SELECT CODE_ETC FROM TB_CM05M01 WHERE CODE_ID = (SELECT CRN_TYP FROM TB_BM02M01 WHERE CLNT_CD = T1.CLNT_CD)) AS CTAIV_BJ_1,
			 B.BANK_CD,
			 FN_CM05M01_CD_TO_NM(B.BANK_CD) AS BANK_NM,
             B.BKAC_NO,
             B.BKAC_OWNER
		FROM (
			SELECT 
				T.CO_CD,
		        T.TAXIVC_COPRT AS TAXIVC_COPRT_CD,
		        (SELECT CODE_ETC FROM TB_CM05M01 WHERE CODE_ID = T.TAXIVC_COPRT) AS TAXIVC_COPRT,
		        T.TRST_CLNT_CD AS CLNT_CD,
		        T.CLNT_NM,
		        T.SELPCH_CD,
		        MAX(T.TRST_DT) AS TRST_DT,	        
		        SUM(T.TRST_QTY) AS TRST_QTY,
		        NVL(SUM(T.TRST_WT), 0) AS TRST_WT,
		        SUM(T.TRST_UPR) AS TRST_UPR,
		        SUM(T.TRST_AMT) AS TRST_AMT,
		        SUM(T.REAL_TRST_QTY) AS REAL_TRST_QTY,
		        SUM(T.REAL_TRST_WT) AS REAL_TRST_WT,
		        SUM(T.REAL_TRST_UPR) AS REAL_TRST_UPR,
		        SUM(T.REAL_TRST_AMT) AS REAL_TRST_AMT,
		        SUM(T.BILG_QTY) AS BILG_QTY,
		        SUM(T.BILG_WT) AS BILG_WT,
		        SUM(T.BILG_UPR) AS BILG_UPR,
		        SUM(T.BILG_AMT) AS BILG_AMT,
		        SUM(T.TRST_DC_AMT) AS TRST_DC_AMT,
				SUM(T.ETC_AMT) AS ETC_AMT,
				SUM(T.TRANS_AMT) AS TRANS_AMT,
				COUNT(*) AS TAX_DMS5_7240,
		        SUM(T.BILG_AMT) AS TAX_MOA5_23,
		        SUM(T.BILG_VAT_AMT) AS TAX_MOA5_124,
		        SUM(T.BILG_AMT) + SUM(T.BILG_VAT_AMT) AS TAX_MOA5_388,
		        SUM(T.BILG_AMT) + SUM(T.BILG_VAT_AMT) AS TAX_MOA5_9,
		        NVL2(MAX(T.ORGN_TAX_BILG_NO), 'RFFGN102', CASE WHEN SUM(T.BILG_AMT) <![CDATA[ < ]]> 0 THEN 'RFFGN102' ELSE 'RFFGN101' END) AS RFF_GN1,
		        'RFFGN201' AS RFF_GN2,
		        MAX(T.ORGN_TAX_BILG_NO) AS ORGN_TAX_BILG_NO,
		       	CASE WHEN SUM(T.BILG_AMT) <![CDATA[ < ]]> 0 THEN 'RFFAEA03' ELSE MAX(T.RFF_AEA) END AS RFF_AEA,
		        'BGM12259' AS BGM_1225,
		        '1' AS BGM_4343,
		        'S' AS XML_FLOW,
		        #{userId} AS TAX_CREAT_ID,
		        #{userNm} AS TAX_CREAT_NM,
		        COUNT(DISTINCT NVL(T.SITE_CD, 0)) AS SITE_CNT,
		        MIN(SD09M01.SITE_NM) AS SITE_NM
			FROM 
				TB_AR02M01 T
				LEFT JOIN TB_SD09M01 SD09M01 ON T.SITE_CD = SD09M01.SITE_CD
			WHERE 
				TRST_CERTI_NO IN
				<foreach item="item" index="index" collection="trstCertiNoList" open="(" close=")" separator=",">
					#{item}
				</foreach>
			GROUP BY T.CO_CD, T.TAXIVC_COPRT, T.TRST_CLNT_CD, T.SELPCH_CD, T.CLNT_NM
		) T1 
		INNER JOIN TB_BM02M01 B ON T1.TAXIVC_COPRT = B.CLNT_CD
	</select>
	
	<select id="selectBilgInfoUpdate" parameterType="Map" resultType="CamelMap">
		SELECT 
			T.CO_CD,
	        T.TAXIVC_COPRT AS TAXIVC_COPRT_CD,
	        (SELECT CODE_ETC FROM TB_CM05M01 WHERE CODE_ID = TAXIVC_COPRT) AS TAXIVC_COPRT,
	        TRST_CLNT_CD AS CLNT_CD,
	        B.CLNT_NM,
	        T.SELPCH_CD,	        
	        SUM(TRST_QTY) AS TRST_QTY,
	        NVL(SUM(TRST_WT), 0) AS TRST_WT,
	        SUM(TRST_UPR) AS TRST_UPR,
	        SUM(TRST_AMT) AS TRST_AMT,
	        SUM(REAL_TRST_QTY) AS REAL_TRST_QTY,
	        SUM(REAL_TRST_WT) AS REAL_TRST_WT,
	        SUM(REAL_TRST_UPR) AS REAL_TRST_UPR,
	        SUM(REAL_TRST_AMT) AS REAL_TRST_AMT,
	        SUM(BILG_QTY) AS BILG_QTY,
	        SUM(BILG_WT) AS BILG_WT,
	        SUM(BILG_UPR) AS BILG_UPR,
	        SUM(BILG_AMT) AS BILG_AMT,
	        SUM(TRST_DC_AMT) AS TRST_DC_AMT,
			SUM(ETC_AMT) AS ETC_AMT,
			SUM(TRANS_AMT) AS TRANS_AMT,
			COUNT(*) AS TAX_DMS5_7240,
	        SUM(BILG_AMT) AS TAX_MOA5_23,
	        SUM(BILG_VAT_AMT) AS TAX_MOA5_124,
	        SUM(BILG_AMT) + SUM(BILG_VAT_AMT) AS TAX_MOA5_388,
			NVL(B.SELL_PAY_DIV_CD, 'PAYDIV02') AS RFF_CNO,
			NVL(B.SELL_VAT_CD, 'VAT01') AS RFF_VA,
	        'RFFGN101' AS RFF_GN1,
	        'RFFGN201' AS RFF_GN2,
	        '' AS RFF_AEA,
	        'BGM12259' AS BGM_1225,
	        '1' AS BGM_4343,
	        'S' AS XML_FLOW,
	        #{bilgCertNo} AS BILG_CERT_NO,
	        #{userId} AS TAX_CREAT_ID,
	        #{userNm} AS TAX_CREAT_NM
		FROM TB_AR02M01 T LEFT OUTER JOIN TB_BM02M01 B
		                              ON T.TRST_CLNT_CD = B.CLNT_CD
		WHERE BILG_CERT_NO = #{bilgCertNo}
		GROUP BY T.CO_CD, T.TAXIVC_COPRT, T.TRST_CLNT_CD, T.SELPCH_CD, B.CLNT_NM, B.SELL_PAY_DIV_CD, B.SELL_VAT_CD
	</select>
	
	<update id="updatePchsSellBilg" parameterType="Map">
		UPDATE TB_AR02M01
		SET BILG_CERT_NO = #{bilgCertNo}
		WHERE TRST_CERTI_NO = #{trstCertiNo}
	</update>
	
	<update id="updateBilgCancel" parameterType="Map">
		UPDATE TB_AR02M01
		SET BILG_CERT_NO = ''
		WHERE BILG_CERT_NO = #{bilgCertNo}
	</update>
	
	<update id="updateSalesClnt" parameterType="Map">
		UPDATE
			TB_AR02M01
		SET
			TRST_CLNT_CD = #{clntCd},
			CLNT_NM = #{clntNm},
			ORGN_TAX_BILG_NO = NULL,
			RFF_AEA = NULL,
			UDT_PGM = #{updatePgmId},
			UDT_DTTM = SYSDATE
		WHERE
			TRST_CERTI_NO = #{trstCertiNo}
	</update>
	
	<update id="updateSalesMng" parameterType="Map">
		UPDATE
			TB_AR02M01
		SET
			SALES_MNG = #{salesMng},
			UDT_ID = #{userId},
			UDT_PGM = #{pgmId},
			UDT_DTTM = SYSDATE
		WHERE
			TRST_RPRC_SEQ = #{trstRprcSeq}
			AND CREAT_PGM = #{pgmId}
	</update>
	
	<update id="updateTrspRmk" parameterType="Map">
		UPDATE
			TB_AR02M01
		SET
			TRSP_RMK = #{trspRmk},
			UDT_ID = #{userId},
			UDT_PGM = #{pgmId},
			UDT_DTTM = SYSDATE
		WHERE
			TRST_RPRC_SEQ = #{trstRprcSeq}
			AND CREAT_PGM = #{pgmId}
			AND SELPCH_CD = #{selpchCd}
	</update>
	
    <select id="callCreditLoan" parameterType="Map" resultType="long">
    	SELECT F_CREDIT_LOAN(#{loanCd}, #{clntCd}, #{coCd}, #{iTrDt}, #{amt}) FROM DUAL
    </select>
    
    <select id="callCreditLoan2" parameterType="Map" resultType="long">
    	SELECT F_CREDIT_LOAN_PRDTGRP(#{loanCd}, #{clntCd}, #{coCd}, #{iPrdtGrp}, #{iTrDt}, #{amt}) FROM DUAL
    </select>
    
    <select id="callCreditNonPayAmt" parameterType="Map" resultType="long">
    	SELECT F_CREDIT_PRDTGRP_NON_PAY_AMT(#{clntCd}, #{coCd}, #{iPrdtGrp}, #{iTrDt}) FROM DUAL
    </select>
    
    <select id="callCreditNonRecvAmt" parameterType="Map" resultType="long">
    	SELECT F_CREDIT_PRDTGRP_NON_RECV_AMT(#{clntCd}, #{coCd}, #{iPrdtGrp}, #{iTrDt}) FROM DUAL
    </select>
    
    <select id="callCreditUnsetlBilAmt" parameterType="Map" resultType="long">
    	SELECT F_CREDIT_PRDTGRP_UNSETL_BIL_AMT(#{clntCd}, #{coCd}, #{iPrdtGrp}, #{iTrDt}) FROM DUAL
    </select>
    
    <select id="checkPldgAmt" parameterType="Map" resultType="long">
		SELECT NVL(SUM(PLDG_AMT*PLDG_RCOGN_RATE/100),0) AS O_CO_AMT
		  FROM TB_BM02D02
		 WHERE CLNT_CD  = #{clntCd}
		   AND CO_CD    = NVL(#{coCd},CO_CD)
		   --AND PLDG_DIV_CD NOT IN ('PLDG03')
		   AND SELPCH_CD = 'SELPCH2'
		   <![CDATA[
		   AND NVL(SETUP_DT,00010101) <= TO_NUMBER(#{iTrDt}) 
		   AND NVL(EXPRTN_DT,99999999) >= TO_NUMBER(#{iTrDt})
		   ]]>
		   AND PRDT_GRP  = #{iPrdtGrp}
		   AND USE_YN    = 'Y'
	</select>
	
    <select id="selectSellSumList" parameterType="Map" resultType="CamelMap">
	    SELECT 		
			FN_CM05M01_CD_TO_NM(B.PRDT_DIV) AS PRDT_DIV_NM,
			FN_CM05M01_CD_TO_NM(B.PRDT_STKN) AS PRDT_STKN_NM,
			A.TRST_PRDT_CD,
			B.PRDT_NM,
			CASE WHEN IMP_YN = 'Y' THEN '수입' ELSE '국산' END IMP_YN,
			FN_CM05M01_CD_TO_NM(A.MAKR_CD) AS MAKR_NM,
			B.PRDT_SPEC,
			A.PRDT_LEN,
			SUM(BILG_QTY) BILG_QTY,
			SUM(BILG_WT) BILG_WT,
		    ROUND( AVG(BILG_UPR),2) BILG_UPR,
		    SUM(BILG_AMT) BILG_AMT,
		    SUM(BILG_VAT_AMT) TAX_AMT
		FROM TB_AR02M01 A INNER JOIN TB_BM01M01 B ON A.TRST_PRDT_CD = B.PRDT_CD
		                  INNER JOIN TB_BM02M01 C ON A.TRST_CLNT_CD = C.CLNT_CD
		                  LEFT OUTER JOIN TB_SD09M01 D ON A.CO_CD = D.CO_CD AND A.SITE_CD = D.SITE_CD
		WHERE SELPCH_CD = #{selpchCd}
		<if test="coCd != null and !coCd.equals('')">
			AND A.CO_CD = #{coCd}				
		</if>
		<if test="reqDtFrom != null and !reqDtFrom.equals('')">
			AND A.TRST_DT BETWEEN #{reqDtFrom} AND #{reqDtTo}		
		</if>
		<if test="prdtDiv != null and !prdtDiv.equals('')">
			AND B.PRDT_DIV = #{prdtDiv}				
		</if>
		<if test="clntCd != null and !clntCd.equals('')">
			AND A.TRST_CLNT_CD = #{clntCd}				
		</if>
		<if test="clntNm != null and !clntNm.equals('')">
			AND C.CLNT_NM LIKE '%${clntNm}%'			
		</if>
		<if test="siteCd != null and !siteCd.equals('')">
			AND A.SITE_CD = #{siteCd}
		</if>
		<if test="siteNm != null and !siteNm.equals('')">
			AND D.SITE_NM LIKE '%${siteNm}%'			
		</if>
		<if test='bilgYn == "Y"'>
			AND A.BILG_CERT_NO IS NOT NULL 		
		</if>
		<if test='bilgYn == "N"'>
			AND A.BILG_CERT_NO IS NULL 		
		</if>
		<if test="typCd != null and !typCd.equals('')">
			AND A.TYP_CD = #{typCd}
		</if>
		<if test="prdtGrp != null and !prdtGrp.equals('')">
			AND B.PRDT_GRP = #{prdtGrp}
		</if>
		<if test="taxivcCoprt != null and !taxivcCoprt.equals('')">
			AND A.TAXIVC_COPRT = #{taxivcCoprt}
		</if>
		<if test="makrCd != null and !makrCd.equals('')">
			AND A.MAKR_CD = #{makrCd}
		</if>
		GROUP BY B.PRDT_DIV, B.PRDT_NM, A.TRST_PRDT_CD, B.PRDT_STKN, IMP_YN, A.MAKR_CD, B.PRDT_SPEC, A.PRDT_LEN
		ORDER BY B.PRDT_DIV, B.PRDT_NM, A.TRST_PRDT_CD, B.PRDT_STKN, IMP_YN, A.MAKR_CD, B.PRDT_SPEC, A.PRDT_LEN
    </select>
	
	<select id="selectOwner1ClntCd" parameterType="Map" resultType="String">
		SELECT 
		(
			SELECT CODE_ETC FROM TB_CM05M01 WHERE CODE_ID = (SELECT CODE_ETC FROM TB_CM05M01 WHERE CODE_ID = #{whCd})
		) AS WH_CLNT_CD FROM DUAL	
	</select>
	
	<select id="selectBilgVatPer" parameterType="Map" resultType="int">
		<if test='selpchCd == "SELPCH1" or selpchCd == "SELPCH3"'>
			SELECT 
				NVL(
						(
							SELECT 
								A.CODE_RPRC 
							FROM 
						    	TB_CM05M01 A 
						        INNER JOIN TB_CM05M01 A2 ON A2.CODE_ID = #{taxivcCoprt}
						        INNER JOIN TB_BM02M01 B ON A.CODE_ID = B.PCHS_VAT_CD AND B.CLNT_CD = A2.CODE_ETC
						)
				,10) AS BILG_VAT_PER
			FROM DUAL	
        </if>
        <if test='selpchCd == "SELPCH2" or selpchCd == "SELPCH4"'>
	        SELECT 
	        	NVL(
	        	       (
			        		SELECT 
			        			CODE_RPRC 
			        		FROM 
			        			TB_CM05M01 A 
			        			INNER JOIN TB_BM02M01 B ON A.CODE_ID = B.SELL_VAT_CD AND B.CLNT_CD = #{clntCd}
			        	)
				,10) AS BILG_VAT_AMT
	        FROM DUAL
        </if>
	</select>

	<select id="selectBilgVatAmt" parameterType="Map" resultType="long">
		<if test='selpchCd == "SELPCH1" or selpchCd == "SELPCH3"'>
	        SELECT 
	        	TRUNC(${realTrstAmt} / 100 * NVL((
	        	SELECT 
	        		A.CODE_RPRC 
	        	FROM 
		        	TB_CM05M01 A 
		            INNER JOIN TB_CM05M01 A2 ON A2.CODE_ID = #{taxivcCoprt}
		            INNER JOIN TB_BM02M01 B ON A.CODE_ID = B.PCHS_VAT_CD AND B.CLNT_CD = A2.CODE_ETC),10)) AS BILG_VAT_AMT
	        FROM DUAL
        </if>
        <if test='selpchCd == "SELPCH2" or selpchCd == "SELPCH4"'>
	        SELECT 
	        	TRUNC(${realTrstAmt} / 100 * NVL((
	        		SELECT 
	        			CODE_RPRC 
	        		FROM 
	        			TB_CM05M01 A 
	        			INNER JOIN TB_BM02M01 B ON A.CODE_ID = B.SELL_VAT_CD AND B.CLNT_CD = #{clntCd}),10)) AS BILG_VAT_AMT
	        FROM DUAL
        </if>
	</select>
	
	<select id="selectSellSaleCount" parameterType="Map" resultType="int">
		SELECT COUNT(*)
		FROM (
			SELECT PCH_CLNT,
					SEL_CLNT,
					(SELECT CLNT_NM FROM TB_BM02M01 BM02 WHERE BM02.CLNT_CD = PCH_CLNT) PCH_CLNT_NM,
					(SELECT CLNT_NM FROM TB_BM02M01 BM02 WHERE BM02.CLNT_CD = SEL_CLNT) SEL_CLNT_NM,
					PRDT_NM,
					<choose>
						<when test='siteDivYn != null and siteDivYn == "Y"'>
							SITE_CD,
							SITE_NM,
						</when>
						<otherwise>
							MAX(SITE_NM) SITE_NM,
						</otherwise>
					</choose>
					MAX(PRDT_SPEC),
					MAX(PRDT_STKN),
					MAX(PRDT_LEN),
					MAX(PCH_TRSP_RMK),
					MAX(SEL_TRSP_RMK),
					MAX(PRDT_STKN_NM),
					MAX(SEL_CLMN),
					SUM(PCH_QTY) PCH_QTY,
					SUM(PCH_WT) PCH_WT,
					SUM(PCH_UPR) PCH_UPR,
					SUM(PCH_AMT) PCH_AMT,
					SUM(PCH_VAT_AMT) PCH_VAT_AMT,
					SUM(SEL_QTY) SEL_QTY,
					SUM(SEL_WT) SEL_WT,
					SUM(SEL_UPR) SEL_UPR,
					SUM(SEL_AMT) SEL_AMT,
					SUM(SEL_VAT_AMT) SEL_VAT_AMT,
					SUM(SEL_AMT)-SUM(PCH_AMT) "이익액",
					max(SEL_CLMN) SEL_CLMN
			FROM
			(
				SELECT
				ROWNUM AS RNUM, A.*
				,(SELECT SITE_NM FROM TB_SD09M01 SD09 WHERE SD09.SITE_CD = A.SITE_CD) SITE_NM
				FROM (SELECT TRST_RPRC_SEQ, TRST_DTL_SEQ, ODR_NO,
						PRDT_NM,
						TRST_PRDT_CD,
						SITE_CD,
						MAX(T.PRDT_SPEC) AS PRDT_SPEC,
						MAX(T.PRDT_STKN) AS PRDT_STKN,
						MAX(T.PRDT_LEN) AS PRDT_LEN,
						MAX(T.PCH_TRSP_RMK) AS PCH_TRSP_RMK,
						MAX(T.SEL_TRSP_RMK) AS SEL_TRSP_RMK,
						DECODE(PRDT_NM,'운반비(철근)','운반비', FN_CM05M01_CD_TO_NM(MAX(T.PRDT_STKN))) AS PRDT_STKN_NM,
						MAX(PCH_CLNT) PCH_CLNT,
						MAX(PCH_CLNT_NM) PCH_CLNT_NM,
						SUM(PCH_QTY) PCH_QTY,
						SUM(PCH_WT) PCH_WT,
						SUM(PCH_UPR) PCH_UPR,
						SUM(PCH_AMT) PCH_AMT,
						SUM(PCH_VAT_AMT) PCH_VAT_AMT,
						MAX(SEL_CLNT) SEL_CLNT,
						MAX(SEL_CLNT_NM) SEL_CLNT_NM,
						SUM(SEL_QTY) SEL_QTY,
						SUM(SEL_WT) SEL_WT,
						SUM(SEL_UPR) SEL_UPR,
						SUM(SEL_AMT) SEL_AMT,
						SUM(SEL_VAT_AMT) SEL_VAT_AMT,
						SUM(SEL_AMT)-SUM(PCH_AMT) "이익액",
						max(SEL_CLMN) SEL_CLMN
						FROM (
							SELECT TRST_RPRC_SEQ, TRST_DTL_SEQ, ODR_NO, TRST_PRDT_CD, SELPCH_CD ,
							TRST_CLNT_CD , BILG_QTY , BILG_WT , BILG_UPR , BILG_AMT , BILG_VAT_AMT,
							A.PRDT_SPEC, A.PRDT_STKN,A.PRDT_LEN, A.SITE_CD,
							decode(SELPCH_CD,'SELPCH1',TRST_CLNT_CD) AS PCH_CLNT,
							decode(SELPCH_CD,'SELPCH1',B.CLNT_NM) AS PCH_CLNT_NM,
							decode(SELPCH_CD,'SELPCH1',BILG_QTY) AS PCH_QTY,
							decode(SELPCH_CD,'SELPCH1',BILG_WT) AS PCH_WT,
							decode(SELPCH_CD,'SELPCH1',BILG_UPR) AS PCH_UPR,
							decode(SELPCH_CD,'SELPCH1',BILG_AMT) AS PCH_AMT,
							decode(SELPCH_CD,'SELPCH1',BILG_VAT_AMT) AS PCH_VAT_AMT,
							decode(SELPCH_CD,'SELPCH1',TRSP_RMK) AS PCH_TRSP_RMK,
							decode(SELPCH_CD,'SELPCH2',TRST_CLNT_CD) AS SEL_CLNT,
							decode(SELPCH_CD,'SELPCH2',B.CLNT_NM) AS SEL_CLNT_NM,
							decode(SELPCH_CD,'SELPCH2',BILG_QTY) AS SEL_QTY,
							decode(SELPCH_CD,'SELPCH2',BILG_WT) AS SEL_WT,
							decode(SELPCH_CD,'SELPCH2',BILG_UPR) AS SEL_UPR,
							decode(SELPCH_CD,'SELPCH2',BILG_AMT) AS SEL_AMT,
							decode(SELPCH_CD,'SELPCH2',BILG_VAT_AMT) AS SEL_VAT_AMT,
							decode(SELPCH_CD,'SELPCH2',TRSP_RMK) AS SEL_TRSP_RMK,
							decode(SELPCH_CD,'SELPCH2',FN_CM05M01_CD_TO_NM(B.SELL_CLMN_DIV_CD)) AS SEL_CLMN,
							decode(SELPCH_CD,'SELPCH2',(SELECT SITE_NM FROM TB_SD09M01 WHERE SITE_CD = A.SITE_CD)) AS SITE_NM
							FROM TB_AR02M01 A INNER JOIN TB_BM02M01 B ON B.CLNT_CD=A.TRST_CLNT_CD
							INNER JOIN TB_BM01M01 D ON A.TRST_PRDT_CD=D.PRDT_CD
							LEFT OUTER JOIN TB_SD09M01 E ON A.CO_CD = E.CO_CD AND A.SITE_CD = E.SITE_CD
							WHERE 1=1
							<if test="coCd != null and !coCd.equals('')">
								AND A.CO_CD = #{coCd}
							</if>
							<if test="reqDtFrom != null and !reqDtFrom.equals('')">
								AND A.TRST_DT BETWEEN #{reqDtFrom} AND #{reqDtTo}
							</if>
							<if test="typCd != null and !typCd.equals('')">
								AND A.TYP_CD = #{typCd}
							</if>
							<if test="prdtDiv != null and !prdtDiv.equals('')">
								AND A.PRDT_DIV = #{prdtDiv}
							</if>
							<if test="taxBilgYn != null and !taxBilgYn.equals('')">
								<choose>
									<when test='taxBilgYn == "Y"'>
										AND #{taxBilgYn} = (SELECT 'Y' FROM TB_AR04M01 AR04 WHERE
										AR04.BILG_CERT_NO = A.BILG_CERT_NO
										AND AR04.TAX_BILG_NO IS NOT NULL AND ROWNUM = 1 )
									</when>
									<otherwise>
										AND #{taxBilgYn} = (SELECT 'N' FROM TB_AR04M01 AR04 WHERE
										AR04.BILG_CERT_NO = A.BILG_CERT_NO
										AND AR04.TAX_BILG_NO IS NULL AND ROWNUM = 1 )
									</otherwise>
								</choose>
							</if>
							<if test="taxivcCoprt != null and !taxivcCoprt.equals('')">
								AND A.TAXIVC_COPRT = #{taxivcCoprt}
							</if>
							) T INNER JOIN TB_BM01M01 B ON TRST_PRDT_CD = B.PRDT_CD
							<where>
								<if test="prdtGrp != null and !prdtGrp.equals('')">
									AND B.PRDT_GRP = #{prdtGrp}
								</if>
							</where>
							GROUP BY TRST_RPRC_SEQ, TRST_DTL_SEQ, ODR_NO, PRDT_NM, TRST_PRDT_CD, SITE_CD
							ORDER BY PCH_CLNT_NM, PRDT_NM, TRST_PRDT_CD, SEL_CLNT_NM
				) A	
				<where>
					<if test="clntCd != null and !clntCd.equals('')">
						AND (PCH_CLNT = #{clntCd} OR SEL_CLNT = #{clntCd})
					</if>
					<if test="clntNm != null and !clntNm.equals('')">
						AND (PCH_CLNT_NM LIKE '%'|| #{clntNm} ||'%' OR SEL_CLNT_NM LIKE
						'%'|| #{clntNm} ||'%')
					</if>
					<if test="siteCd != null and !siteCd.equals('')">
						AND SITE_CD = #{siteCd}
					</if>
				</where>
			)
			<if test="siteNm != null and !siteNm.equals('')">
				WHERE SITE_NM LIKE '%'|| #{siteNm} || '%'
			</if>
			GROUP BY PCH_CLNT,
					 SEL_CLNT,
					 PRDT_NM
					 <if test='siteDivYn != null and siteDivYn == "Y"'>
					 ,SITE_CD
					 ,SITE_NM
					</if>
		)
	</select>
<!-- 
	<select id="selectSellSaleList" parameterType="Map" resultType="CamelMap">
		SELECT
			*
		FROM
		(
			SELECT
				ROWNUM AS RNUM, A.*
			FROM
			(
			SELECT TRST_RPRC_SEQ, TRST_DTL_SEQ, ODR_NO,
					PRDT_NM,
					TRST_PRDT_CD ,
					FN_CM05M01_CD_TO_NM(MAX(PRDT_GRP)) AS PRDT_GRP_NM,
					FN_CM05M01_CD_TO_NM(MAX(PRDT_DIV)) AS PRDT_DIV_NM,
					MAX(ORGN_TAX_BILG_NO) ORGN_TAX_BILG_NO,
					MAX(PCH_CLNT) PCH_CLNT,
					MAX(PCH_CLNT_NM) PCH_CLNT_NM,
					SUM(PCH_QTY) PCH_QTY,
					SUM(PCH_WT) PCH_WT,
					SUM(PCH_UPR) PCH_UPR,
					SUM(PCH_AMT) PCH_AMT,
					SUM(PCH_VAT_AMT) PCH_VAT_AMT,
					MAX(SEL_CLNT) SEL_CLNT,
					MAX(SEL_CLNT_NM) SEL_CLNT_NM,
					SUM(SEL_QTY) SEL_QTY,
					SUM(SEL_WT) SEL_WT,
					SUM(SEL_UPR) SEL_UPR,
					SUM(SEL_AMT) SEL_AMT,
					SUM(SEL_VAT_AMT) SEL_VAT_AMT,
					SUM(SEL_AMT)-SUM(PCH_AMT) "이익액",
					max(SELL_CLMN_DIV_NM) SELL_CLMN_DIV_NM
					<if test='siteDivYn != null and siteDivYn == "Y"'>
					    ,max(SITE_CD) SITE_CD,
						 max(SITE_NM) SITE_NM
					</if>
		FROM (
			SELECT TRST_RPRC_SEQ, TRST_DTL_SEQ, ODR_NO, TRST_PRDT_CD, SELPCH_CD , ORGN_TAX_BILG_NO,
					TRST_CLNT_CD , BILG_QTY , BILG_WT , BILG_UPR , BILG_AMT ,
					BILG_VAT_AMT,
					decode(SELPCH_CD,'SELPCH1',TRST_CLNT_CD) AS PCH_CLNT,
					decode(SELPCH_CD,'SELPCH1',B.CLNT_NM) AS PCH_CLNT_NM,
					decode(SELPCH_CD,'SELPCH1',BILG_QTY) AS PCH_QTY,
					decode(SELPCH_CD,'SELPCH1',BILG_WT) AS PCH_WT,
					decode(SELPCH_CD,'SELPCH1',BILG_UPR) AS PCH_UPR,
					decode(SELPCH_CD,'SELPCH1',BILG_AMT) AS PCH_AMT,
					decode(SELPCH_CD,'SELPCH1',BILG_VAT_AMT) AS PCH_VAT_AMT,
					decode(SELPCH_CD,'SELPCH2',TRST_CLNT_CD) AS SEL_CLNT,
					decode(SELPCH_CD,'SELPCH2',B.CLNT_NM) AS SEL_CLNT_NM,
					decode(SELPCH_CD,'SELPCH2',BILG_QTY) AS SEL_QTY,
					decode(SELPCH_CD,'SELPCH2',BILG_WT) AS SEL_WT,
					decode(SELPCH_CD,'SELPCH2',BILG_UPR) AS SEL_UPR,
					decode(SELPCH_CD,'SELPCH2',BILG_AMT) AS SEL_AMT,
					decode(SELPCH_CD,'SELPCH2',BILG_VAT_AMT) AS SEL_VAT_AMT,
					decode(SELPCH_CD,'SELPCH2',FN_CM05M01_CD_TO_NM(B.SELL_CLMN_DIV_CD)) AS SELL_CLMN_DIV_NM
					<if test='siteDivYn != null and siteDivYn == "Y"'>
					   ,A.SITE_CD,
						(SELECT SITE_NM FROM TB_SD09M01 WHERE SITE_CD = A.SITE_CD) SITE_NM
					</if>
			FROM TB_AR02M01 A 
				LEFT OUTER JOIN TB_BM02M01 B ON B.CLNT_CD=A.TRST_CLNT_CD
				LEFT OUTER JOIN TB_SD09M01 C ON C.SITE_CD=A.SITE_CD
			WHERE 1=1
			<if test= "coCd != null and !coCd.equals('')">
					AND A.CO_CD = #{coCd}
			</if>
			<if test="reqDtFrom != null and !reqDtFrom.equals('')">
				AND A.TRST_DT BETWEEN #{reqDtFrom} AND #{reqDtTo}
			</if>
			<if test="typCd != null and !typCd.equals('')">
				AND A.TYP_CD = #{typCd}
			</if>
			<if test="prdtDiv != null and !prdtDiv.equals('')">
				AND A.PRDT_DIV = #{prdtDiv}
			</if>
			<if test="taxBilgYn != null and !taxBilgYn.equals('')">
				<choose>
					<when test='taxBilgYn == "Y"'>
					   AND #{taxBilgYn} = (SELECT 'Y' FROM  TB_AR04M01 AR04 WHERE AR04.BILG_CERT_NO = A.BILG_CERT_NO 
					                                                        AND   AR04.TAX_BILG_NO IS NOT NULL AND  ROWNUM = 1 )
						AND ORGN_TAX_BILG_NO IS NOT NULL
					</when>
					<otherwise>
					 AND #{taxBilgYn} = (SELECT 'N' FROM  TB_AR04M01 AR04 WHERE AR04.BILG_CERT_NO = A.BILG_CERT_NO 
					                                                        AND   AR04.TAX_BILG_NO IS  NULL AND  ROWNUM = 1 )
					                                                        
						AND ORGN_TAX_BILG_NO IS NULL
					</otherwise>
				</choose>
			</if>
			<if test="taxivcCoprt != null and !taxivcCoprt.equals('')">
				AND A.TAXIVC_COPRT = #{taxivcCoprt}
			</if>
		) T
		INNER JOIN TB_BM01M01 B ON TRST_PRDT_CD = B.PRDT_CD
			<where>
				<if test="prdtGrp != null and !prdtGrp.equals('')">
					B.PRDT_GRP = #{prdtGrp}
				</if>
			</where>
			GROUP BY TRST_RPRC_SEQ, TRST_DTL_SEQ, ODR_NO,PRDT_NM,TRST_PRDT_CD
			HAVING 1 = 1
				<if test="clntCd != null and !clntCd.equals('')">
					AND (MAX(PCH_CLNT) = #{clntCd} OR MAX(SEL_CLNT) = #{clntCd})
				</if>
				
				<if test="clntNm != null and !clntNm.equals('')">
					AND (MAX(PCH_CLNT_NM)  LIKE '%'|| #{clntNm} ||'%'  OR MAX(SEL_CLNT_NM) LIKE '%'|| #{clntNm} ||'%')
				</if>
				<if test="siteCd != null and !siteCd.equals('')">
					AND MAX(SITE_CD) = #{siteCd}
				</if>
				<if test="siteNm != null and !siteNm.equals('')">
					AND MAX(SITE_NM) LIKE '%'|| #{siteNm} || '%'
				</if>
				ORDER BY 
				<if test='siteDivYn != null and siteDivYn == "Y"'>
					SITE_CD, 
				</if>
			PRDT_GRP_NM, PRDT_DIV_NM
					) A
		)
		<if test='pageYn != null and pageYn.equals("Y")'>
		WHERE
			RNUM BETWEEN #{firstIndex} AND #{lastIndex}
		</if>
	</select>   -->

	<select id="selectSellSaleList" parameterType="Map" resultType="CamelMap">
		SELECT
				PCH_CLNT,
				SEL_CLNT,
				(SELECT CLNT_NM FROM TB_BM02M01 BM02 WHERE BM02.CLNT_CD = PCH_CLNT) PCH_CLNT_NM,
				(SELECT CLNT_NM FROM TB_BM02M01 BM02 WHERE BM02.CLNT_CD = SEL_CLNT) SEL_CLNT_NM,
				PRDT_NM,
				<choose>
					<when test='siteDivYn != null and siteDivYn == "Y"'>
						SITE_CD,
						SITE_NM,
					</when>
					<otherwise>
						MAX(SITE_NM) SITE_NM,
					</otherwise>
				</choose>
				MAX(PRDT_SPEC),
				MAX(PRDT_STKN),
				MAX(PRDT_LEN),
				MAX(PCH_TRSP_RMK),
				MAX(SEL_TRSP_RMK),
				MAX(PRDT_STKN_NM),
				MAX(SEL_CLMN),
				SUM(PCH_QTY) PCH_QTY,
				SUM(PCH_WT) PCH_WT,
				SUM(PCH_UPR) PCH_UPR,
				SUM(PCH_AMT) PCH_AMT,
				SUM(PCH_VAT_AMT) PCH_VAT_AMT,
				SUM(SEL_QTY) SEL_QTY,
				SUM(SEL_WT) SEL_WT,
				SUM(SEL_UPR) SEL_UPR,
				SUM(SEL_AMT) SEL_AMT,
				SUM(SEL_VAT_AMT) SEL_VAT_AMT,
				SUM(SEL_AMT)-SUM(PCH_AMT) "이익액",
				max(SEL_CLMN) SEL_CLMN
		FROM
		(
			SELECT
			ROWNUM AS RNUM, A.*
			FROM (SELECT TRST_RPRC_SEQ, TRST_DTL_SEQ, ODR_NO,
					PRDT_NM,
					TRST_PRDT_CD,
					SITE_CD,
					(SELECT SITE_NM FROM TB_SD09M01 SD09 WHERE SD09.SITE_CD = T.SITE_CD) SITE_NM,
					MAX(T.PRDT_SPEC) AS PRDT_SPEC,
					MAX(T.PRDT_STKN) AS PRDT_STKN,
					MAX(T.PRDT_LEN) AS PRDT_LEN,
					MAX(T.PCH_TRSP_RMK) AS PCH_TRSP_RMK,
					MAX(T.SEL_TRSP_RMK) AS SEL_TRSP_RMK,
					DECODE(PRDT_NM,'운반비(철근)','운반비', FN_CM05M01_CD_TO_NM(MAX(T.PRDT_STKN))) AS PRDT_STKN_NM,
					MAX(PCH_CLNT) PCH_CLNT,
					MAX(PCH_CLNT_NM) PCH_CLNT_NM,
					SUM(PCH_QTY) PCH_QTY,
					SUM(PCH_WT) PCH_WT,
					SUM(PCH_UPR) PCH_UPR,
					SUM(PCH_AMT) PCH_AMT,
					SUM(PCH_VAT_AMT) PCH_VAT_AMT,
					MAX(SEL_CLNT) SEL_CLNT,
					MAX(SEL_CLNT_NM) SEL_CLNT_NM,
					SUM(SEL_QTY) SEL_QTY,
					SUM(SEL_WT) SEL_WT,
					SUM(SEL_UPR) SEL_UPR,
					SUM(SEL_AMT) SEL_AMT,
					SUM(SEL_VAT_AMT) SEL_VAT_AMT,
					SUM(SEL_AMT)-SUM(PCH_AMT) "이익액",
					max(SEL_CLMN) SEL_CLMN
					FROM (
						SELECT TRST_RPRC_SEQ, TRST_DTL_SEQ, ODR_NO, TRST_PRDT_CD, SELPCH_CD ,
						TRST_CLNT_CD , BILG_QTY , BILG_WT , BILG_UPR , BILG_AMT , BILG_VAT_AMT,
						A.PRDT_SPEC, A.PRDT_STKN,A.PRDT_LEN, A.SITE_CD,
						decode(SELPCH_CD,'SELPCH1',TRST_CLNT_CD) AS PCH_CLNT,
						decode(SELPCH_CD,'SELPCH1',B.CLNT_NM) AS PCH_CLNT_NM,
						decode(SELPCH_CD,'SELPCH1',BILG_QTY) AS PCH_QTY,
						decode(SELPCH_CD,'SELPCH1',BILG_WT) AS PCH_WT,
						decode(SELPCH_CD,'SELPCH1',BILG_UPR) AS PCH_UPR,
						decode(SELPCH_CD,'SELPCH1',BILG_AMT) AS PCH_AMT,
						decode(SELPCH_CD,'SELPCH1',BILG_VAT_AMT) AS PCH_VAT_AMT,
						decode(SELPCH_CD,'SELPCH1',TRSP_RMK) AS PCH_TRSP_RMK,
						decode(SELPCH_CD,'SELPCH2',TRST_CLNT_CD) AS SEL_CLNT,
						decode(SELPCH_CD,'SELPCH2',B.CLNT_NM) AS SEL_CLNT_NM,
						decode(SELPCH_CD,'SELPCH2',BILG_QTY) AS SEL_QTY,
						decode(SELPCH_CD,'SELPCH2',BILG_WT) AS SEL_WT,
						decode(SELPCH_CD,'SELPCH2',BILG_UPR) AS SEL_UPR,
						decode(SELPCH_CD,'SELPCH2',BILG_AMT) AS SEL_AMT,
						decode(SELPCH_CD,'SELPCH2',BILG_VAT_AMT) AS SEL_VAT_AMT,
						decode(SELPCH_CD,'SELPCH2',TRSP_RMK) AS SEL_TRSP_RMK,
						decode(SELPCH_CD,'SELPCH2',FN_CM05M01_CD_TO_NM(B.SELL_CLMN_DIV_CD)) AS SEL_CLMN,
						decode(SELPCH_CD,'SELPCH2',(SELECT SITE_NM FROM TB_SD09M01 WHERE SITE_CD = A.SITE_CD)) AS SITE_NM
						FROM TB_AR02M01 A INNER JOIN TB_BM02M01 B ON B.CLNT_CD=A.TRST_CLNT_CD
						INNER JOIN TB_BM01M01 D ON A.TRST_PRDT_CD=D.PRDT_CD
						LEFT OUTER JOIN TB_SD09M01 E ON A.CO_CD = E.CO_CD AND A.SITE_CD = E.SITE_CD
						WHERE 1=1
						<if test="coCd != null and !coCd.equals('')">
							AND A.CO_CD = #{coCd}
						</if>
						<if test="reqDtFrom != null and !reqDtFrom.equals('')">
							AND A.TRST_DT BETWEEN #{reqDtFrom} AND #{reqDtTo}
						</if>
						<if test="typCd != null and !typCd.equals('')">
							AND A.TYP_CD = #{typCd}
						</if>
						<if test="prdtDiv != null and !prdtDiv.equals('')">
							AND A.PRDT_DIV = #{prdtDiv}
						</if>
						<if test="taxBilgYn != null and !taxBilgYn.equals('')">
							<choose>
								<when test='taxBilgYn == "Y"'>
									AND #{taxBilgYn} = (SELECT 'Y' FROM TB_AR04M01 AR04 WHERE
									AR04.BILG_CERT_NO = A.BILG_CERT_NO
									AND AR04.TAX_BILG_NO IS NOT NULL AND ROWNUM = 1 )
								</when>
								<otherwise>
									AND #{taxBilgYn} = (SELECT 'N' FROM TB_AR04M01 AR04 WHERE
									AR04.BILG_CERT_NO = A.BILG_CERT_NO
									AND AR04.TAX_BILG_NO IS NULL AND ROWNUM = 1 )
								</otherwise>
							</choose>
						</if>
						<if test="taxivcCoprt != null and !taxivcCoprt.equals('')">
							AND A.TAXIVC_COPRT = #{taxivcCoprt}
						</if>
						) T INNER JOIN TB_BM01M01 B ON TRST_PRDT_CD = B.PRDT_CD
						<where>
							<if test="prdtGrp != null and !prdtGrp.equals('')">
								AND B.PRDT_GRP = #{prdtGrp}
							</if>
						</where>
						GROUP BY TRST_RPRC_SEQ, TRST_DTL_SEQ, ODR_NO, PRDT_NM, TRST_PRDT_CD, SITE_CD
						ORDER BY PCH_CLNT_NM, PRDT_NM, TRST_PRDT_CD, SEL_CLNT_NM
				) A	
				<where>
					<if test="clntCd != null and !clntCd.equals('')">
						AND (PCH_CLNT = #{clntCd} OR SEL_CLNT = #{clntCd})
					</if>
					<if test="clntNm != null and !clntNm.equals('')">
						AND (PCH_CLNT_NM LIKE '%'|| #{clntNm} ||'%' OR SEL_CLNT_NM LIKE
						'%'|| #{clntNm} ||'%')
					</if>
					<if test="siteCd != null and !siteCd.equals('')">
						AND SITE_CD = #{siteCd}
					</if>
					<if test="siteNm != null and !siteNm.equals('')">
						AND SITE_NM LIKE '%'|| #{siteNm} || '%'
					</if>
				</where>
			)
			WHERE 1=1
			<if test='pageYn != null and pageYn.equals("Y")'>
				AND RNUM BETWEEN #{firstIndex} AND #{lastIndex}
			</if>
			GROUP BY PCH_CLNT,
					 SEL_CLNT,
					 PRDT_NM
					 <if test='siteDivYn != null and siteDivYn == "Y"'>
					 ,SITE_CD
					 ,SITE_NM
					</if>
	</select>  

	<select id="selectSellPchSumCount" parameterType="Map" resultType="int">
	 	SELECT 
			COUNT(*)
		FROM
			(
				WITH TT AS 
				(
					SELECT T.CO_CD, T.TAXIVC_COPRT, T.SELPCH_CD, T.TRST_CLNT_CD, T.CLNT_NM,  
							SUBSTR(T.TRST_DT,1,6) yymm, sum(T.BILG_AMT+T.BILG_VAT_AMT) BILG_TOT_AMT, count(*) cnt
					  FROM TB_AR02M01 T
								LEFT JOIN TB_BM01M01 BM01M01 ON T.TRST_PRDT_CD = BM01M01.PRDT_CD
								LEFT JOIN TB_SD09M01 SD09M01 ON T.SITE_CD = SD09M01.SITE_CD
								LEFT JOIN TB_CM06M01 CM06M01 ON T.SALES_MNG = CM06M01.ID
	 				 WHERE 
			 				T.SELPCH_CD = #{selpchCd}
							<if test="coCd != null and !coCd.equals('')">
								AND T.CO_CD = #{coCd}				
							</if>
							<if test="searchYear != null and !searchYear.equals('')">
								AND T.TRST_DT BETWEEN #{searchYear}||'0101' AND #{searchYear}||'1231'		
							</if>
							<if test="clntCd != null and !clntCd.equals('')">
								AND T.TRST_CLNT_CD = #{clntCd}
							</if>
							<if test="clntNm != null and !clntNm.equals('')">
								AND T.CLNT_NM LIKE '%${clntNm}%'
							</if>
							<if test="prdtDiv != null and !prdtDiv.equals('')">
								AND T.PRDT_DIV = #{prdtDiv}				
							</if>
							<if test="taxivcCoprt != null and !taxivcCoprt.equals('')">
								AND T.TAXIVC_COPRT = #{taxivcCoprt}				
							</if>
							<if test="dirtrsYn != null and !dirtrsYn.equals('')">
								AND T.DIRTRS_YN = #{dirtrsYn}				
							</if>
							<if test="typCd != null and !typCd.equals('')">
								AND T.TYP_CD = #{typCd}				
							</if>
							<if test="prjctCd != null and !prjctCd.equals('')">
								AND T.PRJCT_CD = #{prjctCd}				
							</if>
							<if test="siteCd != null and !siteCd.equals('')">
								AND T.SITE_CD = #{siteCd}				
							</if>
							<if test="siteNm != null and !siteNm.equals('')">
								AND SD09M01.SITE_NM LIKE '%'|| #{siteNm} || '%'				
							</if>
							<if test="pdsk != null and !pdsk.equals('')">
								AND T.PRDT_STKN = #{pdsk}				
							</if>
							<if test="bilgYn != null and !bilgYn.equals('')">
								<choose>
									<when test='bilgYn == "Y"'>
										AND T.BILG_CERT_NO IS NOT NULL 		
									</when>
									<otherwise>
										AND T.BILG_CERT_NO IS NULL 
									</otherwise>
								</choose>
							</if>
							<if test="salesMng != null and !salesMng.equals('')">
								AND T.SALES_MNG = #{salesMng}				
							</if>
							<if test="salesMngNm != null and !salesMngNm.equals('')">
								AND CM06M01.NAME LIKE '%'|| #{salesMngNm} || '%'				
							</if>
							<if test="whCd != null and !whCd.equals('')">
								AND T.WH_CD = #{whCd}
							</if>
							<if test="trspRmk != null and !trspRmk.equals('')">
								AND T.TRSP_RMK LIKE '%'|| #{trspRmk} || '%'
							</if>
							<if test="prdtGrp != null and !prdtGrp.equals('')">
								AND BM01M01.PRDT_GRP = #{prdtGrp}
							</if>
							<if test="trspTypCd != null and !trspTypCd.equals('')">
								AND T.TRSP_TYP_CD = #{trspTypCd}
							</if>	   
						 GROUP BY T.CO_CD, T.TAXIVC_COPRT, T.SELPCH_CD, T.TRST_CLNT_CD, T.CLNT_NM, SUBSTR(T.TRST_DT,1,6)
					)
					SELECT CO_CD, TAXIVC_COPRT, SELPCH_CD, TRST_CLNT_CD, CLNT_NM, sum(BILG_TOT_AMT) TOT_AMT, sum(CNT) TOT_CNT,
						sum(CASE WHEN substr(yymm,5,2) = 01 THEN  BILG_TOT_AMT ELSE 0 END) "01월합계", 
						sum(CASE WHEN substr(yymm,5,2) = 02 THEN  BILG_TOT_AMT ELSE 0 END) "02월합계", 
						sum(CASE WHEN substr(yymm,5,2) = 03 THEN  BILG_TOT_AMT ELSE 0 END) "03월합계", 
						sum(CASE WHEN substr(yymm,5,2) = 04 THEN  BILG_TOT_AMT ELSE 0 END) "04월합계", 
						sum(CASE WHEN substr(yymm,5,2) = 05 THEN  BILG_TOT_AMT ELSE 0 END) "05월합계", 
						sum(CASE WHEN substr(yymm,5,2) = 06 THEN  BILG_TOT_AMT ELSE 0 END) "06월합계", 
						sum(CASE WHEN substr(yymm,5,2) = 07 THEN  BILG_TOT_AMT ELSE 0 END) "07월합계", 
						sum(CASE WHEN substr(yymm,5,2) = 08 THEN  BILG_TOT_AMT ELSE 0 END) "08월합계", 
						sum(CASE WHEN substr(yymm,5,2) = 09 THEN  BILG_TOT_AMT ELSE 0 END) "09월합계", 
						sum(CASE WHEN substr(yymm,5,2) = 10 THEN  BILG_TOT_AMT ELSE 0 END) "10월합계", 
						sum(CASE WHEN substr(yymm,5,2) = 11 THEN  BILG_TOT_AMT ELSE 0 END) "11월합계", 
						sum(CASE WHEN substr(yymm,5,2) = 12 THEN  BILG_TOT_AMT ELSE 0 END) "12월합계", 
						sum(CASE WHEN substr(yymm,5,2) = 01 THEN  cnt ELSE 0 END) "01월건수", 
						sum(CASE WHEN substr(yymm,5,2) = 02 THEN  cnt ELSE 0 END) "02월건수", 
						sum(CASE WHEN substr(yymm,5,2) = 03 THEN  cnt ELSE 0 END) "03월건수", 
						sum(CASE WHEN substr(yymm,5,2) = 04 THEN  cnt ELSE 0 END) "04월건수", 
						sum(CASE WHEN substr(yymm,5,2) = 05 THEN  cnt ELSE 0 END) "05월건수", 
						sum(CASE WHEN substr(yymm,5,2) = 06 THEN  cnt ELSE 0 END) "06월건수", 
						sum(CASE WHEN substr(yymm,5,2) = 07 THEN  cnt ELSE 0 END) "07월건수", 
						sum(CASE WHEN substr(yymm,5,2) = 08 THEN  cnt ELSE 0 END) "08월건수", 
						sum(CASE WHEN substr(yymm,5,2) = 09 THEN  cnt ELSE 0 END) "09월건수", 
						sum(CASE WHEN substr(yymm,5,2) = 10 THEN  cnt ELSE 0 END) "10월건수", 
						sum(CASE WHEN substr(yymm,5,2) = 11 THEN  cnt ELSE 0 END) "11월건수", 
						sum(CASE WHEN substr(yymm,5,2) = 12 THEN  cnt ELSE 0 END) "12월건수"	
					FROM TT
					GROUP BY CO_CD, TAXIVC_COPRT, SELPCH_CD, TRST_CLNT_CD, CLNT_NM
					ORDER BY CO_CD, TAXIVC_COPRT, SELPCH_CD, TRST_CLNT_CD, CLNT_NM
		)
	</select>
	
	<select id="selectSellPchSumList" parameterType="Map" resultType="CamelMap">
		SELECT
			*
		FROM
		(
			SELECT
				A.*,
				ROWNUM AS RNUM
			FROM
			(
				WITH TT AS 
				(
					SELECT T.CO_CD, T.TAXIVC_COPRT, T.SELPCH_CD, T.TRST_CLNT_CD, T.CLNT_NM,  
							SUBSTR(T.TRST_DT,1,6) yymm, sum(T.BILG_AMT+T.BILG_VAT_AMT) BILG_TOT_AMT, count(*) cnt
					  FROM TB_AR02M01 T
								LEFT JOIN TB_BM01M01 BM01M01 ON T.TRST_PRDT_CD = BM01M01.PRDT_CD
								LEFT JOIN TB_SD09M01 SD09M01 ON T.SITE_CD = SD09M01.SITE_CD
								LEFT JOIN TB_CM06M01 CM06M01 ON T.SALES_MNG = CM06M01.ID
	 				 WHERE 
			 				T.SELPCH_CD = #{selpchCd}
							<if test="coCd != null and !coCd.equals('')">
								AND T.CO_CD = #{coCd}				
							</if>
							<if test="searchYear != null and !searchYear.equals('')">
								AND T.TRST_DT BETWEEN #{searchYear}||'0101' AND #{searchYear}||'1231'		
							</if>
							<if test="clntCd != null and !clntCd.equals('')">
								AND T.TRST_CLNT_CD = #{clntCd}
							</if>
							<if test="clntNm != null and !clntNm.equals('')">
								AND T.CLNT_NM LIKE '%${clntNm}%'
							</if>
							<if test="prdtDiv != null and !prdtDiv.equals('')">
								AND T.PRDT_DIV = #{prdtDiv}				
							</if>
							<if test="taxivcCoprt != null and !taxivcCoprt.equals('')">
								AND T.TAXIVC_COPRT = #{taxivcCoprt}				
							</if>
							<if test="dirtrsYn != null and !dirtrsYn.equals('')">
								AND T.DIRTRS_YN = #{dirtrsYn}				
							</if>
							<if test="typCd != null and !typCd.equals('')">
								AND T.TYP_CD = #{typCd}				
							</if>
							<if test="prjctCd != null and !prjctCd.equals('')">
								AND T.PRJCT_CD = #{prjctCd}				
							</if>
							<if test="siteCd != null and !siteCd.equals('')">
								AND T.SITE_CD = #{siteCd}				
							</if>
							<if test="siteNm != null and !siteNm.equals('')">
								AND SD09M01.SITE_NM LIKE '%'|| #{siteNm} || '%'				
							</if>
							<if test="pdsk != null and !pdsk.equals('')">
								AND T.PRDT_STKN = #{pdsk}				
							</if>
							<if test="bilgYn != null and !bilgYn.equals('')">
								<choose>
									<when test='bilgYn == "Y"'>
										AND T.BILG_CERT_NO IS NOT NULL 		
									</when>
									<otherwise>
										AND T.BILG_CERT_NO IS NULL 
									</otherwise>
								</choose>
							</if>
							<if test="salesMng != null and !salesMng.equals('')">
								AND T.SALES_MNG = #{salesMng}				
							</if>
							<if test="salesMngNm != null and !salesMngNm.equals('')">
								AND CM06M01.NAME LIKE '%'|| #{salesMngNm} || '%'				
							</if>
							<if test="whCd != null and !whCd.equals('')">
								AND T.WH_CD = #{whCd}
							</if>
							<if test="trspRmk != null and !trspRmk.equals('')">
								AND T.TRSP_RMK LIKE '%'|| #{trspRmk} || '%'
							</if>
							<if test="prdtGrp != null and !prdtGrp.equals('')">
								AND BM01M01.PRDT_GRP = #{prdtGrp}
							</if>
							<if test="trspTypCd != null and !trspTypCd.equals('')">
								AND T.TRSP_TYP_CD = #{trspTypCd}
							</if>	   
						 GROUP BY T.CO_CD, T.TAXIVC_COPRT, T.SELPCH_CD, T.TRST_CLNT_CD, T.CLNT_NM, SUBSTR(T.TRST_DT,1,6)
					)
					SELECT CO_CD, TAXIVC_COPRT, FN_CM05M01_CD_TO_NM(TAXIVC_COPRT) AS TAXIVC_COPRT_NM, 
						SELPCH_CD, TRST_CLNT_CD, CLNT_NM, round(sum(BILG_TOT_AMT)/#{searchItem}) TOT_AMT, sum(CNT) TOT_CNT,
						round(sum(CASE WHEN substr(yymm,5,2) = 01 THEN  BILG_TOT_AMT ELSE 0 END)/#{searchItem}) "01월합계", 
						round(sum(CASE WHEN substr(yymm,5,2) = 02 THEN  BILG_TOT_AMT ELSE 0 END)/#{searchItem}) "02월합계", 
						round(sum(CASE WHEN substr(yymm,5,2) = 03 THEN  BILG_TOT_AMT ELSE 0 END)/#{searchItem}) "03월합계", 
						round(sum(CASE WHEN substr(yymm,5,2) = 04 THEN  BILG_TOT_AMT ELSE 0 END)/#{searchItem}) "04월합계", 
						round(sum(CASE WHEN substr(yymm,5,2) = 05 THEN  BILG_TOT_AMT ELSE 0 END)/#{searchItem}) "05월합계", 
						round(sum(CASE WHEN substr(yymm,5,2) = 06 THEN  BILG_TOT_AMT ELSE 0 END)/#{searchItem}) "06월합계", 
						round(sum(CASE WHEN substr(yymm,5,2) = 07 THEN  BILG_TOT_AMT ELSE 0 END)/#{searchItem}) "07월합계", 
						round(sum(CASE WHEN substr(yymm,5,2) = 08 THEN  BILG_TOT_AMT ELSE 0 END)/#{searchItem}) "08월합계", 
						round(sum(CASE WHEN substr(yymm,5,2) = 09 THEN  BILG_TOT_AMT ELSE 0 END)/#{searchItem}) "09월합계", 
						round(sum(CASE WHEN substr(yymm,5,2) = 10 THEN  BILG_TOT_AMT ELSE 0 END)/#{searchItem}) "10월합계", 
						round(sum(CASE WHEN substr(yymm,5,2) = 11 THEN  BILG_TOT_AMT ELSE 0 END)/#{searchItem}) "11월합계", 
						round(sum(CASE WHEN substr(yymm,5,2) = 12 THEN  BILG_TOT_AMT ELSE 0 END)/#{searchItem}) "12월합계", 
						sum(CASE WHEN substr(yymm,5,2) = 01 THEN  cnt ELSE 0 END) "01월건수", 
						sum(CASE WHEN substr(yymm,5,2) = 02 THEN  cnt ELSE 0 END) "02월건수", 
						sum(CASE WHEN substr(yymm,5,2) = 03 THEN  cnt ELSE 0 END) "03월건수", 
						sum(CASE WHEN substr(yymm,5,2) = 04 THEN  cnt ELSE 0 END) "04월건수", 
						sum(CASE WHEN substr(yymm,5,2) = 05 THEN  cnt ELSE 0 END) "05월건수", 
						sum(CASE WHEN substr(yymm,5,2) = 06 THEN  cnt ELSE 0 END) "06월건수", 
						sum(CASE WHEN substr(yymm,5,2) = 07 THEN  cnt ELSE 0 END) "07월건수", 
						sum(CASE WHEN substr(yymm,5,2) = 08 THEN  cnt ELSE 0 END) "08월건수", 
						sum(CASE WHEN substr(yymm,5,2) = 09 THEN  cnt ELSE 0 END) "09월건수", 
						sum(CASE WHEN substr(yymm,5,2) = 10 THEN  cnt ELSE 0 END) "10월건수", 
						sum(CASE WHEN substr(yymm,5,2) = 11 THEN  cnt ELSE 0 END) "11월건수", 
						sum(CASE WHEN substr(yymm,5,2) = 12 THEN  cnt ELSE 0 END) "12월건수"	
					FROM TT
					GROUP BY CO_CD, TAXIVC_COPRT, SELPCH_CD, TRST_CLNT_CD, CLNT_NM
					ORDER BY CO_CD, TAXIVC_COPRT, SELPCH_CD, TRST_CLNT_CD, CLNT_NM

			) A
		)
		<if test='pageYn != null and pageYn.equals("Y")'>
			WHERE
				RNUM BETWEEN #{firstIndex} AND #{lastIndex}
		</if>
	</select>
	
	<select id="callSaleMatch" parameterType="Map">
		{call PL_AR05_ETRDPS_SALES_MATCH_AR02(
				#{coCd, jdbcType=VARCHAR},
				#{clntCd, jdbcType=VARCHAR},
				#{prdtGrp, jdbcType=VARCHAR}
			)
		}
	</select>
		
	<select id="countSell" parameterType="Map" resultType="int">
		SELECT COUNT(*) FROM TB_AR05D02
			WHERE TRST_CERTI_NO = '0'
			AND ETRDPS_SEQ = (SELECT ETRDPS_SEQ FROM TB_AR05D02 WHERE TRST_CERTI_NO = #{trstCertiNo} GROUP BY ETRDPS_SEQ)
	</select>
	
	<select id="countSellFind" parameterType="Map" resultType="int">
		SELECT COUNT(*) FROM TB_AR05D02
			WHERE TRST_CERTI_NO = '0'
			AND ETRDPS_SEQ = #{etrdpsSeqFind}
	</select>
	
	<select id="countSellList" parameterType="Map" resultType="Map">
		SELECT ETRDPS_SEQ FROM TB_AR05D02 WHERE TRST_CERTI_NO = #{trstCertiNo} GROUP BY ETRDPS_SEQ
	</select>
	
	<select id="selectTrstCertiNo" parameterType="Map" resultType="Map">
		SELECT 
			TRST_CERTI_NO
				FROM 
					TB_AR02M01
						WHERE TRST_RPRC_SEQ = #{trstRprcSeq}
						  AND TRST_DTL_SEQ = #{trstDtlSeq}
						  AND CREAT_PGM = #{pgmId}
						  <if test="selpchCd != null and !selpchCd.equals('')">
							  AND SELPCH_CD     = #{selpchCd}
						  </if>
	</select>
	
	
	<update id="updateOrgItemODSH1" parameterType="Map">
		UPDATE 
			TB_OD01D01
				SET 
					ORDRG_UPR = #{bilgUpr},
					ORDRG_AMT = #{bilgUpr} * (SELECT ORDRG_QTY FROM TB_OD01D01 WHERE ORDRG_SEQ = #{trstRprcSeq} AND ORDRG_DTL_SEQ = #{trstDtlSeq})
					
					WHERE 1=1 
						AND ORDRG_SEQ = #{trstRprcSeq}
						AND ORDRG_DTL_SEQ = #{trstDtlSeq};
	</update>
	
	<update id="updateOrgItemODSH2" parameterType="Map">
		UPDATE 
			TB_OD01D01
				SET 
					SHIP_UPR = #{bilgUpr},
					SHIP_AMT = #{bilgUpr} * (SELECT ORDRG_QTY FROM TB_OD01D01 WHERE ORDRG_SEQ = #{trstRprcSeq} AND ORDRG_DTL_SEQ = #{trstDtlSeq})
					
					WHERE 1=1 
						AND ORDRG_SEQ = #{trstRprcSeq}
						AND ORDRG_DTL_SEQ = #{trstDtlSeq};
	</update>
	
	<update id="updateOrgItemAR" parameterType="Map">
		UPDATE 
			TB_AR01D01 
				SET 
					SHIP_UPR = #{bilgUpr},
					SHIP_AMT = #{bilgUpr} * (SELECT SHIP_QTY FROM TB_AR01D01 WHERE SHIP_SEQ = #{trstRprcSeq} AND SHIP_DTL_SEQ = #{trstDtlSeq}),
					REAL_SHIP_AMT = #{bilgUpr} * (SELECT SHIP_QTY FROM TB_AR01D01 WHERE SHIP_SEQ = #{trstRprcSeq} AND SHIP_DTL_SEQ = #{trstDtlSeq})
				
					WHERE 1=1 
						AND SHIP_SEQ = #{trstRprcSeq}
						AND SHIP_DTL_SEQ = #{trstDtlSeq};
	</update>
	
	<update id="updateOrgMainOD" parameterType="Map">
		UPDATE 
			TB_OD01M01 
				SET TOT_AMT = (SELECT SUM(ORDRG_AMT) FROM TB_OD01D01 WHERE ORDRG_SEQ = #{trstRprcSeq})
					WHERE ORDRG_SEQ = #{trstRprcSeq}
	</update>
	
	<update id="updateOrgMainAR" parameterType="Map">
		UPDATE 
			TB_AR01M01
				SET   
					  SHIP_TOT_AMT = (SELECT SUM(SHIP_AMT) FROM TB_AR01D01 WHERE SHIP_SEQ = #{trstRprcSeq})
					, REAL_TOT_AMT = (SELECT SUM(SHIP_AMT) FROM TB_AR01D01 WHERE SHIP_SEQ = #{trstRprcSeq} AND SHIP_YN = 'Y')
					WHERE SHIP_SEQ = #{trstRprcSeq}
	</update>
	
</mapper>