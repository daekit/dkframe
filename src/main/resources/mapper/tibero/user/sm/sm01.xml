<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.dksys.biz.user.sm.sm01.mapper.SM01Mapper">

	<select id="selectStockListCount" parameterType="Map" resultType="int">
		SELECT COUNT(*)
		FROM TB_SM01M01 A, TB_BM01M01 C 
		WHERE  A.PRDT_CD = C.PRDT_CD
				<if test="coCd != null and !coCd.equals('')">
				AND A.CO_CD = #{coCd}
				</if>
				<if test="whCd != null and !whCd.equals('')">
				 		AND A.WH_CD = #{whCd}
				 </if>
				 <if test="ownerCd != null and !ownerCd.equals('')">
						AND A.OWNER_CD = #{ownerCd}
				</if>
				<if test="typCd != null and !typCd.equals('')">
						AND A.TYP_CD = #{typCd}
				</if>
				<if test="makrCd != null and !makrCd.equals('')">
						AND A.MAKR_CD = #{makrCd}
				</if>
				<if test="prdtNm != null and !prdtNm.equals('')">
						AND C.PRDT_NM LIKE '%' || #{prdtNm} || '%'
				</if>
				
	</select>

	 <select id="selectStockList" parameterType="Map" resultType="CamelMap">
		SELECT *
		FROM (
			SELECT
				ROWNUM AS RNUM, D.*
			FROM(
				SELECT A.CO_CD
						, NVL((SELECT B.CODE_NM FROM TB_CM05M01 B WHERE A.CO_CD = B.CODE_ID), A.CO_CD) AS CO_NM
						, A.WH_CD
						, NVL((SELECT B.CODE_NM FROM TB_CM05M01 B WHERE A.WH_CD = B.CODE_ID), A.WH_CD) AS WH_NM
						, A.OWNER_CD
						, NVL((SELECT B.CODE_NM FROM TB_CM05M01 B WHERE A.OWNER_CD = B.CODE_ID), A.OWNER_CD) AS OWNER_NM
						, A.TYP_CD
						, NVL((SELECT B.CODE_NM FROM TB_CM05M01 B WHERE A.TYP_CD = B.CODE_ID), A.TYP_CD) AS TYP_NM
						, A.MAKR_CD
						, NVL((SELECT B.CODE_NM FROM TB_CM05M01 B WHERE A.MAKR_CD = B.CODE_ID), A.MAKR_CD) AS MAKR_NM
						, A.PRDT_CD
				     	, C.PRDT_NM
					    , A.IMP_YN
						, NVL((SELECT B.CODE_NM FROM TB_CM05M01 B WHERE A.IMP_YN = B.CODE_ID), A.IMP_YN) AS IMP_NM
						, A.STOCK_AMT
						, A.STOCK_QTY
						, A.STOCK_UPR
						, A.STD_UPR
						, A.PCHS_UPR 
						, A.SELL_UPR 
						, E.CLNT_NM
						, TO_CHAR(A.UDT_DTTM, 'YYYY-MM-DD') AS UDT_DTTM 
				FROM TB_SM01M01 A, TB_BM01M01 C, TB_BM02M01 E
				WHERE  A.PRDT_CD = C.PRDT_CD
				AND A.CLNT_CD = E.CLNT_CD
				<if test="coCd != null and !coCd.equals('')">
						AND A.CO_CD = #{coCd}
						</if>
						<if test="whCd != null and !whCd.equals('')">
						 		AND A.WH_CD = #{whCd}
						 </if>
						 <if test="ownerCd != null and !ownerCd.equals('')">
								AND A.OWNER_CD = #{ownerCd}
						</if>
						<if test="typCd != null and !typCd.equals('')">
								AND A.TYP_CD = #{typCd}
						</if>
						<if test="makrCd != null and !makrCd.equals('')">
								AND A.MAKR_CD = #{makrCd}
						</if>
						<if test="prdtNm != null and !prdtNm.equals('')">
								AND C.PRDT_NM LIKE '%' || #{prdtNm} || '%'
						</if>
						<if test="clntNm != null and !clntNm.equals('')">
								AND E.CLNT_NM LIKE '%' || #{clntNm} || '%'
						</if>
						
				ORDER BY UDT_DTTM DESC
			)D
		)
		WHERE
			RNUM BETWEEN #{firstIndex} AND #{lastIndex} 
	</select>
	

	
</mapper>