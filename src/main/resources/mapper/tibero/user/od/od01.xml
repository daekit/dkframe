<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.dksys.biz.user.od.od01.mapper.OD01Mapper">

	<insert id="insertOrder" parameterType="Map">
		<selectKey keyProperty="ordrgSeq" resultType="String" order="BEFORE">
			SELECT TB_OD01M01_SQ01.NEXTVAL FROM DUAL
		</selectKey>
		INSERT INTO TB_OD01M01
		(
			CO_CD,
		    REQ_DT,
		    CLNT_CD,
		    ORDRG_SEQ,
		    PRJCT_CD,
		    MAKR_CD,
		    WH_CD,
		    TYP_CD,
		    OWNER_CD,
		    IMP_YN,
		    SALES_AREA_CD,
		    SELL_CLNT_CD,
		    MNG_TEL,
		    DLVR_DTTM,
<!-- 		    DLVR_RMK, -->
		    DIRTRS_YN,
		    ADDR_ZIP,
		    ADDR_MAIN,
		    ADDR_SUB,
		    ORDRG_RMK,
		    TOT_QTY,
		    TOT_WT,
		    TOT_AMT,
		    TRANS_AMT,
		    ODR_SEQ,
<!-- 		    PCHS_NO, -->
		    SALES_MNG,
		    ORDRG_YN,
<!-- 		    ORDRG_PROC_ID, -->
<!-- 		    ORDRG_PROC_DTTM, -->
<!-- 		    ETC_FIELD1, -->
<!-- 		    ETC_FIELD2, -->
<!-- 		    ETC_FIELD3, -->
		    CREAT_ID,
		    CREAT_PGM,
		    CREAT_DTTM,
		    UDT_ID,
		    UDT_PGM,
		    UDT_DTTM
	    ) 
	    VALUES
	    (
	    	#{coCd},
		    #{reqDt},
		    #{clntCd},
		    #{ordrgSeq},
		    #{prjctCd},
		    #{makrCd},
		    #{whCd},
		    #{typCd},
		    #{ownerCd},
		    #{impYn},
		    #{salesAreaCd},
		    #{sellClntCd},
		    #{mngTel},
		    #{dlvrDttm},
<!-- 		    #{}, -->
		    #{dirtrsYn},
		    #{addrZip},
		    #{addrMain},
		    #{addrSub},
		    #{ordrgRmk},
		    #{totQty},
		    #{totWt},
		    #{totAmt},
		    #{transAmt},
		    #{odrSeq},
<!-- 		    PCHS_NO, -->
		    #{salesMng},
		    'N',
<!-- 		    ORDRG_PROC_ID, -->
<!-- 		    ORDRG_PROC_DTTM, -->
<!-- 		    ETC_FIELD1, -->
<!-- 		    ETC_FIELD2, -->
<!-- 		    ETC_FIELD3, -->
		    #{userId},
		    #{pgmId},
		    SYSDATE,
		    #{userId},
		    #{pgmId},
		    SYSDATE
	    )
	</insert>
	
	<select id="selectOrderCount" parameterType="Map" resultType="int">
		SELECT 
	 		COUNT(*) 
	 	FROM TB_OD01M01
	 	WHERE 1=1
	 		AND REQ_DT BETWEEN #{reqDtFrom} AND #{reqDtTo}	
	 	<if test="coCd != null and !coCd.equals('')">
			AND CO_CD = #{coCd}				
		</if>
		<if test="ownerCd != null and !ownerCd.equals('')">
			AND OWNER_CD = #{ownerCd}			
		</if>
		<if test="typCd != null and !typCd.equals('')">
			AND TYP_CD = #{typCd}				
		</if>
		<if test="clntCd != null and !clntCd.equals('')">
			AND CLNT_CD = #{clntCd}				
		</if>
		<if test="dirtrsYn != null and !dirtrsYn.equals('')">
			AND DIRTRS_YN = #{dirtrsYn}				
		</if>
	</select>
	
	<select id="selectOrderList" parameterType="Map" resultType="camelMap">
		SELECT * FROM (
			SELECT 
				 ROWNUM RNUM
				,T.*
				,TO_CHAR(TO_DATE(REQ_DT), 'YYYY-MM-DD') REQ_DT2
				,(SELECT CLNT_NM FROM TB_BM02M01 WHERE CLNT_CD = T.CLNT_CD) AS CLNT_NM
				,(SELECT PRJCT_NM FROM TB_SD05M01 WHERE PRJCT_CD = T.PRJCT_CD) AS PRJCT_NM
				,FN_CM05M01_CD_TO_NM(T.SELL_CLNT_CD) AS SELL_CLNT_NM
				,FN_CM05M01_CD_TO_NM(T.MAKR_CD) AS MAKR_NM
				,FN_CM05M01_CD_TO_NM(T.TYP_CD) AS TYP_NM
				,FN_CM05M01_CD_TO_NM(T.WH_CD) AS WH_NM
				,ADDR_MAIN || ' ' || ADDR_SUB AS ADDR
				,DECODE(ORDRG_YN||DIRTRS_YN, 'YY', 'Y', 'N') AS SELL_YN
				,(SELECT NAME FROM TB_CM06M01 WHERE ID = T.SALES_MNG) AS SALES_MNG_NM
			FROM 
			(
			 	SELECT * FROM TB_OD01M01
			 	WHERE 1=1
			 		AND REQ_DT BETWEEN #{reqDtFrom} AND #{reqDtTo}
			 	<if test="coCd != null and !coCd.equals('')">
					AND CO_CD = #{coCd}				
				</if>
				<if test="ownerCd != null and !ownerCd.equals('')">
					AND OWNER_CD = #{ownerCd}			
				</if>
				<if test="typCd != null and !typCd.equals('')">
					AND TYP_CD = #{typCd}				
				</if>
				<if test="clntCd != null and !clntCd.equals('')">
					AND CLNT_CD = #{clntCd}				
				</if>
				<if test="dirtrsYn != null and !dirtrsYn.equals('')">
					AND DIRTRS_YN = #{dirtrsYn}				
				</if>
				ORDER BY UDT_DTTM DESC
			) T
		)
		WHERE RNUM BETWEEN ${firstIndex} AND ${lastIndex}
	</select>
	
	<delete id="deleteOrder" parameterType="Map">
		DELETE FROM TB_OD01M01
		WHERE ORDRG_SEQ = #{ordrgSeq}
	</delete>
	
	<delete id="deleteOrderDetail" parameterType="Map">
		DELETE FROM TB_OD01D01
		WHERE ORDRG_SEQ = #{ordrgSeq}
	</delete>
	
	<insert id="insertOrderDetail" parameterType="Map">
		<selectKey keyProperty="ordrgDtlSeq" resultType="String" order="BEFORE">
			SELECT TB_OD01D01_SQ01.NEXTVAL FROM DUAL
		</selectKey>
		INSERT INTO TB_OD01D01
		(
			ORDRG_SEQ,
	        ORDR_DTL_SEQ,
	        PRDT_CD,
	        PRDT_UNIT,
	        PRDT_LEN,
	        ORDRG_QTY,
	        ORDRG_WT,
	        ORDRG_UPR,
	        ORDRG_AMT,
<!-- 	        REAL_DLVR_QTY, -->
<!-- 	        REAL_DLVR_WT, -->
<!-- 	        REAL_DLVR_AMT, -->
<!-- 	        SELL_UPR, -->
<!-- 	        PCHS_UPR, -->
	        STOCK_UPR,
	        PRDT_UPR,
<!-- 	        PCHS_CERTI_NO, -->
	        ORDRG_YN,
<!-- 	        ORDRG_PROC_ID, -->
<!-- 	        ORDRG_PROC_DTTM, -->
	        ORDRG_DTL_RMK,
<!-- 	        ETC_FIELD1, -->
<!-- 	        ETC_FIELD2, -->
<!-- 	        ETC_FIELD3, -->
	        CREAT_ID,
	        CREAT_PGM,
	        CREAT_DTTM,
	        UDT_ID,
	        UDT_PGM,
	        UDT_DTTM
        ) 
        VALUES
        (
        	#{ordrgSeq},
	        #{ordrgDtlSeq},
	        #{prdtCd},
	        #{prdtUnit},
	        #{prdtLen},
	        #{ordrgQty},
	        #{ordrgWt},
	        #{ordrgUpr},
	        #{ordrgAmt},
<!-- 	        REAL_DLVR_QTY, -->
<!-- 	        REAL_DLVR_WT, -->
<!-- 	        REAL_DLVR_AMT, -->
<!-- 	        SELL_UPR, -->
<!-- 	        PCHS_UPR, -->
	        #{stockUpr},
	        #{prdtUpr},
<!-- 	        PCHS_CERTI_NO, -->
	        'N',
<!-- 	        ORDRG_PROC_ID, -->
<!-- 	        ORDRG_PROC_DTTM, -->
	        #{ordrgDtlRmk},
<!-- 	        ETC_FIELD1, -->
<!-- 	        ETC_FIELD2, -->
<!-- 	        ETC_FIELD3, -->
	        #{userId},
		    #{pgmId},
		    SYSDATE,
		    #{userId},
		    #{pgmId},
		    SYSDATE
        )
	</insert>
	
	<select id="selectOrderInfo" parameterType="Map" resultType="camelMap">
		SELECT 
			T.*,
			(SELECT CLNT_NM FROM TB_BM02M01 WHERE CLNT_CD = T.CLNT_CD) AS CLNT_NM,
			(SELECT PRJCT_NM FROM TB_SD05M01 WHERE PRJCT_CD = T.PRJCT_CD) AS PRJCT_NM,
			(SELECT NAME FROM TB_CM06M01 WHERE ID = T.SALES_MNG) AS SALES_MNG_NM 
		FROM TB_OD01M01 T
		WHERE REQ_DT = #{reqDt} AND ORDRG_SEQ = #{ordrgSeq}
	</select>
	
	<select id="selectOrderDetail" parameterType="Map" resultType="camelMap">
		SELECT 
			T.*,
			(SELECT PRDT_NM FROM TB_BM01M01 WHERE PRDT_CD = T.PRDT_CD) AS PRDT_NM
		FROM TB_OD01D01 T
		WHERE ORDRG_SEQ = #{ordrgSeq}
	</select>
	
	<update id="updateOrder" parameterType="Map">
		UPDATE TB_OD01M01
		SET
<!-- 			CO_CD                  = #{coCd}, -->
<!-- 		    REQ_DT                 = #{reqDt}, -->
		    CLNT_CD                = #{clntCd},                      
<!-- 		    ORDRG_SEQ              = #{ordrgSeq},                     -->
		    PRJCT_CD               = #{prjctCd},                     
		    MAKR_CD                = #{makrCd},                      
		    WH_CD                  = #{whCd},                        
		    TYP_CD                 = #{typCd},                       
		    OWNER_CD               = #{ownerCd},                     
		    IMP_YN                 = #{impYn},                       
		    SALES_AREA_CD          = #{salesAreaCd},                 
		    SELL_CLNT_CD           = #{sellClntCd},                  
		    MNG_TEL                = #{mngTel},                      
		    DLVR_DTTM              = #{dlvrDttm},                    
<!-- 		    DLVR_RMK        = #{dlvrRmk}, -->                    
		    DIRTRS_YN              = #{dirtrsYn},                    
		    ADDR_ZIP               = #{addrZip},                     
		    ADDR_MAIN              = #{addrMain},                    
		    ADDR_SUB               = #{addrSub},                     
		    ORDRG_RMK              = #{ordrgRmk},                    
		    TOT_QTY                = #{totQty},                      
		    TOT_WT                 = #{totWt},                       
		    TOT_AMT                = #{totAmt},                      
		    TRANS_AMT              = #{transAmt},                    
		    ODR_SEQ                = #{odrSeq},                      
<!-- 		    PCHS_NO         =     PCHS_NO, -->                
		    SALES_MNG              = #{salesMng},                    
<!-- 		    ORDRG_YN               = 'N',                             -->
<!-- 		    ORDRG_PROC_ID   =     ORDRG_PROC_ID, -->          
<!-- 		    ORDRG_PROC_DTTM =     ORDRG_PROC_DTTM, -->        
<!-- 		    ETC_FIELD1      =     ETC_FIELD1, -->             
<!-- 		    ETC_FIELD2      =     ETC_FIELD2, -->             
<!-- 		    ETC_FIELD3      =     ETC_FIELD3, -->             
		    UDT_ID                 = #{userId},                      
		    UDT_PGM                = #{pgmId},                       
		    UDT_DTTM                = SYSDATE                         
		WHERE REQ_DT = #{reqDt} AND ORDRG_SEQ = #{ordrgSeq}
	</update>
	
</mapper>